!function(){define("deferLink",["jquery"],function(a){"use strict";function b(a){return function(b){return c.call(this,b,a)}}function c(b,c){function d(){var a=+e.data(h)-1;e.data(h,a),a<=0&&!e.data(j)&&(e.removeData(i),k.location.href=l)}var e="A"===this.nodeName?a(this):a(b.target).closest("a"),l=e.attr("href"),m=e.attr("target"),n=e.length&&l&&1===b.which&&!b.metaKey&&!b.shiftKey,o=c;if(a.isFunction(c)&&(o=c.call(this,b),o===!1))return!1;n&&b.isDefaultPrevented()&&!e.data(h)&&(n=!1),n&&m&&"_self"!==m&&(n=!1),n&&g&&e.is("[download]")&&(n=!1),n&&e.hasClass(f)&&(n=!1);var p=+(e.data(h)||0);n&&(e.data(h,p+1),o.when?("resolved"===o.state()&&d(),o.done(d)):a.isNumeric(o)?k.setTimeout(d,o):(n=!1,e.data(h,p))),n&&!p&&(b.preventDefault(),e.data(i,!0))}function d(d){return d.when||a.isNumeric(d)||a.isFunction(d)?b(d):void c.call(this,d,e)}var e=50,f="no-defer",g="download"in document.createElement("a"),h="defer-link-pends",i="defer-link-preventable",j="defer-link-prevented",k=window,l=a.Event.prototype.preventDefault;return a.Event.prototype.preventDefault=function(){var b=a(this.target);return b.data(i)&&b.data(j,!0),l.apply(this,Array.prototype.slice.call(arguments))},d}),define("utils/ted",[],function(){"use strict";return function(a){return window.TED?window.TED[a]:""}}),define("lib/browserDetect",["exports"],function(a){"use strict";function b(a){for(var b=0;b<a.length;b++){var c=a[b].string,e=a[b].prop;if(d=a[b].versionSearch||a[b].identity,c){if(c.indexOf(a[b].subString)!==-1)return a[b].identity}else if(e)return a[b].identity}}function c(a){var b=a.indexOf(d);if(b!==-1)return parseFloat(a.substring(b+d.length+1))}var d,e=window.navigator,f=[{string:e.userAgent,subString:"Chrome",identity:"Chrome"},{string:e.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:e.userAgent,subString:"Firefox",identity:"Firefox"},{string:e.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:e.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"}];a.browser=b(f)||"Unknown Browser",a.version=c(window.navigator.userAgent)||c(window.navigator.appVersion)||"Unknown Version"}),function(a){"use strict";var b=function(a,c,d){return 1===arguments.length?b.get(a):b.set(a,c,d)};b._document=document,b._navigator=navigator,b.defaults={path:"/"},b.get=function(a){return b._cachedDocumentCookie!==b._document.cookie&&b._renewCache(),b._cache[a]},b.set=function(c,d,e){return e=b._getExtendedOptions(e),e.expires=b._getExpiresDate(d===a?-1:e.expires),b._document.cookie=b._generateCookieString(c,d,e),b},b.expire=function(c,d){return b.set(c,a,d)},b._getExtendedOptions=function(c){return{path:c&&c.path||b.defaults.path,domain:c&&c.domain||b.defaults.domain,expires:c&&c.expires||b.defaults.expires,secure:c&&c.secure!==a?c.secure:b.defaults.secure}},b._isValidDate=function(a){return"[object Date]"===Object.prototype.toString.call(a)&&!isNaN(a.getTime())},b._getExpiresDate=function(a,c){switch(c=c||new Date,typeof a){case"number":a=new Date(c.getTime()+1e3*a);break;case"string":a=new Date(a)}if(a&&!b._isValidDate(a))throw new Error("`expires` parameter cannot be converted to a valid Date instance");return a},b._generateCookieString=function(a,b,c){a=encodeURIComponent(a),b=(b+"").replace(/[^!#$&-+\--:<-\[\]-~]/g,encodeURIComponent),c=c||{};var d=a+"="+b;return d+=c.path?";path="+c.path:"",d+=c.domain?";domain="+c.domain:"",d+=c.expires?";expires="+c.expires.toGMTString():"",d+=c.secure?";secure":""},b._getCookieObjectFromString=function(c){for(var d={},e=c?c.split("; "):[],f=0;f<e.length;f++){var g=b._getKeyValuePairFromCookieString(e[f]);d[g.key]===a&&(d[g.key]=g.value)}return d},b._getKeyValuePairFromCookieString=function(a){var b=a.indexOf("=");return b=b<0?a.length:b,{key:decodeURIComponent(a.substr(0,b)),value:decodeURIComponent(a.substr(b+1))}},b._renewCache=function(){b._cache=b._getCookieObjectFromString(b._document.cookie),b._cachedDocumentCookie=b._document.cookie},b._areEnabled=function(){return b._navigator.cookieEnabled||"1"===b.set("cookies.js",1).get("cookies.js")},b.enabled=b._areEnabled(),"function"==typeof define&&define.amd?define("Cookies",[],function(){return b}):"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.Cookies=b):window.Cookies=b}(),define("lib/currentUserId",["Cookies"],function(a){"use strict";var b="_ted_user_id";return{get:function(){return a.get(b)}}}),define("lib/errorCollector",["jquery","lodash","lib/browserDetect","lib/currentUserId","utils/ted","exports"],function(a,b,c,d,e,f){"use strict";var g=window&&window.console;f.postUnthrottled=function(b){a.post("https://error-collector.ted.com/",{message:b})},f.post=b.throttle(f.postUnthrottled,5e3),f.log=function(b,h){if(h=a.extend({error:!0,message:b,context:"js",uri:window.location.href,throttled:!0,client_name:c.browser,client_version:c.version,elapsed_seconds:Math.floor((+new Date-e("startTime"))/1e3),profile_id:d.get()||"N/A",user_agent:window.navigator?window.navigator.userAgent:"Unknown User Agent"},h||{}),f[h.throttled?"post":"postUnthrottled"](h),g&&g.log){var i=h.error?"#FCF1CC":"#999999";g.log("%c"+b,"color:"+i)}}}),define("lib/ga-cookie",["Cookies"],function(a){"use strict";var b="_ga",c={};return c.get=function(){return a.get(b)},c.getClientId=function(){var a=String(c.get()),b=a.split(".")[2]+"."+a.split(".")[3];return b.indexOf("undefined")===-1?b:void 0},c}),define("lib/source-context",["Cookies","exports"],function(a,b){"use strict";b.key="sourceContext",b.get=function(){var c=a.get(b.key);if(c)return c;var d=b.getReferrer();if(""===d)return"direct";var e=b.getLocation(),f=b.extractHost(d),g=b.extractHost(e);return f===g?"internal":"external"},b.set=function(c,d){var e=b.extractPath(c);e&&a.set(b.key,d,{expires:30,path:e})},b.extractHost=function(a){var b=String(a).match(/^\w+:\/\/([^\/]+)/);return b&&b[1]},b.extractPath=function(a){var b=String(a).match(/^(?:\w+:)?(?:\/\/[^\/]+)?((?:\/[^?\/#]+)+)/);return b&&b[1]},b.getReferrer=function(){return document&&document.referrer||""},b.getLocation=function(){return location&&location.href||""}}),define("utils/applyAll",["jquery"],function(a){"use strict";function b(c,d,e){var f,g;for(f=0,g=d.length;f<g;f++)a.isArray(d[f])?b(c,d[f],e):d[f].apply(c,e)}return b}),define("utils/throwError",[],function(){"use strict";return function(a){throw new Error("Error in TED: "+a)}}),define("lib/pubSub",["jquery","utils/applyAll","utils/throwError"],function(a,b,c){"use strict";function d(a){var d={publish:a.fire,subscribe:a.add,unsubscribe:a.remove},e=null;a.add(function(a){e=a}),d.read=function(){return e};var f;return d.publishUnique=function(){if(!window.JSON)return c("JSON object not available. You may need to shim it on this client."),!1;var b=Array.prototype.slice.call(arguments,0),d=JSON.stringify(b);d!==f&&(a.fire.apply(a,b),f=d)},d.once=function(){function c(){b(a,d,arguments),a.remove(c)}var d=arguments;return a.add(c)},d.future=function(){function c(){f&&b(a,e,arguments)}var d,e=arguments,f=!1;return d=a.add(c),f=!0,d},d}function e(b){var c,e=b&&f[b];return e||(c=a.Callbacks("memory"),e=d(c),b&&(f[b]=e)),e}var f={};return e._reset=function(){f={}},e}),define("lib/resize",["jquery","lodash","lib/pubSub"],function(a,b,c){"use strict";function d(a){for(var b,d=m;d--;)!b&&a>=l[d].at&&(b=l[d].its);c("sizeGroup").publishUnique(b)}function e(){var a=0,b=k;if(f=window.innerHeight,g=window.innerWidth||document.documentElement.clientWidth,j)a=i;else for(;b--;)!a&&g>=h[b]&&(a=h[b]);c("breakpoint").publishUnique(a),c("height").publishUnique(f),c("width").publishUnique(g)}var f,g,h=[320,480,600,768,1024,1200],i=1024,j=a("html").is(".oldie"),k=h.length,l=[{at:0,its:"oh"},{at:480,its:"xs"},{at:768,its:"sm"},{at:1024,its:"lg"}],m=l.length;return a(window).on("resize",b.throttle(e,100)),e(),c("breakpoint").subscribe(d),c}),define("lib/ga",["jquery","lodash","deferLink","utils/ted","lib/errorCollector","lib/ga-cookie","lib/currentUserId","lib/source-context","lib/pubSub","lib/resize"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(){var b=t[t.GoogleAnalyticsObject]||a.noop,c=s.slice.call(arguments);b===t.__gaIn||42===b.answer?b.apply(t,c):u.push(c)}function k(){var a=s.slice.call(arguments),d=this;return function(e){if(d.apply(j,a),b.has(e,"originalEvent")&&b.has(this,"nodeName")&&"click"===e.type)return c.call(this,e)}}function l(){var a,b=0;i("breakpoint").subscribe(function(c){j.setDimension("breakpoint",c),b++&&j.sendEvent("breakpoint","change",a+"|"+c,b),a=c})}function m(){var a=f.getClientId();a&&j.setDimension("gaClientId",a);var b=g.get();b&&j.setDimension("tedUserId",b),i("auth.login").subscribe(function(a){j.setDimension("tedUserId",a.id)})}function n(a){var b=a&&a.get&&a.get("hitType"),c=h.get();return"pageview"===b&&c&&j.setDimension("sourceContext",c),a}function o(b){var c=a(this),d="ga-",e=a.extend(b||{},{category:c.data(d+"category"),action:c.data(d+"action"),label:c.data(d+"label")});j.sendEvent(e.category,e.action,e.label);var f=c.data(d+"context");f&&j.setContext(c.attr("href"),f)}function p(a){(new Image).src="https://"+("production"===d("env")?"www":"master.roadrunner")+".ted.com/collect?"+a.get("hitPayload")}function q(a){var b=a.get("buildHitTask");b&&a.set("buildHitTask",function(a){return b(n(a))})}var r=!1,s=[],t=window,u=[];return b.assign(j,{send:b.partial(j,"send"),set:b.partial(j,"set"),sendEvent:b.partial(j,"send","event"),sendSocial:b.partial(j,"send","social"),sendNonInteraction:b.partialRight(b.partial(j,"send","event"),{nonInteraction:1})},function(a,b){return b.recall=k,b}),j.sendPageview=function(){j.send("pageview")},j.sendVirtualPageview=function(a){j.set("page",a+(a.indexOf("?")===-1?"?":"&")+"vp="),j.sendPageview()},j.sendTiming=function(a,c,f,g){if(b.isUndefined(f)&&(f=new Date),f&&f.constructor===Date){var h=d("headReady");if(h&&h.constructor!==Date)return void e.log("GA: headReady timing is missing");f=+f-+h}j("send","timing",a,c,f,g)},j.setContext=function(a,b){h.set(a,b)},j.setDimension=function(a,b){var c=String(a);c.match(/^dimension\d+$/)||(c=(d("gaDimensions")||{})[c]),c?j.set(c,b):e.log('GA: missing dimension: "'+a+'"')},t.setTimeout(function(){var b=t[t.GoogleAnalyticsObject];if(r&&(b===t.__gaIn||42!==b.answer)){try{b=t[t.GoogleAnalyticsObject]=t.__gaIn,s.push.apply(b.q,u),b.q.splice(1,0,["set","sendHitTask",p])}catch(a){}a.ajax({cache:!0,dataType:"script",url:"/collect/001.js"})}},500),j(q),l(),m(),j.sendPageview(),a(function(){a(document).on("click","a.ga-link",c(function(){return o.call(this,{action:"click",category:"site.link",label:this.href}),50}))}),j}),define("utils/is_mobile",[],function(){"use strict";function a(){return a.isIOS()||a.isAndroid()}function b(b){return!!a.ua.match(b)}var c=/Android/g,d=/(iPad|iPhone|iPod)/g;return a.isIOS=function(){return b(d)},a.isAndroid=function(){return b(c)},a.ua=window.navigator&&window.navigator.userAgent||"",a}),define("lib/instaplay",["jquery","utils/is_mobile","exports"],function(a,b,c){"use strict";var d="instaplay",e=50,f=15e3;c.capable=function(){return!b()&&this._storage()},c.set=function(b,d){if(c.capable()){var e=c._getStore()||{history:[]};d=a.extend({clearHistory:!0},d||{}),e.url=b,e.time=+new Date,d.clearHistory&&(e.history=[]),c._setStore(e)}},c.check=function(a){if(!c.capable())return!1;var b=c._getStore();return b&&a.indexOf(b.url)!==-1&&+new Date-b.time<f?(b.history=b.history.slice(0,e-1),b.history.push(a),c._setStore(b),!0):(c._clearStore(),!1)},c.history=function(){if(!c.capable())return[];var a=c._getStore();return a?a.history:[]},c.recentMatches=function(a){if(!c.capable())return[];var b=c.history(),d=b.length,e=[];if(d)for(var f=0;f<d&&b[f].match(a);f++)e.push(b[f]);return e},c._getStore=function(){var a=c._storage();if(a){var b=a.getItem(d);if(b&&(b=window.JSON.parse(b),b&&b.url&&b.history&&b.time))return b}},c._setStore=function(a){var b=c._storage();b&&b.setItem(d,window.JSON.stringify(a))},c._clearStore=function(){var a=c._storage();a&&a.removeItem(d)},c._storage=function(){try{var a=window.sessionStorage,b=d+"-test",c="1";if(a.setItem(b,c),a.getItem(b)===c)return a.removeItem(b),a}catch(a){}return null},a(function(){a(document).on("click","a.instaplay-link",function(){c.set(a(this).attr("href"))})})}),define("hbs/underscore",{}),function(window){var JSON=window.JSON||{};!function(){"use strict";function f(a){return a<10?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;c<f;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;c<f;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;d<c;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),define("hbs/json2",[],function(){return JSON})}.call(this,this),define("hbs",{load:function(a){throw new Error("Dynamic load not allowed: "+a)}}),define("utils/formatDuration",[],function(){"use strict";function a(a){return(a>9?"":"0")+a}return function(b){var c=b%60|0,d=b/3600|0,e=b%3600/60|0;return(d?d+":"+a(e):e)+":"+a(c)}}),define("templates/helpers/formatDuration",["Handlebars","utils/formatDuration"],function(a,b){"use strict";a.registerHelper("formatDuration",b)}),define("hbs!templates/thumb",["hbs","hbs/handlebars","templates/helpers/formatDuration"],function(a,b){var c=b.template({1:function(a,b,c,d){return'    <span class="thumb__duration">\n      '+this.escapeExpression((b.formatDuration||a&&a.formatDuration||b.helperMissing).call(a,null!=a?a.playDuration:a,{name:"formatDuration",hash:{},data:d}))+"\n    </span>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f;return'\n<span class="thumb thumb--'+this.escapeExpression((f=null!=(f=b.ratio||(null!=a?a.ratio:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"ratio",hash:{},data:d}):f))+" "+this.escapeExpression((f=null!=(f=b.cropClass||(null!=a?a.cropClass:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"cropClass",hash:{},data:d}):f))+'">\n  <span class="thumb__sizer"><span class="thumb__tugger"><img src="'+this.escapeExpression((f=null!=(f=b.src||(null!=a?a.src:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"src",hash:{},data:d}):f))+'" class="thumb__image" alt=""><span class="thumb__aligner"></span></span></span>\n\n'+(null!=(e=b.if.call(a,null!=a?a.playDuration:a,{name:"if",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+"</span>\n"},useData:!0});return b.registerPartial("templates/thumb",c),c}),define("templates/helpers/thumb",["Handlebars","hbs!templates/thumb"],function(a,b){"use strict";a.registerHelper("thumb",function(c,d,e){var f=!!(e&&e>0)&&e;return d=d||"video",new a.SafeString(b({cropClass:"video"===d?"thumb--crop-top":"",src:c,ratio:d,playDuration:f,playIcon:!f}))})}),define("hbs!templates/talk-countdown-checker",["hbs","hbs/handlebars","templates/helpers/thumb","templates/helpers/formatDuration"],function(a,b){var c=b.template({1:function(a,b,c,d){var e;return'            <div class="col">\n              <a class="ga-link undec" href="/talks/'+this.escapeExpression((e=null!=(e=b.slug||(null!=a?a.slug:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"slug",hash:{},data:d}):e))+'" data-ga-category="talk.relatedTalk" data-ga-context="countdown-checker">\n                <div class="m4">'+this.escapeExpression((b.thumb||a&&a.thumb||b.helperMissing).call(a,null!=a?a.image:a,{name:"thumb",hash:{},data:d}))+'</div>\n\n                <div class="small hide-sm">'+this.escapeExpression((e=null!=(e=b.title||(null!=a?a.title:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"title",hash:{},data:d}):e))+'</div>\n                <div class="show-sm">\n                  <div class="h12 show-sm m5">'+this.escapeExpression((e=null!=(e=b.speaker||(null!=a?a.speaker:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"speaker",hash:{},data:d}):e))+'</div>\n                  <div class="h9 m5">'+this.escapeExpression((e=null!=(e=b.title||(null!=a?a.title:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"title",hash:{},data:d}):e))+'</div>\n                  <div class="show-sm">'+this.escapeExpression((b.formatDuration||a&&a.formatDuration||b.helperMissing).call(a,null!=a?a.duration:a,{name:"formatDuration",hash:{},data:d}))+"</div>\n                </div>\n              </a>\n            </div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'\n<div class="talk-end-card Talk-countdown-checker inverse">\n  <div class="vc">\n    <div class="vc__wrap">\n      <div class="container">\n\n        <h2 class="h4 m2 show-sm">Recommended talks:</h2>\n        <div class="row row-oh-3up row-skinny row-lg-wide">\n          <div class="col">\n            <a class="ga-link undec" href="/talks/'+this.escapeExpression(this.lambda(null!=(e=null!=a?a.nextTalk:a)?e.slug:e,a))+'" data-ga-category="talk.relatedTalk" data-ga-context="countdown-checker">\n              <div class="m4">'+this.escapeExpression((b.thumb||a&&a.thumb||b.helperMissing).call(a,null!=(e=null!=a?a.nextTalk:a)?e.image:e,{name:"thumb",hash:{},data:d}))+'</div>\n\n              <div class="small hide-sm">'+this.escapeExpression(this.lambda(null!=(e=null!=a?a.nextTalk:a)?e.title:e,a))+'</div>\n              <div class="show-sm">\n                <div class="h12 show-sm m5">'+this.escapeExpression(this.lambda(null!=(e=null!=a?a.nextTalk:a)?e.speaker:e,a))+'</div>\n                <div class="h9 m5">'+this.escapeExpression(this.lambda(null!=(e=null!=a?a.nextTalk:a)?e.title:e,a))+'</div>\n                <div class="show-sm">'+this.escapeExpression((b.formatDuration||a&&a.formatDuration||b.helperMissing).call(a,null!=(e=null!=a?a.nextTalk:a)?e.duration:e,{name:"formatDuration",hash:{},data:d}))+"</div>\n              </div>\n            </a>\n          </div>\n\n"+(null!=(e=b.each.call(a,null!=a?a.relatedTalks:a,{name:"each",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+"        </div>\n\n      </div>\n    </div>\n  </div>\n</div>\n"},useData:!0});return b.registerPartial("templates/talk-countdown-checker",c),c}),define("hbs!templates/talk-countdown-timer",["hbs","hbs/handlebars","templates/helpers/thumb","templates/helpers/formatDuration"],function(a,b){var c=b.template({1:function(a,b,c,d){var e,f;return'            <div class="col col-oh-6 col-lg-4 '+(null!=(e=b.unless.call(a,d&&d.index,{name:"unless",hash:{},fn:this.program(2,d,0),inverse:this.noop,data:d}))?e:"")+'">\n              <a class="ga-link undec Talk-countdown-timer__talk" href="/talks/'+this.escapeExpression((f=null!=(f=b.slug||(null!=a?a.slug:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"slug",hash:{},data:d}):f))+'" data-ga-category="talk.countdownTalk" data-ga-context="countdown-click">\n                <div class="m3">'+this.escapeExpression((b.thumb||a&&a.thumb||b.helperMissing).call(a,null!=a?a.image:a,{name:"thumb",hash:{},data:d}))+'</div>\n                <div class="h12 Talk-countdown-timer__talk__speaker show-sm">'+this.escapeExpression((f=null!=(f=b.speaker||(null!=a?a.speaker:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"speaker",hash:{},data:d}):f))+'</div>\n                <div class="Talk-countdown-timer__talk__title">'+this.escapeExpression((f=null!=(f=b.title||(null!=a?a.title:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"title",hash:{},data:d}):f))+'</div>\n                <div class="Talk-countdown-timer__talk__duration show-sm">'+this.escapeExpression((b.formatDuration||a&&a.formatDuration||b.helperMissing).call(a,null!=a?a.duration:a,{name:"formatDuration",hash:{},data:d}))+"</div>\n              </a>\n            </div>\n"},2:function(a,b,c,d){return"col-lg-offset-1"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'\n<div class="talk-end-card Talk-countdown-timer inverse">\n\n  <div class="container Talk-countdown-timer__container Talk-countdown-timer__container--running">\n    <div class="row row-skinny row-lg-wide">\n      <div class="col col-sm-4">\n        <div class="Talk-countdown-timer__heading">\n          Playing next in\n          <span class="Talk-countdown-timer__remaining">10</span>\n\n          <a class="Talk-countdown-timer__cancel undec" href="#">Cancel</a>\n        </div>\n\n        <div class="Talk-countdown-timer__progress Talk-countdown-timer__progress--top show-lg">\n          <div class="Talk-countdown-timer__progress__meter" style="width:100%"></div>\n        </div>\n      </div>\n    </div>\n\n    <div class="row row-skinny row-lg-wide m3">\n      <div class="col col-oh-4">\n        <a class="ga-link undec" href="/talks/'+this.escapeExpression(this.lambda(null!=(e=null!=a?a.nextTalk:a)?e.slug:e,a))+'" data-ga-category="talk.countdownTalk" data-ga-context="countdown-click">\n          '+this.escapeExpression((b.thumb||a&&a.thumb||b.helperMissing).call(a,null!=(e=null!=a?a.nextTalk:a)?e.image:e,{name:"thumb",hash:{},data:d}))+'\n        </a>\n      </div>\n\n      <div class="col col-oh-8">\n        <a class="ga-link undec Talk-countdown-timer__talk Talk-countdown-timer__talk--next" href="/talks/'+this.escapeExpression(this.lambda(null!=(e=null!=a?a.nextTalk:a)?e.slug:e,a))+'" data-ga-category="talk.countdownTalk" data-ga-context="countdown-click">\n          <div class="h12 m5 Talk-countdown-timer__talk__speaker">'+this.escapeExpression(this.lambda(null!=(e=null!=a?a.nextTalk:a)?e.speaker:e,a))+'</div>\n          <div class="h6 m4 Talk-countdown-timer__talk__title">'+this.escapeExpression(this.lambda(null!=(e=null!=a?a.nextTalk:a)?e.title:e,a))+'</div>\n          <div class="h11 Talk-countdown-timer__talk__duration show-sm">'+this.escapeExpression((b.formatDuration||a&&a.formatDuration||b.helperMissing).call(a,null!=(e=null!=a?a.nextTalk:a)?e.duration:e,{name:"formatDuration",hash:{},data:d}))+'</div>\n        </a>\n      </div>\n    </div>\n\n    <div class="Talk-countdown-timer__progress hide-lg">\n      <div class="Talk-countdown-timer__progress__meter" style="width:100%"></div>\n    </div>\n  </div>\n\n  <div class="container Talk-countdown-timer__container Talk-countdown-timer__container--canceled">\n    <h2 class="Talk-countdown-timer__heading hide-lg">Related talks</h2>\n\n    <div class="row row-skinny row-lg-wide">\n      <div class="col col-oh-4">\n        <h2 class="Talk-countdown-timer__heading show-lg">Up next</h2>\n\n        <a class="ga-link undec Talk-countdown-timer__talk" href="/talks/'+this.escapeExpression(this.lambda(null!=(e=null!=a?a.nextTalk:a)?e.slug:e,a))+'" data-ga-category="talk.countdownTalk" data-ga-context="countdown-click">\n          <div class="m3">'+this.escapeExpression((b.thumb||a&&a.thumb||b.helperMissing).call(a,null!=(e=null!=a?a.nextTalk:a)?e.image:e,{name:"thumb",hash:{},data:d}))+'</div>\n          <div class="h12 Talk-countdown-timer__talk__speaker show-sm">'+this.escapeExpression(this.lambda(null!=(e=null!=a?a.nextTalk:a)?e.speaker:e,a))+'</div>\n          <div class="Talk-countdown-timer__talk__title">'+this.escapeExpression(this.lambda(null!=(e=null!=a?a.nextTalk:a)?e.title:e,a))+'</div>\n          <div class="Talk-countdown-timer__talk__duration show-sm">'+this.escapeExpression((b.formatDuration||a&&a.formatDuration||b.helperMissing).call(a,null!=(e=null!=a?a.nextTalk:a)?e.duration:e,{name:"formatDuration",hash:{},data:d}))+'</div>\n        </a>\n      </div>\n\n      <div class="col col-oh-8">\n        <div class="row row-skinny row-lg-wide show-lg">\n          <div class="col col-lg-offset-1">\n            <h2 class="Talk-countdown-timer__heading">More related talks</h2>\n          </div>\n        </div>\n\n        <div class="row row-skinny row-lg-wide">\n'+(null!=(e=b.each.call(a,null!=a?a.relatedTalks:a,{name:"each",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+"        </div>\n      </div>\n    </div>\n  </div>\n\n</div>\n"},useData:!0});return b.registerPartial("templates/talk-countdown-timer",c),c}),function(){var a=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},b=[].slice;!function(a,b){return"function"==typeof define&&define.amd?define("waypoints",["jquery"],function(c){return b(c,a)}):b(a.jQuery,a)}(this,function(c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;return e=c(d),l=a.call(d,"ontouchstart")>=0,h={horizontal:{},vertical:{}},i=1,k={},j="waypoints-context-id",o="resize.waypoints",p="scroll.waypoints",q=1,r="waypoints-waypoint-ids",s="waypoint",t="waypoints",f=function(){function a(a){var b=this;this.$element=a,this.element=a[0],this.didResize=!1,this.didScroll=!1,this.id="context"+i++,this.oldScroll={x:a.scrollLeft(),y:a.scrollTop()},this.waypoints={horizontal:{},vertical:{}},this.element[j]=this.id,k[this.id]=this,a.bind(p,function(){var a;if(!b.didScroll&&!l)return b.didScroll=!0,a=function(){return b.doScroll(),b.didScroll=!1},d.setTimeout(a,c[t].settings.scrollThrottle)}),a.bind(o,function(){var a;if(!b.didResize)return b.didResize=!0,a=function(){return c[t]("refresh"),b.didResize=!1},d.setTimeout(a,c[t].settings.resizeThrottle)})}return a.prototype.doScroll=function(){var a,b=this;return a={horizontal:{newScroll:this.$element.scrollLeft(),oldScroll:this.oldScroll.x,forward:"right",backward:"left"},vertical:{newScroll:this.$element.scrollTop(),oldScroll:this.oldScroll.y,forward:"down",backward:"up"}},!l||a.vertical.oldScroll&&a.vertical.newScroll||c[t]("refresh"),c.each(a,function(a,d){var e,f,g;return g=[],f=d.newScroll>d.oldScroll,e=f?d.forward:d.backward,c.each(b.waypoints[a],function(a,b){var c,e;return d.oldScroll<(c=b.offset)&&c<=d.newScroll?g.push(b):d.newScroll<(e=b.offset)&&e<=d.oldScroll?g.push(b):void 0}),g.sort(function(a,b){return a.offset-b.offset}),f||g.reverse(),c.each(g,function(a,b){if(b.options.continuous||a===g.length-1)return b.trigger([e])})}),this.oldScroll={x:a.horizontal.newScroll,y:a.vertical.newScroll}},a.prototype.refresh=function(){var a,b,d,e=this;return d=c.isWindow(this.element),b=this.$element.offset(),this.doScroll(),a={horizontal:{contextOffset:d?0:b.left,contextScroll:d?0:this.oldScroll.x,contextDimension:this.$element.width(),oldScroll:this.oldScroll.x,forward:"right",backward:"left",offsetProp:"left"},vertical:{contextOffset:d?0:b.top,contextScroll:d?0:this.oldScroll.y,contextDimension:d?c[t]("viewportHeight"):this.$element.height(),oldScroll:this.oldScroll.y,forward:"down",backward:"up",offsetProp:"top"}},c.each(a,function(a,b){return c.each(e.waypoints[a],function(a,d){var e,f,g,h,i;if(e=d.options.offset,g=d.offset,f=c.isWindow(d.element)?0:d.$element.offset()[b.offsetProp],c.isFunction(e)?e=e.apply(d.element):"string"==typeof e&&(e=parseFloat(e),d.options.offset.indexOf("%")>-1&&(e=Math.ceil(b.contextDimension*e/100))),d.offset=f-b.contextOffset+b.contextScroll-e,(!d.options.onlyOnScroll||null==g)&&d.enabled)return null!==g&&g<(h=b.oldScroll)&&h<=d.offset?d.trigger([b.backward]):null!==g&&g>(i=b.oldScroll)&&i>=d.offset?d.trigger([b.forward]):null===g&&b.oldScroll>=d.offset?d.trigger([b.forward]):void 0})})},a.prototype.checkEmpty=function(){if(c.isEmptyObject(this.waypoints.horizontal)&&c.isEmptyObject(this.waypoints.vertical))return this.$element.unbind([o,p].join(" ")),delete k[this.id]},a}(),g=function(){function a(a,b,d){var e,f;d=c.extend({},c.fn[s].defaults,d),"bottom-in-view"===d.offset&&(d.offset=function(){var a;return a=c[t]("viewportHeight"),c.isWindow(b.element)||(a=b.$element.height()),a-c(this).outerHeight()}),this.$element=a,this.element=a[0],this.axis=d.horizontal?"horizontal":"vertical",this.callback=d.handler,this.context=b,this.enabled=d.enabled,this.id="waypoints"+q++,this.offset=null,this.options=d,b.waypoints[this.axis][this.id]=this,h[this.axis][this.id]=this,e=null!=(f=this.element[r])?f:[],e.push(this.id),this.element[r]=e}return a.prototype.trigger=function(a){if(this.enabled)return null!=this.callback&&this.callback.apply(this.element,a),this.options.triggerOnce?this.destroy():void 0},a.prototype.disable=function(){return this.enabled=!1},a.prototype.enable=function(){return this.context.refresh(),this.enabled=!0},a.prototype.destroy=function(){return delete h[this.axis][this.id],delete this.context.waypoints[this.axis][this.id],this.context.checkEmpty()},a.getWaypointsByElement=function(a){var b,d;return(d=a[r])?(b=c.extend({},h.horizontal,h.vertical),c.map(d,function(a){return b[a]})):[]},a}(),n={init:function(a,b){var d;return null==b&&(b={}),null==(d=b.handler)&&(b.handler=a),this.each(function(){var a,d,e,h;return a=c(this),e=null!=(h=b.context)?h:c.fn[s].defaults.context,c.isWindow(e)||(e=a.closest(e)),e=c(e),d=k[e[0][j]],d||(d=new f(e)),new g(a,d,b)}),c[t]("refresh"),this},disable:function(){return n._invoke.call(this,"disable")},enable:function(){return n._invoke.call(this,"enable")},destroy:function(){return n._invoke.call(this,"destroy")},prev:function(a,b){return n._traverse.call(this,a,b,function(a,b,c){if(b>0)return a.push(c[b-1])})},next:function(a,b){return n._traverse.call(this,a,b,function(a,b,c){if(b<c.length-1)return a.push(c[b+1])})},_traverse:function(a,b,e){var f,g;return null==a&&(a="vertical"),null==b&&(b=d),g=m.aggregate(b),f=[],this.each(function(){var b;return b=c.inArray(this,g[a]),e(f,b,g[a])}),this.pushStack(f)},_invoke:function(a){return this.each(function(){var b;return b=g.getWaypointsByElement(this),c.each(b,function(b,c){return c[a](),!0})}),this}},c.fn[s]=function(){var a,d;return d=arguments[0],a=2<=arguments.length?b.call(arguments,1):[],
n[d]?n[d].apply(this,a):c.isFunction(d)?n.init.apply(this,arguments):c.isPlainObject(d)?n.init.apply(this,[null,d]):d?c.error("The "+d+" method does not exist in jQuery Waypoints."):c.error("jQuery Waypoints needs a callback function or handler option.")},c.fn[s].defaults={context:d,continuous:!0,enabled:!0,horizontal:!1,offset:0,triggerOnce:!1},m={refresh:function(){return c.each(k,function(a,b){return b.refresh()})},viewportHeight:function(){var a;return null!=(a=d.innerHeight)?a:e.height()},aggregate:function(a){var b,d,e;return b=h,a&&(b=null!=(e=k[c(a)[0][j]])?e.waypoints:void 0),b?(d={horizontal:[],vertical:[]},c.each(d,function(a,e){return c.each(b[a],function(a,b){return e.push(b)}),e.sort(function(a,b){return a.offset-b.offset}),d[a]=c.map(e,function(a){return a.element}),d[a]=c.unique(d[a])}),d):[]},above:function(a){return null==a&&(a=d),m._filter(a,"vertical",function(a,b){return b.offset<=a.oldScroll.y})},below:function(a){return null==a&&(a=d),m._filter(a,"vertical",function(a,b){return b.offset>a.oldScroll.y})},left:function(a){return null==a&&(a=d),m._filter(a,"horizontal",function(a,b){return b.offset<=a.oldScroll.x})},right:function(a){return null==a&&(a=d),m._filter(a,"horizontal",function(a,b){return b.offset>a.oldScroll.x})},enable:function(){return m._invoke("enable")},disable:function(){return m._invoke("disable")},destroy:function(){return m._invoke("destroy")},extendFn:function(a,b){return n[a]=b},_invoke:function(a){var b;return b=c.extend({},h.vertical,h.horizontal),c.each(b,function(b,c){return c[a](),!0})},_filter:function(a,b,d){var e,f;return(e=k[c(a)[0][j]])?(f=[],c.each(e.waypoints[b],function(a,b){if(d(e,b))return f.push(b)}),f.sort(function(a,b){return a.offset-b.offset}),c.map(f,function(a){return a.element})):[]}},c[t]=function(){var a,c;return c=arguments[0],a=2<=arguments.length?b.call(arguments,1):[],m[c]?m[c].apply(null,a):m.aggregate.call(null,c)},c[t].settings={resizeThrottle:100,scrollThrottle:30},e.load(function(){return c[t]("refresh")})})}.call(this),define("talk/countdown",["jquery","lodash","lib/ga","lib/instaplay","hbs!templates/talk-countdown-checker","hbs!templates/talk-countdown-timer","exports","waypoints"],function(a,b,c,d,e,f,g){"use strict";g.countdownPeriod=1e4,g.maxInstaplays=3;var h=g._cache={};g.checkerTemplate=e,g.timerTemplate=b.wrap(f,function(a,b){return h.renderedTimer=!0,a(b)}),g.startCountdown=function(){h.renderedTimer&&(g._initCountdown(),h.targetDate||(h.targetDate=new Date(+new Date+g.countdownPeriod)))},g.pauseCountdown=function(){h.targetDate=null},g.cancelCountdown=function(){h.targetDate=null,h.intervalId&&window.clearInterval(h.intervalId),h.$timer.addClass("Talk-countdown-timer--canceled")},g.countdownInterval=function(){if(h.targetDate){var a=h.targetDate-new Date;a<=0?(g.countdownStep(0),g.countdownReached()):g.countdownStep(a)}},g.countdownStep=function(a){h.$meter.css({width:a/g.countdownPeriod*100+"%"}),h.$remaining.text(a>0?Math.round(a/1e3):"0")},g.countdownReached=function(){h.targetDate=null;var a=h.$timer.find("a.Talk-countdown-timer__talk--next").attr("href");c.sendEvent("talk.countdownTalk","force",a),c.setContext(a,"countdown-force"),d.set(a,{clearHistory:!1}),window.location.href=a},g.hasMaxed=function(){return d.recentMatches(/\/talks\//).length>=g.maxInstaplays},g.getNext=function(a){if(a&&a.length){var b=d.recentMatches(/\/talks\//);if(!b.length)return a[0];for(var c=0,e=a.length;c<e;c++){for(var f=a[c],g=new RegExp("/talks/"+f.slug),h=!0,i=0,j=b.length;i<j;i++)h=h&&!b[i].match(g);if(h)return f}}},g.template=function(a){return g.hasMaxed()?g.checkerTemplate(a):g.timerTemplate(a)},g._initCountdown=function(){if(!h.initedCounter){h.initedCounter=!0;var b=a("div.Talk-countdown-timer");h.$timer=b,h.$remaining=b.find("span.Talk-countdown-timer__remaining"),h.$meter=b.find("div.Talk-countdown-timer__progress__meter"),h.$remaining.waypoint(function(a){"up"===a?g.startCountdown():g.pauseCountdown()}),h.intervalId=window.setInterval(g.countdownInterval,100),b.find("a.Talk-countdown-timer__cancel").click(function(a){a.preventDefault(),g.cancelCountdown()})}}}),define("utils/query_param",[],function(){"use strict";return function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))}}),define("Modernizr",[],function(){"use strict";return window.Modernizr}),define("hbs!templates/talkArticle",["hbs","hbs/handlebars"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return'<div class="talk-article">\n  <div class="container">\n    <div class="talk-article__container">\n    </div>\n  </div>\n</div>\n'},useData:!0});return b.registerPartial("templates/talkArticle",c),c}),function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define("spinjs",b):a.Spinner=b()}(this,function(){"use strict";function a(a,b){var c,d=document.createElement(a||"div");for(c in b)d[c]=b[c];return d}function b(a){for(var b=1,c=arguments.length;b<c;b++)a.appendChild(arguments[b]);return a}function c(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=k.substring(0,k.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return m[e]||(n.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",n.cssRules.length),m[e]=1),e}function d(a,b){var c,d,e=a.style;for(b=b.charAt(0).toUpperCase()+b.slice(1),d=0;d<l.length;d++)if(c=l[d]+b,void 0!==e[c])return c;if(void 0!==e[b])return b}function e(a,b){for(var c in b)a.style[d(a,c)||c]=b[c];return a}function f(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)void 0===a[d]&&(a[d]=c[d])}return a}function g(a){for(var b={x:a.offsetLeft,y:a.offsetTop};a=a.offsetParent;)b.x+=a.offsetLeft,b.y+=a.offsetTop;return b}function h(a,b){return"string"==typeof a?a:a[b%a.length]}function i(a){return"undefined"==typeof this?new i(a):void(this.opts=f(a||{},i.defaults,o))}function j(){function c(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}n.addRule(".spin-vml","behavior:url(#default#VML)"),i.prototype.lines=function(a,d){function f(){return e(c("group",{coordsize:k+" "+k,coordorigin:-j+" "+-j}),{width:k,height:k})}function g(a,g,i){b(m,b(e(f(),{rotation:360/d.lines*a+"deg",left:~~g}),b(e(c("roundrect",{arcsize:d.corners}),{width:j,height:d.width,left:d.radius,top:-d.width>>1,filter:i}),c("fill",{color:h(d.color,a),opacity:d.opacity}),c("stroke",{opacity:0}))))}var i,j=d.length+d.width,k=2*j,l=2*-(d.width+d.length)+"px",m=e(f(),{position:"absolute",top:l,left:l});if(d.shadow)for(i=1;i<=d.lines;i++)g(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=d.lines;i++)g(i);return b(a,m)},i.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}}var k,l=["webkit","Moz","ms","O"],m={},n=function(){var c=a("style",{type:"text/css"});return b(document.getElementsByTagName("head")[0],c),c.sheet||c.styleSheet}(),o={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};i.defaults={},f(i.prototype,{spin:function(b){this.stop();var c,d,f=this,h=f.opts,i=f.el=e(a(0,{className:h.className}),{position:h.position,width:0,zIndex:h.zIndex}),j=h.radius+h.length+h.width;if(b&&(b.insertBefore(i,b.firstChild||null),d=g(b),c=g(i),e(i,{left:("auto"==h.left?d.x-c.x+(b.offsetWidth>>1):parseInt(h.left,10)+j)+"px",top:("auto"==h.top?d.y-c.y+(b.offsetHeight>>1):parseInt(h.top,10)+j)+"px"})),i.setAttribute("role","progressbar"),f.lines(i,f.opts),!k){var l,m=0,n=(h.lines-1)*(1-h.direction)/2,o=h.fps,p=o/h.speed,q=(1-h.opacity)/(p*h.trail/100),r=p/h.lines;!function a(){m++;for(var b=0;b<h.lines;b++)l=Math.max(1-(m+(h.lines-b)*r)%p*q,h.opacity),f.opacity(i,b*h.direction+n,l,h);f.timeout=f.el&&setTimeout(a,~~(1e3/o))}()}return f},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),this},lines:function(d,f){function g(b,c){return e(a(),{position:"absolute",width:f.length+f.width+"px",height:f.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/f.lines*j+f.rotate)+"deg) translate("+f.radius+"px,0)",borderRadius:(f.corners*f.width>>1)+"px"})}for(var i,j=0,l=(f.lines-1)*(1-f.direction)/2;j<f.lines;j++)i=e(a(),{position:"absolute",top:1+~(f.width/2)+"px",transform:f.hwaccel?"translate3d(0,0,0)":"",opacity:f.opacity,animation:k&&c(f.opacity,f.trail,l+j*f.direction,f.lines)+" "+1/f.speed+"s linear infinite"}),f.shadow&&b(i,e(g("#000","0 0 4px #000"),{top:"2px"})),b(d,b(i,g(h(f.color,j),"0 0 1px rgba(0,0,0,.1)")));return d},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}});var p=e(a("group"),{behavior:"url(#default#VML)"});return!d(p,"transform")&&p.adj?j():k=d(p,"animation"),i}),define("jqueryui/widget",["jquery"],function(a){return function(a,b){var c=0,d=Array.prototype.slice,e=a.cleanData;a.cleanData=function(b){for(var c,d=0;null!=(c=b[d]);d++)try{a(c).triggerHandler("remove")}catch(a){}e(b)},a.widget=function(b,c,d){var e,f,g,h,i={},j=b.split(".")[0];b=b.split(".")[1],e=j+"-"+b,d||(d=c,c=a.Widget),a.expr[":"][e.toLowerCase()]=function(b){return!!a.data(b,e)},a[j]=a[j]||{},f=a[j][b],g=a[j][b]=function(a,b){return this._createWidget?void(arguments.length&&this._createWidget(a,b)):new g(a,b)},a.extend(g,f,{version:d.version,_proto:a.extend({},d),_childConstructors:[]}),h=new c,h.options=a.widget.extend({},h.options),a.each(d,function(b,d){return a.isFunction(d)?void(i[b]=function(){var a=function(){return c.prototype[b].apply(this,arguments)},e=function(a){return c.prototype[b].apply(this,a)};return function(){var b,c=this._super,f=this._superApply;return this._super=a,this._superApply=e,b=d.apply(this,arguments),this._super=c,this._superApply=f,b}}()):void(i[b]=d)}),g.prototype=a.widget.extend(h,{widgetEventPrefix:f?h.widgetEventPrefix||b:b},i,{constructor:g,namespace:j,widgetName:b,widgetFullName:e}),f?(a.each(f._childConstructors,function(b,c){var d=c.prototype;a.widget(d.namespace+"."+d.widgetName,g,c._proto)}),delete f._childConstructors):c._childConstructors.push(g),a.widget.bridge(b,g)},a.widget.extend=function(c){for(var e,f,g=d.call(arguments,1),h=0,i=g.length;h<i;h++)for(e in g[h])f=g[h][e],g[h].hasOwnProperty(e)&&f!==b&&(a.isPlainObject(f)?c[e]=a.isPlainObject(c[e])?a.widget.extend({},c[e],f):a.widget.extend({},f):c[e]=f);return c},a.widget.bridge=function(c,e){var f=e.prototype.widgetFullName||c;a.fn[c]=function(g){var h="string"==typeof g,i=d.call(arguments,1),j=this;return g=!h&&i.length?a.widget.extend.apply(null,[g].concat(i)):g,h?this.each(function(){var d,e=a.data(this,f);return e?a.isFunction(e[g])&&"_"!==g.charAt(0)?(d=e[g].apply(e,i),d!==e&&d!==b?(j=d&&d.jquery?j.pushStack(d.get()):d,!1):void 0):a.error("no such method '"+g+"' for "+c+" widget instance"):a.error("cannot call methods on "+c+" prior to initialization; attempted to call method '"+g+"'")}):this.each(function(){var b=a.data(this,f);b?b.option(g||{})._init():a.data(this,f,new e(g,this))}),j}},a.Widget=function(){},a.Widget._childConstructors=[],a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(b,d){d=a(d||this.defaultElement||this)[0],this.element=a(d),this.uuid=c++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=a.widget.extend({},this.options,this._getCreateOptions(),b),this.bindings=a(),this.hoverable=a(),this.focusable=a(),d!==this&&(a.data(d,this.widgetFullName,this),this._on(!0,this.element,{remove:function(a){a.target===d&&this.destroy()}}),this.document=a(d.style?d.ownerDocument:d.document||d),this.window=a(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:a.noop,_getCreateEventData:a.noop,_create:a.noop,_init:a.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(a.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:a.noop,widget:function(){return this.element},option:function(c,d){var e,f,g,h=c;if(0===arguments.length)return a.widget.extend({},this.options);if("string"==typeof c)if(h={},e=c.split("."),c=e.shift(),e.length){for(f=h[c]=a.widget.extend({},this.options[c]),g=0;g<e.length-1;g++)f[e[g]]=f[e[g]]||{},f=f[e[g]];if(c=e.pop(),1===arguments.length)return f[c]===b?null:f[c];f[c]=d}else{if(1===arguments.length)return this.options[c]===b?null:this.options[c];h[c]=d}return this._setOptions(h),this},_setOptions:function(a){var b;for(b in a)this._setOption(b,a[b]);return this},_setOption:function(a,b){return this.options[a]=b,"disabled"===a&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!b).attr("aria-disabled",b),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(b,c,d){var e,f=this;"boolean"!=typeof b&&(d=c,c=b,b=!1),d?(c=e=a(c),this.bindings=this.bindings.add(c)):(d=c,c=this.element,e=this.widget()),a.each(d,function(d,g){function h(){if(b||f.options.disabled!==!0&&!a(this).hasClass("ui-state-disabled"))return("string"==typeof g?f[g]:g).apply(f,arguments)}"string"!=typeof g&&(h.guid=g.guid=g.guid||h.guid||a.guid++);var i=d.match(/^(\w+)\s*(.*)$/),j=i[1]+f.eventNamespace,k=i[2];k?e.delegate(k,j,h):c.bind(j,h)})},_off:function(a,b){b=(b||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,a.unbind(b).undelegate(b)},_delay:function(a,b){function c(){return("string"==typeof a?d[a]:a).apply(d,arguments)}var d=this;return setTimeout(c,b||0)},_hoverable:function(b){this.hoverable=this.hoverable.add(b),this._on(b,{mouseenter:function(b){a(b.currentTarget).addClass("ui-state-hover")},mouseleave:function(b){a(b.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(b){this.focusable=this.focusable.add(b),this._on(b,{focusin:function(b){a(b.currentTarget).addClass("ui-state-focus")},focusout:function(b){a(b.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(b,c,d){var e,f,g=this.options[b];if(d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent)for(e in f)e in c||(c[e]=f[e]);return this.element.trigger(c,d),!(a.isFunction(g)&&g.apply(this.element[0],[c].concat(d))===!1||c.isDefaultPrevented())}},a.each({show:"fadeIn",hide:"fadeOut"},function(b,c){a.Widget.prototype["_"+b]=function(d,e,f){"string"==typeof e&&(e={effect:e});var g,h=e?e===!0||"number"==typeof e?c:e.effect||c:b;e=e||{},"number"==typeof e&&(e={duration:e}),g=!a.isEmptyObject(e),e.complete=f,e.delay&&d.delay(e.delay),g&&a.effects&&a.effects.effect[h]?d[b](e):h!==b&&d[h]?d[h](e.duration,e.easing,f):d.queue(function(c){a(this)[b](),f&&f.call(d[0]),c()})}})}(a),a}),define("transit",["jquery"],function(a){return function(a){function b(a){if(a in l.style)return a;var b=["Moz","Webkit","O","ms"],c=a.charAt(0).toUpperCase()+a.substr(1);if(a in l.style)return a;for(var d=0;d<b.length;++d){var e=b[d]+c;if(e in l.style)return e}}function c(){return l.style[m.transform]="",l.style[m.transform]="rotateY(90deg)",""!==l.style[m.transform]}function d(a){return"string"==typeof a&&this.parse(a),this}function e(a,b,c){b===!0?a.queue(c):b?a.queue(b,c):c()}function f(b){var c=[];return a.each(b,function(b){b=a.camelCase(b),b=a.transit.propertyMap[b]||a.cssProps[b]||b,b=i(b),a.inArray(b,c)===-1&&c.push(b)}),c}function g(b,c,d,e){var g=f(b);a.cssEase[d]&&(d=a.cssEase[d]);var h=""+k(c)+" "+d;parseInt(e,10)>0&&(h+=" "+k(e));var i=[];return a.each(g,function(a,b){i.push(b+" "+h)}),i.join(", ")}function h(b,c){c||(a.cssNumber[b]=!0),a.transit.propertyMap[b]=m.transform,a.cssHooks[b]={get:function(c){var d=a(c).css("transit:transform");return d.get(b)},set:function(c,d){var e=a(c).css("transit:transform");e.setFromString(b,d),a(c).css({"transit:transform":e})}}}function i(a){return a.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})}function j(a,b){return"string"!=typeof a||a.match(/^[\-0-9\.]+$/)?""+a+b:a}function k(b){var c=b;return a.fx.speeds[c]&&(c=a.fx.speeds[c]),j(c,"ms")}a.transit={version:"0.9.9",propertyMap:{marginLeft:"margin",marginRight:"margin",marginBottom:"margin",marginTop:"margin",paddingLeft:"padding",paddingRight:"padding",paddingBottom:"padding",paddingTop:"padding"},enabled:!0,useTransitionEnd:!1};var l=document.createElement("div"),m={},n=navigator.userAgent.toLowerCase().indexOf("chrome")>-1;m.transition=b("transition"),m.transitionDelay=b("transitionDelay"),m.transform=b("transform"),m.transformOrigin=b("transformOrigin"),m.transform3d=c();var o={transition:"transitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd",msTransition:"MSTransitionEnd"},p=m.transitionEnd=o[m.transition]||null;for(var q in m)m.hasOwnProperty(q)&&"undefined"==typeof a.support[q]&&(a.support[q]=m[q]);l=null,a.cssEase={_default:"ease",in:"ease-in",out:"ease-out","in-out":"ease-in-out",snap:"cubic-bezier(0,1,.5,1)",easeOutCubic:"cubic-bezier(.215,.61,.355,1)",easeInOutCubic:"cubic-bezier(.645,.045,.355,1)",easeInCirc:"cubic-bezier(.6,.04,.98,.335)",easeOutCirc:"cubic-bezier(.075,.82,.165,1)",easeInOutCirc:"cubic-bezier(.785,.135,.15,.86)",easeInExpo:"cubic-bezier(.95,.05,.795,.035)",easeOutExpo:"cubic-bezier(.19,1,.22,1)",easeInOutExpo:"cubic-bezier(1,0,0,1)",easeInQuad:"cubic-bezier(.55,.085,.68,.53)",easeOutQuad:"cubic-bezier(.25,.46,.45,.94)",easeInOutQuad:"cubic-bezier(.455,.03,.515,.955)",easeInQuart:"cubic-bezier(.895,.03,.685,.22)",easeOutQuart:"cubic-bezier(.165,.84,.44,1)",easeInOutQuart:"cubic-bezier(.77,0,.175,1)",easeInQuint:"cubic-bezier(.755,.05,.855,.06)",easeOutQuint:"cubic-bezier(.23,1,.32,1)",easeInOutQuint:"cubic-bezier(.86,0,.07,1)",easeInSine:"cubic-bezier(.47,0,.745,.715)",easeOutSine:"cubic-bezier(.39,.575,.565,1)",easeInOutSine:"cubic-bezier(.445,.05,.55,.95)",easeInBack:"cubic-bezier(.6,-.28,.735,.045)",easeOutBack:"cubic-bezier(.175, .885,.32,1.275)",easeInOutBack:"cubic-bezier(.68,-.55,.265,1.55)"},a.cssHooks["transit:transform"]={get:function(b){return a(b).data("transform")||new d},set:function(b,c){var e=c;e instanceof d||(e=new d(e)),"WebkitTransform"!==m.transform||n?b.style[m.transform]=e.toString():b.style[m.transform]=e.toString(!0),a(b).data("transform",e)}},a.cssHooks.transform={set:a.cssHooks["transit:transform"].set},a.fn.jquery<"1.8"&&(a.cssHooks.transformOrigin={get:function(a){return a.style[m.transformOrigin]},set:function(a,b){a.style[m.transformOrigin]=b}},a.cssHooks.transition={get:function(a){return a.style[m.transition]},set:function(a,b){a.style[m.transition]=b}}),h("scale"),h("translate"),h("rotate"),h("rotateX"),h("rotateY"),h("rotate3d"),h("perspective"),h("skewX"),h("skewY"),h("x",!0),h("y",!0),d.prototype={setFromString:function(a,b){var c="string"==typeof b?b.split(","):b.constructor===Array?b:[b];c.unshift(a),d.prototype.set.apply(this,c)},set:function(a){var b=Array.prototype.slice.apply(arguments,[1]);this.setter[a]?this.setter[a].apply(this,b):this[a]=b.join(",")},get:function(a){return this.getter[a]?this.getter[a].apply(this):this[a]||0},setter:{rotate:function(a){this.rotate=j(a,"deg")},rotateX:function(a){this.rotateX=j(a,"deg")},rotateY:function(a){this.rotateY=j(a,"deg")},scale:function(a,b){void 0===b&&(b=a),this.scale=a+","+b},skewX:function(a){this.skewX=j(a,"deg")},skewY:function(a){this.skewY=j(a,"deg")},perspective:function(a){this.perspective=j(a,"px")},x:function(a){this.set("translate",a,null)},y:function(a){this.set("translate",null,a)},translate:function(a,b){void 0===this._translateX&&(this._translateX=0),void 0===this._translateY&&(this._translateY=0),null!==a&&void 0!==a&&(this._translateX=j(a,"px")),null!==b&&void 0!==b&&(this._translateY=j(b,"px")),this.translate=this._translateX+","+this._translateY}},getter:{x:function(){return this._translateX||0},y:function(){return this._translateY||0},scale:function(){var a=(this.scale||"1,1").split(",");return a[0]&&(a[0]=parseFloat(a[0])),a[1]&&(a[1]=parseFloat(a[1])),a[0]===a[1]?a[0]:a},rotate3d:function(){for(var a=(this.rotate3d||"0,0,0,0deg").split(","),b=0;b<=3;++b)a[b]&&(a[b]=parseFloat(a[b]));return a[3]&&(a[3]=j(a[3],"deg")),a}},parse:function(a){var b=this;a.replace(/([a-zA-Z0-9]+)\((.*?)\)/g,function(a,c,d){b.setFromString(c,d)})},toString:function(a){var b=[];for(var c in this)if(this.hasOwnProperty(c)){if(!m.transform3d&&("rotateX"===c||"rotateY"===c||"perspective"===c||"transformOrigin"===c))continue;"_"!==c[0]&&(a&&"scale"===c?b.push(c+"3d("+this[c]+",1)"):a&&"translate"===c?b.push(c+"3d("+this[c]+",0)"):b.push(c+"("+this[c]+")"))}return b.join(" ")}},a.fn.transition=a.fn.transit=function(b,c,d,f){var h=this,i=0,j=!0;"function"==typeof c&&(f=c,c=void 0),"function"==typeof d&&(f=d,d=void 0),"undefined"!=typeof b.easing&&(d=b.easing,delete b.easing),"undefined"!=typeof b.duration&&(c=b.duration,delete b.duration),"undefined"!=typeof b.complete&&(f=b.complete,delete b.complete),"undefined"!=typeof b.queue&&(j=b.queue,delete b.queue),"undefined"!=typeof b.delay&&(i=b.delay,delete b.delay),"undefined"==typeof c&&(c=a.fx.speeds._default),"undefined"==typeof d&&(d=a.cssEase._default),c=k(c);var l=g(b,c,d,i),n=a.transit.enabled&&m.transition,o=n?parseInt(c,10)+parseInt(i,10):0;if(0===o){var q=function(a){h.css(b),f&&f.apply(h),a&&a()};return e(h,j,q),h}var r={},s=function(c){var d=!1,e=function(){d&&h.unbind(p,e),o>0&&h.each(function(){this.style[m.transition]=r[this]||null}),"function"==typeof f&&f.apply(h),"function"==typeof c&&c()};o>0&&p&&a.transit.useTransitionEnd?(d=!0,h.bind(p,e)):window.setTimeout(e,o),h.each(function(){o>0&&(this.style[m.transition]=l),a(this).css(b)})},t=function(a){var b=0;"MozTransition"===m.transition&&b<25&&(b=25),window.setTimeout(function(){s(a)},b)};return e(h,j,t),this},a.transit.getTransitionValue=g}(a),a}),define("widgets/talkArticle",["jquery","lodash","jqueryui/widget","transit"],function(a,b){"use strict";function c(){f.show(),f.removeClass(k)}function d(){f.hide()}var e,f,g,h,i,j=300,k="talk-article--main--collapsed",l=b.once(function(){e=a("#talk-pusher"),f=a("#talk"),g=a("body,html"),h=a("#player-hero"),i=h.find("div.player-hero__banner")});return a.widget("ted.talkArticle",{options:{autoShow:!0},_create:function(){var a=this;l(),this.element.hide(),f.after(this.element),this._on("a.talk-article__return__link",{click:function(b){b.preventDefault(),a.hide()}}),this.options.autoShow&&this.show()},show:function(){this.element.fadeIn(j),f.addClass(k),e.transition({duration:j,marginTop:0-f.outerHeight(),complete:d}),g.animate({scrollTop:i.offset().top+i.outerHeight()},j),this._trigger("show")},hide:function(){this.element.fadeOut(j),f.show(),e.transition({duration:j,marginTop:0,complete:c}),this._trigger("hide")}}),function(b,c){return a(b).talkArticle(c)}}),define("widgets/talkArticleLink",["jquery","lodash","hbs!templates/talkArticle","spinjs","widgets/talkArticle"],function(a,b,c,d){"use strict";var e="talk-article-link",f="talk-article-link--loading";return a.widget("ted.talkArticleLink",{options:{articleUrl:null,returnUrl:window.location.href,unpopped:!1},_create:function(){var a=this;this.options.articleUrl||(this.options.articleUrl=this.element.attr("href")),this.element.addClass(e),this._on(this.element,this._handleEvents),this._on(window,{popstate:function(){a.options.unpopped&&(a.options.unpopped=!1,a.article.talkArticle("hide"))}})},_handleEvents:{click:function(a){a.preventDefault(),this.showArticle()}},_onShow:function(){this._trigger("show")},_onHide:function(){window.history&&history.pushState&&this.options.unpopped&&(this.options.unpopped=!1,history.back()),this._trigger("hide")},article:null,loadUrl:function(e){var g=this;g.article&&g.article.remove();var h=a(c());h.addClass("talk-article--loading"),g.article=h,g.article.talkArticle({show:b.bind(g._onShow,g),hide:b.bind(g._onHide,g)}),this.article.talkArticle("show"),this._spinner||(this._spinner=new d),this._spinner.spin(g.article.find("div.talk-article__container")[0]),this.options.articleUrl=e,this.element.addClass(f),e+=(e.match(/\?/)?"&":"?")+"talkarticle=true",a.get(e).then(b.bind(this.loadHtml,this))},loadHtml:function(c){var d=!0,e=this;window.history&&window.history.pushState&&!e.options.unpopped&&(d=!1),e.article&&(this._spinner.stop(),e.article.remove()),e.article=a(c).find("div.talk-article"),e.article.talkArticle({autoShow:d,show:b.bind(e._onShow,e),hide:b.bind(e._onHide,e)}),e.element.removeClass(f)},showArticle:function(){var a=this;a.element.hasClass(f)||(this.article?this.article.talkArticle("show"):this.loadUrl(this.options.articleUrl),window.history&&history.pushState&&(history.pushState(null,null,this.options.articleUrl),this.options.unpopped=!0))}}),function(b,c){return a(b).talkArticle(c)}}),define("talk/transcript",["jquery","lodash","Modernizr","lib/ga","widgets/talkArticleLink"],function(a,b,c,d){"use strict";function e(a){var c,d;return c=b.findIndex(t,function(b){return d=b===a,d||b>a}),!(c<1&&!d)&&r.eq(c-(d?0:1))}function f(){var b=+a(this).data("time"),c=Math.floor((s.offset+b)/1e3);x.player&&(x.player.player("seek",c),d.sendEvent("player","seek","transcript",c)),window.history&&history.pushState&&history.pushState(null,null,location.href.split("#")[0]+"#t-"+b)}function g(a){var b=e(a);b&&b!==p&&(p&&(p.removeClass(u),q.removeClass(v)),p=b.addClass(u),q=b.closest("p.talk-transcript__para").addClass(v))}function h(a){a||(a=w),g(1e3*a-s.offset),w=a}function i(){n||(n=a("div.talk-transcript").first()),r=n.find("span.talk-transcript__fragment"),t=r.map(function(b,c){return+a(c).data("time")}).toArray(),n.on("click","span.talk-transcript__fragment",f),x.player&&x.player.on("playercurrenttime",function(a,b){h(b.currentTime)}),h()}function j(){n&&n.parent().length||(n=o.data("ted-talkArticleLink").article,i())}function k(){j()}function l(){a(document).on("change","select.talk-transcript__language",function(){var b=a(this),d="/talks/"+b.data("slug")+"/transcript?language="+b.val();o?(c.history&&window.history.replaceState({language:b.val()},"",d),o.talkArticleLink("loadUrl",d)):location.href=d})}function m(b){s=b,o=a("#open-transcript"),l(),o.talkArticleLink({show:k}),o.on("click",function(){d.sendEvent("talk.transcript","show","talk details")}),a("#hero-transcript-link").on("click",function(a){a.preventDefault(),o.data("ted-talkArticleLink").showArticle(),d.sendEvent("talk.transcript","show","hero")}),a("#player-hero").on("click","a.controls__transcript",function(a){a.preventDefault(),o.data("ted-talkArticleLink").showArticle(),d.sendEvent("talk.transcript","show","controls")})}var n,o,p,q,r,s,t,u="talk-transcript__fragment--current",v="talk-transcript__para--current",w=0,x={player:null};return x.initArticle=i,x.initLanguages=b.once(l),x.initLink=m,x});var fetchText,_buildMap={};define("es6",["module"],function(a){return{load:function(a,b,c,d){},write:function(a,b,c){b in _buildMap&&c.asModule(a+"!"+b,_buildMap[b])}}}),define("es6!components/companion-ads/slot-spot.babel",["exports","module"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=function(){function a(b,d,e){c(this,a),this.adUnitPath=b,this.targetingKey=d,this.size=e.slice(0);var f=document.createElement("div"),g="ad-"+Math.floor(Math.random()*Math.pow(2,52)-1).toString(36);this.el=f,this.el.setAttribute("id",g),this.id=g,this.fillChangeHandlers=[],this.filled=!1,this.wiped=!1}return d(a,[{key:"handleFillChange",value:function(a){var b=this;this.filled=a,this.wiped=!this.filled&&this.wiped,this.fillChangeHandlers.forEach(function(a){return a(b.filled,b.wiped)})}},{key:"addFillChangeHandler",value:function(a){this.fillChangeHandlers.push(a)}},{key:"removeFillChangeHandler",value:function(a){var b=this.fillChangeHandlers.indexOf(a);b!==-1&&this.fillChangeHandlers.splice(b,1)}},{key:"setContainer",value:function(a){this.container&&this.container===a||(a.appendChild(this.el),this.container=a,this.filled&&(this.wiped=!0,this.handleFillChange(!1)))}},{key:"unsetContainer",value:function(a){this.container&&this.container===a&&(a.removeChild(this.el),this.container=null)}},{key:"setTargetingValue",value:function(a){var b=this;this.targetingValue&&this.targetingValue===a||window.googletag.cmd.push(function(){var c=!!b.slot;b.slot=b.slot||window.googletag.defineSlot(b.adUnitPath,b.size,b.id).addService(window.googletag.pubads()),b.handleFillChange(!1),b.slot.clearTargeting(),b.slot.setTargeting(b.targetingKey,a),b.targetingValue=a,c?window.googletag.pubads().refresh([b.slot]):window.googletag.display(b.id)})}}]),a}();b.exports=e}),define("es6!components/companion-ads/slot-spot-lot.babel",["exports","es6!./slot-spot.babel"],function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{default:a}}function d(a,b){return j.find(function(c){return c.adUnitPath===a&&c.targetingKey===b})}function e(a){return j.find(function(b){return b.slot===a})}function f(){k||(k=!0,window.googletag.cmd.push(function(){window.googletag.pubads().addEventListener("slotRenderEnded",function(a){if(a&&a.slot&&!a.isEmpty){var b=e(a.slot);b&&b.handleFillChange(!0)}})}))}function g(a){var b=a.props,c=b.adUnitPath,e=b.targetingKey,g=b.targetingValue,h=b.size,k=a.el,l=a.handleFillChange;if(c&&e&&g&&h&&k){f();var m=d(c,e);m||(m=new i.default(c,e,h),j.push(m)),m.setContainer(k),m.setTargetingValue(g),m.addFillChangeHandler(l),l(m.filled,m.wiped)}}function h(a){var b=a.props,c=b.adUnitPath,e=b.targetingKey,f=a.el,g=a.handleFillChange,h=d(c,e);h&&(h.unsetContainer(f),h.removeFillChangeHandler(g))}Object.defineProperty(a,"__esModule",{value:!0}),a.findByPathAndKey=d,a.findBySlot=e,a.init=f,a.register=g,a.unregister=h;var i=c(b),j=[],k=!1}),define("widgets/ad",["lodash","jquery","jqueryui/widget"],function(a,b){"use strict";b.widget("ted.ad",{_rendered:!1,$image:null,$text:null,$link:null,blocked:function(){this.element.hide()},refreshJsonAd:function(){if(this.options.blocked)return void this.blocked();if(this._rendered||(this._addAdClass(),this.element.children().addClass("ad__prefill"),this._getAppreciationText().appendTo(this.element),this.$link=b('<a class="ad__unit" href="#" rel="nofollow" target="_blank">').appendTo(this.element),this.$image=b("<img>").appendTo(this.$link),this._rendered=!0),!this.options.ad)return void this.element.hide();var a=this._getRenderDetails();this.$link.attr("href",a.click),this.$image.attr({src:a.currentCreative.url,width:a.dimensions.width,height:a.dimensions.height}),this.element[this.options.ad.hasDisplay===!1?"hide":"show"](),this._impress()},refreshHtmlAd:function(){this._addAdClass(),this._getAppreciationText().prependTo(this.element)},_init:function(){var a=String(this.options.mode);this._rendered=!1,"json"===a?this.refreshJsonAd():"html"===a&&this.refreshHtmlAd()},_fireImpression:function(a){var b=new Image;b.src=a;
},_impress:function(){this._fireImpression(this.options.ad.impression),a.forEach(this.options.ad.thirdPartyImpressions,this._fireImpression)},_getCreative:function(){var b=a.filter(this.options.ad.creative,function(a){return""!==a.url}),c=Math.max(window.devicePixelRatio||1,1);return a.reduce(b,function(a,b){return b.density<=c?b:a||b},{})},_getRenderDetails:function(){return a.extend({currentCreative:this._getCreative()},this.options.ad)},_getAppreciationText:function(){return this.$text=b('<div class="ad__text">TED Talks are free thanks to our partners &amp; advertisers</div>'),this.$text},_addAdClass:function(){this.element.addClass("ad")}})}),define("hbs!templates/sponsorshipBug",["hbs","hbs/handlebars"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return'\n<a class="sponsorship-bug__link" href="#" rel="nofollow" target="_blank" style="display:block"><img src="" alt=""></a>\n'},useData:!0});return b.registerPartial("templates/sponsorshipBug",c),c}),define("widgets/sponsorshipBug",["jquery","hbs!templates/sponsorshipBug","widgets/ad"],function(a,b){"use strict";a.widget("ted.sponsorshipBug",a.ted.ad,{blocked:function(){},refreshHtmlAd:function(){},refreshJsonAd:function(){return this.options.blocked?this.blocked():(this._rendered||(this.element.children().addClass("sponsorship-bug__prefill"),this.element.append(b()),this.$image=this.element.find("img"),this.$link=this.element.find("a.sponsorship-bug__link"),this._rendered=!0),void this._super())},_init:function(){this.element.closest("div.sponsorship-bug").addClass("sponsorship-bug--active"),this._super()}})}),define("lib/ads",["jquery","lodash","utils/ted","utils/query_param","es6!components/companion-ads/slot-spot-lot.babel","exports","widgets/ad","widgets/sponsorshipBug"],function(a,b,c,d,e,f){"use strict";function g(a){var b=new Image;b.src=a}function h(b){var c=String(b.type),d=n[b.type];"master"===c?o.deferred.resolve(b):void 0===d?window.console&&console.log&&(console.log("Unknown ad type"),console.log(b)):a(d.id)[d.widget]({ad:b,mode:"json"})}function i(c){b.forEach(o.companionAdSlots,function(b){if(b.gptSlot.setTargeting(b.key,c.target),b.displayed){var d=a("#"+b.containerId);d.data("tedAd")?d.ad("destroy"):d.data("sponsorshipBug")&&d.sponsorshipBug("destroy"),f.refreshAd(b.gptSlot)}else f.displayAd(b.containerId);b.displayed=!0}),c.impression&&g(c.impression)}function j(a){return a.replace("{adUnit}",o.slot.adUnit)}function k(a){p.done(function(b){b.isMai||f.player.player("sendAds",{postroll:j(a.postrollURL),preroll:j(a.prerollURL)})})}function l(b){var d=f.player=b;if(d){var e=d.player("isMai"),g=f.playerMode=String(d.player("mode")),j="flash"===g,l=!e&&(j||"surprise_me"===c("controller"));if(f.setMasterDeets({isMai:d.player("isMai"),isGptProxy:l,maiAdUnitId:d.player("maiAdUnitId")}),e)d.on({playerad:function(a,b){h(b.ad)}}),o.deferred.done(i);else if(l){o.deferred.done(i),d.on({playeradblock:function(){var b=n.bug;a(b.id)[b.widget]({blocked:!0})}});var m=!0;d.on({playertalk:function(a,b){var c=String(d.player("talks")[0].id),e=String(b.id);m&&c===e?(m=!1,"flash"===g&&o.deferred.done(k)):f.refreshMasterAd({targeting:b.targeting}),m=!1}})}}}function m(){b.forEach(o.slot.targeting,function(a,c){o.slot.gptSlot.setTargeting(c,b.isArray(a)?a.join(","):a)});var a=d("dfptest");a&&o.slot.gptSlot.setTargeting("dfptest",a)}var n={bug:{id:"#sponsorship-bug-placeholder",widget:"sponsorshipBug"},companion:{id:"#ad-unit",widget:"ad"},"companion-mobile":{id:"#ad-unit-mobile",widget:"ad"},devil:{id:"#devil-ad",widget:"ad"},onPage:{id:"#ad-unit",widget:"ad"}},o={companionAdSlots:[],deferred:a.Deferred(),slot:{adUnit:null,containerId:null,gptSlot:null,targeting:{}}};f._masterAd=o,f.player=null;var p=a.Deferred();window.googletag=window.googletag||{cmd:[]},f.slotRenderEndedHandler=function(c){if(c&&c.slot&&!c.isEmpty&&!e.findBySlot(c.slot)){var d,f="ad",g="tedAd",h=b.find(o.companionAdSlots,function(a){return a.gptSlot===c.slot}),i=h&&String(h.containerId);"ad-unit"===i&&(d=a("#ad-unit")),"sponsorship-bug-placeholder"===i&&(d=a("#sponsorship-bug-placeholder"),f="sponsorshipBug",g="tedSponsorshipBug");var j=c.slot.getSlotElementId&&c.slot.getSlotElementId();if(!h&&j&&(d=a("#"+j)),"master-gpt"!==i&&"master-gpt"!==j&&d&&d.length){var k=d.data(g);k||d[f]({mode:"html"})}}},f.displayMasterAd=function(a){p.done(function(c){c.isMai||(o.slot.containerId=a.containerId,o.slot.adUnit=c.adUnitId,window.googletag.cmd.push(function(){o.slot.gptSlot=googletag.defineOutOfPageSlot(o.slot.adUnit,o.slot.containerId).addService(googletag.pubads()),b.assign(o.slot.targeting,a.targeting),m(),f.displayAd(o.slot.containerId)}))})},f.refreshMasterAd=function(c){o.slot.gptSlot&&(o.deferred=a.Deferred(),o.deferred.done(i),"flash"===f.playerMode&&o.deferred.done(k),o.slot.gptSlot.clearTargeting(),b.forEach(o.companionAdSlots,function(a){a.gptSlot.clearTargeting()}),b.assign(o.slot.targeting,c.targeting),m(),f.refreshAd(o.slot.gptSlot))},f.displayAd=function(b){a(function(){window.googletag.cmd.push(function(){googletag.display(b)})})},f.refreshAd=function(a){window.googletag.cmd.push(function(){googletag.pubads().refresh([a])})},f.createStandardSlot=function(a){window.googletag.cmd.push(function(){var b=googletag.defineSlot(a.adUnitId,a.size,a.containerId).addService(googletag.pubads()),c=d("dfptest");c&&b.setTargeting("dfptest",c),f.displayAd(a.containerId)})},f.createCompanionSlot=function(a){p.done(function(b){b.isMai||b.isGptProxy?window.googletag.cmd.push(function(){var c=googletag.defineSlot(b.adUnitId,a.size,a.containerId).addService(googletag.pubads());o.companionAdSlots.push({containerId:a.containerId,gptSlot:c,key:a.key})}):f.createStandardSlot({adUnitId:b.adUnitId,size:a.size,containerId:a.containerId})})};var q={};f.setMasterDeets=function(b){a.extend(q,b),q.hasOwnProperty("isMai")&&q.hasOwnProperty("gptAdUnitId")&&q.hasOwnProperty("maiAdUnitId")&&p.resolve({isMai:q.isMai,isGptProxy:q.isGptProxy,adUnitId:q.isMai?q.maiAdUnitId:q.gptAdUnitId})},f.initPlayer=l,f.gptAd=function(a){h(a.ad)},window.googletag.cmd.push(function(){googletag.pubads().addEventListener("slotRenderEnded",f.slotRenderEndedHandler)})}),define("flot",["jquery"],function(a){return function(a){a.color={},a.color.make=function(b,c,d,e){var f={};return f.r=b||0,f.g=c||0,f.b=d||0,f.a=null!=e?e:1,f.add=function(a,b){for(var c=0;c<a.length;++c)f[a.charAt(c)]+=b;return f.normalize()},f.scale=function(a,b){for(var c=0;c<a.length;++c)f[a.charAt(c)]*=b;return f.normalize()},f.toString=function(){return f.a>=1?"rgb("+[f.r,f.g,f.b].join(",")+")":"rgba("+[f.r,f.g,f.b,f.a].join(",")+")"},f.normalize=function(){function a(a,b,c){return b<a?a:b>c?c:b}return f.r=a(0,parseInt(f.r),255),f.g=a(0,parseInt(f.g),255),f.b=a(0,parseInt(f.b),255),f.a=a(0,f.a,1),f},f.clone=function(){return a.color.make(f.r,f.b,f.g,f.a)},f.normalize()},a.color.extract=function(b,c){var d;do{if(d=b.css(c).toLowerCase(),""!=d&&"transparent"!=d)break;b=b.parent()}while(b.length&&!a.nodeName(b.get(0),"body"));return"rgba(0, 0, 0, 0)"==d&&(d="transparent"),a.color.parse(d)},a.color.parse=function(c){var d,e=a.color.make;if(d=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(c))return e(parseInt(d[1],10),parseInt(d[2],10),parseInt(d[3],10));if(d=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(c))return e(parseInt(d[1],10),parseInt(d[2],10),parseInt(d[3],10),parseFloat(d[4]));if(d=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(c))return e(2.55*parseFloat(d[1]),2.55*parseFloat(d[2]),2.55*parseFloat(d[3]));if(d=/rgba\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(c))return e(2.55*parseFloat(d[1]),2.55*parseFloat(d[2]),2.55*parseFloat(d[3]),parseFloat(d[4]));if(d=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(c))return e(parseInt(d[1],16),parseInt(d[2],16),parseInt(d[3],16));if(d=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(c))return e(parseInt(d[1]+d[1],16),parseInt(d[2]+d[2],16),parseInt(d[3]+d[3],16));var f=a.trim(c).toLowerCase();return"transparent"==f?e(255,255,255,0):(d=b[f]||[0,0,0],e(d[0],d[1],d[2]))};var b={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0]}}(a),function(a){function b(b,c){var d=c.children("."+b)[0];if(null==d&&(d=document.createElement("canvas"),d.className=b,a(d).css({direction:"ltr",position:"absolute",left:0,top:0}).appendTo(c),!d.getContext)){if(!window.G_vmlCanvasManager)throw new Error("Canvas is not available. If you're using IE with a fall-back such as Excanvas, then there's either a mistake in your conditional include, or the page has no DOCTYPE and is rendering in Quirks Mode.");d=window.G_vmlCanvasManager.initElement(d)}this.element=d;var e=this.context=d.getContext("2d"),f=window.devicePixelRatio||1,g=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;this.pixelRatio=f/g,this.resize(c.width(),c.height()),this.textContainer=null,this.text={},this._textCache={}}function c(c,e,f,g){function h(a,b){b=[qa].concat(b);for(var c=0;c<a.length;++c)a[c].apply(this,b)}function i(){for(var c={Canvas:b},d=0;d<g.length;++d){var e=g[d];e.init(qa,c),e.options&&a.extend(!0,ea,e.options)}}function j(b){a.extend(!0,ea,b),b&&b.colors&&(ea.colors=b.colors),null==ea.xaxis.color&&(ea.xaxis.color=a.color.parse(ea.grid.color).scale("a",.22).toString()),null==ea.yaxis.color&&(ea.yaxis.color=a.color.parse(ea.grid.color).scale("a",.22).toString()),null==ea.xaxis.tickColor&&(ea.xaxis.tickColor=ea.grid.tickColor||ea.xaxis.color),null==ea.yaxis.tickColor&&(ea.yaxis.tickColor=ea.grid.tickColor||ea.yaxis.color),null==ea.grid.borderColor&&(ea.grid.borderColor=ea.grid.color),null==ea.grid.tickColor&&(ea.grid.tickColor=a.color.parse(ea.grid.color).scale("a",.22).toString());var d,e,f,g=c.css("font-size"),i=g?+g.replace("px",""):13,j={style:c.css("font-style"),size:Math.round(.8*i),variant:c.css("font-variant"),weight:c.css("font-weight"),family:c.css("font-family")};for(f=ea.xaxes.length||1,d=0;d<f;++d)e=ea.xaxes[d],e&&!e.tickColor&&(e.tickColor=e.color),e=a.extend(!0,{},ea.xaxis,e),ea.xaxes[d]=e,e.font&&(e.font=a.extend({},j,e.font),e.font.color||(e.font.color=e.color),e.font.lineHeight||(e.font.lineHeight=Math.round(1.15*e.font.size)));for(f=ea.yaxes.length||1,d=0;d<f;++d)e=ea.yaxes[d],e&&!e.tickColor&&(e.tickColor=e.color),e=a.extend(!0,{},ea.yaxis,e),ea.yaxes[d]=e,e.font&&(e.font=a.extend({},j,e.font),e.font.color||(e.font.color=e.color),e.font.lineHeight||(e.font.lineHeight=Math.round(1.15*e.font.size)));for(ea.xaxis.noTicks&&null==ea.xaxis.ticks&&(ea.xaxis.ticks=ea.xaxis.noTicks),ea.yaxis.noTicks&&null==ea.yaxis.ticks&&(ea.yaxis.ticks=ea.yaxis.noTicks),ea.x2axis&&(ea.xaxes[1]=a.extend(!0,{},ea.xaxis,ea.x2axis),ea.xaxes[1].position="top"),ea.y2axis&&(ea.yaxes[1]=a.extend(!0,{},ea.yaxis,ea.y2axis),ea.yaxes[1].position="right"),ea.grid.coloredAreas&&(ea.grid.markings=ea.grid.coloredAreas),ea.grid.coloredAreasColor&&(ea.grid.markingsColor=ea.grid.coloredAreasColor),ea.lines&&a.extend(!0,ea.series.lines,ea.lines),ea.points&&a.extend(!0,ea.series.points,ea.points),ea.bars&&a.extend(!0,ea.series.bars,ea.bars),null!=ea.shadowSize&&(ea.series.shadowSize=ea.shadowSize),null!=ea.highlightColor&&(ea.series.highlightColor=ea.highlightColor),d=0;d<ea.xaxes.length;++d)q(ka,d+1).options=ea.xaxes[d];for(d=0;d<ea.yaxes.length;++d)q(la,d+1).options=ea.yaxes[d];for(var k in pa)ea.hooks[k]&&ea.hooks[k].length&&(pa[k]=pa[k].concat(ea.hooks[k]));h(pa.processOptions,[ea])}function k(a){da=l(a),r(),s()}function l(b){for(var c=[],d=0;d<b.length;++d){var e=a.extend(!0,{},ea.series);null!=b[d].data?(e.data=b[d].data,delete b[d].data,a.extend(!0,e,b[d]),b[d].data=e.data):e.data=b[d],c.push(e)}return c}function m(a,b){var c=a[b+"axis"];return"object"==typeof c&&(c=c.n),"number"!=typeof c&&(c=1),c}function n(){return a.grep(ka.concat(la),function(a){return a})}function o(a){var b,c,d={};for(b=0;b<ka.length;++b)c=ka[b],c&&c.used&&(d["x"+c.n]=c.c2p(a.left));for(b=0;b<la.length;++b)c=la[b],c&&c.used&&(d["y"+c.n]=c.c2p(a.top));return void 0!==d.x1&&(d.x=d.x1),void 0!==d.y1&&(d.y=d.y1),d}function p(a){var b,c,d,e={};for(b=0;b<ka.length;++b)if(c=ka[b],c&&c.used&&(d="x"+c.n,null==a[d]&&1==c.n&&(d="x"),null!=a[d])){e.left=c.p2c(a[d]);break}for(b=0;b<la.length;++b)if(c=la[b],c&&c.used&&(d="y"+c.n,null==a[d]&&1==c.n&&(d="y"),null!=a[d])){e.top=c.p2c(a[d]);break}return e}function q(b,c){return b[c-1]||(b[c-1]={n:c,direction:b==ka?"x":"y",options:a.extend(!0,{},b==ka?ea.xaxis:ea.yaxis)}),b[c-1]}function r(){var b,c=da.length,d=-1;for(b=0;b<da.length;++b){var e=da[b].color;null!=e&&(c--,"number"==typeof e&&e>d&&(d=e))}c<=d&&(c=d+1);var f,g=[],h=ea.colors,i=h.length,j=0;for(b=0;b<c;b++)f=a.color.parse(h[b%i]||"#666"),b%i==0&&b&&(j=j>=0?j<.5?-j-.2:0:-j),g[b]=f.scale("rgb",1+j);var k,l=0;for(b=0;b<da.length;++b){if(k=da[b],null==k.color?(k.color=g[l].toString(),++l):"number"==typeof k.color&&(k.color=g[k.color].toString()),null==k.lines.show){var n,o=!0;for(n in k)if(k[n]&&k[n].show){o=!1;break}o&&(k.lines.show=!0)}null==k.lines.zero&&(k.lines.zero=!!k.lines.fill),k.xaxis=q(ka,m(k,"x")),k.yaxis=q(la,m(k,"y"))}}function s(){function b(a,b,c){b<a.datamin&&b!=-s&&(a.datamin=b),c>a.datamax&&c!=s&&(a.datamax=c)}var c,d,e,f,g,i,j,k,l,m,o,p,q=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,s=Number.MAX_VALUE;for(a.each(n(),function(a,b){b.datamin=q,b.datamax=r,b.used=!1}),c=0;c<da.length;++c)g=da[c],g.datapoints={points:[]},h(pa.processRawData,[g,g.data,g.datapoints]);for(c=0;c<da.length;++c){if(g=da[c],o=g.data,p=g.datapoints.format,!p){if(p=[],p.push({x:!0,number:!0,required:!0}),p.push({y:!0,number:!0,required:!0}),g.bars.show||g.lines.show&&g.lines.fill){var t=!!(g.bars.show&&g.bars.zero||g.lines.show&&g.lines.zero);p.push({y:!0,number:!0,required:!1,defaultValue:0,autoscale:t}),g.bars.horizontal&&(delete p[p.length-1].y,p[p.length-1].x=!0)}g.datapoints.format=p}if(null==g.datapoints.pointsize){g.datapoints.pointsize=p.length,j=g.datapoints.pointsize,i=g.datapoints.points;var u=g.lines.show&&g.lines.steps;for(g.xaxis.used=g.yaxis.used=!0,d=e=0;d<o.length;++d,e+=j){m=o[d];var v=null==m;if(!v)for(f=0;f<j;++f)k=m[f],l=p[f],l&&(l.number&&null!=k&&(k=+k,isNaN(k)?k=null:k==1/0?k=s:k==-(1/0)&&(k=-s)),null==k&&(l.required&&(v=!0),null!=l.defaultValue&&(k=l.defaultValue))),i[e+f]=k;if(v)for(f=0;f<j;++f)k=i[e+f],null!=k&&(l=p[f],l.autoscale!==!1&&(l.x&&b(g.xaxis,k,k),l.y&&b(g.yaxis,k,k))),i[e+f]=null;else if(u&&e>0&&null!=i[e-j]&&i[e-j]!=i[e]&&i[e-j+1]!=i[e+1]){for(f=0;f<j;++f)i[e+j+f]=i[e+f];i[e+1]=i[e-j+1],e+=j}}}}for(c=0;c<da.length;++c)g=da[c],h(pa.processDatapoints,[g,g.datapoints]);for(c=0;c<da.length;++c){g=da[c],i=g.datapoints.points,j=g.datapoints.pointsize,p=g.datapoints.format;var w=q,x=q,y=r,z=r;for(d=0;d<i.length;d+=j)if(null!=i[d])for(f=0;f<j;++f)k=i[d+f],l=p[f],l&&l.autoscale!==!1&&k!=s&&k!=-s&&(l.x&&(k<w&&(w=k),k>y&&(y=k)),l.y&&(k<x&&(x=k),k>z&&(z=k)));if(g.bars.show){var A;switch(g.bars.align){case"left":A=0;break;case"right":A=-g.bars.barWidth;break;default:A=-g.bars.barWidth/2}g.bars.horizontal?(x+=A,z+=A+g.bars.barWidth):(w+=A,y+=A+g.bars.barWidth)}b(g.xaxis,w,y),b(g.yaxis,x,z)}a.each(n(),function(a,b){b.datamin==q&&(b.datamin=null),b.datamax==r&&(b.datamax=null)})}function t(){c.css("padding",0).children().filter(function(){return!a(this).hasClass("flot-overlay")&&!a(this).hasClass("flot-base")}).remove(),"static"==c.css("position")&&c.css("position","relative"),fa=new b("flot-base",c),ga=new b("flot-overlay",c),ia=fa.context,ja=ga.context,ha=a(ga.element).unbind();var d=c.data("plot");d&&(d.shutdown(),ga.clear()),c.data("plot",qa)}function u(){ea.grid.hoverable&&(ha.mousemove(T),ha.bind("mouseleave",U)),ea.grid.clickable&&ha.click(V),h(pa.bindEvents,[ha])}function v(){sa&&clearTimeout(sa),ha.unbind("mousemove",T),ha.unbind("mouseleave",U),ha.unbind("click",V),h(pa.shutdown,[ha])}function w(a){function b(a){return a}var c,d,e=a.options.transform||b,f=a.options.inverseTransform;"x"==a.direction?(c=a.scale=na/Math.abs(e(a.max)-e(a.min)),d=Math.min(e(a.max),e(a.min))):(c=a.scale=oa/Math.abs(e(a.max)-e(a.min)),c=-c,d=Math.max(e(a.max),e(a.min))),e==b?a.p2c=function(a){return(a-d)*c}:a.p2c=function(a){return(e(a)-d)*c},f?a.c2p=function(a){return f(d+a/c)}:a.c2p=function(a){return d+a/c}}function x(a){for(var b=a.options,c=a.ticks||[],d=b.labelWidth||0,e=b.labelHeight||0,f=d||("x"==a.direction?Math.floor(fa.width/(c.length||1)):null),g=a.direction+"Axis "+a.direction+a.n+"Axis",h="flot-"+a.direction+"-axis flot-"+a.direction+a.n+"-axis "+g,i=b.font||"flot-tick-label tickLabel",j=0;j<c.length;++j){var k=c[j];if(k.label){var l=fa.getTextInfo(h,k.label,i,null,f);d=Math.max(d,l.width),e=Math.max(e,l.height)}}a.labelWidth=b.labelWidth||d,a.labelHeight=b.labelHeight||e}function y(b){var c=b.labelWidth,d=b.labelHeight,e=b.options.position,f="x"===b.direction,g=b.options.tickLength,h=ea.grid.axisMargin,i=ea.grid.labelMargin,j=!0,k=!0,l=!0,m=!1;a.each(f?ka:la,function(a,c){c&&c.reserveSpace&&(c===b?m=!0:c.options.position===e&&(m?k=!1:j=!1),m||(l=!1))}),k&&(h=0),null==g&&(g=l?"full":5),isNaN(+g)||(i+=+g),f?(d+=i,"bottom"==e?(ma.bottom+=d+h,b.box={top:fa.height-ma.bottom,height:d}):(b.box={top:ma.top+h,height:d},ma.top+=d+h)):(c+=i,"left"==e?(b.box={left:ma.left+h,width:c},ma.left+=c+h):(ma.right+=c+h,b.box={left:fa.width-ma.right,width:c})),b.position=e,b.tickLength=g,b.box.padding=i,b.innermost=j}function z(a){"x"==a.direction?(a.box.left=ma.left-a.labelWidth/2,a.box.width=fa.width-ma.left-ma.right+a.labelWidth):(a.box.top=ma.top-a.labelHeight/2,a.box.height=fa.height-ma.bottom-ma.top+a.labelHeight)}function A(){var b,c=ea.grid.minBorderMargin;if(null==c)for(c=0,b=0;b<da.length;++b)c=Math.max(c,2*(da[b].points.radius+da[b].points.lineWidth/2));var d={left:c,right:c,top:c,bottom:c};a.each(n(),function(a,b){if(b.reserveSpace&&b.ticks&&b.ticks.length){var c=b.ticks[b.ticks.length-1];"x"===b.direction?(d.left=Math.max(d.left,b.labelWidth/2),c.v<=b.max&&(d.right=Math.max(d.right,b.labelWidth/2))):(d.bottom=Math.max(d.bottom,b.labelHeight/2),c.v<=b.max&&(d.top=Math.max(d.top,b.labelHeight/2)))}}),ma.left=Math.ceil(Math.max(d.left,ma.left)),ma.right=Math.ceil(Math.max(d.right,ma.right)),ma.top=Math.ceil(Math.max(d.top,ma.top)),ma.bottom=Math.ceil(Math.max(d.bottom,ma.bottom))}function B(){var b,c=n(),d=ea.grid.show;for(var e in ma){var f=ea.grid.margin||0;ma[e]="number"==typeof f?f:f[e]||0}h(pa.processOffset,[ma]);for(var e in ma)"object"==typeof ea.grid.borderWidth?ma[e]+=d?ea.grid.borderWidth[e]:0:ma[e]+=d?ea.grid.borderWidth:0;if(a.each(c,function(a,b){b.show=b.options.show,null==b.show&&(b.show=b.used),b.reserveSpace=b.show||b.options.reserveSpace,C(b)}),d){var g=a.grep(c,function(a){return a.reserveSpace});for(a.each(g,function(a,b){D(b),E(b),F(b,b.ticks),x(b)}),b=g.length-1;b>=0;--b)y(g[b]);A(),a.each(g,function(a,b){z(b)})}na=fa.width-ma.left-ma.right,oa=fa.height-ma.bottom-ma.top,a.each(c,function(a,b){w(b)}),d&&K(),R()}function C(a){var b=a.options,c=+(null!=b.min?b.min:a.datamin),d=+(null!=b.max?b.max:a.datamax),e=d-c;if(0==e){var f=0==d?1:.01;null==b.min&&(c-=f),null!=b.max&&null==b.min||(d+=f)}else{var g=b.autoscaleMargin;null!=g&&(null==b.min&&(c-=e*g,c<0&&null!=a.datamin&&a.datamin>=0&&(c=0)),null==b.max&&(d+=e*g,d>0&&null!=a.datamax&&a.datamax<=0&&(d=0)))}a.min=c,a.max=d}function D(b){var c,e=b.options;c="number"==typeof e.ticks&&e.ticks>0?e.ticks:.3*Math.sqrt("x"==b.direction?fa.width:fa.height);var f=(b.max-b.min)/c,g=-Math.floor(Math.log(f)/Math.LN10),h=e.tickDecimals;null!=h&&g>h&&(g=h);var i,j=Math.pow(10,-g),k=f/j;if(k<1.5?i=1:k<3?(i=2,k>2.25&&(null==h||g+1<=h)&&(i=2.5,++g)):i=k<7.5?5:10,i*=j,null!=e.minTickSize&&i<e.minTickSize&&(i=e.minTickSize),b.delta=f,b.tickDecimals=Math.max(0,null!=h?h:g),b.tickSize=e.tickSize||i,"time"==e.mode&&!b.tickGenerator)throw new Error("Time mode requires the flot.time plugin.");if(b.tickGenerator||(b.tickGenerator=function(a){var b,c=[],e=d(a.min,a.tickSize),f=0,g=Number.NaN;do b=g,g=e+f*a.tickSize,c.push(g),++f;while(g<a.max&&g!=b);return c},b.tickFormatter=function(a,b){var c=b.tickDecimals?Math.pow(10,b.tickDecimals):1,d=""+Math.round(a*c)/c;if(null!=b.tickDecimals){var e=d.indexOf("."),f=e==-1?0:d.length-e-1;if(f<b.tickDecimals)return(f?d:d+".")+(""+c).substr(1,b.tickDecimals-f)}return d}),a.isFunction(e.tickFormatter)&&(b.tickFormatter=function(a,b){return""+e.tickFormatter(a,b)}),null!=e.alignTicksWithAxis){var l=("x"==b.direction?ka:la)[e.alignTicksWithAxis-1];if(l&&l.used&&l!=b){var m=b.tickGenerator(b);if(m.length>0&&(null==e.min&&(b.min=Math.min(b.min,m[0])),null==e.max&&m.length>1&&(b.max=Math.max(b.max,m[m.length-1]))),b.tickGenerator=function(a){var b,c,d=[];for(c=0;c<l.ticks.length;++c)b=(l.ticks[c].v-l.min)/(l.max-l.min),b=a.min+b*(a.max-a.min),d.push(b);return d},!b.mode&&null==e.tickDecimals){var n=Math.max(0,-Math.floor(Math.log(b.delta)/Math.LN10)+1),o=b.tickGenerator(b);o.length>1&&/\..*0$/.test((o[1]-o[0]).toFixed(n))||(b.tickDecimals=n)}}}}function E(b){var c=b.options.ticks,d=[];null==c||"number"==typeof c&&c>0?d=b.tickGenerator(b):c&&(d=a.isFunction(c)?c(b):c);var e,f;for(b.ticks=[],e=0;e<d.length;++e){var g=null,h=d[e];"object"==typeof h?(f=+h[0],h.length>1&&(g=h[1])):f=+h,null==g&&(g=b.tickFormatter(f,b)),isNaN(f)||b.ticks.push({v:f,label:g})}}function F(a,b){a.options.autoscaleMargin&&b.length>0&&(null==a.options.min&&(a.min=Math.min(a.min,b[0].v)),null==a.options.max&&b.length>1&&(a.max=Math.max(a.max,b[b.length-1].v)))}function G(){fa.clear(),h(pa.drawBackground,[ia]);var a=ea.grid;a.show&&a.backgroundColor&&I(),a.show&&!a.aboveData&&J();for(var b=0;b<da.length;++b)h(pa.drawSeries,[ia,da[b]]),L(da[b]);h(pa.draw,[ia]),a.show&&a.aboveData&&J(),fa.render(),X()}function H(a,b){for(var c,d,e,f,g=n(),h=0;h<g.length;++h)if(c=g[h],c.direction==b&&(f=b+c.n+"axis",a[f]||1!=c.n||(f=b+"axis"),a[f])){d=a[f].from,e=a[f].to;break}if(a[f]||(c="x"==b?ka[0]:la[0],d=a[b+"1"],e=a[b+"2"]),null!=d&&null!=e&&d>e){var i=d;d=e,e=i}return{from:d,to:e,axis:c}}function I(){ia.save(),ia.translate(ma.left,ma.top),ia.fillStyle=ca(ea.grid.backgroundColor,oa,0,"rgba(255, 255, 255, 0)"),ia.fillRect(0,0,na,oa),ia.restore()}function J(){var b,c,d,e;ia.save(),ia.translate(ma.left,ma.top);var f=ea.grid.markings;if(f)for(a.isFunction(f)&&(c=qa.getAxes(),c.xmin=c.xaxis.min,c.xmax=c.xaxis.max,c.ymin=c.yaxis.min,c.ymax=c.yaxis.max,f=f(c)),b=0;b<f.length;++b){var g=f[b],h=H(g,"x"),i=H(g,"y");null==h.from&&(h.from=h.axis.min),null==h.to&&(h.to=h.axis.max),null==i.from&&(i.from=i.axis.min),null==i.to&&(i.to=i.axis.max),h.to<h.axis.min||h.from>h.axis.max||i.to<i.axis.min||i.from>i.axis.max||(h.from=Math.max(h.from,h.axis.min),h.to=Math.min(h.to,h.axis.max),i.from=Math.max(i.from,i.axis.min),i.to=Math.min(i.to,i.axis.max),h.from==h.to&&i.from==i.to||(h.from=h.axis.p2c(h.from),h.to=h.axis.p2c(h.to),i.from=i.axis.p2c(i.from),i.to=i.axis.p2c(i.to),h.from==h.to||i.from==i.to?(ia.beginPath(),ia.strokeStyle=g.color||ea.grid.markingsColor,ia.lineWidth=g.lineWidth||ea.grid.markingsLineWidth,ia.moveTo(h.from,i.from),ia.lineTo(h.to,i.to),ia.stroke()):(ia.fillStyle=g.color||ea.grid.markingsColor,ia.fillRect(h.from,i.to,h.to-h.from,i.from-i.to))))}c=n(),d=ea.grid.borderWidth;for(var j=0;j<c.length;++j){var k,l,m,o,p=c[j],q=p.box,r=p.tickLength;if(p.show&&0!=p.ticks.length){for(ia.lineWidth=1,"x"==p.direction?(k=0,l="full"==r?"top"==p.position?0:oa:q.top-ma.top+("top"==p.position?q.height:0)):(l=0,k="full"==r?"left"==p.position?0:na:q.left-ma.left+("left"==p.position?q.width:0)),p.innermost||(ia.strokeStyle=p.options.color,ia.beginPath(),m=o=0,"x"==p.direction?m=na+1:o=oa+1,1==ia.lineWidth&&("x"==p.direction?l=Math.floor(l)+.5:k=Math.floor(k)+.5),ia.moveTo(k,l),ia.lineTo(k+m,l+o),ia.stroke()),ia.strokeStyle=p.options.tickColor,ia.beginPath(),b=0;b<p.ticks.length;++b){var s=p.ticks[b].v;m=o=0,isNaN(s)||s<p.min||s>p.max||"full"==r&&("object"==typeof d&&d[p.position]>0||d>0)&&(s==p.min||s==p.max)||("x"==p.direction?(k=p.p2c(s),o="full"==r?-oa:r,"top"==p.position&&(o=-o)):(l=p.p2c(s),m="full"==r?-na:r,"left"==p.position&&(m=-m)),1==ia.lineWidth&&("x"==p.direction?k=Math.floor(k)+.5:l=Math.floor(l)+.5),ia.moveTo(k,l),ia.lineTo(k+m,l+o))}ia.stroke()}}d&&(e=ea.grid.borderColor,"object"==typeof d||"object"==typeof e?("object"!=typeof d&&(d={top:d,right:d,bottom:d,left:d}),"object"!=typeof e&&(e={top:e,right:e,bottom:e,left:e}),d.top>0&&(ia.strokeStyle=e.top,ia.lineWidth=d.top,ia.beginPath(),ia.moveTo(0-d.left,0-d.top/2),ia.lineTo(na,0-d.top/2),ia.stroke()),d.right>0&&(ia.strokeStyle=e.right,ia.lineWidth=d.right,ia.beginPath(),ia.moveTo(na+d.right/2,0-d.top),ia.lineTo(na+d.right/2,oa),ia.stroke()),d.bottom>0&&(ia.strokeStyle=e.bottom,ia.lineWidth=d.bottom,ia.beginPath(),ia.moveTo(na+d.right,oa+d.bottom/2),ia.lineTo(0,oa+d.bottom/2),ia.stroke()),d.left>0&&(ia.strokeStyle=e.left,ia.lineWidth=d.left,ia.beginPath(),ia.moveTo(0-d.left/2,oa+d.bottom),ia.lineTo(0-d.left/2,0),ia.stroke())):(ia.lineWidth=d,ia.strokeStyle=ea.grid.borderColor,ia.strokeRect(-d/2,-d/2,na+d,oa+d))),ia.restore()}function K(){a.each(n(),function(a,b){var c,d,e,f,g,h=b.box,i=b.direction+"Axis "+b.direction+b.n+"Axis",j="flot-"+b.direction+"-axis flot-"+b.direction+b.n+"-axis "+i,k=b.options.font||"flot-tick-label tickLabel";if(fa.removeText(j),b.show&&0!=b.ticks.length)for(var l=0;l<b.ticks.length;++l)c=b.ticks[l],!c.label||c.v<b.min||c.v>b.max||("x"==b.direction?(f="center",d=ma.left+b.p2c(c.v),"bottom"==b.position?e=h.top+h.padding:(e=h.top+h.height-h.padding,g="bottom")):(g="middle",e=ma.top+b.p2c(c.v),"left"==b.position?(d=h.left+h.width-h.padding,f="right"):d=h.left+h.padding),fa.addText(j,d,e,c.label,k,null,null,f,g))})}function L(a){a.lines.show&&M(a),a.bars.show&&P(a),a.points.show&&N(a)}function M(a){function b(a,b,c,d,e){var f=a.points,g=a.pointsize,h=null,i=null;ia.beginPath();for(var j=g;j<f.length;j+=g){var k=f[j-g],l=f[j-g+1],m=f[j],n=f[j+1];if(null!=k&&null!=m){if(l<=n&&l<e.min){if(n<e.min)continue;k=(e.min-l)/(n-l)*(m-k)+k,l=e.min}else if(n<=l&&n<e.min){if(l<e.min)continue;m=(e.min-l)/(n-l)*(m-k)+k,n=e.min}if(l>=n&&l>e.max){if(n>e.max)continue;k=(e.max-l)/(n-l)*(m-k)+k,l=e.max}else if(n>=l&&n>e.max){if(l>e.max)continue;m=(e.max-l)/(n-l)*(m-k)+k,n=e.max}if(k<=m&&k<d.min){if(m<d.min)continue;l=(d.min-k)/(m-k)*(n-l)+l,k=d.min}else if(m<=k&&m<d.min){if(k<d.min)continue;n=(d.min-k)/(m-k)*(n-l)+l,m=d.min}if(k>=m&&k>d.max){if(m>d.max)continue;l=(d.max-k)/(m-k)*(n-l)+l,k=d.max}else if(m>=k&&m>d.max){if(k>d.max)continue;n=(d.max-k)/(m-k)*(n-l)+l,m=d.max}k==h&&l==i||ia.moveTo(d.p2c(k)+b,e.p2c(l)+c),h=m,i=n,ia.lineTo(d.p2c(m)+b,e.p2c(n)+c)}}ia.stroke()}function c(a,b,c){for(var d=a.points,e=a.pointsize,f=Math.min(Math.max(0,c.min),c.max),g=0,h=!1,i=1,j=0,k=0;;){if(e>0&&g>d.length+e)break;g+=e;var l=d[g-e],m=d[g-e+i],n=d[g],o=d[g+i];if(h){if(e>0&&null!=l&&null==n){k=g,e=-e,i=2;continue}if(e<0&&g==j+e){ia.fill(),h=!1,e=-e,i=1,g=j=k+e;continue}}if(null!=l&&null!=n){if(l<=n&&l<b.min){if(n<b.min)continue;m=(b.min-l)/(n-l)*(o-m)+m,l=b.min}else if(n<=l&&n<b.min){if(l<b.min)continue;o=(b.min-l)/(n-l)*(o-m)+m,n=b.min}if(l>=n&&l>b.max){if(n>b.max)continue;m=(b.max-l)/(n-l)*(o-m)+m,l=b.max}else if(n>=l&&n>b.max){if(l>b.max)continue;o=(b.max-l)/(n-l)*(o-m)+m,n=b.max}if(h||(ia.beginPath(),ia.moveTo(b.p2c(l),c.p2c(f)),h=!0),m>=c.max&&o>=c.max)ia.lineTo(b.p2c(l),c.p2c(c.max)),ia.lineTo(b.p2c(n),c.p2c(c.max));else if(m<=c.min&&o<=c.min)ia.lineTo(b.p2c(l),c.p2c(c.min)),ia.lineTo(b.p2c(n),c.p2c(c.min));else{var p=l,q=n;m<=o&&m<c.min&&o>=c.min?(l=(c.min-m)/(o-m)*(n-l)+l,m=c.min):o<=m&&o<c.min&&m>=c.min&&(n=(c.min-m)/(o-m)*(n-l)+l,o=c.min),m>=o&&m>c.max&&o<=c.max?(l=(c.max-m)/(o-m)*(n-l)+l,m=c.max):o>=m&&o>c.max&&m<=c.max&&(n=(c.max-m)/(o-m)*(n-l)+l,o=c.max),l!=p&&ia.lineTo(b.p2c(p),c.p2c(m)),ia.lineTo(b.p2c(l),c.p2c(m)),ia.lineTo(b.p2c(n),c.p2c(o)),n!=q&&(ia.lineTo(b.p2c(n),c.p2c(o)),ia.lineTo(b.p2c(q),c.p2c(o)))}}}}ia.save(),ia.translate(ma.left,ma.top),ia.lineJoin="round";var d=a.lines.lineWidth,e=a.shadowSize;if(d>0&&e>0){ia.lineWidth=e,ia.strokeStyle="rgba(0,0,0,0.1)";var f=Math.PI/18;b(a.datapoints,Math.sin(f)*(d/2+e/2),Math.cos(f)*(d/2+e/2),a.xaxis,a.yaxis),ia.lineWidth=e/2,b(a.datapoints,Math.sin(f)*(d/2+e/4),Math.cos(f)*(d/2+e/4),a.xaxis,a.yaxis)}ia.lineWidth=d,ia.strokeStyle=a.color;var g=Q(a.lines,a.color,0,oa);g&&(ia.fillStyle=g,c(a.datapoints,a.xaxis,a.yaxis)),d>0&&b(a.datapoints,0,0,a.xaxis,a.yaxis),ia.restore()}function N(a){function b(a,b,c,d,e,f,g,h){for(var i=a.points,j=a.pointsize,k=0;k<i.length;k+=j){var l=i[k],m=i[k+1];null==l||l<f.min||l>f.max||m<g.min||m>g.max||(ia.beginPath(),l=f.p2c(l),m=g.p2c(m)+d,"circle"==h?ia.arc(l,m,b,0,e?Math.PI:2*Math.PI,!1):h(ia,l,m,b,e),ia.closePath(),c&&(ia.fillStyle=c,ia.fill()),ia.stroke())}}ia.save(),ia.translate(ma.left,ma.top);var c=a.points.lineWidth,d=a.shadowSize,e=a.points.radius,f=a.points.symbol;if(0==c&&(c=1e-4),c>0&&d>0){var g=d/2;ia.lineWidth=g,ia.strokeStyle="rgba(0,0,0,0.1)",b(a.datapoints,e,null,g+g/2,!0,a.xaxis,a.yaxis,f),ia.strokeStyle="rgba(0,0,0,0.2)",b(a.datapoints,e,null,g/2,!0,a.xaxis,a.yaxis,f)}ia.lineWidth=c,ia.strokeStyle=a.color,b(a.datapoints,e,Q(a.points,a.color),0,!1,a.xaxis,a.yaxis,f),ia.restore()}function O(a,b,c,d,e,f,g,h,i,j,k){var l,m,n,o,p,q,r,s,t;j?(s=q=r=!0,p=!1,l=c,m=a,o=b+d,n=b+e,m<l&&(t=m,m=l,l=t,p=!0,q=!1)):(p=q=r=!0,s=!1,l=a+d,m=a+e,n=c,o=b,o<n&&(t=o,o=n,n=t,s=!0,r=!1)),m<g.min||l>g.max||o<h.min||n>h.max||(l<g.min&&(l=g.min,p=!1),m>g.max&&(m=g.max,q=!1),n<h.min&&(n=h.min,s=!1),o>h.max&&(o=h.max,r=!1),l=g.p2c(l),n=h.p2c(n),m=g.p2c(m),o=h.p2c(o),f&&(i.fillStyle=f(n,o),i.fillRect(l,o,m-l,n-o)),k>0&&(p||q||r||s)&&(i.beginPath(),i.moveTo(l,n),p?i.lineTo(l,o):i.moveTo(l,o),r?i.lineTo(m,o):i.moveTo(m,o),q?i.lineTo(m,n):i.moveTo(m,n),s?i.lineTo(l,n):i.moveTo(l,n),i.stroke()))}function P(a){function b(b,c,d,e,f,g){for(var h=b.points,i=b.pointsize,j=0;j<h.length;j+=i)null!=h[j]&&O(h[j],h[j+1],h[j+2],c,d,e,f,g,ia,a.bars.horizontal,a.bars.lineWidth)}ia.save(),ia.translate(ma.left,ma.top),ia.lineWidth=a.bars.lineWidth,ia.strokeStyle=a.color;var c;switch(a.bars.align){case"left":c=0;break;case"right":c=-a.bars.barWidth;break;default:c=-a.bars.barWidth/2}var d=a.bars.fill?function(b,c){return Q(a.bars,a.color,b,c)}:null;b(a.datapoints,c,c+a.bars.barWidth,d,a.xaxis,a.yaxis),ia.restore()}function Q(b,c,d,e){var f=b.fill;if(!f)return null;if(b.fillColor)return ca(b.fillColor,d,e,c);var g=a.color.parse(c);return g.a="number"==typeof f?f:.4,g.normalize(),g.toString()}function R(){if(null!=ea.legend.container?a(ea.legend.container).html(""):c.find(".legend").remove(),ea.legend.show){for(var b,d,e=[],f=[],g=!1,h=ea.legend.labelFormatter,i=0;i<da.length;++i)b=da[i],b.label&&(d=h?h(b.label,b):b.label,d&&f.push({label:d,color:b.color}));if(ea.legend.sorted)if(a.isFunction(ea.legend.sorted))f.sort(ea.legend.sorted);else if("reverse"==ea.legend.sorted)f.reverse();else{var j="descending"!=ea.legend.sorted;f.sort(function(a,b){return a.label==b.label?0:a.label<b.label!=j?1:-1})}for(var i=0;i<f.length;++i){
var k=f[i];i%ea.legend.noColumns==0&&(g&&e.push("</tr>"),e.push("<tr>"),g=!0),e.push('<td class="legendColorBox"><div style="border:1px solid '+ea.legend.labelBoxBorderColor+';padding:1px"><div style="width:4px;height:0;border:5px solid '+k.color+';overflow:hidden"></div></div></td><td class="legendLabel">'+k.label+"</td>")}if(g&&e.push("</tr>"),0!=e.length){var l='<table style="font-size:smaller;color:'+ea.grid.color+'">'+e.join("")+"</table>";if(null!=ea.legend.container)a(ea.legend.container).html(l);else{var m="",n=ea.legend.position,o=ea.legend.margin;null==o[0]&&(o=[o,o]),"n"==n.charAt(0)?m+="top:"+(o[1]+ma.top)+"px;":"s"==n.charAt(0)&&(m+="bottom:"+(o[1]+ma.bottom)+"px;"),"e"==n.charAt(1)?m+="right:"+(o[0]+ma.right)+"px;":"w"==n.charAt(1)&&(m+="left:"+(o[0]+ma.left)+"px;");var p=a('<div class="legend">'+l.replace('style="','style="position:absolute;'+m+";")+"</div>").appendTo(c);if(0!=ea.legend.backgroundOpacity){var q=ea.legend.backgroundColor;null==q&&(q=ea.grid.backgroundColor,q=q&&"string"==typeof q?a.color.parse(q):a.color.extract(p,"background-color"),q.a=1,q=q.toString());var r=p.children();a('<div style="position:absolute;width:'+r.width()+"px;height:"+r.height()+"px;"+m+"background-color:"+q+';"> </div>').prependTo(p).css("opacity",ea.legend.backgroundOpacity)}}}}}function S(a,b,c){var d,e,f,g=ea.grid.mouseActiveRadius,h=g*g+1,i=null;for(d=da.length-1;d>=0;--d)if(c(da[d])){var j=da[d],k=j.xaxis,l=j.yaxis,m=j.datapoints.points,n=k.c2p(a),o=l.c2p(b),p=g/k.scale,q=g/l.scale;if(f=j.datapoints.pointsize,k.options.inverseTransform&&(p=Number.MAX_VALUE),l.options.inverseTransform&&(q=Number.MAX_VALUE),j.lines.show||j.points.show)for(e=0;e<m.length;e+=f){var r=m[e],s=m[e+1];if(null!=r&&!(r-n>p||r-n<-p||s-o>q||s-o<-q)){var t=Math.abs(k.p2c(r)-a),u=Math.abs(l.p2c(s)-b),v=t*t+u*u;v<h&&(h=v,i=[d,e/f])}}if(j.bars.show&&!i){var w,x;switch(j.bars.align){case"left":w=0;break;case"right":w=-j.bars.barWidth;break;default:w=-j.bars.barWidth/2}for(x=w+j.bars.barWidth,e=0;e<m.length;e+=f){var r=m[e],s=m[e+1],y=m[e+2];null!=r&&(da[d].bars.horizontal?n<=Math.max(y,r)&&n>=Math.min(y,r)&&o>=s+w&&o<=s+x:n>=r+w&&n<=r+x&&o>=Math.min(y,s)&&o<=Math.max(y,s))&&(i=[d,e/f])}}}return i?(d=i[0],e=i[1],f=da[d].datapoints.pointsize,{datapoint:da[d].datapoints.points.slice(e*f,(e+1)*f),dataIndex:e,series:da[d],seriesIndex:d}):null}function T(a){ea.grid.hoverable&&W("plothover",a,function(a){return 0!=a.hoverable})}function U(a){ea.grid.hoverable&&W("plothover",a,function(a){return!1})}function V(a){W("plotclick",a,function(a){return 0!=a.clickable})}function W(a,b,d){var e=ha.offset(),f=b.pageX-e.left-ma.left,g=b.pageY-e.top-ma.top,h=o({left:f,top:g});h.pageX=b.pageX,h.pageY=b.pageY;var i=S(f,g,d);if(i&&(i.pageX=parseInt(i.series.xaxis.p2c(i.datapoint[0])+e.left+ma.left,10),i.pageY=parseInt(i.series.yaxis.p2c(i.datapoint[1])+e.top+ma.top,10)),ea.grid.autoHighlight){for(var j=0;j<ra.length;++j){var k=ra[j];k.auto!=a||i&&k.series==i.series&&k.point[0]==i.datapoint[0]&&k.point[1]==i.datapoint[1]||$(k.series,k.point)}i&&Z(i.series,i.datapoint,a)}c.trigger(a,[h,i])}function X(){var a=ea.interaction.redrawOverlayInterval;return a==-1?void Y():void(sa||(sa=setTimeout(Y,a)))}function Y(){sa=null,ja.save(),ga.clear(),ja.translate(ma.left,ma.top);var a,b;for(a=0;a<ra.length;++a)b=ra[a],b.series.bars.show?ba(b.series,b.point):aa(b.series,b.point);ja.restore(),h(pa.drawOverlay,[ja])}function Z(a,b,c){if("number"==typeof a&&(a=da[a]),"number"==typeof b){var d=a.datapoints.pointsize;b=a.datapoints.points.slice(d*b,d*(b+1))}var e=_(a,b);e==-1?(ra.push({series:a,point:b,auto:c}),X()):c||(ra[e].auto=!1)}function $(a,b){if(null==a&&null==b)return ra=[],void X();if("number"==typeof a&&(a=da[a]),"number"==typeof b){var c=a.datapoints.pointsize;b=a.datapoints.points.slice(c*b,c*(b+1))}var d=_(a,b);d!=-1&&(ra.splice(d,1),X())}function _(a,b){for(var c=0;c<ra.length;++c){var d=ra[c];if(d.series==a&&d.point[0]==b[0]&&d.point[1]==b[1])return c}return-1}function aa(b,c){var d=c[0],e=c[1],f=b.xaxis,g=b.yaxis,h="string"==typeof b.highlightColor?b.highlightColor:a.color.parse(b.color).scale("a",.5).toString();if(!(d<f.min||d>f.max||e<g.min||e>g.max)){var i=b.points.radius+b.points.lineWidth/2;ja.lineWidth=i,ja.strokeStyle=h;var j=1.5*i;d=f.p2c(d),e=g.p2c(e),ja.beginPath(),"circle"==b.points.symbol?ja.arc(d,e,j,0,2*Math.PI,!1):b.points.symbol(ja,d,e,j,!1),ja.closePath(),ja.stroke()}}function ba(b,c){var d,e="string"==typeof b.highlightColor?b.highlightColor:a.color.parse(b.color).scale("a",.5).toString(),f=e;switch(b.bars.align){case"left":d=0;break;case"right":d=-b.bars.barWidth;break;default:d=-b.bars.barWidth/2}ja.lineWidth=b.bars.lineWidth,ja.strokeStyle=e,O(c[0],c[1],c[2]||0,d,d+b.bars.barWidth,function(){return f},b.xaxis,b.yaxis,ja,b.bars.horizontal,b.bars.lineWidth)}function ca(b,c,d,e){if("string"==typeof b)return b;for(var f=ia.createLinearGradient(0,d,0,c),g=0,h=b.colors.length;g<h;++g){var i=b.colors[g];if("string"!=typeof i){var j=a.color.parse(e);null!=i.brightness&&(j=j.scale("rgb",i.brightness)),null!=i.opacity&&(j.a*=i.opacity),i=j.toString()}f.addColorStop(g/(h-1),i)}return f}var da=[],ea={colors:["#edc240","#afd8f8","#cb4b4b","#4da74d","#9440ed"],legend:{show:!0,noColumns:1,labelFormatter:null,labelBoxBorderColor:"#ccc",container:null,position:"ne",margin:5,backgroundColor:null,backgroundOpacity:.85,sorted:null},xaxis:{show:null,position:"bottom",mode:null,font:null,color:null,tickColor:null,transform:null,inverseTransform:null,min:null,max:null,autoscaleMargin:null,ticks:null,tickFormatter:null,labelWidth:null,labelHeight:null,reserveSpace:null,tickLength:null,alignTicksWithAxis:null,tickDecimals:null,tickSize:null,minTickSize:null},yaxis:{autoscaleMargin:.02,position:"left"},xaxes:[],yaxes:[],series:{points:{show:!1,radius:3,lineWidth:2,fill:!0,fillColor:"#ffffff",symbol:"circle"},lines:{lineWidth:2,fill:!1,fillColor:null,steps:!1},bars:{show:!1,lineWidth:2,barWidth:1,fill:!0,fillColor:null,align:"left",horizontal:!1,zero:!0},shadowSize:3,highlightColor:null},grid:{show:!0,aboveData:!1,color:"#545454",backgroundColor:null,borderColor:null,tickColor:null,margin:0,labelMargin:5,axisMargin:8,borderWidth:2,minBorderMargin:null,markings:null,markingsColor:"#f4f4f4",markingsLineWidth:2,clickable:!1,hoverable:!1,autoHighlight:!0,mouseActiveRadius:10},interaction:{redrawOverlayInterval:1e3/60},hooks:{}},fa=null,ga=null,ha=null,ia=null,ja=null,ka=[],la=[],ma={left:0,right:0,top:0,bottom:0},na=0,oa=0,pa={processOptions:[],processRawData:[],processDatapoints:[],processOffset:[],drawBackground:[],drawSeries:[],draw:[],bindEvents:[],drawOverlay:[],shutdown:[]},qa=this;qa.setData=k,qa.setupGrid=B,qa.draw=G,qa.getPlaceholder=function(){return c},qa.getCanvas=function(){return fa.element},qa.getPlotOffset=function(){return ma},qa.width=function(){return na},qa.height=function(){return oa},qa.offset=function(){var a=ha.offset();return a.left+=ma.left,a.top+=ma.top,a},qa.getData=function(){return da},qa.getAxes=function(){var b={};return a.each(ka.concat(la),function(a,c){c&&(b[c.direction+(1!=c.n?c.n:"")+"axis"]=c)}),b},qa.getXAxes=function(){return ka},qa.getYAxes=function(){return la},qa.c2p=o,qa.p2c=p,qa.getOptions=function(){return ea},qa.highlight=Z,qa.unhighlight=$,qa.triggerRedrawOverlay=X,qa.pointOffset=function(a){return{left:parseInt(ka[m(a,"x")-1].p2c(+a.x)+ma.left,10),top:parseInt(la[m(a,"y")-1].p2c(+a.y)+ma.top,10)}},qa.shutdown=v,qa.destroy=function(){v(),c.removeData("plot").empty(),da=[],ea=null,fa=null,ga=null,ha=null,ia=null,ja=null,ka=[],la=[],pa=null,ra=[],qa=null},qa.resize=function(){var a=c.width(),b=c.height();fa.resize(a,b),ga.resize(a,b)},qa.hooks=pa,i(qa),j(f),t(),k(e),B(),G(),u();var ra=[],sa=null}function d(a,b){return b*Math.floor(a/b)}var e=Object.prototype.hasOwnProperty;b.prototype.resize=function(a,b){if(a<=0||b<=0)throw new Error("Invalid dimensions for plot, width = "+a+", height = "+b);var c=this.element,d=this.context,e=this.pixelRatio;this.width!=a&&(c.width=a*e,c.style.width=a+"px",this.width=a),this.height!=b&&(c.height=b*e,c.style.height=b+"px",this.height=b),d.restore(),d.save(),d.scale(e,e)},b.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},b.prototype.render=function(){var a=this._textCache;for(var b in a)if(e.call(a,b)){var c=this.getTextLayer(b),d=a[b];c.hide();for(var f in d)if(e.call(d,f)){var g=d[f];for(var h in g)if(e.call(g,h)){for(var i,j=g[h].positions,k=0;i=j[k];k++)i.active?i.rendered||(c.append(i.element),i.rendered=!0):(j.splice(k--,1),i.rendered&&i.element.detach());0==j.length&&delete g[h]}}c.show()}},b.prototype.getTextLayer=function(b){var c=this.text[b];return null==c&&(null==this.textContainer&&(this.textContainer=a("<div class='flot-text'></div>").css({position:"absolute",top:0,left:0,bottom:0,right:0,"font-size":"smaller",color:"#545454"}).insertAfter(this.element)),c=this.text[b]=a("<div></div>").addClass(b).css({position:"absolute",top:0,left:0,bottom:0,right:0}).appendTo(this.textContainer)),c},b.prototype.getTextInfo=function(b,c,d,e,f){var g,h,i,j;if(c=""+c,g="object"==typeof d?d.style+" "+d.variant+" "+d.weight+" "+d.size+"px/"+d.lineHeight+"px "+d.family:d,h=this._textCache[b],null==h&&(h=this._textCache[b]={}),i=h[g],null==i&&(i=h[g]={}),j=i[c],null==j){var k=a("<div></div>").html(c).css({position:"absolute","max-width":f,top:-9999}).appendTo(this.getTextLayer(b));"object"==typeof d?k.css({font:g,color:d.color}):"string"==typeof d&&k.addClass(d),j=i[c]={width:k.outerWidth(!0),height:k.outerHeight(!0),element:k,positions:[]},k.detach()}return j},b.prototype.addText=function(a,b,c,d,e,f,g,h,i){var j=this.getTextInfo(a,d,e,f,g),k=j.positions;"center"==h?b-=j.width/2:"right"==h&&(b-=j.width),"middle"==i?c-=j.height/2:"bottom"==i&&(c-=j.height);for(var l,m=0;l=k[m];m++)if(l.x==b&&l.y==c)return void(l.active=!0);l={active:!0,rendered:!1,element:k.length?j.element.clone():j.element,x:b,y:c},k.push(l),l.element.css({top:Math.round(c),left:Math.round(b),"text-align":h})},b.prototype.removeText=function(a,b,c,d,f,g){if(null==d){var h=this._textCache[a];if(null!=h)for(var i in h)if(e.call(h,i)){var j=h[i];for(var k in j)if(e.call(j,k))for(var l,m=j[k].positions,n=0;l=m[n];n++)l.active=!1}}else for(var l,m=this.getTextInfo(a,d,f,g).positions,n=0;l=m[n];n++)l.x==b&&l.y==c&&(l.active=!1)},a.plot=function(b,d,e){var f=new c(a(b),d,e,a.plot.plugins);return f},a.plot.version="0.8.2",a.plot.plugins=[],a.fn.plot=function(b,c){return this.each(function(){a.plot(this,b,c)})}}(a),a}),define("widgets/continuousGraph",["jquery","jqueryui/widget","flot"],function(a){"use strict";a.widget("ted.continuousGraph",{options:{label:"Label",numberOfDataPoints:120,initialValue:0,flotConfig:{series:{shadowSize:0,lines:{fill:!0}},colors:["#ff0000"],yaxis:{min:0,max:5e3},xaxis:{show:!1},legend:{backgroundOpacity:0}}},_create:function(){this.data=[];for(var b=0;b<this.options.numberOfDataPoints;b++)this.data.push([b,this.options.initialValue]);this.ui=a.plot(this.element,[{label:this.options.label,data:this.data}],this.options.flotConfig),this._refresh()},_refresh:function(){this.ui.draw()},_setOption:function(a,b){this._super(a,b),this._refresh()},update:function(a){this.data.length===this.options.numberOfDataPoints&&(this.data=this.data.slice(1)),this.data.push(Math.min(a,this.options.flotConfig.yaxis.max));for(var b=[],c=0;c<this.data.length;c++)b.push([c,this.data[c]]);this.ui.setData([{label:this.options.label,data:b}]),this._refresh()}})}),define("widgets/multiSeriesIndexGraph",["jquery","jqueryui/widget","flot"],function(a){"use strict";a.widget("ted.multiSeriesIndexGraph",{options:{labels:["Label"],initialValue:0,flotConfig:{series:{shadowSize:0,lines:{fill:!0}},colors:["#00ff00"],yaxis:{min:0,max:100},xaxis:{show:!1},legend:{backgroundOpacity:0}},numberOfDataPoints:120},_create:function(){this.data=[];for(var b=0;b<this.options.labels.length;b++){this.data[b]=[];for(var c=0;c<this.options.numberOfDataPoints;c++)this.data[b].push(this.options.initialValue)}this.ui=a.plot(this.element,this._graphData(),this.options.flotConfig),this._refresh()},_refresh:function(){this.ui.draw()},_setOption:function(a,b){this._super(a,b),this._refresh()},_graphData:function(){for(var a=[],b=0;b<this.data.length;b++){for(var c=[],d=0;d<this.options.numberOfDataPoints;d++)c.push([d,this.data[b][d]]);a.push({label:this.options.labels[b],data:c})}return a},update:function(a){if(this.data[0].length===this.options.numberOfDataPoints)for(var b=0;b<this.data.length;b++)this.data[b]=this.data[b].slice(1);for(var c=0;c<a.length;c++)this.data[c].push(Math.min(a[c],this.options.flotConfig.yaxis.max));this.ui.setData(this._graphData()),this._refresh()}})}),define("widgets/videoQos",["lodash","jquery","jqueryui/widget","widgets/continuousGraph","widgets/multiSeriesIndexGraph"],function(a,b){"use strict";b.widget("ted.videoQos",{options:{bandwidth:0,bufferLength:0,backBufferLength:0,loadLevel:0,nextLevel:0,currentLevel:0},_create:function(){var c="";a(["bandwidth","buffer","level"]).forEach(function(a){c+='<div id="'+a+'-graph" class="qos-player-graph"></div>'}),this.element.append('<div class="qos-graph-container">'+c+"</div>");var d=b("#bandwidth-graph");this.bwGraph=d,this.bwGraph.continuousGraph({label:"Bandwidth (kbps)",numberOfDataPoints:300,initialValue:0,flotConfig:{series:{shadowSize:0,lines:{fill:!0}},colors:["#ff0000"],yaxis:{min:0,max:5e3},xaxis:{show:!1},legend:{backgroundOpacity:0}}});var e=b("#buffer-graph");this.bufferGraph=e,this.bufferGraph.multiSeriesIndexGraph({labels:["Buffer","Back Buffer"],numberOfDataPoints:300,initialValue:0,flotConfig:{series:{shadowSize:0,lines:{fill:!1}},colors:["#00ff00","#0000ff"],yaxis:{min:0,max:100},xaxis:{show:!1},legend:{backgroundOpacity:0}}});var f=b("#level-graph");this.levelGraph=f,this.levelGraph.multiSeriesIndexGraph({labels:["Load level","Next level","Current level"],numberOfDataPoints:300,initialValue:0,flotConfig:{series:{shadowSize:0,lines:{show:!0,fill:!1}},colors:["#F3610D","#644089","#dbe66b"],yaxis:{min:0,max:7},xaxis:{show:!1},legend:{backgroundOpacity:0}}}),this._refresh()},_refresh:function(){this.bwGraph.continuousGraph("update",parseInt(this.options.bandwidth/1e3,10)),this.bufferGraph.multiSeriesIndexGraph("update",[parseInt(this.options.bufferLength,10),parseInt(this.options.backBufferLength,10)]),this.levelGraph.multiSeriesIndexGraph("update",[parseInt(this.options.loadLevel,10),parseInt(this.options.nextLevel,10),parseInt(this.options.currentLevel,10)])},_setOption:function(a,b){this._super(a,b),this._refresh()},_destroy:function(){this.element.children(".qos-graph-container").remove()}})}),define("jqueryui/core",["jquery"],function(a){return function(a,b){function c(b,c){var e,f,g,h=b.nodeName.toLowerCase();return"area"===h?(e=b.parentNode,f=e.name,!(!b.href||!f||"map"!==e.nodeName.toLowerCase())&&(g=a("img[usemap=#"+f+"]")[0],!!g&&d(g))):(/input|select|textarea|button|object/.test(h)?!b.disabled:"a"===h?b.href||c:c)&&d(b)}function d(b){return a.expr.filters.visible(b)&&!a(b).parents().addBack().filter(function(){return"hidden"===a.css(this,"visibility")}).length}var e=0,f=/^ui-id-\d+$/;a.ui=a.ui||{},a.extend(a.ui,{version:"@VERSION",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),a.fn.extend({focus:function(b){return function(c,d){return"number"==typeof c?this.each(function(){var b=this;setTimeout(function(){a(b).focus(),d&&d.call(b)},c)}):b.apply(this,arguments)}}(a.fn.focus),scrollParent:function(){var b;return b=a.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.css(this,"position"))&&/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!b.length?a(document):b},zIndex:function(c){if(c!==b)return this.css("zIndex",c);if(this.length)for(var d,e,f=a(this[0]);f.length&&f[0]!==document;){if(d=f.css("position"),("absolute"===d||"relative"===d||"fixed"===d)&&(e=parseInt(f.css("zIndex"),10),!isNaN(e)&&0!==e))return e;f=f.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})},removeUniqueId:function(){return this.each(function(){f.test(this.id)&&a(this).removeAttr("id")})}}),a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(b){return function(c){return!!a.data(c,b)}}):function(b,c,d){return!!a.data(b,d[3])},focusable:function(b){return c(b,!isNaN(a.attr(b,"tabindex")))},tabbable:function(b){var d=a.attr(b,"tabindex"),e=isNaN(d);return(e||d>=0)&&c(b,!e)}}),a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(c,d){function e(b,c,d,e){return a.each(f,function(){c-=parseFloat(a.css(b,"padding"+this))||0,d&&(c-=parseFloat(a.css(b,"border"+this+"Width"))||0),e&&(c-=parseFloat(a.css(b,"margin"+this))||0)}),c}var f="Width"===d?["Left","Right"]:["Top","Bottom"],g=d.toLowerCase(),h={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+d]=function(c){return c===b?h["inner"+d].call(this):this.each(function(){a(this).css(g,e(this,c)+"px")})},a.fn["outer"+d]=function(b,c){return"number"!=typeof b?h["outer"+d].call(this,b):this.each(function(){a(this).css(g,e(this,b,!0,c)+"px")})}}),a.fn.addBack||(a.fn.addBack=function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}),a("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(a.fn.removeData=function(b){return function(c){return arguments.length?b.call(this,a.camelCase(c)):b.call(this)}}(a.fn.removeData)),a.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),a.support.selectstart="onselectstart"in document.createElement("div"),a.fn.extend({disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),a.extend(a.ui,{plugin:{add:function(b,c,d){var e,f=a.ui[b].prototype;for(e in d)f.plugins[e]=f.plugins[e]||[],f.plugins[e].push([c,d[e]])},call:function(a,b,c){var d,e=a.plugins[b];if(e&&a.element[0].parentNode&&11!==a.element[0].parentNode.nodeType)for(d=0;d<e.length;d++)a.options[e[d][0]]&&e[d][1].apply(a.element,c)}},hasScroll:function(b,c){if("hidden"===a(b).css("overflow"))return!1;var d=c&&"left"===c?"scrollLeft":"scrollTop",e=!1;return b[d]>0||(b[d]=1,e=b[d]>0,b[d]=0,e)}})}(a),a}),define("lib/qos",["widgets/videoQos","jqueryui/core"],function(){"use strict";function a(){return c.player.is(":data(tedVideoQos)")}function b(){var b=c.player,d=b.player("mode"),e=!1;"flash"!==d&&"hlsjs"!==d||(b.on("playermetricsdata",function(c,d){e&&a()&&b.videoQos("option",d.metricsData)}),b.on("playermetricstoggle",function(){e=!e,e?a()||b.videoQos():a()&&b.videoQos("destroy")}))}var c={player:null};return c.initQos=b,c}),define("lib/fallback",["lodash","utils/query_param","exports"],function(a,b,c){"use strict";var d=window;c.winProp="TED_FALLBACK",c.init=a.once(function(){b("fallback")&&(d[c.winProp]=!0)}),c.isEnabled=function(){return c.init(),!!window[c.winProp]}}),define("lib/favorite",["exports","jquery","lib/fallback","lib/ga","lib/currentUserId","lib/pubSub"],function(a,b,c,d,e,f){"use strict";function g(a){var b=!!e.get();return b||a.reject(new Error("Not logged in")),c.isEnabled()?(a.reject(new Error("Site in degraded mode")),!1):b}var h=b.Deferred;a.add=function(a){var c=new h,e=c.promise();return g(c)?(b.post("/favorites",a).then(function(a){f("favorite.add").publish(a),c.resolve(a),d.sendEvent("favorite","add",a.itemType.toLowerCase())},function(){c.reject(new Error("Rejected by server"))}),e):e},a.get=function(a){var c=new h,d=c.promise();return g(c)?(b.getJSON("/favorites/find",a).then(function(a){c.resolve(a)},function(){c.reject(new Error("Rejected by server"))}),d):d},a.remove=function(a){var c=new h,d=c.promise();if(!g(c))return d;var e={data:a,dataType:"json",type:"DELETE",url:"/favorites/"+a.id};return b.ajax(e).then(function(a){f("favorite.remove").publish(a),c.resolve(a)},function(){c.reject(new Error("Rejected by server"))}),d}}),define("lib/personalStorage",["lodash","Modernizr","exports","lib/currentUserId"],function(a,b,c,d){"use strict";function e(b,d){var e=a.toArray(arguments);return!!c.storageAdapter&&(e[1]=c.getKey(d),b.apply(c.storageAdapter,e.slice(1)))}c.storageAdapter=b.localstorage?window.localStorage:void 0,c.getKey=function(a){var b=d.get();return b||(b="0"),b+"-"+a},c.getItem=a.wrap(function(a){return c.storageAdapter.getItem(a)},e),c.setItem=a.wrap(function(a,b){c.storageAdapter.setItem(a,b)},e),c.removeItem=a.wrap(function(a){c.storageAdapter.removeItem(a)},e)}),define("lib/watchLaterLocal",["exports","jquery","lodash","Modernizr","lib/currentUserId","lib/personalStorage"],function(a,b,c,d,e,f){"use strict";function g(a){return+a.split("|",1).pop()}function h(a){return(a.match(/(\|\d+)+/)||"|")[0]+"|"}function i(b){var c=new j,d=c.promise(),e=a._checkCapability();return e!==!0?(c.reject(e),d):(b.apply(c,Array.prototype.splice.call(arguments,1)),d)}var j=b.Deferred,k="wl",l=null,m=18e4,n=null;a.addPlaylist=function(b){return a._add("playlists",b)},a.addTalk=function(b){return a._add("talks",b)},a.checkPlaylist=function(b){return a._check("playlists",b)},a.checkTalk=function(b){return a._check("talks",b)},a.count=c.wrap(function(){var b=this;a._getCache().then(function(a){b.resolve({total:a.talksCount+a.playlistsCount,talks:a.talksCount,playlists:a.playlistsCount})},function(a){b.reject(a)})},i),a.removePlaylist=function(b){return a._remove("playlists",b)},a.removeTalk=function(b){return a._remove("talks",b)},a.sync=c.wrap(function(){if(n)return n;var d=this;return n=d.promise(),b.get("/saved_items/sync.txt").then(function(b){return b=+new Date+";"+b,(l=a._fromS(b))?(f.setItem(k,b),void d.resolve(l)):void d.reject(new Error("Invalid response"))},function(){d.reject(new Error("Rejected by server"))}).always(c.delay(function(){n=null},m)),n},i),a._add=c.wrap(function(b,c){var d=this;a._check(b,c).then(function(e){e||(l[b+"List"]+=c+"|",l[b+"Count"]++,f.setItem(k,a._toS(l))),d.resolve(l)},function(a){d.reject(a)})},i),a._check=c.wrap(function(b,c){var d=this;a._getCache().then(function(a){d.resolve(a[b+"List"].indexOf("|"+c+"|")!==-1)},function(a){d.reject(a)})},i),a._checkCapability=function(){return d.localstorage?!!e.get()||new Error("Not logged in"):new Error("No localStorage")},a._getCache=function(){var b=new j,c=b.promise();return l?(b.resolve(l),c):(l=a._fromS(f.getItem(k)),l?(b.resolve(l),+new Date-+l.lastSync>m&&a.sync()):a.sync().then(function(){b.resolve(l)},function(a){b.reject(a)}),c)},a._remove=c.wrap(function(b,c){var d=this;a._check(b,c).then(function(e){e&&(l[b+"List"]=l[b+"List"].replace("|"+c+"|","|"),l[b+"Count"]--,f.setItem(k,a._toS(l))),d.resolve(l)},function(a){d.reject(a)})},i),a._reset=function(){l=null,n=null},a._fromS=function(a){if(!a)return null;if(!a.match(/^\d+;\d+(\|\d+)*;\d+(\|\d+)*$/))return null;var b=a.split(";");return{lastSync:+b[0],talksCount:g(b[1]),talksList:h(b[1]),playlistsCount:g(b[2]),playlistsList:h(b[2])}},a._toS=function(a){return a?[a.lastSync,a.talksCount+a.talksList.slice(0,-1),a.playlistsCount+a.playlistsList.slice(0,-1)].join(";"):null}}),define("lib/watchLater",["exports","jquery","lodash","Modernizr","lib/fallback","lib/ga","lib/currentUserId","lib/watchLaterLocal","lib/pubSub"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){return d.localstorage?g.get()?!e.isEnabled()||(a.reject(new Error("Site in degraded mode")),!1):(a.reject(new Error("Not logged in")),!1):(a.reject(new Error("No localStorage")),!1)}var k=b.Deferred,l=[];a.add=function(a){var c=new k,d=c.promise();return j(c)?(b.post("/saved_items",a).then(function(a){h["add"+a.itemType](a.itemId),i("watchLater.add").publish(a),c.resolve(a),f.sendEvent("watchLater","add",a.itemType.toLowerCase())},function(){c.reject(new Error("Rejected by server"))}),d):d},a.all=function(){var a=new k,c=a.promise();return j(a)?(b.getJSON("/saved_items").then(function(b){a.resolve(b)},function(){a.reject(new Error("Rejected by server"))}),c):c},a.get=function(a){var d=new k,e=d.promise();if(!j(d))return e;var f={itemId:a.itemId,itemType:a.itemType},g=c.find(l,f);return g?g.promise:(f.promise=e,l.push(f),b.getJSON("/saved_items/find",a).then(function(a){d.resolve(a)},function(){d.reject(new Error("Rejected by server"))}),e)},a.remove=function(a){var c=new k,d=c.promise();if(!j(c))return d;var e={data:a,dataType:"json",type:"DELETE",url:"/saved_items/"+a.id};return b.ajax(e).then(function(a){h["remove"+a.itemType](a.itemId),i("watchLater.remove").publish(a),c.resolve(a)},function(){c.reject(new Error("Rejected by server"))}),d},a.update=function(a){var c=new k,d=c.promise();if(!j(c))return d;var e={data:a,dataType:"json",type:"PUT",url:"/saved_items/"+a.id};return b.ajax(e).then(function(a){c.resolve(a)},function(){c.reject(new Error("Rejected by server"))}),d},a._reset=function(){l=[]}}),define("utils/share",["jquery","lodash"],function(a,b){"use strict";var c={media:a('meta[property="og:image"]').first().attr("content"),height:450,message:"",url:location.href,width:500,utmSource:"tedcomshare",utmMedium:"social",utmCampaign:"tedspread"},d=encodeURIComponent,e={email:{href:"mailto:?subject=<%= message %>&body=<%= email %>",ga:"email",utmMedium:"email"},facebook:{href:"//www.facebook.com/sharer/sharer.php?u=<%= url %>",ga:"facebook",utmSource:"facebook.com"},gplus:{href:"//plus.google.com/share?url=<%= url %>",ga:"googlePlus",utmSource:"plus.google.com"},linkedin:{href:"//www.linkedin.com/shareArticle?mini=true&url=<%= url %>&title=<%= message %>&source=TED",ga:"linkedIn",height:500,utmSource:"linkedin.com"},twitter:{href:"//twitter.com/intent/tweet?url=<%= url %>&via=TEDTalks&text=<%= message %>",ga:"twitter",utmSource:"twitter.com"},pinterest:{href:"//pinterest.com/pin/create/button/?url=<%= url %>&media=<%= media %>",ga:"pinterest",utmSource:"pinterest.com"}};return function(a,f){var g=e[a];if(!g)return!1;f=b.merge({},c,g,f);var h=f.url+(f.url.indexOf("?")===-1?"?":"&")+"utm_source="+f.utmSource+"&utm_medium="+f.utmMedium+"&utm_campaign="+f.utmCampaign,i=b.template(f.href,{url:d(h),message:d(f.message),media:d(f.media),email:d(f.message+"\n"+h)});i.match(/mailto:/)?window.location.href=i:window.open(i,"sharingpopup",["scrollbars=1","resizable=1","height="+f.height,"width="+f.width].join(",")).focus()}}),define("utils/timeFromUrl",[],function(){"use strict";return function(a){var b,c,d,e={offset:!0};return a||(a=document.location.href),b=a.match(/#t=((\d+)m)?(\d+)s[^\/]*/),b&&(b[2]&&(c=parseInt(b[2],10)),d=parseInt(b[3],10),c&&(d+=60*c),e.offset=!1),b=a.match(/#t-(\d+)[^\/]*/),b&&(d=parseInt(b[1],10)/1e3),b=a.match(/#(\d+)[^\/]*/),b&&(d=parseInt(b[1],10)),e.seconds=d,e}}),define("views/mixins/cached-find",["exports"],function(a){"use strict";a._findEls=null,a.find=function(a){if(this._findEls||(this._findEls={}),this._findEls[a])return this._findEls[a];var b=this.$el.find(a);return b.length&&(this._findEls[a]=b),b}}),define("templates/helpers/ifCond",["Handlebars"],function(a){"use strict";a.registerHelper("ifCond",function(a,b,c,d){switch(b){case"!=":case"!==":return a!==c?d.fn(this):d.inverse(this);case"==":case"===":return a===c?d.fn(this):d.inverse(this);case"===":return a===c?d.fn(this):d.inverse(this);case"<":return a<c?d.fn(this):d.inverse(this);case"<=":return a<=c?d.fn(this):d.inverse(this);case">":return a>c?d.fn(this):d.inverse(this);case">=":return a>=c?d.fn(this):d.inverse(this);case"&&":return a&&c?d.fn(this):d.inverse(this);case"||":return a||c?d.fn(this):d.inverse(this);default:return d.inverse(this)}})}),define("hbs!templates/language-list",["hbs","hbs/handlebars","templates/helpers/ifCond"],function(a,b){var c=b.template({1:function(a,b,c,d){var e,f;return'    <li class="language-list__item">\n      <a class="language checkable" href="#" data-language-code="'+this.escapeExpression((f=null!=(f=b.languageCode||(null!=a?a.languageCode:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"languageCode",hash:{},data:d}):f))+'">\n        <div class="language__exonym">\n          <span class="language__label checkable__label">'+this.escapeExpression((f=null!=(f=b.languageName||(null!=a?a.languageName:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"languageName",hash:{},data:d}):f))+"</span>\n        </div>\n"+(null!=(e=(b.ifCond||a&&a.ifCond||b.helperMissing).call(a,null!=a?a.languageName:a,"!=",null!=a?a.endonym:a,{name:"ifCond",hash:{},fn:this.program(2,d,0),inverse:this.noop,data:d}))?e:"")+"      </a>\n    </li>\n"},2:function(a,b,c,d){var e;return'          <div class="language__endonym" lang="'+this.escapeExpression((e=null!=(e=b.ianaCode||(null!=a?a.ianaCode:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"ianaCode",hash:{},data:d}):e))+'">\n            <span class="language__label checkable__label">'+this.escapeExpression((e=null!=(e=b.endonym||(null!=a?a.endonym:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"endonym",hash:{},data:d}):e))+"</span>\n          </div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'\n<ul class="m3 sl language-list">\n'+(null!=(e=b.each.call(a,null!=a?a.languages:a,{name:"each",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+"</ul>\n"},useData:!0});return b.registerPartial("templates/language-list",c),b.registerPartial("templates/language-list",c),c}),define("templates/helpers/icon",["Handlebars"],function(a){"use strict";function b(a,b,d){return a=c(a),b=c(b),d=c(d),'<i class="icon icon_'+a+" "+(d||"")+'">'+(b?"<span class=screen-reader-text>"+b+"</span>":"")+"</i>"}var c=a.Utils.escapeExpression;return a.registerHelper("icon",function(c,d,e){return new a.SafeString(b(c,d,e))}),b}),define("hbs!templates/subtitle-modal",["hbs","hbs/handlebars","hbs!templates/language-list","templates/helpers/icon"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'\n<div class="modal__head">\n  <a class="modal__close modal__head__close" href="#" role="button">\n    <i class="g-button-modal-close">Close</i>\n  </a>\n  <h3 class="modal__head__title">\n    '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"subtitle",null,"modal__head__icon",{name:"icon",hash:{},data:d}))+'\n    Language\n  </h3>\n</div>\n\n<div class="m3">\n  <a class="Subtitle-modal__switch checkable checkable--checked" href="#">\n    Subtitles off\n  </a>\n</div>\n\n<div class="m3 Subtitle-modal__list">\n'+(null!=(e=this.invokePartial(c["templates/language-list"],a,{name:"templates/language-list",data:d,indent:"  ",helpers:b,partials:c}))?e:"")+'</div>\n\n<hr>\n\nTED Talks are subtitled by volunteers.\nDon\'t see your language?\n<a href="http://www.ted.com/participate/translate/get-started" target="_blank">Help us translate</a>!\n'},usePartial:!0,useData:!0});return b.registerPartial("templates/subtitle-modal",c),c}),define("templates/helpers/t",["Handlebars"],function(a){"use strict";a.registerHelper("t",function(a){return a})}),define("hbs!templates/modalDefault",["hbs","hbs/handlebars","templates/helpers/t"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'\n<div class="modal__head">\n  <a class="modal__close modal__head__close" href="#" role="button">\n    <i class="g-button-modal-close">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Close",{name:"t",hash:{},data:d}))+'</i>\n  </a>\n  <h3 class="modal__head__title">'+this.escapeExpression((e=null!=(e=b.title||(null!=a?a.title:a))?e:b.helperMissing,
"function"==typeof e?e.call(a,{name:"title",hash:{},data:d}):e))+"</h3>\n</div>\n"},useData:!0});return b.registerPartial("templates/modalDefault",c),c}),define("lib/focus-zone",["jquery","lodash","jqueryui/core"],function(a,b){"use strict";function c(b){this.$el=a(b)}function d(a){a.preventDefault()}var e=a(window);return c.__reset=function(){b.assign(c,{__active:void 0,__isListening:!1,__zones:[]})},c.__addZone=function(a){c.__zones.push(a),c.__setActive(),c.__startListening()},c.__removeZone=function(a){c.__zones=b.without(c.__zones,a),c.__setActive(),c.__stopListening()},c.__setActive=function(){c.__active=b.last(c.__zones)},c.__startListening=function(){c.__isListening||c.__active&&(c.__startListeningInner(),c.__isListening=!0)},c.__startListeningInner=function(){e.on("keydown",c.__keyDown)},c.__stopListening=function(){c.__isListening&&(c.__active||(c.__stopListeningInner(),c.__isListening=!1))},c.__stopListeningInner=function(){e.off("keydown",c.__keyDown)},c.__keyDown=function(e){var f=c.__active;if(f&&e.keyCode===a.ui.keyCode.TAB){var g=e.target,h=f.$el,i=h.find(":tabbable"),j=i.filter(":first"),k=i.filter(":last");g!==k[0]&&g!==h[0]||e.shiftKey?g!==j[0]&&g!==h[0]||!e.shiftKey?b.indexOf(i,g)===-1&&(j.focus(),d(e)):(k.focus(),d(e)):(j.focus(),d(e))}},b.assign(c.prototype,{activate:function(){return this._recordFocus(),c.__addZone(this),this},deactivate:function(){return c.__removeZone(this),this._restoreFocus(),this},_recordFocus:function(){this.$focus=a(":focus")},_restoreFocus:function(){this.$focus&&this.$focus.length&&this.$focus.focus()}}),c.__reset(),c}),define("widgets/modal",["jquery","lodash","hbs!templates/modalDefault","lib/pubSub","lib/focus-zone","jqueryui/widget","lib/resize"],function(a,b,c,d,e){"use strict";function f(){l||(k=a(window),i=a(document.body),j=a("html"))}var g,h,i,j,k,l=0,m="modal-backdrop--show",n="modal--show",o="modal-open",p="modal__content",q=0;return h=["<div class=modal>","<div class=modal__outer>","<div class=modal__inner>"].join(""),d("breakpoint").subscribe(function(a){g=a<768}),a.widget("ted.modal",{options:{align:"middle",autoOpen:!0},_create:function(){var b=this;f(),this.options.title&&this.element.prepend(c(this.options)),this.modal=this.element.addClass(p).css("display","").wrap(h).closest("div.modal"),this.modal.addClass("modal--align-"+this.options.align);var d=a("<div class=modal-backdrop>");this.backdrop=d;var j=a("<div class=modal-wrapper>");this.wrapper=j,j.append(this.backdrop).append(this.modal),this.focusZone=new e(this.modal),this.wrapper.on("click",function(c){return!!g||(!!a(c.target).closest("div.modal__content").length||(c.preventDefault(),void b.close()))}),i.append(this.wrapper),this._on({"click a.modal__close":function(a){a.preventDefault(),b.close()},keyup:function(c){c.preventDefault(),c.keyCode===a.ui.keyCode.ESCAPE&&b.close()}}),this.options.autoOpen&&b.open()},_destroy:function(){var a=this;b.defer(function(){a.wrapper.remove()})},open:function(){var a=this;return this._hasOpened?(a.backdrop.addClass(m),a.openedAt={y:k.scrollTop()},q++||j.addClass(o),g&&window.scrollTo(0,0),a.modal.addClass(n),a.focusZone.activate(),this.element.attr("tabindex",0),this.element.focus(),void a._trigger("open")):void window.setTimeout(function(){a._hasOpened||(a._hasOpened=!0,a.open())},10)},close:function(){this.modal.removeClass(n),--q||j.removeClass(o),this.openedAt&&window.scrollTo(0,this.openedAt.y),this.backdrop.removeClass(m),this.element.attr("tabindex",-1),this.focusZone.deactivate(),this._trigger("close")}}),function(b,c){return a(b).modal(c)}}),define("views/subtitle-modal",["jquery","lodash","Backbone","views/mixins/cached-find","hbs!templates/subtitle-modal","hbs!templates/language-list","widgets/modal"],function(a,b,c,d,e,f){"use strict";var g="checkable--checked",h=c.View.extend({className:"Subtitle-modal",template:e,events:{"click a.language":"_clickLanguage","click a.Subtitle-modal__switch":"_clickSwitch"},_rendered:!1,close:function(){return this.$el.modal("close"),this},initialize:function(a){var d=this;return d.state=new c.Model(b.extend({isOpen:!1,selected:!1},a||{})),d.listenTo(d.state,"change:selected",d._actSelected),d.listenTo(d.state,"change:languages",d._rerenderLanguages),this},open:function(){return this.$el.modal("open"),this},render:function(){var a=this;return a.$el.addClass("subtitle-modal").html(a.template(a.state.toJSON())).modal({autoOpen:!1}).on("modalclose",function(){a.trigger("close"),a.state.set("isOpen",!1)}).on("modalopen",function(){a.trigger("open"),a.state.set("isOpen",!0)}),a._rendered=!0,this._actSelected(),this},_actSelected:function(){var a=this.state.get("selected"),b=this.find("a.language");b.removeClass(g),a&&b.filter('[data-language-code="'+a+'"]').addClass(g),this.find("a.Subtitle-modal__switch")[a?"removeClass":"addClass"](g)},_clickLanguage:function(b){b.preventDefault();var c=a(b.target).closest("a.language"),d=c.data("language-code")||!1;this.state.set("selected",d)},_clickSwitch:function(a){a.preventDefault(),this.state.set("selected",!1)},_rerenderLanguages:function(){if(this._rendered){var a=this.state.get("languages");this.find("div.Subtitle-modal__list").html(f({languages:a}))}}});return b.extend(h.prototype,d),h}),define("hbs!templates/talkEndCard",["hbs","hbs/handlebars","templates/helpers/t","templates/helpers/formatDuration"],function(a,b){var c=b.template({1:function(a,b,c,d){var e;return'        <li class="talk-end-card__item">\n          <a class="l3 talk-end-card__link ga-link" href="/talks/'+this.escapeExpression((e=null!=(e=b.slug||(null!=a?a.slug:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"slug",hash:{},data:d}):e))+'" data-ga-category="talk.relatedTalk" data-ga-context="endcard">\n            <img class="talk-end-card__image" src="'+this.escapeExpression((e=null!=(e=b.image||(null!=a?a.image:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"image",hash:{},data:d}):e))+'" alt="'+this.escapeExpression((e=null!=(e=b.title||(null!=a?a.title:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"title",hash:{},data:d}):e))+'">\n\n            <div class="talk-end-card__speaker">'+this.escapeExpression((e=null!=(e=b.speaker||(null!=a?a.speaker:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"speaker",hash:{},data:d}):e))+'</div>\n            <div class="talk-end-card__title">'+this.escapeExpression((e=null!=(e=b.title||(null!=a?a.title:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"title",hash:{},data:d}):e))+'</div>\n            <div class="talk-end-card__duration">'+this.escapeExpression((b.formatDuration||a&&a.formatDuration||b.helperMissing).call(a,null!=a?a.duration:a,{name:"formatDuration",hash:{},data:d}))+"</div>\n          </a>\n        </li>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'\n<div class="talk-end-card">\n  <h2 class="talk-end-card__headline">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"More TED Talks",{name:"t",hash:{},data:d}))+'</h2>\n\n  <div class="talk-end-card__container">\n    <ul class="talk-end-card__list">\n'+(null!=(e=b.each.call(a,null!=a?a.relatedTalks:a,{name:"each",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+"    </ul>\n  </div>\n</div>\n"},useData:!0});return b.registerPartial("templates/talkEndCard",c),c}),define("hbs!templates/talkViewsBreakdown",["hbs","hbs/handlebars"],function(a,b){var c=b.template({1:function(a,b,c,d){var e;return'      <li class="talk-breakdown__source">\n        <span class="talk-breakdown__source__bar" style="width:'+this.escapeExpression((e=null!=(e=b.width||(null!=a?a.width:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"width",hash:{},data:d}):e))+'%"></span>\n        <span class="talk-breakdown__source__label">'+this.escapeExpression((e=null!=(e=b.value||(null!=a?a.value:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"value",hash:{},data:d}):e))+"% "+this.escapeExpression((e=null!=(e=b.label||(null!=a?a.label:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"label",hash:{},data:d}):e))+"</span>\n      </li>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'\n<div class="talk-breakdown">\n  <p><strong>This number combines views from the following outlets:</strong></p>\n\n  <ul class="sl talk-breakdown__sources">\n'+(null!=(e=b.each.call(a,null!=a?a.sources:a,{name:"each",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+"  </ul>\n</div>\n"},useData:!0});return b.registerPartial("templates/talkViewsBreakdown",c),c}),define("hbs!templates/commentApologyModal",["hbs","hbs/handlebars","templates/helpers/t"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return'\n<div>\n  <div class="modal__head">\n    <a class="modal__close modal__head__close" href="#" role="button">\n      <i class="g-button-modal-close">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Close",{name:"t",hash:{},data:d}))+'</i>\n    </a>\n    <h3 class="modal__head__title">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Could not save comment",{name:"t",hash:{},data:d}))+"</h3>\n  </div>\n\n  <p>"+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Sorry: we're currently experiencing difficulties and were unable to save your comment.",{name:"t",hash:{},data:d}))+"</p>\n</div>\n"},useData:!0});return b.registerPartial("templates/commentApologyModal",c),c}),define("lib/currentUser",["jquery","lodash","lib/currentUserId","lib/personalStorage"],function(a,b,c,d){"use strict";function e(a){return b.isFinite(a)?+a:null}function f(a){return a?""+a:null}function g(a){return a=b.pick(a,z),b.forOwn(a,function(b,c){a[c]=y[c](b)}),a}function h(a){return a&&JSON.parse(a)}function i(){return g(h(v.storageAdapter.getItem(w)))}function j(){return a.ajax({dataType:"json",url:"/me",data:{c:c.get()+"-"+Math.round(+new Date/1e3/120)},timeout:3e3})}function k(){r=null,v.storageAdapter.removeItem(w),a(document.documentElement).removeClass("loggedin").addClass("loggedout")}function l(a){k(),a.reject()}function m(){return v._check(r)}function n(a){var b=m();return b?a.resolve(r):(k(),a.reject()),b}function o(a,b){if(!b)return void l(a,b);if(b.unavailable&&b.unavailable.length)for(var c=i(),d=b.unavailable,e=d.length;e--;)b[d[e]]=c[d[e]]||b[d[e]];b.lastDownloaded=(new Date).getTime(),r=g(b),n(a)&&v.storageAdapter.setItem(w,JSON.stringify(r))}function p(a){j().then(b.bind(o,v,a),b.bind(l,v,a))}function q(a,b){var c=(new Date).getTime();return c-(b||0)<a}var r,s=function(a){return!!a},t=function(a){return a},u=a.Deferred,v={},w="me",x=!0,y={id:e,profileId:e,firstName:f,lastName:f,avatarUrl:f,hasConferences:s,upcomingConferences:t,isCommentModerator:s,hasEdActivity:s,isTEDxOrganizer:s,lastDownloaded:e},z=b.keys(y);return v.storageAdapter=d,v.getDetails=function(){var a=new u;return r=r||i(),m()||(r=null),r?(a.resolve(r),x&&!q(18e4,r.lastDownloaded)&&(x=!1,p(new u))):c.get()?p(a):a.reject(),a.promise()},v._check=function(a){var d=864e5;return a&&+a.id===+c.get()&&z.length===b.keys(b.pick(a,z)).length&&q(d,a.lastDownloaded)},v._reset=function(){r=void 0,x=!0},v}),define("hbs!templates/authPromptModal",["hbs","hbs/handlebars","templates/helpers/icon"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'\n<div class="auth-prompt__section auth-prompt__header">\n  <h2 class="auth-prompt__header__title">\n    Log in to\n    TED\n  </h2>\n\n  <a href="#" class="modal__close auth-prompt__close">\n    <i class="g-button-modal-close">Close</i>\n  </a>\n</div>\n\n<div class="auth-prompt__section auth-prompt__options">\n  <form class="auth-prompt__option auth-prompt__option--standard">\n    <div class="auth-prompt__message">\n      Your email or password was incorrect.\n    </div>\n\n    <div class="m3">\n      <label class="form-label">Email</label>\n      <input class="form-control auth-prompt__email" name="user[email]" type="email">\n    </div>\n\n    <div class="m3">\n      <label class="form-label">Password</label>\n      <input class="form-control auth-prompt__password" name="user[password]" type="password">\n    </div>\n\n    <div class="m3">\n      <label>\n        <input class="auth-prompt__remember" type="checkbox" checked name="user[remember_me]">\n        <span class="form-label" style="display:inline; margin-left: 2px;">\n          Remember me\n        </span>\n      </label>\n    </div>\n\n    <div>\n      <button class="button button--dark auth-prompt__login">Log in</button>\n      <a class="l3 auth-prompt__halp" href="'+this.escapeExpression((e=null!=(e=b.signInHelpUrl||(null!=a?a.signInHelpUrl:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"signInHelpUrl",hash:{},data:d}):e))+'" target="_blank">Need help logging in?</a>\n    </div>\n  </form>\n\n  <div class="auth-prompt__option auth-prompt__option--social">\n    <button class="button button--wide button--dark button--labeled button--facebook auth-prompt__facebook">\n      '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"facebook","","button__icon",{name:"icon",hash:{},data:d}))+'\n      <span class="button__label">Log in with Facebook</span>\n    </button>\n  </div>\n</div>\n\n<div class="auth-prompt__section auth-prompt__footer">\n  <span class="auth-prompt__footer__question">Don\'t have an account yet?</span>\n  <a class="l3" href="'+this.escapeExpression((e=null!=(e=b.signUpUrl||(null!=a?a.signUpUrl:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"signUpUrl",hash:{},data:d}):e))+'" target="_blank">Sign up</a>\n</div>\n\n<div class="auth-prompt__thinking"></div>\n'},useData:!0});return b.registerPartial("templates/authPromptModal",c),c}),define("views/AuthPromptView",["lodash","Modernizr","Backbone","lib/auth","hbs!templates/authPromptModal","utils/ted","spinjs","widgets/modal"],function(a,b,c,d,e,f,g){"use strict";function h(){d||(d=require("lib/auth"))}var i=c.View.extend({template:e,events:{"click button.auth-prompt__facebook":"facebook","click button.auth-prompt__login":"login","submit form.auth-prompt__option--standard":"login"},close:function(){this.$el.modal("close")},open:function(){this.$el.removeClass("auth-prompt--error"),this.$el.modal("open"),this.$email.focus()},login:function(a){a&&a.preventDefault(),this._startThinking(),h(),d.login(this.$email.val(),this.$password.val(),this.$remember.val()).then(this._loginSuccess,this._loginFailure).always(this._stopThinking),this.$password.val("")},facebook:function(a){a&&a.preventDefault(),this._startThinking(),h(),d.facebook().then(this._facebookSuccess,this._facebookFailure).always(this._stopThinking)},initialize:function(){var a=this;this._loginSuccess=function(){a.close(),a.trigger("login.success")},this._facebookSuccess=this._loginSuccess,this._loginFailure=function(b){b&&b.responseJSON&&a.$el.find(".auth-prompt__message").html(b.responseJSON.error),a.$el.addClass("auth-prompt--error"),a.trigger("login.failure")},this._facebookFailure=function(){a.trigger("login.failure")},this._stopThinking=function(){a.$thinkers.prop("disabled",!1),a.$el.removeClass("auth-prompt--thinking"),a._spinner&&a._spinner.stop()}},render:function(){var a=this;return this.$el.addClass("auth-prompt").html(a.template({signInHelpUrl:f("signInHelpUrl"),signUpUrl:f("signUpUrl")})).modal({autoOpen:!1}).on("modalclose",function(){a.trigger("close")}).on("modalopen",function(){a.trigger("open")}),this.$email=this.$el.find("input.auth-prompt__email"),this.$password=this.$el.find("input.auth-prompt__password"),this.$remember=this.$el.find("input.auth-prompt__remember"),this.$thinkers=this.$el.find(["form.auth-prompt__option--standard","button.auth-prompt__login","button.auth-prompt__facebook"].join(", ")).add(this.$email).add(this.$password),this},_startThinking:function(){this.$thinkers.prop("disabled",!0),this.$el.addClass("auth-prompt--thinking"),this._spinner||(this._spinner=new g({className:"spinner spinner--centered"})),this._spinner.spin(this.el)}});return i}),define("hbs!templates/authError",["hbs","hbs/handlebars","templates/helpers/t"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return'\n<div>\n  <div class="modal__head">\n    <a class="modal__close modal__head__close" href="#" role="button">\n      <i class="g-button-modal-close">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Close",{name:"t",hash:{},data:d}))+'</i>\n    </a>\n    <h3 class="modal__head__title">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Error",{name:"t",hash:{},data:d}))+"</h3>\n  </div>\n\n  <p>"+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Sorry, an error occurred. Please log in and try again.",{name:"t",hash:{},data:d}))+'</p>\n  <p><a class="l3" href="/session/new">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Log in",{name:"t",hash:{},data:d}))+"</a></p>\n</div>\n"},useData:!0});return b.registerPartial("templates/authError",c),c}),define("utils/callback",["lodash"],function(a){"use strict";var b=Number(new Date),c="tedc"+b,d=0;return function(b){var e=c+ ++d,f=this;return window[e]=function(){b.apply(f,a.toArray(arguments)),delete window[e]},e}}),define("utils/iframep",["jquery","utils/callback"],function(a,b){"use strict";return function(c){function d(){"pending"===f.state&&(f.reject(),delete window[g])}function e(){var a=i.contentDocument||i.contentWindow&&i.contentWindow.document;window[g]&&window.setTimeout("complete"===a.readyState?d:e,300)}var f=new a.Deferred,g=b(function(a){f.resolve(a)});c=c.replace("callback=?","callback="+g);var h=a("<iframe></iframe>").css({display:"none",width:0,height:0}).appendTo(document.body),i=h.get(0);return h.ready(e).attr("src",c),f.always(function(){h.remove()}),window.setTimeout(d,5e3),f.promise()}}),define("utils/origin",[],function(){"use strict";return window.location.origin||window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}),define("lib/auth",["jquery","lodash","lib/currentUser","lib/errorCollector","Modernizr","views/AuthPromptView","hbs!templates/authError","utils/callback","utils/iframep","utils/origin","lib/pubSub","utils/ted","exports"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";function n(){var b=new a.Deferred;return b.done(function(a){k("auth.login").publish(a)}),b}function o(){v?v.modal("open"):v=a(g()).modal()}function p(){if(!y)throw new Error("lib/auth: please check auth.capable() to ensure client support before using auth methods.");if(!m.capable())throw o(),new Error("lib/auth: this client is not capable of using auth methods.")}function q(a,b){return'<meta name="'+a+'" content="'+b+'">'}function r(b){a("head").append(q("csrf-param",b.csrf.param)+q("csrf-token",b.csrf.token))}function s(){return i("/session/check?callback=?").done(r)}function t(a,b){return function(c){a.reject(c),m._reportError(b)}}function u(){f||(f=require("views/AuthPromptView"))}var v,w,x,y=!1;window.console;m._openPrompt=function(){x||(u(),x=new f,x.on("close",function(){b.defer(function(){w&&"pending"!==w.state()&&w.reject()})}).on("login.success",function(){m._resolveDetails(w).fail(o)}).render()),x.open()},m._reportError=function(a){d.log(a,{context:"auth"})},m._reset=function(){v&&v.remove(),x&&x.remove(),v=void 0,y=!1,w=void 0,x=void 0},m._resolveDetails=function(a){return c.getDetails().done(function(b){a.resolve(b)})},m.getAuthenticityToken=function(){var b=new a.Deferred;return a.ajax({url:l("authHost")+"/session/new.json",timeout:3e3,type:"GET",xhrFields:{withCredentials:!0}}).then(function(a){b.resolve(a.authenticity_token)},b.reject),b.promise()},m.capable=function(){return y=!0,e.cors},m.facebook=function(){function a(a){a&&a.csrf&&r(a),"pending"===d.state()&&(m._resolveDetails(d).fail(t(d,"unable to corroborate Facebook authentication")),c&&c.close())}p();var b=h(a),c=window.open("/users/new?facebook=true&referer="+encodeURIComponent(j+"/session/check?callback="+b),"authfb",["scrollbars=1","resizable=1","height=480","width=640"].join(",")),d=n(),e=0,f=300,g=1e4,i=window.setInterval(function(){e++,(c&&c.closed||!c&&e*f>g)&&(a(),window[b]&&delete window[b],window.clearInterval(i),i=null)},f);return d.promise()},m.login=function(b,c,d){p();var e=n();return m._resolveDetails(e).then(function(a){e.resolve(a)},function(){m.getAuthenticityToken().then(function(f){a.ajax({url:l("authHost")+"/session.json",timeout:3e3,type:"POST",data:{authenticity_token:f,user:{email:b,password:c,remember_me:d}},xhrFields:{withCredentials:!0}}).then(function(){s().then(function(){m._resolveDetails(e).fail(t(e,"unable to corroborate authentication"))},t(e,"session check timed out"))},t(e,"credentials rejected"))},t(e,"could not obtain token"))}),e.promise()},m.logout=function(){p()},m.prompt=function(){p();var a=n();return w=a,m._resolveDetails(a).fail(m._openPrompt),a.promise()},k("auth.login").subscribe(function(){a(document.documentElement).addClass("loggedin").removeClass("loggedout")}),a(function(){a(document).on("click","a.auth-login",function(a){m.capable()&&(a.preventDefault(),m.prompt())})})}),define("hbs!templates/authRequest",["hbs","hbs/handlebars","templates/helpers/t"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return'\n<div>\n  <div class="modal__head">\n    <a class="modal__close modal__head__close" href="#" role="button">\n      <i class="g-button-modal-close">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Close",{name:"t",hash:{},data:d}))+'</i>\n    </a>\n    <h3 class="modal__head__title">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Please log in",{name:"t",hash:{},data:d}))+"</h3>\n  </div>\n\n  <p>"+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Please log in or sign up to complete this action.",{name:"t",hash:{},data:d}))+'</p>\n  <p><a class="l3" href="/session/new">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Log in or sign up",{name:"t",hash:{},data:d}))+"</a></p>\n</div>\n"},useData:!0});return b.registerPartial("templates/authRequest",c),c}),define("views/AuthView",["jquery","lodash","Backbone","lib/currentUser","lib/auth","hbs!templates/authRequest","widgets/modal"],function(a,b,c,d,e,f){"use strict";function g(){if(h)h.modal("open");else{var b=a(f());h=b.modal()}}var h,i=b.memoize(function(){return d.getDetails()}),j=c.View.extend({demandAuthFor:function(c){if(arguments.length>1)return void this.demandAuthFor(b.toArray(arguments));if(b.isArray(c))return void b.each(c,function(a){this.demandAuthFor(a)},this);var d=this[c];this[c]=function(){function b(){d.apply(f,c)}var c=arguments,f=this;c[0]instanceof a.Event&&c[0].preventDefault(),i().then(b,function(){e.capable()?e.prompt().done(b):g()})}}});return j}),function(a){function b(a,b){return function(c){return i(a.call(this,c),b)}}function c(a,b){return function(c){return this.lang().ordinal(a.call(this,c),b)}}function d(){}function e(a){g(this,a)}function f(a){var b=a.years||a.year||a.y||0,c=a.months||a.month||a.M||0,d=a.weeks||a.week||a.w||0,e=a.days||a.day||a.d||0,f=a.hours||a.hour||a.h||0,g=a.minutes||a.minute||a.m||0,h=a.seconds||a.second||a.s||0,i=a.milliseconds||a.millisecond||a.ms||0;this._input=a,this._milliseconds=i+1e3*h+6e4*g+36e5*f,this._days=e+7*d,this._months=c+12*b,this._data={},this._bubble()}function g(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function h(a){return a<0?Math.ceil(a):Math.floor(a)}function i(a,b){for(var c=a+"";c.length<b;)c="0"+c;return c}function j(a,b,c,d){var e,f,g=b._milliseconds,h=b._days,i=b._months;g&&a._d.setTime(+a._d+g*c),(h||i)&&(e=a.minute(),f=a.hour()),h&&a.date(a.date()+h*c),i&&a.month(a.month()+i*c),g&&!d&&H.updateOffset(a),(h||i)&&(a.minute(e),a.hour(f))}function k(a){return"[object Array]"===Object.prototype.toString.call(a)}function l(a,b){var c,d=Math.min(a.length,b.length),e=Math.abs(a.length-b.length),f=0;for(c=0;c<d;c++)~~a[c]!==~~b[c]&&f++;return f+e}function m(a){return a?ea[a]||a.toLowerCase().replace(/(.)s$/,"$1"):a}function n(a,b){return b.abbr=a,L[a]||(L[a]=new d),L[a].set(b),L[a]}function o(a){if(!a)return H.fn._lang;if(!L[a]&&M)try{require("./lang/"+a)}catch(a){return H.fn._lang}return L[a]}function p(a){return a.match(/\[.*\]/)?a.replace(/^\[|\]$/g,""):a.replace(/\\/g,"")}function q(a){var b,c,d=a.match(P);for(b=0,c=d.length;b<c;b++)ia[d[b]]?d[b]=ia[d[b]]:d[b]=p(d[b]);return function(e){var f="";for(b=0;b<c;b++)f+=d[b]instanceof Function?d[b].call(e,a):d[b];return f}}function r(a,b){function c(b){return a.lang().longDateFormat(b)||b}for(var d=5;d--&&Q.test(b);)b=b.replace(Q,c);return fa[b]||(fa[b]=q(b)),fa[b](a)}function s(a,b){switch(a){case"DDDD":return T;case"YYYY":return U;case"YYYYY":return V;case"S":case"SS":case"SSS":case"DDD":return S;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return W;case"a":case"A":return o(b._l)._meridiemParse;case"X":return Z;case"Z":case"ZZ":return X;case"T":return Y;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return R;default:return new RegExp(a.replace("\\",""))}}function t(a){var b=(X.exec(a)||[])[0],c=(b+"").match(ba)||["-",0,0],d=+(60*c[1])+~~c[2];return"+"===c[0]?-d:d}function u(a,b,c){var d,e=c._a;switch(a){case"M":case"MM":e[1]=null==b?0:~~b-1;break;case"MMM":case"MMMM":d=o(c._l).monthsParse(b),null!=d?e[1]=d:c._isValid=!1;break;case"D":case"DD":case"DDD":case"DDDD":null!=b&&(e[2]=~~b);break;case"YY":e[0]=~~b+(~~b>68?1900:2e3);break;case"YYYY":case"YYYYY":e[0]=~~b;break;case"a":case"A":c._isPm=o(c._l).isPM(b);break;case"H":case"HH":case"h":case"hh":e[3]=~~b;break;case"m":case"mm":e[4]=~~b;break;case"s":case"ss":e[5]=~~b;break;case"S":case"SS":case"SSS":e[6]=~~(1e3*("0."+b));break;case"X":c._d=new Date(1e3*parseFloat(b));break;case"Z":case"ZZ":c._useUTC=!0,c._tzm=t(b)}null==b&&(c._isValid=!1)}function v(a){var b,c,d=[];if(!a._d){for(b=0;b<7;b++)a._a[b]=d[b]=null==a._a[b]?2===b?1:0:a._a[b];d[3]+=~~((a._tzm||0)/60),d[4]+=~~((a._tzm||0)%60),c=new Date(0),a._useUTC?(c.setUTCFullYear(d[0],d[1],d[2]),c.setUTCHours(d[3],d[4],d[5],d[6])):(c.setFullYear(d[0],d[1],d[2]),c.setHours(d[3],d[4],d[5],d[6])),a._d=c}}function w(a){var b,c,d=a._f.match(P),e=a._i;for(a._a=[],b=0;b<d.length;b++)c=(s(d[b],a).exec(e)||[])[0],c&&(e=e.slice(e.indexOf(c)+c.length)),ia[d[b]]&&u(d[b],c,a);e&&(a._il=e),a._isPm&&a._a[3]<12&&(a._a[3]+=12),a._isPm===!1&&12===a._a[3]&&(a._a[3]=0),v(a)}function x(a){var b,c,d,f,h,i=99;for(f=0;f<a._f.length;f++)b=g({},a),b._f=a._f[f],w(b),c=new e(b),h=l(b._a,c.toArray()),c._il&&(h+=c._il.length),h<i&&(i=h,d=c);g(a,d)}function y(a){var b,c=a._i,d=$.exec(c);if(d){for(a._f="YYYY-MM-DD"+(d[2]||" "),b=0;b<4;b++)if(aa[b][1].exec(c)){a._f+=aa[b][0];break}X.exec(c)&&(a._f+=" Z"),w(a)}else a._d=new Date(c)}function z(b){var c=b._i,d=N.exec(c);c===a?b._d=new Date:d?b._d=new Date(+d[1]):"string"==typeof c?y(b):k(c)?(b._a=c.slice(0),v(b)):b._d=c instanceof Date?new Date(+c):new Date(c)}function A(a,b,c,d,e){return e.relativeTime(b||1,!!c,a,d)}function B(a,b,c){var d=K(Math.abs(a)/1e3),e=K(d/60),f=K(e/60),g=K(f/24),h=K(g/365),i=d<45&&["s",d]||1===e&&["m"]||e<45&&["mm",e]||1===f&&["h"]||f<22&&["hh",f]||1===g&&["d"]||g<=25&&["dd",g]||g<=45&&["M"]||g<345&&["MM",K(g/30)]||1===h&&["y"]||["yy",h];return i[2]=b,i[3]=a>0,i[4]=c,A.apply({},i)}function C(a,b,c){var d,e=c-b,f=c-a.day();return f>e&&(f-=7),f<e-7&&(f+=7),d=H(a).add("d",f),{week:Math.ceil(d.dayOfYear()/7),year:d.year()}}function D(a){var b=a._i,c=a._f;return null===b||""===b?null:("string"==typeof b&&(a._i=b=o().preparse(b)),H.isMoment(b)?(a=g({},b),a._d=new Date(+b._d)):c?k(c)?x(a):w(a):z(a),new e(a))}function E(a,b){H.fn[a]=H.fn[a+"s"]=function(a){var c=this._isUTC?"UTC":"";return null!=a?(this._d["set"+c+b](a),H.updateOffset(this),this):this._d["get"+c+b]()}}function F(a){H.duration.fn[a]=function(){return this._data[a]}}function G(a,b){H.duration.fn["as"+a]=function(){return+this/b}}for(var H,I,J="2.1.0",K=Math.round,L={},M="undefined"!=typeof module&&module.exports,N=/^\/?Date\((\-?\d+)/i,O=/(\-)?(\d*)?\.?(\d+)\:(\d+)\:(\d+)\.?(\d{3})?/,P=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|SS?S?|X|zz?|ZZ?|.)/g,Q=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,R=/\d\d?/,S=/\d{1,3}/,T=/\d{3}/,U=/\d{1,4}/,V=/[+\-]?\d{1,6}/,W=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,X=/Z|[\+\-]\d\d:?\d\d/i,Y=/T/i,Z=/[\+\-]?\d+(\.\d{1,3})?/,$=/^\s*\d{4}-\d\d-\d\d((T| )(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,_="YYYY-MM-DDTHH:mm:ssZ",aa=[["HH:mm:ss.S",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],ba=/([\+\-]|\d\d)/gi,ca="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),da={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},ea={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",w:"week",M:"month",y:"year"},fa={},ga="DDD w W M D d".split(" "),ha="M D H h m s w W".split(" "),ia={M:function(){return this.month()+1},MMM:function(a){return this.lang().monthsShort(this,a)},MMMM:function(a){return this.lang().months(this,a)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(a){return this.lang().weekdaysMin(this,a)},ddd:function(a){return this.lang().weekdaysShort(this,a)},dddd:function(a){return this.lang().weekdays(this,a)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return i(this.year()%100,2)},YYYY:function(){return i(this.year(),4)},YYYYY:function(){return i(this.year(),5)},gg:function(){return i(this.weekYear()%100,2)},gggg:function(){return this.weekYear()},ggggg:function(){return i(this.weekYear(),5)},GG:function(){return i(this.isoWeekYear()%100,2)},GGGG:function(){return this.isoWeekYear()},GGGGG:function(){return i(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return i(~~(this.milliseconds()/10),2)},SSS:function(){return i(this.milliseconds(),3)},Z:function(){var a=-this.zone(),b="+";return a<0&&(a=-a,b="-"),b+i(~~(a/60),2)+":"+i(~~a%60,2)},ZZ:function(){var a=-this.zone(),b="+";return a<0&&(a=-a,b="-"),b+i(~~(10*a/6),4)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()}};ga.length;)I=ga.pop(),ia[I+"o"]=c(ia[I],I);for(;ha.length;)I=ha.pop(),ia[I+I]=b(ia[I],2);for(ia.DDDD=b(ia.DDD,3),d.prototype={set:function(a){var b,c;for(c in a)b=a[c],"function"==typeof b?this[c]=b:this["_"+c]=b},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(a){return this._months[a.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(a){return this._monthsShort[a.month()]},monthsParse:function(a){var b,c,d;for(this._monthsParse||(this._monthsParse=[]),b=0;b<12;b++)if(this._monthsParse[b]||(c=H([2e3,b]),d="^"+this.months(c,"")+"|^"+this.monthsShort(c,""),this._monthsParse[b]=new RegExp(d.replace(".",""),"i")),this._monthsParse[b].test(a))return b},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(a){return this._weekdays[a.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(a){return this._weekdaysShort[a.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(a){return this._weekdaysMin[a.day()]},weekdaysParse:function(a){
var b,c,d;for(this._weekdaysParse||(this._weekdaysParse=[]),b=0;b<7;b++)if(this._weekdaysParse[b]||(c=H([2e3,1]).day(b),d="^"+this.weekdays(c,"")+"|^"+this.weekdaysShort(c,"")+"|^"+this.weekdaysMin(c,""),this._weekdaysParse[b]=new RegExp(d.replace(".",""),"i")),this._weekdaysParse[b].test(a))return b},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(a){var b=this._longDateFormat[a];return!b&&this._longDateFormat[a.toUpperCase()]&&(b=this._longDateFormat[a.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(a){return a.slice(1)}),this._longDateFormat[a]=b),b},isPM:function(a){return"p"===(a+"").toLowerCase()[0]},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(a,b,c){return a>11?c?"pm":"PM":c?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(a,b){var c=this._calendar[a];return"function"==typeof c?c.apply(b):c},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(a,b,c,d){var e=this._relativeTime[c];return"function"==typeof e?e(a,b,c,d):e.replace(/%d/i,a)},pastFuture:function(a,b){var c=this._relativeTime[a>0?"future":"past"];return"function"==typeof c?c(b):c.replace(/%s/i,b)},ordinal:function(a){return this._ordinal.replace("%d",a)},_ordinal:"%d",preparse:function(a){return a},postformat:function(a){return a},week:function(a){return C(a,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6}},H=function(a,b,c){return D({_i:a,_f:b,_l:c,_isUTC:!1})},H.utc=function(a,b,c){return D({_useUTC:!0,_isUTC:!0,_l:c,_i:a,_f:b})},H.unix=function(a){return H(1e3*a)},H.duration=function(a,b){var c,d,e=H.isDuration(a),g="number"==typeof a,h=e?a._input:g?{}:a,i=O.exec(a);return g?b?h[b]=a:h.milliseconds=a:i&&(c="-"===i[1]?-1:1,h={y:0,d:~~i[2]*c,h:~~i[3]*c,m:~~i[4]*c,s:~~i[5]*c,ms:~~i[6]*c}),d=new f(h),e&&a.hasOwnProperty("_lang")&&(d._lang=a._lang),d},H.version=J,H.defaultFormat=_,H.updateOffset=function(){},H.lang=function(a,b){return a?(b?n(a,b):L[a]||o(a),void(H.duration.fn._lang=H.fn._lang=o(a))):H.fn._lang._abbr},H.langData=function(a){return a&&a._lang&&a._lang._abbr&&(a=a._lang._abbr),o(a)},H.isMoment=function(a){return a instanceof e},H.isDuration=function(a){return a instanceof f},H.fn=e.prototype={clone:function(){return H(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){return r(H(this).utc(),"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var a=this;return[a.year(),a.month(),a.date(),a.hours(),a.minutes(),a.seconds(),a.milliseconds()]},isValid:function(){return null==this._isValid&&(this._a?this._isValid=!l(this._a,(this._isUTC?H.utc(this._a):H(this._a)).toArray()):this._isValid=!isNaN(this._d.getTime())),!!this._isValid},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(a){var b=r(this,a||H.defaultFormat);return this.lang().postformat(b)},add:function(a,b){var c;return c="string"==typeof a?H.duration(+b,a):H.duration(a,b),j(this,c,1),this},subtract:function(a,b){var c;return c="string"==typeof a?H.duration(+b,a):H.duration(a,b),j(this,c,-1),this},diff:function(a,b,c){var d,e,f=this._isUTC?H(a).zone(this._offset||0):H(a).local(),g=6e4*(this.zone()-f.zone());return b=m(b),"year"===b||"month"===b?(d=432e5*(this.daysInMonth()+f.daysInMonth()),e=12*(this.year()-f.year())+(this.month()-f.month()),e+=(this-H(this).startOf("month")-(f-H(f).startOf("month")))/d,e-=6e4*(this.zone()-H(this).startOf("month").zone()-(f.zone()-H(f).startOf("month").zone()))/d,"year"===b&&(e/=12)):(d=this-f,e="second"===b?d/1e3:"minute"===b?d/6e4:"hour"===b?d/36e5:"day"===b?(d-g)/864e5:"week"===b?(d-g)/6048e5:d),c?e:h(e)},from:function(a,b){return H.duration(this.diff(a)).lang(this.lang()._abbr).humanize(!b)},fromNow:function(a){return this.from(H(),a)},calendar:function(){var a=this.diff(H().startOf("day"),"days",!0),b=a<-6?"sameElse":a<-1?"lastWeek":a<0?"lastDay":a<1?"sameDay":a<2?"nextDay":a<7?"nextWeek":"sameElse";return this.format(this.lang().calendar(b,this))},isLeapYear:function(){var a=this.year();return a%4===0&&a%100!==0||a%400===0},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(a){var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=a?"string"==typeof a&&(a=this.lang().weekdaysParse(a),"number"!=typeof a)?this:this.add({d:a-b}):b},month:function(a){var b,c=this._isUTC?"UTC":"";return null!=a?"string"==typeof a&&(a=this.lang().monthsParse(a),"number"!=typeof a)?this:(b=this.date(),this.date(1),this._d["set"+c+"Month"](a),this.date(Math.min(b,this.daysInMonth())),H.updateOffset(this),this):this._d["get"+c+"Month"]()},startOf:function(a){switch(a=m(a)){case"year":this.month(0);case"month":this.date(1);case"week":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===a&&this.weekday(0),this},endOf:function(a){return this.startOf(a).add(a,1).subtract("ms",1)},isAfter:function(a,b){return b="undefined"!=typeof b?b:"millisecond",+this.clone().startOf(b)>+H(a).startOf(b)},isBefore:function(a,b){return b="undefined"!=typeof b?b:"millisecond",+this.clone().startOf(b)<+H(a).startOf(b)},isSame:function(a,b){return b="undefined"!=typeof b?b:"millisecond",+this.clone().startOf(b)===+H(a).startOf(b)},min:function(a){return a=H.apply(null,arguments),a<this?this:a},max:function(a){return a=H.apply(null,arguments),a>this?this:a},zone:function(a){var b=this._offset||0;return null==a?this._isUTC?b:this._d.getTimezoneOffset():("string"==typeof a&&(a=t(a)),Math.abs(a)<16&&(a*=60),this._offset=a,this._isUTC=!0,b!==a&&j(this,H.duration(b-a,"m"),1,!0),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},daysInMonth:function(){return H.utc([this.year(),this.month()+1,0]).date()},dayOfYear:function(a){var b=K((H(this).startOf("day")-H(this).startOf("year"))/864e5)+1;return null==a?b:this.add("d",a-b)},weekYear:function(a){var b=C(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==a?b:this.add("y",a-b)},isoWeekYear:function(a){var b=C(this,1,4).year;return null==a?b:this.add("y",a-b)},week:function(a){var b=this.lang().week(this);return null==a?b:this.add("d",7*(a-b))},isoWeek:function(a){var b=C(this,1,4).week;return null==a?b:this.add("d",7*(a-b))},weekday:function(a){var b=(this._d.getDay()+7-this.lang()._week.dow)%7;return null==a?b:this.add("d",a-b)},isoWeekday:function(a){return null==a?this.day()||7:this.day(this.day()%7?a:a-7)},lang:function(b){return b===a?this._lang:(this._lang=o(b),this)}},I=0;I<ca.length;I++)E(ca[I].toLowerCase().replace(/s$/,""),ca[I]);E("year","FullYear"),H.fn.days=H.fn.day,H.fn.months=H.fn.month,H.fn.weeks=H.fn.week,H.fn.isoWeeks=H.fn.isoWeek,H.fn.toJSON=H.fn.toISOString,H.duration.fn=f.prototype={_bubble:function(){var a,b,c,d,e=this._milliseconds,f=this._days,g=this._months,i=this._data;i.milliseconds=e%1e3,a=h(e/1e3),i.seconds=a%60,b=h(a/60),i.minutes=b%60,c=h(b/60),i.hours=c%24,f+=h(c/24),i.days=f%30,g+=h(f/30),i.months=g%12,d=h(g/12),i.years=d},weeks:function(){return h(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*~~(this._months/12)},humanize:function(a){var b=+this,c=B(b,!a,this.lang());return a&&(c=this.lang().pastFuture(b,c)),this.lang().postformat(c)},add:function(a,b){var c=H.duration(a,b);return this._milliseconds+=c._milliseconds,this._days+=c._days,this._months+=c._months,this._bubble(),this},subtract:function(a,b){var c=H.duration(a,b);return this._milliseconds-=c._milliseconds,this._days-=c._days,this._months-=c._months,this._bubble(),this},get:function(a){return a=m(a),this[a.toLowerCase()+"s"]()},as:function(a){return a=m(a),this["as"+a.charAt(0).toUpperCase()+a.slice(1)+"s"]()},lang:H.fn.lang};for(I in da)da.hasOwnProperty(I)&&(G(I,da[I]),F(I.toLowerCase()));G("Weeks",6048e5),H.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},H.lang("en",{ordinal:function(a){var b=a%10,c=1===~~(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return a+c}}),M&&(module.exports=H),"undefined"==typeof ender&&(this.moment=H),"function"==typeof define&&define.amd&&define("moment",[],function(){return H})}.call(this),define("templates/helpers/timeAgo",["Handlebars","moment"],function(a,b){"use strict";a.registerHelper("timeAgo",function(a){return b(a).fromNow()})}),define("hbs!templates/comment",["hbs","hbs/handlebars","templates/helpers/t","templates/helpers/timeAgo","templates/helpers/icon"],function(a,b){var c=b.template({1:function(a,b,c,d){return'        <img src="'+this.escapeExpression(this.lambda(null!=a?a.thumb:a,a))+'" class="comment__image__thumb">\n'},3:function(a,b,c,d){var e;return null!=(e=b.if.call(a,null!=a?a.monogram:a,{name:"if",hash:{},fn:this.program(4,d,0),inverse:this.program(6,d,0),data:d}))?e:""},4:function(a,b,c,d){var e;return'          <div class="comment__image__thumb comment__image__monogram" style="background:#'+this.escapeExpression((e=null!=(e=b.color||(null!=a?a.color:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"color",hash:{},data:d}):e))+'">'+this.escapeExpression((e=null!=(e=b.monogram||(null!=a?a.monogram:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"monogram",hash:{},data:d}):e))+"</div>\n"},6:function(a,b,c,d){return'          <img src="/temp/noface.png" class="comment__image__thumb">\n'},8:function(a,b,c,d){var e;return'  <div class="comment__parent">\n    '+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"In reply to:",{name:"t",hash:{},data:d}))+'\n\n    <figure class="comment__quote">\n      <blockquote class="comment__quote__body">\n        '+this.escapeExpression(this.lambda(null!=(e=null!=a?a.parent:a)?e.message:e,a))+'\n      </blockquote>\n\n      <figcaption class="comment__quote__attribution">\n        '+this.escapeExpression(this.lambda(null!=(e=null!=a?a.parent:a)?e.name:e,a))+"\n      </figcaption>\n    </figure>\n  </div>\n"},10:function(a,b,c,d){var e;return"    <p>\n"+(null!=(e=b.each.call(a,a,{name:"each",hash:{},fn:this.program(11,d,0),inverse:this.noop,data:d}))?e:"")+"    </p>\n"},11:function(a,b,c,d){var e;return"        "+this.escapeExpression(this.lambda(a,a))+"\n        "+(null!=(e=b.unless.call(a,d&&d.last,{name:"unless",hash:{},fn:this.program(12,d,0),inverse:this.noop,data:d}))?e:"")+"\n"},12:function(a,b,c,d){return"<br>"},14:function(a,b,c,d){var e,f;return'    <a class="button button--small comment__link comment__upvote '+(null!=(e=b.if.call(a,null!=a?a.upvoted:a,{name:"if",hash:{},fn:this.program(15,d,0),inverse:this.noop,data:d}))?e:"")+'" href="#">\n      '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"upvote",{name:"icon",hash:{},data:d}))+"\n      "+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Upvote",{name:"t",hash:{},data:d}))+'\n\n      <span class="comment__upvote__count" '+(null!=(e=b.unless.call(a,null!=a?a.upvotes:a,{name:"unless",hash:{},fn:this.program(17,d,0),inverse:this.noop,data:d}))?e:"")+">\n        (+"+this.escapeExpression((f=null!=(f=b.upvotes||(null!=a?a.upvotes:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"upvotes",hash:{},data:d}):f))+")\n      </span>\n    </a>\n"},15:function(a,b,c,d){return"comment__upvote--upvoted"},17:function(a,b,c,d){return'style="display:none"'},19:function(a,b,c,d){var e,f;return'    <span class="comment__upvote__count--ro" '+(null!=(e=b.unless.call(a,null!=a?a.upvotes:a,{name:"unless",hash:{},fn:this.program(17,d,0),inverse:this.noop,data:d}))?e:"")+">\n      Upvotes (+"+this.escapeExpression((f=null!=(f=b.upvotes||(null!=a?a.upvotes:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"upvotes",hash:{},data:d}):f))+")\n    </span>\n"},21:function(a,b,c,d){return'    <a class="comment__link comment__edit" href="#">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Edit",{name:"t",hash:{},data:d}))+'</a>\n    <a class="comment__link comment__delete" href="#">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Delete",{name:"t",hash:{},data:d}))+"</a>\n"},23:function(a,b,c,d){return'    <!-- <a class="comment__link comment__move" href="#">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Move",{name:"t",hash:{},data:d}))+"</a> -->\n"},25:function(a,b,c,d){var e;return null!=(e=b.if.call(a,null!=a?a.reported:a,{name:"if",hash:{},fn:this.program(26,d,0),inverse:this.program(28,d,0),data:d}))?e:""},26:function(a,b,c,d){return'      <span class="comment__report comment__report--reported">\n        '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"flag",{name:"icon",hash:{},data:d}))+"\n        "+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Reported. Thank you.",{name:"t",hash:{},data:d}))+"\n      </span>\n"},28:function(a,b,c,d){return'      <a class="comment__link comment__report" href="#">\n        '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"flag",{name:"icon",hash:{},data:d}))+"\n        "+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Report",{name:"t",hash:{},data:d}))+"\n      </a>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f;return'\n<header class="comment__header">\n  <div class="media">\n    <a href=\'/profiles/'+this.escapeExpression((f=null!=(f=b.profileId||(null!=a?a.profileId:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"profileId",hash:{},data:d}):f))+'\' class="comment__image media__image">\n'+(null!=(e=b.if.call(a,null!=a?a.thumb:a,{name:"if",hash:{},fn:this.program(1,d,0),inverse:this.program(3,d,0),data:d}))?e:"")+'    </a>\n\n    <div class="media__message">\n      <a class="comment__name" href="/profiles/'+this.escapeExpression((f=null!=(f=b.profileId||(null!=a?a.profileId:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"profileId",hash:{},data:d}):f))+'" target="_blank">'+this.escapeExpression((f=null!=(f=b.name||(null!=a?a.name:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"name",hash:{},data:d}):f))+'</a>\n      <div class="comment__date">\n        <strong>'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Posted",{name:"t",hash:{},data:d}))+"</strong>\n        "+this.escapeExpression((b.timeAgo||a&&a.timeAgo||b.helperMissing).call(a,null!=a?a.date:a,{name:"timeAgo",hash:{},data:d}))+"\n      </div>\n    </div>\n  </div>\n</header>\n\n"+(null!=(e=b.if.call(a,null!=a?a.parent:a,{name:"if",hash:{},fn:this.program(8,d,0),inverse:this.noop,data:d}))?e:"")+'\n<div class="comment__body hyphens">\n'+(null!=(e=b.each.call(a,null!=a?a.paragraphs:a,{name:"each",hash:{},fn:this.program(10,d,0),inverse:this.noop,data:d}))?e:"")+'</div>\n\n<div class="comment__editor">\n  <textarea class="comment__editor__input"></textarea>\n\n  <div class="comment__editor__message"></div>\n\n  <div class="comment__editor__controls">\n    <span class="comment__editor__count">2000</span>\n    '+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"characters left",{name:"t",hash:{},data:d}))+'\n\n    <button class="button button-small comment__editor__button comment__editor__submit">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Submit",{name:"t",hash:{},data:d}))+'</button>\n  </div>\n</div>\n\n<footer class="comment__footer">\n  <a class="button button--small comment__link comment__reply" href="#">\n    '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"reply",{name:"icon",hash:{},data:d}))+"\n    "+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Reply",{name:"t",hash:{},data:d}))+"\n  </a>\n\n"+(null!=(e=b.unless.call(a,null!=a?a.isOwn:a,{name:"unless",hash:{},fn:this.program(14,d,0),inverse:this.noop,data:d}))?e:"")+"\n"+(null!=(e=b.if.call(a,null!=a?a.isOwn:a,{name:"if",hash:{},fn:this.program(19,d,0),inverse:this.noop,data:d}))?e:"")+"\n"+(null!=(e=b.if.call(a,null!=a?a.isEditable:a,{name:"if",hash:{},fn:this.program(21,d,0),inverse:this.noop,data:d}))?e:"")+"\n"+(null!=(e=b.if.call(a,null!=a?a.isModable:a,{name:"if",hash:{},fn:this.program(23,d,0),inverse:this.noop,data:d}))?e:"")+"\n"+(null!=(e=b.unless.call(a,null!=a?a.isOwn:a,{name:"unless",hash:{},fn:this.program(25,d,0),inverse:this.noop,data:d}))?e:"")+'</footer>\n\n<article class="comment__response">\n  <textarea rows="6" class="comment__response__input"></textarea>\n\n  <div class="comment__response__message"></div>\n\n  <div class="comment__response__buttons">\n    <span class="comment__response__limit">\n      <span class="comment__response__limit__remain">2000</span>\n      '+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"characters left",{name:"t",hash:{},data:d}))+'\n    </span>\n\n    <button class="button button--small comment__response__button comment__response__submit">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Submit",{name:"t",hash:{},data:d}))+'</button>\n  </div>\n</article>\n\n<div class="comment__replies"></div>\n'},useData:!0});return b.registerPartial("templates/comment",c),c}),define("lib/thread",["exports","lodash","jquery","lib/currentUser"],function(a,b,c,d){"use strict";function e(a,b,c){return{records:a,metadata:{page:b,pageCount:c}}}function f(a,c){var d=new Date(1e3*(0+a.date));if(!a.deleted){var e=g(a.children,b.extend({parentId:a.comment_id},c)),f=+c.currentUserId===+a.user_id;return{id:a.comment_id,parentId:c.parentId,threadId:c.threadId,isOwn:f,isModable:c.isCommentModerator,isEditable:c.isCommentModerator||f,name:a.name,profileId:a.profile_id,thumb:a.profile_pic,date:d,message:a.comment,replies:e,upvoted:!!a.actor_score_id,scoreId:a.actor_score_id||null,reported:!!a.actor_flag_id,flagId:a.actor_flag_id||null,upvotes:a.score,removed:a.deleted}}}function g(a,c){function d(a){return f(a,c)}return b.isPlainObject(a)?b.filter(b.map(b.values(a),d)):[]}var h={page:1,perPage:10,sort:"rated"},i={};a.get=function(a,f){var i=new c.Deferred;f=b.extend({},h,f);var j="/conversation_forums/"+a,k={page:f.page,per_page:f.perPage,sort:f.sort},l=new c.Deferred;return d.getDetails().then(function(a){l.resolve({currentUserId:a.id,isCommentModerator:a.isCommentModerator})},function(){l.resolve({currentUserId:!1,isCommentModerator:!1})}),c.when(c.getJSON(j,k),l).then(function(a,c){var d,f=a[0],h=c;if(f.attributes&&(f=f.attributes),!f||!f.discussion_thread)return void i.resolve(e([],1,1));d=b.extend({threadId:f.id},h);var j=f.discussion_thread.thread[0],l=g(j,d);i.resolve(e(l,k.page,b.size(j)<k.per_page?k.page:k.page+1))},function(){i.reject()}),i.promise()},a.saveComment=function(a,d){var e=c.Deferred(),f=e.promise();d=b.extend({},i,d);var g="/comments",h={comment:a.message,timestamp:Math.floor(new Date/1e3).toString()},j={};if(a.id)g="/comments/"+a.id,j._method="PUT";else if(a.parentId)h.commentable_type="comment",h.commentable_id=a.parentId;else{if(!a.threadId)return e.reject(new Error("parentId or threadId required.")),f;h.commentable_type="conversation_forum",h.commentable_id=a.threadId}return j.comment=h,c.post(g,j,null,"json").then(function(a){e.resolve(a?{id:a.id}:null)},function(){e.reject()}),f},a.destroyComment=function(a,d){var e=c.Deferred(),f=e.promise(),g="/comments/"+a,h={_method:"DELETE"};return d&&(d.send=d.send?"1":""),b.extend(h,d||{}),c.post(g,h,null,"json").then(function(){e.resolve()},function(){e.reject()}),f},a.saveFlag=function(a){var b=c.Deferred(),d=b.promise(),e="/comment_flags",f={comment_flag:{comment_id:a.commentId}};return a.id&&(e="/comment_flags/"+a.id,f._method="PUT"),c.post(e,f,null,"json").then(function(a){b.resolve({id:a.id})},function(){b.reject()}),d},a.destroyFlag=function(a){var b=c.Deferred(),d=b.promise(),e="/comment_flags/"+a,f={_method:"DELETE"};return c.post(e,f,null,"json").then(function(){b.resolve()},function(){b.reject()}),d},a.saveScore=function(a){var b=c.Deferred(),d=b.promise(),e="/comment_scores",f={comment_score:{comment_id:a.commentId}};return a.id&&(e="/comment_scores/"+a.id,f._method="PUT"),c.post(e,f,null,"json").then(function(a){b.resolve({id:a.id})},function(){b.reject()}),d},a.destroyScore=function(a){var b=c.Deferred(),d=b.promise(),e="/comment_scores/"+a,f={_method:"DELETE"};return c.post(e,f,null,"json").then(function(){b.resolve()},function(){b.reject()}),d}}),define("utils/monogram",["jquery"],function(a){"use strict";return function(b){return(b=a.trim(b))?(b=b.split(",")[0],b=b.replace(/\s[a-z]\w+\s/g," "),b=b.replace(/\s\w+\.$/,""),b=b.replace(/\s[A-Z]+$/,""),b=b.replace(/[^\s\w]+([\w])/g,"$1"),b=a.trim(b).toUpperCase().split(/\s+/),b[0][0]+(b.length>1?b[b.length-1][0]:"")):""}}),define("collections/Comments",["Backbone","models/Comment"],function(a,b){"use strict";var c=a.Collection.extend({constructor:function(){this.model||(this.model=require("models/Comment")),a.Collection.apply(this,arguments)},model:b,parent:null});return c}),define("models/Comment",["jquery","lodash","Backbone","lib/pubSub","lib/thread","lib/currentUser","utils/monogram","collections/Comments"],function(a,b,c,d,e,f,g,h){"use strict";function i(){h||(h=require("collections/Comments"))}var j=c.Model.extend({defaults:{isOwn:!0,isEditable:!0,upvotes:0,upvoted:!1},maxMessageLength:2e3,constructor:function(){i(),this.replies=new h,this.replies.parent=this,c.Model.apply(this,arguments)},initialize:function(a){this.replies.reset(a.replies)},monogram:function(){return g(this.get("name"))},parse:function(a){return this.replies.reset(a.replies),b.omit(a,"replies")},remove:function(a){var b=this,c=e.destroyComment(b.get("id"),a);return b.trigger("request",b,c),c.done(function(){b.set("removed",!0)}),c},report:function(){var a=this,b=e.saveFlag({commentId:a.get("id")});return b.done(function(b){a.set({reported:!0,flagId:b.id}),d("comment.report").publish(a.toJSON())}),b},unreport:function(){var a=this,b=e.destroyFlag(a.get("flagId"));return b.done(function(){a.set("reported",!1)}),b},sync:function(b,c){var g;return g="delete"===b?e.destroyComment(c.get("id")):"create"===b?a.when(e.saveComment(c.toJSON()).done(function(a){c.set(a)}),f.getDetails().done(function(a){c.set({name:a.firstName+" "+a.lastName,thumb:a.avatarUrl})})).done(function(){c.get("profileId")||c.set("profileId","me"),d("comment.create").publish(c.toJSON())}):e.saveComment(c.toJSON()),c.trigger("request",c,g),g},toggleUpvote:function(){var a,b=this,c=b.get("upvotes"),f=b.get("upvoted");return f?(c-=1,a=e.destroyScore(b.get("scoreId"))):(c+=1,a=e.saveScore({commentId:b.get("id")})),a.done(function(a){b.set({upvoted:!f,upvotes:c,scoreId:a?a.id||null:null}),d("comment.upvote").publish(b.toJSON())}),a},validate:function(a){return a.message?a.message.length>this.maxMessageLength?"Comments must container fewer than "+this.maxMessageLength+" characters.":a.id||a.threadId||a.parentId?void 0:"Your comment is not associated with any thread.":"Please enter a comment."}});return j}),define("hbs!templates/commentReportModal",["hbs","hbs/handlebars","templates/helpers/t"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return'\n<div>\n  <div class="modal__head">\n    <a class="modal__close modal__head__close" href="#" role="button">\n      <i class="g-button-modal-close">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Close",{name:"t",hash:{},data:d}))+'</i>\n    </a>\n    <h3 class="modal__head__title">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Report this comment?",{name:"t",hash:{},data:d}))+"</h3>\n  </div>\n\n  <p>"+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Reporting a comment or conversation sends a notification to our moderation team. They will review the message and take the appropriate action.",{name:"t",hash:{},data:d}))+"</p>\n  <p>"+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"This action cannot be undone.",{name:"t",hash:{},data:d}))+'</p>\n\n  <p>\n    <label>\n      <input class="comment-report__reason" type="radio" name="reason" data-reason="spam">\n      '+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Flag as spam",{name:"t",hash:{},data:d}))+'\n    </label>\n  </p>\n\n  <p>\n    <label>\n      <input class="comment-report__reason" type="radio" name="reason" data-reason="abuse">\n      '+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Flag as inappropriate",{name:"t",hash:{},data:d}))+'\n    </label>\n  </p>\n\n  <p class="comment-report__message" style="display:none">\n    <strong>Please select a reason for reporting this comment.</strong>\n  </p>\n\n  <button class="comment-report__submit button">Flag</button>\n  <button class="comment-report__cancel button">Cancel</button>\n</div>\n'},useData:!0});return b.registerPartial("templates/commentReportModal",c),c}),define("views/CommentReportView",["lodash","Backbone","hbs!templates/commentReportModal","widgets/modal"],function(a,b,c){"use strict";var d=b.View.extend({tagName:"div",className:"comment-report",events:{"click .comment-report__submit":"submit","click .comment-report__cancel":"cancel"},render:function(){return this.$el.html(c()).modal({close:a.bind(this.remove,this)}),this},cancel:function(){this.$el.modal("close")},submit:function(){var a=this.$el.find("input.comment-report__reason:checked").data("reason");return a?(this.disable(!0),this.model.report(a),void this.$el.modal("close")):void this.$el.find("p.comment-report__message").slideDown("fast")},disable:function(a){this.$el[a?"addClass":"removeClass"]("comment-report--disabled"),this.$el.find("button, input, textarea").prop("disabled",a)}});return d}),define("hbs!templates/commentRemoveOwnModal",["hbs","hbs/handlebars","templates/helpers/t"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return'\n<div>\n  <div class="modal__head">\n    <a class="modal__close modal__head__close" href="#" role="button">\n      <i class="g-button-modal-close">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Close",{name:"t",hash:{},data:d}))+'</i>\n    </a>\n    <h3 class="modal__head__title">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Remove your comment?",{name:"t",hash:{},data:d}))+"</h3>\n  </div>\n\n  <p>"+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Are you sure you want to delete your comment?",{name:"t",hash:{},data:d}))+"</p>\n  <p>"+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"This action cannot be undone.",{name:"t",hash:{},data:d}))+'</p>\n\n  <button class="comment-remove__submit button">Yes, delete it</button>\n  <button class="comment-remove__cancel button">Cancel</button>\n</div>\n'},useData:!0});return b.registerPartial("templates/commentRemoveOwnModal",c),c}),define("hbs!templates/commentRemoveModModal",["hbs","hbs/handlebars","templates/helpers/t"],function(a,b){var c=b.template({1:function(a,b,c,d){var e;return'        <option value="'+this.escapeExpression((e=null!=(e=b.value||(null!=a?a.value:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"value",hash:{},data:d}):e))+'">'+this.escapeExpression((e=null!=(e=b.label||(null!=a?a.label:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"label",hash:{},data:d}):e))+"</option>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'\n<div>\n  <div class="modal__head">\n    <a class="modal__close modal__head__close" href="#" role="button">\n      <i class="g-button-modal-close">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Close",{name:"t",hash:{},data:d}))+'</i>\n    </a>\n    <h3 class="modal__head__title">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Remove this comment?",{name:"t",hash:{},data:d}))+'</h3>\n  </div>\n\n  <div class="form-group">\n    <select class="form-control form-control--dropdown comment-remove__reason">\n      <option value="">Reason for deletion</option>\n'+(null!=(e=b.each.call(a,null!=a?a.reasons:a,{name:"each",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+'    </select>\n  </div>\n\n  <div class="form-group">\n    <label class="checkbox">\n      <input class="checkbox__input comment-remove__send" type="checkbox">\n      <span class="form-label">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Send an email notifying the commenter.",{name:"t",hash:{},data:d}))+'</span>\n    </label>\n  </div>\n\n  <div class="form-group">\n    <input class="form-control comment-remove__subject" type="text" value="Your TED.com comment">\n  </div>\n\n  <div class="form-group">\n    <textarea class="form-control comment-remove__email" rows="5"></textarea>\n  </div>\n\n  <button class="comment-remove__submit button">Delete it</button>\n  <button class="comment-remove__cancel button">Cancel</button>\n</div>\n'},useData:!0});return b.registerPartial("templates/commentRemoveModModal",c),c}),define("hbs!templates/emails/commentRemoveNone",["hbs","hbs/handlebars"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return"Dear "+this.escapeExpression((e=null!=(e=b.name||(null!=a?a.name:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"name",hash:{},data:d}):e))+",\n\nThank you for your post, but I'm afraid the right folks won't see it in these comments. Would you mind sending this in via our contact form?\n\nhttp://www.ted.com/contact\n\nThank you!\n\nThe TED Conversations Team\n\nFull text of your comment:\n\n"+this.escapeExpression((e=null!=(e=b.comment||(null!=a?a.comment:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"comment",hash:{},data:d}):e))+"\n"},useData:!0});return b.registerPartial("templates/emails/commentRemoveNone",c),c}),define("hbs!templates/emails/commentRemoveCollateral",["hbs","hbs/handlebars"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return"Dear "+this.escapeExpression((e=null!=(e=b.name||(null!=a?a.name:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"name",hash:{},data:d}):e))+",\n\nWe're sorry, but your comment (included below) has been removed, as a comment it was in response to was deleted. Please feel free to start a new discussion with your comment (included below).\n\n"+this.escapeExpression((e=null!=(e=b.url||(null!=a?a.url:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"url",hash:{},data:d}):e))+"\n\nSincerely,\nThe TED Conversations Team\n\nFull text of your comment:\n\n"+this.escapeExpression((e=null!=(e=b.comment||(null!=a?a.comment:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"comment",hash:{},data:d}):e))+"\n"},useData:!0});return b.registerPartial("templates/emails/commentRemoveCollateral",c),c}),define("hbs!templates/emails/commentRemoveInappropriate",["hbs","hbs/handlebars"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return"Dear "+this.escapeExpression((e=null!=(e=b.name||(null!=a?a.name:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"name",hash:{},data:d}):e))+",\n\nWe're sorry. Your comment has been removed according to the TED.com Terms of Use:\n\nhttp://www.ted.com/termsofuse\n\nWant to rephrase your comment?\n\nRejoin the conversation:\n\n"+this.escapeExpression((e=null!=(e=b.url||(null!=a?a.url:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"url",hash:{},data:d}):e))+"\n\nSincerely,\nThe TED Conversations Team\n\nFull text of your comment:\n\n"+this.escapeExpression((e=null!=(e=b.comment||(null!=a?a.comment:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"comment",hash:{},data:d}):e))+"\n"},useData:!0
});return b.registerPartial("templates/emails/commentRemoveInappropriate",c),c}),define("hbs!templates/emails/commentRemoveGeneral",["hbs","hbs/handlebars"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return"Dear "+this.escapeExpression((e=null!=(e=b.name||(null!=a?a.name:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"name",hash:{},data:d}):e))+",\n\nTED comment threads are a welcoming place for differing opinions, but we ask that you write all comments in a way that is thoughtful and constructive. The goal of our message boards is to host productive conversation and debate. Comments that are insulting or belittling do not make for constructive conversation -- they tend to stifle debate, not promote it.\n\nWith this in mind, we'd ask you to re-write your comment as though the other party were sitting across from you at a dinner table. How could you engage them in constructive and respectful debate?\n\nThe full text of the comment is below; please let us know if you have any questions. For more information on our approach to comments on TED.com, check out our community How-To Guide:\n\nhttp://www.ted.com/pages/conversations_howto\n\nThank you!\n\nThe TED Conversations Team\n\nFull text of your comment:\n\n"+this.escapeExpression((e=null!=(e=b.comment||(null!=a?a.comment:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"comment",hash:{},data:d}):e))+"\n"},useData:!0});return b.registerPartial("templates/emails/commentRemoveGeneral",c),c}),define("hbs!templates/emails/commentRemoveOffTopic",["hbs","hbs/handlebars"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return"Dear "+this.escapeExpression((e=null!=(e=b.name||(null!=a?a.name:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"name",hash:{},data:d}):e))+",\n\nWe're sorry, but we need you to stay on topic as you chime in on conversations, or consider starting a new topic of your own. The full text of your comment is included below, please let us know if you have any questions.\n\nWant to rephrase your comment? Rejoin the conversation:\n\n"+this.escapeExpression((e=null!=(e=b.url||(null!=a?a.url:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"url",hash:{},data:d}):e))+"\n\nStart a new Conversation:\n\nhttp://www.ted.com/conversations\n\nSincerely,\nThe TED Conversations Team\n\nFull text of your comment:\n\n"+this.escapeExpression((e=null!=(e=b.comment||(null!=a?a.comment:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"comment",hash:{},data:d}):e))+"\n"},useData:!0});return b.registerPartial("templates/emails/commentRemoveOffTopic",c),c}),define("hbs!templates/emails/commentRemovePoorlyWritten",["hbs","hbs/handlebars"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return"Dear "+this.escapeExpression((e=null!=(e=b.name||(null!=a?a.name:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"name",hash:{},data:d}):e))+",\n\nWe're sorry. We have removed your comment (included below) from TED.com, because the writing was difficult to understand. Want to clarify and re-post your comment?\n\nRejoin the conversation:\n\n"+this.escapeExpression((e=null!=(e=b.url||(null!=a?a.url:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"url",hash:{},data:d}):e))+"\n\nSincerely,\nThe TED Conversations Team\n\nFull text of your comment:\n\n"+this.escapeExpression((e=null!=(e=b.comment||(null!=a?a.comment:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"comment",hash:{},data:d}):e))+"\n"},useData:!0});return b.registerPartial("templates/emails/commentRemovePoorlyWritten",c),c}),define("hbs!templates/emails/commentRemoveRude",["hbs","hbs/handlebars"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return"Dear "+this.escapeExpression((e=null!=(e=b.name||(null!=a?a.name:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"name",hash:{},data:d}):e))+",\n\nTED comment threads are a welcoming place for critical comment and debate, but we ask that you write all comments in a way that is thoughtful and constructive. The goal of our message boards is to host productive conversation and debate. Comments that are insulting or belittling, especially those that are aggressive towards a speaker personally, do not make for constructive conversation -- they tend to stifle debate, not promote it.\n\nWith this in mind, we'd ask you to re-write your comment as though the speaker were sitting across from you at a dinner table. Our speakers do read and respond to comments. How could you engage the speaker in constructive and respectful debate?\n\nThe full text of the comment is below; please let us know if you have any questions. For more information on our approach to comments on TED.com, check out our community How-To Guide:\n\nhttp://www.ted.com/pages/conversations_howto\n\nThank you!\n\nThe TED Conversations Team\n\nFull text of your comment:\n\n"+this.escapeExpression((e=null!=(e=b.comment||(null!=a?a.comment:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"comment",hash:{},data:d}):e))+"\n"},useData:!0});return b.registerPartial("templates/emails/commentRemoveRude",c),c}),define("views/CommentRemoveView",["lodash","Backbone","hbs!templates/commentRemoveOwnModal","hbs!templates/commentRemoveModModal","hbs!templates/emails/commentRemoveNone","hbs!templates/emails/commentRemoveCollateral","hbs!templates/emails/commentRemoveInappropriate","hbs!templates/emails/commentRemoveGeneral","hbs!templates/emails/commentRemoveOffTopic","hbs!templates/emails/commentRemovePoorlyWritten","hbs!templates/emails/commentRemoveRude","widgets/modal"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";var l=b.View.extend({tagName:"div",className:"comment-remove",events:{"change .comment-remove__reason":"reason","click .comment-remove__submit":"submit","click .comment-remove__cancel":"cancel"},reasons:[{value:"comment_none",label:"None",email:e},{value:"comment_collateral",label:"Collateral damage",email:f},{value:"comment_inappropriate",label:"Inappropriate",email:g},{value:"comment_general",label:"General",email:h},{value:"comment_off_topic",label:"Off-topic",email:i},{value:"comment_poorly_written",label:"Poorly written",email:j},{value:"comment_rude",label:"Rude critique",email:k}],reason:function(){var b=a.find(this.reasons,{value:this.$reason.val()}),c={name:this.model.get("name"),comment:this.model.get("message"),url:window.location.href};this.$email.val(b?b.email(c):"")},render:function(){var b=this.model.get("isOwn");return this.$el.html(b?c():d({reasons:this.reasons})),this.$el.modal({close:a.bind(this.remove,this)}),b||(this.$email=this.$el.find("textarea.comment-remove__email"),this.$reason=this.$el.find("select.comment-remove__reason"),this.$subject=this.$el.find("input.comment-remove__subject")),this},cancel:function(){this.$el.modal("close")},submit:function(){this.disable(!0),this.model.get("isOwn")?this.model.remove():this.model.remove({reason:this.$reason.val(),email:this.$email.val(),subject:this.$subject.val(),send:this.$el.find("input.comment-remove__send:checked").length>0}),this.$el.modal("close")},disable:function(a){this.$el[a?"addClass":"removeClass"]("comment-remove--disabled"),this.$el.find("button, input, textarea").prop("disabled",a)}});return l}),define("utils/paragraphs",[],function(){"use strict";var a="\n";return function(b){var c,d;if(!b)return[[]];for(c=b.replace(/\r\n/g,a).replace(/\r/g,a).split(a+a),d=c.length;d--;)c[d]=c[d].split(a);return c}}),define("views/CommentView",["jquery","lodash","Backbone","views/AuthView","views/CommentsView","hbs!templates/comment","models/Comment","spinjs","hbs!templates/commentApologyModal","views/CommentReportView","views/CommentRemoveView","utils/paragraphs","widgets/modal"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(){e||(e=require("views/CommentsView"))}var n=["ADD1D6","B0C4CC","778390","4B6375"],o={},p=b.once(function(){o.$apology=null,o.$body=a("body, html"),o.reportView=null}),q="comment__upvote--upvoted",r=d.extend({tagName:"article",className:"comment",events:{"click a.comment__reply":"toggleReply","click a.comment__upvote":"upvote","click a.comment__report":"report","click a.comment__edit":"toggleEdit","click a.comment__delete":"remove","click a.comment__move":"move","click button.comment__response__submit":"submit","input textarea.comment__response__input":"recountResponse","click button.comment__editor__submit":"submitEdit","input textarea.comment__editor__input":"recountEdit"},initialize:function(){this.listenTo(this.model,"change:upvotes",this.refreshUpvotes),this.listenTo(this.model,"change:reported",this.refreshReported),this.listenTo(this.model,"change:removed",this.refreshRemoved),this.listenTo(this.model,"change:message",this.refreshMessage),this.listenTo(this.model,"request",this._request),this.demandAuthFor("toggleReply","upvote","report","toggleEdit","remove","move"),this.$el.data("view",this)},recountResponse:function(a){this._checkEventRecipient("recountResponse",a)&&this.$responseCount.text(this.model.maxMessageLength-this.$responseText.val().length)},render:function(){p();var a=this.model.collection.parent,c=this.model.toJSON();return c.monogram=this.model.monogram(),c.color=b.shuffle(n)[0],c.paragraphs=l(c.message),this.$el.attr("id","comment-"+c.id).html(f(b.extend({parent:!!a&&a.toJSON()},c))),this.$body=this.$el.find("div.comment__body"),this.$editLink=this.$el.find("a.comment__edit"),this.$edit=this.$el.find("div.comment__editor"),this.$editText=this.$edit.find("textarea.comment__editor__input"),this.$editMessage=this.$edit.find("div.comment__editor__message"),this.$editCount=this.$edit.find("span.comment__editor__count"),this.$response=this.$el.find("article.comment__response"),this.$responseText=this.$response.find("textarea"),this.$responseMessage=this.$response.find("div.comment__response__message"),this.$responseCount=this.$response.find("span.comment__response__limit__remain"),this.$replyLink=this.$el.find("a.comment__reply"),this.$upvote=this.$el.find("a.comment__upvote"),this.$upvoteCount=this.$el.find("span.comment__upvote__count"),this._renderReplies(),this},refreshMessage:function(){var a=l(this.model.get("message")),c="",d=0;do c+="<p>"+b.escape(a[d])+"</p>",d++;while(d<a.length);this.$body.html(c)},refreshRemoved:function(){this.$el.slideUp("fast")},toggleEdit:function(a){if(this._checkEventRecipient("toggleEdit",a)){a.preventDefault();var c="none"===this.$edit.css("display"),d=this;this.$editLink[c?"addClass":"removeClass"]("comment__link--active"),c?(d.$editText.val(d.model.get("message")),d.recountEdit(a),d.$body.slideUp("fast"),d.$edit.slideDown("fast"),b.delay(function(){d.$editText.focus()},100)):(this.$edit.slideUp("fast"),this.$body.slideDown("fast"))}},remove:function(a){this._checkEventRecipient("remove",a)&&(a.preventDefault(),new k({model:this.model}).render())},destroy:function(){return this.undelegateEvents(),this.$el.removeData().unbind(),c.View.prototype.remove.call(this)},move:function(a){this._checkEventRecipient("move",a)&&a.preventDefault()},submitEdit:function(a){var b=this;if(b._checkEventRecipient("submitEdit",a)){a.preventDefault();var c=b.model.get("message");b.model.set("message",b.$editText.val());var d=b.model.save();d?(b.$editMessage.slideUp("fast"),this._getSpinner().spin(b.$edit.get(0)),this.disableEdit(!0),d.then(function(){b.$edit.slideUp("fast"),b.$body.slideDown("fast")},function(){b.apologize(),b.model.set("message",c)}).always(function(){b._spinner.stop(),b.disableEdit(!1)})):(b.model.set("message",c),b.$editMessage.text(b.model.validationError).slideDown("fast"))}},disableEdit:function(a){this.$edit.find("button, input, textarea").prop("disabled",a)},recountEdit:function(a){this._checkEventRecipient("recountEdit",a)&&(a.preventDefault(),this.$editCount.text(this.model.maxMessageLength-this.$editText.val().length))},toggleReply:function(a){if(this._checkEventRecipient("toggleReply",a)){a.preventDefault();var b="none"===this.$response.css("display"),c=this;this.$replyLink[b?"addClass":"removeClass"]("comment__link--active"),b?this.$response.slideDown(400,function(){c.$responseText.focus()}):this.$response.slideUp("fast")}},upvote:function(a){this._checkEventRecipient("upvote",a)&&(a.preventDefault(),this.model.toggleUpvote())},report:function(a){this._checkEventRecipient("report",a)&&(a.preventDefault(),this.model.get("reported")?this.model.unreport():new j({model:this.model}).render())},submit:function(a){var b=this;if(b._checkEventRecipient("submit",a)){a.preventDefault();var c=new g({parentId:b.model.get("id"),message:b.$responseText.val()}),d=c.save();d?(b.$responseMessage.slideUp("fast"),this._getSpinner().spin(b.$response.get(0)),this.disableResponse(!0),d.then(function(){b.model.replies.add(c,{at:0}),b.$responseText.val(""),b.$response.slideUp("fast")},function(){b.apologize(),c=null}).always(function(){b._spinner.stop(),b.disableResponse(!1)})):(b.$responseMessage.text(c.validationError).slideDown("fast"),c=null)}},disableResponse:function(a){this.$response[a?"addClass":"removeClass"]("comment__response--disabled"),this.$response.find("button, input, textarea").prop("disabled",a)},apologize:function(){o.$apology?o.$apology.modal("open"):o.$apology=a(i()).modal()},refreshUpvotes:function(){var a=this.model.get("upvotes"),b=a&&a>0;b&&this.$upvoteCount.text("("+a+")"),this.$upvoteCount[b?"fadeIn":"fadeOut"]("fast"),this.$upvote[this.model.get("upvoted")?"addClass":"removeClass"](q)},refreshReported:function(){var b=a(f(this.model.toJSON())).find(".comment__report");this.$el.find(".comment__report").replaceWith(b)},_checkEventRecipient:function(b,c){var d=a(c.target).closest("article.comment"),e=d.data("view"),f=e===this;return f||e[b].call(e,c),f},_getSpinner:function(){return this._spinner||(this._spinner=new h),this._spinner},_renderReplies:function(){m(),this._repliesView=new e({events:{},collection:this.model.replies}),this._repliesView.render(),this._repliesView.$el.appendTo(this.$el.find("div.comment__replies"))},_pendingRequests:0,_request:function(a,b){var c=this;c._requestSpinner||(c._requestSpinner=new h),c.$body.is(":visible")&&c._requestSpinner.spin(c.$body.get(0)),c._pendingRequests++,b.always(function(){c._pendingRequests--,c._pendingRequests<=0&&c._requestSpinner.stop()})}});return r}),define("views/CommentsView",["jquery","lodash","Backbone","views/CommentView"],function(a,b,c,d){"use strict";function e(b,c){var d=a(c.target).closest("article.comment"),e=d.data("view");e[b].call(e,c)}var f=c.View.extend({tagName:"section",className:"comments",events:{"click a.comment__reply":"commentToggleReply","click a.comment__upvote":"commentUpvote","click a.comment__report":"commentReport","click a.comment__edit":"commentToggleEdit","click a.comment__delete":"commentRemove","click a.comment__move":"commentMove","click button.comment__response__submit":"commentSubmit","input textarea.comment__response__input":"commentRecountResponse","click button.comment__editor__submit":"commentSubmitEdit","input textarea.comment__editor__input":"commentRecountEdit"},initialize:function(){this.listenTo(this.collection,"add",this._addComment),this.listenTo(this.collection,"reset",this.render)},render:function(){var a=this;return a.$el.empty(),a.collection.length?a.collection.each(function(b){a._addComment(b)}):a.$el.hide(),a._rendered=!0,a},destroy:function(){return this.$el.children("article.comment").each(function(){var b=a(this).data("view");b&&b.destroy()}),this.undelegateEvents(),this.$el.removeData().unbind(),c.View.prototype.remove.call(this)},commentToggleReply:function(a){e("toggleReply",a)},commentUpvote:function(a){e("upvote",a)},commentToggleEdit:function(a){e("toggleEdit",a)},commentRemove:function(a){e("remove",a)},commentMove:function(a){e("move",a)},commentRecountResponse:function(a){e("recountResponse",a)},commentReport:function(a){e("report",a)},commentSubmit:function(a){e("submit",a)},commentSubmitEdit:function(a){e("submitEdit",a)},commentRecountEdit:function(a){e("recountEdit",a)},_addComment:function(a,b,c){var e=new d({events:{},model:a}),f=e.render().$el;this._rendered&&f.hide(),this.$el[c&&0===c.at?"prepend":"append"](f),this._rendered&&(this.$el.show(),f.slideDown("fast"))}});return f}),define("autosize",["jquery"],function(a){return function(a){var b,c={className:"autosizejs",id:"autosizejs",append:"\n",callback:!1,resizeDelay:10,placeholder:!0},d='<textarea tabindex="-1" style="position:absolute; top:-999px; left:0; right:auto; bottom:auto; border:0; padding: 0; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden; transition:none; -webkit-transition:none; -moz-transition:none;"/>',e=["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],f=a(d).data("autosize",!0)[0];f.style.lineHeight="99px","99px"===a(f).css("lineHeight")&&e.push("lineHeight"),f.style.lineHeight="",a.fn.autosize=function(d){return this.length?(d=a.extend({},c,d||{}),f.parentNode!==document.body&&a(document.body).append(f),this.each(function(){function c(){var b,c=!!window.getComputedStyle&&window.getComputedStyle(m,null);c?(b=m.getBoundingClientRect().width,0!==b&&"number"==typeof b||(b=parseInt(c.width,10)),a.each(["paddingLeft","paddingRight","borderLeftWidth","borderRightWidth"],function(a,d){b-=parseInt(c[d],10)})):b=n.width(),f.style.width=Math.max(b,0)+"px"}function g(){var g={};if(b=m,f.className=d.className,f.id=d.id,j=parseInt(n.css("maxHeight"),10),a.each(e,function(a,b){g[b]=n.css(b)}),a(f).css(g).attr("wrap",n.attr("wrap")),c(),window.chrome){var h=m.style.width;m.style.width="0px";m.offsetWidth;m.style.width=h}}function h(){var a,e;b!==m?g():c(),!m.value&&d.placeholder?f.value=(n.attr("placeholder")||"")+d.append:f.value=m.value+d.append,f.style.overflowY=m.style.overflowY,e=parseInt(m.style.height,10),f.scrollTop=0,f.scrollTop=9e4,a=f.scrollTop,j&&a>j?(m.style.overflowY="scroll",a=j):(m.style.overflowY="hidden",a<k&&(a=k)),a+=o,e!==a&&(m.style.height=a+"px",p&&d.callback.call(m,m))}function i(){clearTimeout(l),l=setTimeout(function(){var a=n.width();a!==r&&(r=a,h())},parseInt(d.resizeDelay,10))}var j,k,l,m=this,n=a(m),o=0,p=a.isFunction(d.callback),q={height:m.style.height,overflow:m.style.overflow,overflowY:m.style.overflowY,wordWrap:m.style.wordWrap,resize:m.style.resize},r=n.width(),s=n.css("resize");n.data("autosize")||(n.data("autosize",!0),"border-box"!==n.css("box-sizing")&&"border-box"!==n.css("-moz-box-sizing")&&"border-box"!==n.css("-webkit-box-sizing")||(o=n.outerHeight()-n.height()),k=Math.max(parseInt(n.css("minHeight"),10)-o||0,n.height()),n.css({overflow:"hidden",overflowY:"hidden",wordWrap:"break-word"}),"vertical"===s?n.css("resize","none"):"both"===s&&n.css("resize","horizontal"),"onpropertychange"in m?"oninput"in m?n.on("input.autosize keyup.autosize",h):n.on("propertychange.autosize",function(){"value"===event.propertyName&&h()}):n.on("input.autosize",h),d.resizeDelay!==!1&&a(window).on("resize.autosize",i),n.on("autosize.resize",h),n.on("autosize.resizeIncludeStyle",function(){b=null,h()}),n.on("autosize.destroy",function(){b=null,clearTimeout(l),a(window).off("resize",i),n.off("autosize").off(".autosize").css(q).removeData("autosize")}),h())})):this}}(window.jQuery||window.$),a}),define("views/ThreadView",["jquery","lodash","Backbone","spinjs","hbs!templates/commentApologyModal","views/CommentsView","models/Comment","widgets/modal","autosize"],function(a,b,c,d,e,f,g){"use strict";function h(){if(i)i.modal("open");else{var b=a(e());i=b.modal()}}var i,j={newArea:"div.thread__new",newAlert:"div.thread__new__alert",newCount:"span.thread__new__count",newText:"textarea.thread__new__input",comments:"div.thread__comments",sorts:"input.thread__sorts__option__input",more:"a.thread__more",loading:null},k=c.View.extend({events:{"click button.thread__new__button":"submitNew","input textarea.thread__new__input":"recountNew","focus textarea":"enableAutoresize","click a.thread__more":"more","click input.thread__sorts__option__input":"sort"},disableNew:function(a){this.init$el("newArea")&&this.$els.newArea.find("button, input, textarea").prop("disabled",a)},getSort:function(){return this.init$el("sorts")?this.$els.sorts.filter(":checked").val():null},initialize:function(){this.$els={},this.listenTo(this.model,"request",this._loadingMore),this.listenTo(this.model.comments,"add",this._recountComments),this.listenTo(this.model.comments,"remove",this._recountComments),this.listenTo(this.model.comments,"reset",this._recountComments)},more:function(a){a&&a.preventDefault(),this.model.more()},destroy:function(){return this.commentsView.destroy(),c.View.prototype.remove.call(this)},recountNew:function(){var a,b=g.prototype.maxMessageLength,c=this.init$el("newCount")&&this.init$el("newText"),d=this.$els;c&&(a=d.newText.val(),d.newCount.text(b-a.length))},render:function(){this.commentsView||(this.commentsView=new f({collection:this.model.comments})),this.init$el("comments")&&(this.commentsView.render().$el.appendTo(this.$els.comments),this.$els.loading=a("<div></div>").addClass("thread__loading").hide().appendTo(this.$els.comments),this._recountComments())},enableAutoresize:function(b){a(b.target).autosize()},sort:function(){this.model.sort(this.getSort())},submitNew:function(a){var b=this;if(b.init$el("newAlert")&&b.init$el("newArea")&&b.init$el("newText")){a&&a.preventDefault();var c=new g({threadId:b.model.get("id"),message:b.$els.newText.val()}),d=c.save();d?(b.$els.newAlert.slideUp("fast"),this._getSpinner().spin(b.$els.newArea.get(0)),b.disableNew(!0),d.then(function(){b.model.comments.add(c,{at:0}),b.$els.newText.val("")},function(){h(),c=null}).always(function(){b._spinner.stop(),b.disableNew(!1)})):(b.$els.newAlert.text(c.validationError).slideDown("fast"),c=null)}},init$el:function(a){var c=this.$els[a]||j[a];return c&&b.isString(c)?(c=this.$el.find(c),c.length||(c=!1),this.$els[a]=c,c):c},_getSpinner:function(){return this._spinner||(this._spinner=new d),this._spinner},_loadingMore:function(a,b){var c=this;c.$els.loading&&(c._getSpinner().spin(c.$els.loading.show().get(0)),c.$el.addClass("thread--loading"),b.always(function(){c._spinner.stop(),c.$els.loading.slideUp("fast"),c.$el.removeClass("thread--loading")}).done(function(a){a&&a.metadata.pageCount<=a.metadata.page?c.init$el("more").fadeOut("fast"):c.init$el("more").show()}))},_recountCommentsLast:null,_recountComments:function(){var a=this.model.comments.length>0;a!==this._recountCommentsLast&&(this.$el[a?"removeClass":"addClass"]("thread--no-comments")[a?"addClass":"removeClass"]("thread--with-comments"),this._recountCommentsLast=a)}});return k}),define("models/Thread",["Backbone","collections/Comments","lib/thread"],function(a,b,c){"use strict";var d=a.Model.extend({defaults:{id:null,sort:"rated"},_loadingMore:!1,nextPage:1,constructor:function(){this.comments=new b,a.Model.apply(this,arguments)},more:function(){var a=this;if(!a._loadingMore){a._loadingMore=!0;var b=a.get("id"),d={page:a.nextPage,sort:a.get("sort")},e=c.get(b,d).then(function(b){var c=b.records;return c&&c.length&&(a.comments[1===a.nextPage?"reset":"add"](c),a.nextPage++),b}).always(function(){a._loadingMore=!1});a.trigger("request",a,e)}},sort:function(a){this.set("sort",a),this.nextPage=1,this.more()}});return d}),define("hbs!templates/subtitle-help-modal",["hbs","hbs/handlebars"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return'\n<div class="modal__head">\n  <a class="modal__close modal__head__close" href="#" role="button">\n    <i class="g-button-modal-close">Close</i>\n  </a>\n\n  <h3 class="modal__head__title">Help with subtitles</h3>\n</div>\n\n<p><strong>Desktop / laptop users:</strong> please make sure you have the most updated versions of your browser and Flash player, and that Flash is enabled when you visit TED.com.</p>\n\n<p><strong>iOS users:</strong> to access subtitles, start playing the video, then tap the speech bubble icon that appears in the bottom row of video controls.</p>\n\n<p><strong>Android users:</strong> although Android devices do not support subtitles, you can <a href="https://play.google.com/store/apps/details?id=com.ted.android" target="_blank">download the TED app from the Google Play store</a>.</p>\n'},useData:!0});return b.registerPartial("templates/subtitle-help-modal",c),c}),function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define("clipboard",[],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Clipboard=a()}}(function(){var a;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(a,b){for(;a&&a.nodeType!==e;){if(a.matches(b))return a;a=a.parentNode}}var e=9;if("undefined"!=typeof Element&&!Element.prototype.matches){var f=Element.prototype;f.matches=f.matchesSelector||f.mozMatchesSelector||f.msMatchesSelector||f.oMatchesSelector||f.webkitMatchesSelector}b.exports=d},{}],2:[function(a,b,c){function d(a,b,c,d,f){var g=e.apply(this,arguments);return a.addEventListener(c,g,f),{destroy:function(){a.removeEventListener(c,g,f)}}}function e(a,b,c,d){return function(c){c.delegateTarget=f(c.target,b),c.delegateTarget&&d.call(a,c)}}var f=a("./closest");b.exports=d},{"./closest":1}],3:[function(a,b,c){c.node=function(a){return void 0!==a&&a instanceof HTMLElement&&1===a.nodeType},c.nodeList=function(a){var b=Object.prototype.toString.call(a);return void 0!==a&&("[object NodeList]"===b||"[object HTMLCollection]"===b)&&"length"in a&&(0===a.length||c.node(a[0]))},c.string=function(a){return"string"==typeof a||a instanceof String},c.fn=function(a){var b=Object.prototype.toString.call(a);return"[object Function]"===b}},{}],4:[function(a,b,c){function d(a,b,c){if(!a&&!b&&!c)throw new Error("Missing required arguments");if(!h.string(b))throw new TypeError("Second argument must be a String");if(!h.fn(c))throw new TypeError("Third argument must be a Function");if(h.node(a))return e(a,b,c);if(h.nodeList(a))return f(a,b,c);if(h.string(a))return g(a,b,c);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}function e(a,b,c){return a.addEventListener(b,c),{destroy:function(){a.removeEventListener(b,c)}}}function f(a,b,c){return Array.prototype.forEach.call(a,function(a){a.addEventListener(b,c)}),{destroy:function(){Array.prototype.forEach.call(a,function(a){a.removeEventListener(b,c)})}}}function g(a,b,c){return i(document.body,a,b,c)}var h=a("./is"),i=a("delegate");b.exports=d},{"./is":3,delegate:2}],5:[function(a,b,c){function d(a){var b;if("SELECT"===a.nodeName)a.focus(),b=a.value;else if("INPUT"===a.nodeName||"TEXTAREA"===a.nodeName){var c=a.hasAttribute("readonly");c||a.setAttribute("readonly",""),a.select(),a.setSelectionRange(0,a.value.length),c||a.removeAttribute("readonly"),b=a.value}else{a.hasAttribute("contenteditable")&&a.focus();var d=window.getSelection(),e=document.createRange();e.selectNodeContents(a),d.removeAllRanges(),d.addRange(e),b=d.toString()}return b}b.exports=d},{}],6:[function(a,b,c){function d(){}d.prototype={on:function(a,b,c){var d=this.e||(this.e={});return(d[a]||(d[a]=[])).push({fn:b,ctx:c}),this},once:function(a,b,c){function d(){e.off(a,d),b.apply(c,arguments)}var e=this;return d._=b,this.on(a,d,c)},emit:function(a){var b=[].slice.call(arguments,1),c=((this.e||(this.e={}))[a]||[]).slice(),d=0,e=c.length;for(d;d<e;d++)c[d].fn.apply(c[d].ctx,b);return this},off:function(a,b){var c=this.e||(this.e={}),d=c[a],e=[];if(d&&b)for(var f=0,g=d.length;f<g;f++)d[f].fn!==b&&d[f].fn._!==b&&e.push(d[f]);return e.length?c[a]=e:delete c[a],this}},b.exports=d},{}],7:[function(b,c,d){!function(e,f){if("function"==typeof a&&a.amd)a(["module","select"],f);else if("undefined"!=typeof d)f(c,b("select"));else{var g={exports:{}};f(g,e.select),e.clipboardAction=g.exports}}(this,function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{default:a}}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=c(b),f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=function(){function a(b){d(this,a),this.resolveOptions(b),this.initSelection()}return g(a,[{key:"resolveOptions",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action=a.action,this.emitter=a.emitter,this.target=a.target,this.text=a.text,this.trigger=a.trigger,this.selectedText=""}},{key:"initSelection",value:function(){this.text?this.selectFake():this.target&&this.selectTarget()}},{key:"selectFake",value:function(){var a=this,b="rtl"==document.documentElement.getAttribute("dir");this.removeFake(),this.fakeHandlerCallback=function(){return a.removeFake()},this.fakeHandler=document.body.addEventListener("click",this.fakeHandlerCallback)||!0,this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="absolute",this.fakeElem.style[b?"right":"left"]="-9999px";var c=window.pageYOffset||document.documentElement.scrollTop;this.fakeElem.style.top=c+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,document.body.appendChild(this.fakeElem),this.selectedText=(0,e.default)(this.fakeElem),this.copyText()}},{key:"removeFake",value:function(){this.fakeHandler&&(document.body.removeEventListener("click",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null),this.fakeElem&&(document.body.removeChild(this.fakeElem),this.fakeElem=null)}},{key:"selectTarget",value:function(){this.selectedText=(0,e.default)(this.target),this.copyText()}},{key:"copyText",value:function(){var a=void 0;try{a=document.execCommand(this.action)}catch(b){a=!1}this.handleResult(a)}},{key:"handleResult",value:function(a){this.emitter.emit(a?"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function(){this.target&&this.target.blur(),window.getSelection().removeAllRanges()}},{key:"destroy",value:function(){this.removeFake()}},{key:"action",set:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"copy";if(this._action=a,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}},{key:"target",set:function(a){if(void 0!==a){if(!a||"object"!==("undefined"==typeof a?"undefined":f(a))||1!==a.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&a.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(a.hasAttribute("readonly")||a.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');
this._target=a}},get:function(){return this._target}}]),a}();a.exports=h})},{select:5}],8:[function(b,c,d){!function(e,f){if("function"==typeof a&&a.amd)a(["module","./clipboard-action","tiny-emitter","good-listener"],f);else if("undefined"!=typeof d)f(c,b("./clipboard-action"),b("tiny-emitter"),b("good-listener"));else{var g={exports:{}};f(g,e.clipboardAction,e.tinyEmitter,e.goodListener),e.clipboard=g.exports}}(this,function(a,b,c,d){"use strict";function e(a){return a&&a.__esModule?a:{default:a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function i(a,b){var c="data-clipboard-"+a;if(b.hasAttribute(c))return b.getAttribute(c)}var j=e(b),k=e(c),l=e(d),m=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),n=function(a){function b(a,c){f(this,b);var d=g(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return d.resolveOptions(c),d.listenClick(a),d}return h(b,a),m(b,[{key:"resolveOptions",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action="function"==typeof a.action?a.action:this.defaultAction,this.target="function"==typeof a.target?a.target:this.defaultTarget,this.text="function"==typeof a.text?a.text:this.defaultText}},{key:"listenClick",value:function(a){var b=this;this.listener=(0,l.default)(a,"click",function(a){return b.onClick(a)})}},{key:"onClick",value:function(a){var b=a.delegateTarget||a.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new j.default({action:this.action(b),target:this.target(b),text:this.text(b),trigger:b,emitter:this})}},{key:"defaultAction",value:function(a){return i("action",a)}},{key:"defaultTarget",value:function(a){var b=i("target",a);if(b)return document.querySelector(b)}},{key:"defaultText",value:function(a){return i("text",a)}},{key:"destroy",value:function(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)}}],[{key:"isSupported",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["copy","cut"],b="string"==typeof a?[a]:a,c=!!document.queryCommandSupported;return b.forEach(function(a){c=c&&!!document.queryCommandSupported(a)}),c}}]),b}(k.default);a.exports=n})},{"./clipboard-action":7,"good-listener":4,"tiny-emitter":6}]},{},[8])(8)}),define("hbs!templates/playerHeroHiccup",["hbs","hbs/handlebars"],function(a,b){var c=b.template({1:function(a,b,c,d){return"        Sorry:\n        we can't play video on this browser.\n        Please make sure it's up to date\n        and that Flash 11.1 or higher is installed.\n"},3:function(a,b,c,d){return"        We're sorry:\n        video playback cannot be initialized\n        at this time.\n"},5:function(a,b,c,d){return"        We're sorry:\n        video playback has been interrupted.\n        You may need to refresh the page\n        to resume.\n"},7:function(a,b,c,d){return"        We are experiencing a small hiccup.\n        Video playback may be slow or choppy.\n        Please be patient.\n        We're working on it!\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'\n<div class="player-hero__hiccup">\n  <div class="player-hero__inner">\n    <div class="container">\n'+(null!=(e=b.if.call(a,null!=a?a.isClient:a,{name:"if",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+"\n"+(null!=(e=b.if.call(a,null!=a?a.isInit:a,{name:"if",hash:{},fn:this.program(3,d,0),inverse:this.noop,data:d}))?e:"")+"\n"+(null!=(e=b.if.call(a,null!=a?a.isFatal:a,{name:"if",hash:{},fn:this.program(5,d,0),inverse:this.noop,data:d}))?e:"")+"\n"+(null!=(e=b.if.call(a,null!=a?a.isHiccup:a,{name:"if",hash:{},fn:this.program(7,d,0),inverse:this.noop,data:d}))?e:"")+"\n      You can always\n      download this talk\n      or save it to watch later.\n    </div>\n  </div>\n</div>\n"},useData:!0});return b.registerPartial("templates/playerHeroHiccup",c),c}),define("hbs!templates/controlsMaxi",["hbs","hbs/handlebars","templates/helpers/icon","templates/helpers/t"],function(a,b){var c=b.template({1:function(a,b,c,d){return'        <a class="controls__button controls__skip" href="#" tabindex="1" role="button">\n          '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"control-skip","","controls__icon",{name:"icon",hash:{},data:d}))+"\n          "+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Skip",{name:"t",hash:{},data:d}))+"\n        </a>\n"},3:function(a,b,c,d){return'        <a class="controls__button controls__button--right controls__transcript" href="#" tabindex="1" role="button">\n          '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"transcript","","controls__icon",{name:"icon",hash:{},data:d}))+"\n          "+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Transcript",{name:"t",hash:{},data:d}))+"\n        </a>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'\n<div class="controls controls--maxi controls--active">\n  <div class="controls__postbar">\n    <div class="controls__postbar__progress"></div>\n  </div>\n\n  <div class="controls__scrubber scrubber">\n    <span class="controls__time controls__time--elapsed">0:00</span>\n    <span class="controls__time controls__time--duration">0:00</span>\n  </div>\n\n  <div class="controls__toolbar">\n    <div class="controls__adtime">\n      <div class="controls__adtime__inner">\n        <div class="controls__adtime__content">\n          Ad:&nbsp;<span class="controls__adtime__value">0:00</span>\n        </div>\n      </div>\n    </div>\n\n    <div class="controls__toolbar__container">\n      <a class="controls__button controls__play" href="#" tabindex="1" role="button">\n        '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"control-play","","controls__icon",{name:"icon",hash:{},data:d}))+"\n        "+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Play",{name:"t",hash:{},data:d}))+'\n      </a>\n\n      <a class="controls__button controls__pause" href="#" tabindex="1" role="button">\n        '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"control-pause","","controls__icon",{name:"icon",hash:{},data:d}))+"\n        "+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Pause",{name:"t",hash:{},data:d}))+"\n      </a>\n\n"+(null!=(e=b.if.call(a,null!=(e=null!=a?a.options:a)?e.isSkip:e,{name:"if",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+'\n      <a class="controls__button controls__volume" href="#" tabindex="1" role="button">\n        '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"control-volume","","controls__icon",{name:"icon",hash:{},data:d}))+"\n        "+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Volume",{name:"t",hash:{},data:d}))+'\n      </a>\n\n      <a class="controls__button controls__button--right controls__fullscreen" href="#" tabindex="1" role="button">\n        '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"control-fullscreen","","controls__icon",{name:"icon",hash:{},data:d}))+"\n        "+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"FullScreen",{name:"t",hash:{},data:d}))+'\n      </a>\n\n      <a class="controls__button controls__button--right controls__options" href="#" tabindex="1" role="button">\n        '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"control-cog","","controls__icon",{name:"icon",hash:{},data:d}))+"\n        "+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Options",{name:"t",hash:{},data:d}))+"\n      </a>\n\n"+(null!=(e=b.if.call(a,null!=(e=null!=a?a.options:a)?e.isTranscript:e,{name:"if",hash:{},fn:this.program(3,d,0),inverse:this.noop,data:d}))?e:"")+'\n      <a class="controls__button controls__button--right controls__subtitles" href="#" tabindex="1" role="button">\n        '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"subtitle","","controls__icon",{name:"icon",hash:{},data:d}))+"\n        "+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Subtitles",{name:"t",hash:{},data:d}))+'\n      </a>\n\n      <div class="controls__meta">\n        <div class="controls__detail"></div>\n\n        <div class="controls__meta__credits"></div>\n      </div>\n    </div>\n  </div>\n</div>\n'},useData:!0});return b.registerPartial("templates/controlsMaxi",c),c}),define("hbs!templates/controlsMini",["hbs","hbs/handlebars","templates/helpers/icon"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return'\n<div class="controls controls--mini">\n  <div class="controls__toolbar">\n    <a class="controls__button controls__play" href="#" tabindex="1" role="button">\n      '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"control-play","Play","controls__icon",{name:"icon",hash:{},data:d}))+'\n    </a>\n\n    <a class="controls__button controls__pause" href="#" tabindex="1" role="button">\n      '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"control-pause","Pause","controls__icon",{name:"icon",hash:{},data:d}))+'\n    </a>\n\n    <a class="controls__button controls__volume" href="#" tabindex="1" role="button">\n      '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"control-volume","Volume","controls__icon",{name:"icon",hash:{},data:d}))+'\n    </a>\n\n    <a class="controls__button controls__button--right controls__fullscreen" href="#" tabindex="1" role="button">\n      '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"control-fullscreen","Toggle full screen","controls__icon",{name:"icon",hash:{},data:d}))+'\n    </a>\n\n    <a class="controls__button controls__button--right controls__options" href="#" tabindex="1" role="button">\n      '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"control-cog","Options","controls__icon",{name:"icon",hash:{},data:d}))+'\n    </a>\n\n    <a class="controls__button controls__button--right controls__subtitles" href="#" tabindex="1" role="button">\n      '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"subtitle","Subtitles","controls__icon",{name:"icon",hash:{},data:d}))+'\n    </a>\n\n    <span class="controls__time controls__time--elapsed">0:00</span>\n    <span class="controls__time controls__time--duration">0:00</span>\n\n    <div class="controls__scrub-wrapper">\n      <div class="controls__scrubber scrubber"></div>\n    </div>\n  </div>\n</div>\n'},useData:!0});return b.registerPartial("templates/controlsMini",c),c}),define("templates/helpers/formatDate",["Handlebars","moment"],function(a,b){"use strict";function c(a,c,d){return d&&d.hash&&d.hash.forceUTC?b(c||void 0).utc().format(a):b(c||void 0).format(a)}return a.registerHelper("formatDate",c),c}),define("hbs!templates/controlsMaxiDetail",["hbs","hbs/handlebars","templates/helpers/t","templates/helpers/formatDate"],function(a,b){var c=b.template({1:function(a,b,c,d){var e;return"    "+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Playlist:",{name:"t",hash:{},data:d}))+"\n    "+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"playing",{name:"t",hash:{},data:d}))+"\n    "+this.escapeExpression((e=null!=(e=b.index||(null!=a?a.index:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"index",hash:{},data:d}):e))+"\n    "+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"of",{name:"t",hash:{},data:d}))+"\n    "+this.escapeExpression((e=null!=(e=b.talksCount||(null!=a?a.talksCount:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"talksCount",hash:{},data:d}):e))+"\n"},3:function(a,b,c,d){var e;return"    "+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Filmed",{name:"t",hash:{},data:d}))+"\n    "+this.escapeExpression((b.formatDate||a&&a.formatDate||b.helperMissing).call(a,"MMMM YYYY",null!=a?a.filmed:a,{name:"formatDate",hash:{forceUTC:!0},data:d}))+"\n    "+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"at",{name:"t",hash:{},data:d}))+"\n    "+this.escapeExpression((e=null!=(e=b.event||(null!=a?a.event:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"event",hash:{},data:d}):e))+"\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f;return'<div class="controls__meta__details">\n'+(null!=(e=b.if.call(a,null!=a?a.isPlaylist:a,{name:"if",hash:{},fn:this.program(1,d,0),inverse:this.program(3,d,0),data:d}))?e:"")+'</div>\n<h3 class="controls__meta__title">'+this.escapeExpression((f=null!=(f=b.name||(null!=a?a.name:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"name",hash:{},data:d}):f))+"</h3>\n"},useData:!0});return b.registerPartial("templates/controlsMaxiDetail",c),c}),define("jqueryui/mouse",["jquery"],function(a){return function(a,b){var c=!1;a(document).mouseup(function(){c=!1}),a.widget("ui.mouse",{version:"@VERSION",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(a){return b._mouseDown(a)}).bind("click."+this.widgetName,function(c){if(!0===a.data(c.target,b.widgetName+".preventClickEvent"))return a.removeData(c.target,b.widgetName+".preventClickEvent"),c.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(b){if(!c){this._mouseStarted&&this._mouseUp(b),this._mouseDownEvent=b;var d=this,e=1===b.which,f=!("string"!=typeof this.options.cancel||!b.target.nodeName)&&a(b.target).closest(this.options.cancel).length;return!(e&&!f&&this._mouseCapture(b))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){d.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(b)!==!1,!this._mouseStarted)?(b.preventDefault(),!0):(!0===a.data(b.target,this.widgetName+".preventClickEvent")&&a.removeData(b.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return d._mouseMove(a)},this._mouseUpDelegate=function(a){return d._mouseUp(a)},a(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),b.preventDefault(),c=!0,!0))}},_mouseMove:function(b){return a.ui.ie&&(!document.documentMode||document.documentMode<9)&&!b.button?this._mouseUp(b):this._mouseStarted?(this._mouseDrag(b),b.preventDefault()):(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,b)!==!1,this._mouseStarted?this._mouseDrag(b):this._mouseUp(b)),!this._mouseStarted)},_mouseUp:function(b){return a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,b.target===this._mouseDownEvent.target&&a.data(b.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(b)),!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(a),a}),define("touchPunch",["jquery","jqueryui/mouse"],function(a,b){return function(a){function b(a,b){if(!(a.originalEvent.touches.length>1)){a.preventDefault();var c=a.originalEvent.changedTouches[0],d=document.createEvent("MouseEvents");d.initMouseEvent(b,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null),a.target.dispatchEvent(d)}}if(a.support.touch="ontouchend"in document,a.support.touch){var c,d=a.ui.mouse.prototype,e=d._mouseInit;d._touchStart=function(a){var d=this;!c&&d._mouseCapture(a.originalEvent.changedTouches[0])&&(c=!0,d._touchMoved=!1,b(a,"mouseover"),b(a,"mousemove"),b(a,"mousedown"))},d._touchMove=function(a){c&&(this._touchMoved=!0,b(a,"mousemove"))},d._touchEnd=function(a){c&&(b(a,"mouseup"),b(a,"mouseout"),this._touchMoved||b(a,"click"),c=!1)},d._mouseInit=function(){var b=this;b.element.bind("touchstart",a.proxy(b,"_touchStart")).bind("touchmove",a.proxy(b,"_touchMove")).bind("touchend",a.proxy(b,"_touchEnd")),e.call(b)}}}(a),a}),define("widgets/slider",["jquery","jqueryui/widget","jqueryui/mouse","touchPunch"],function(a){"use strict";return a.widget("ted.slider",a.ui.mouse,{options:{distance:0,orientation:"horizontal",value:0,change:null,slide:null,start:null,stop:null},value:function(a){return arguments.length&&(this.options.value=a,this._refreshValue()),this.options.value},_change:function(a){this._trigger("change",a,this._getData({value:this.value()}))},_create:function(){this._detectOrientation(),this._mouseInit();var b=a("<div class=slider__progress></div>");this.progressElement=b,this.cursorElement=a("<div class=slider__cursor></div>").appendTo(this.progressElement),this.element.addClass("slider slider--"+this.orientation).append(this.progressElement)},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_getData:function(a){return a},_mouseCapture:function(a){var b,c;return this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),b={x:a.pageX,y:a.pageY},c=this._valueFromPosition(b),this._start(a),this._slide(a,c),!0},_mouseDrag:function(a){var b={x:a.pageX,y:a.pageY},c=this._valueFromPosition(b);return this._slide(a,c),!1},_mouseStart:function(){return!0},_mouseStop:function(a){return this._mouseDrag(a),this._stop(a),this._change(a),!1},_refreshValue:function(){var a=this.value();this.progressElement.css("vertical"===this.orientation?"height":"width",100*a+"%")},_slide:function(a,b){this._trigger("slide",a,this._getData({value:b})),this.value(b)},_start:function(a){this.element.addClass("slider--active"),this._trigger("start",a)},_stop:function(a){this.element.removeClass("slider--active"),this._trigger("stop",a)},_valueFromPosition:function(a){var b,c,d;return"vertical"===this.orientation?(d=this.elementSize.height,c=a.y-this.elementOffset.top):(d=this.elementSize.width,c=a.x-this.elementOffset.left),b=c/d,b>1&&(b=1),b<0&&(b=0),"vertical"===this.orientation&&(b=1-b),b}}),function(b,c){return a(b).slider(c)}}),define("widgets/scrubber",["jquery","lib/ga","widgets/slider"],function(a,b){"use strict";var c="scrubber",d=c+"--active",e=c+"--hover",f=c+"__cursor",g=c+"__playhead",h=c+"__progress";return a.widget("ted.scrubber",a.ted.slider,{options:{duration:null,player:null},_isScrubbing:!1,_isSeeking:!1,_progress:0,_create:function(){this.options.player&&this._setPlayer(),this.playheadElement=a("<div class="+g+"></div>").prependTo(this.element),this._super(),this.element.addClass(c),this.cursorElement.addClass(f),this.progressElement.addClass(h),this._on(this._handleEvents)},_getData:function(b){return a.extend({cursor:b.value*this.options.duration,playhead:this._progress*this.options.duration,progress:this._progress,duration:this.options.duration},b)},_handleEvents:{mouseover:function(){this.element.addClass(e)},mouseout:function(){this.element.removeClass(e)},scrubberstart:function(){this.element.addClass(d),this._isScrubbing=!0},scrubberstop:function(){this.element.removeClass(d),this._isScrubbing=!1}},_setOption:function(a,b){this._super(a,b),"duration"===a&&this.progress(this._getData({value:this._progress}).playhead/b)},_setPlayer:function(){var c=this,d=a(this.options.player),e=d.player("talk");this.option("duration",e.duration),this._on({scrubberchange:function(a,c){d.player("seek",c.cursor),b.sendEvent("player","seek","scrubber",Math.round(c.cursor))}}),d.on("playertalk",function(a,b){c.option("duration",b.duration),c.progress(0)}).on("playerduration",function(a,b){c.option("duration",b.duration)}).on("playerseeking",function(){c._isSeeking=!0}).on("playerseeked",function(){c._isSeeking=!1}).on("playerprogress",function(a,b){c.progress(b.progress)})},isSeeking:function(a){return arguments.length&&(this._isSeeking=!!a),this._isScrubbing||this._isSeeking},progress:function(a){if(arguments.length){var b=100*a+"%";this.progressElement&&!this.isSeeking()&&this.progressElement.width(b),this.playheadElement&&this.playheadElement.width(b),this._progress=a,this._trigger("progress",null,this._getData({value:a}))}return this._progress}}),function(b,c){return a(b).scrubber(c)}}),define("jqueryui/position",["jquery"],function(a){return function(a,b){function c(a,b,c){return[parseFloat(a[0])*(n.test(a[0])?b/100:1),parseFloat(a[1])*(n.test(a[1])?c/100:1)]}function d(b,c){return parseInt(a.css(b,c),10)||0}function e(b){var c=b[0];return 9===c.nodeType?{width:b.width(),height:b.height(),offset:{top:0,left:0}}:a.isWindow(c)?{width:b.width(),height:b.height(),offset:{top:b.scrollTop(),left:b.scrollLeft()}}:c.preventDefault?{width:0,height:0,offset:{top:c.pageY,left:c.pageX}}:{width:b.outerWidth(),height:b.outerHeight(),offset:b.offset()}}a.ui=a.ui||{};var f,g=Math.max,h=Math.abs,i=Math.round,j=/left|center|right/,k=/top|center|bottom/,l=/[\+\-]\d+(\.[\d]+)?%?/,m=/^\w+/,n=/%$/,o=a.fn.position;a.position={scrollbarWidth:function(){if(f!==b)return f;var c,d,e=a("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),g=e.children()[0];return a("body").append(e),c=g.offsetWidth,e.css("overflow","scroll"),d=g.offsetWidth,c===d&&(d=e[0].clientWidth),e.remove(),f=c-d},getScrollInfo:function(b){var c=b.isWindow||b.isDocument?"":b.element.css("overflow-x"),d=b.isWindow||b.isDocument?"":b.element.css("overflow-y"),e="scroll"===c||"auto"===c&&b.width<b.element[0].scrollWidth,f="scroll"===d||"auto"===d&&b.height<b.element[0].scrollHeight;return{width:f?a.position.scrollbarWidth():0,height:e?a.position.scrollbarWidth():0}},getWithinInfo:function(b){var c=a(b||window),d=a.isWindow(c[0]),e=!!c[0]&&9===c[0].nodeType;return{element:c,isWindow:d,isDocument:e,offset:c.offset()||{left:0,top:0},scrollLeft:c.scrollLeft(),scrollTop:c.scrollTop(),width:d?c.width():c.outerWidth(),height:d?c.height():c.outerHeight()}}},a.fn.position=function(b){if(!b||!b.of)return o.apply(this,arguments);b=a.extend({},b);var f,n,p,q,r,s,t=a(b.of),u=a.position.getWithinInfo(b.within),v=a.position.getScrollInfo(u),w=(b.collision||"flip").split(" "),x={};return s=e(t),t[0].preventDefault&&(b.at="left top"),n=s.width,p=s.height,q=s.offset,r=a.extend({},q),a.each(["my","at"],function(){var a,c,d=(b[this]||"").split(" ");1===d.length&&(d=j.test(d[0])?d.concat(["center"]):k.test(d[0])?["center"].concat(d):["center","center"]),d[0]=j.test(d[0])?d[0]:"center",d[1]=k.test(d[1])?d[1]:"center",a=l.exec(d[0]),c=l.exec(d[1]),x[this]=[a?a[0]:0,c?c[0]:0],b[this]=[m.exec(d[0])[0],m.exec(d[1])[0]]}),1===w.length&&(w[1]=w[0]),"right"===b.at[0]?r.left+=n:"center"===b.at[0]&&(r.left+=n/2),"bottom"===b.at[1]?r.top+=p:"center"===b.at[1]&&(r.top+=p/2),f=c(x.at,n,p),r.left+=f[0],r.top+=f[1],this.each(function(){var e,j,k=a(this),l=k.outerWidth(),m=k.outerHeight(),o=d(this,"marginLeft"),s=d(this,"marginTop"),y=l+o+d(this,"marginRight")+v.width,z=m+s+d(this,"marginBottom")+v.height,A=a.extend({},r),B=c(x.my,k.outerWidth(),k.outerHeight());"right"===b.my[0]?A.left-=l:"center"===b.my[0]&&(A.left-=l/2),"bottom"===b.my[1]?A.top-=m:"center"===b.my[1]&&(A.top-=m/2),A.left+=B[0],A.top+=B[1],a.support.offsetFractions||(A.left=i(A.left),A.top=i(A.top)),e={marginLeft:o,marginTop:s},a.each(["left","top"],function(c,d){a.ui.position[w[c]]&&a.ui.position[w[c]][d](A,{targetWidth:n,targetHeight:p,elemWidth:l,elemHeight:m,collisionPosition:e,collisionWidth:y,collisionHeight:z,offset:[f[0]+B[0],f[1]+B[1]],my:b.my,at:b.at,within:u,elem:k})}),b.using&&(j=function(a){var c=q.left-A.left,d=c+n-l,e=q.top-A.top,f=e+p-m,i={target:{element:t,left:q.left,top:q.top,width:n,height:p},element:{element:k,left:A.left,top:A.top,width:l,height:m},horizontal:d<0?"left":c>0?"right":"center",vertical:f<0?"top":e>0?"bottom":"middle"};n<l&&h(c+d)<n&&(i.horizontal="center"),p<m&&h(e+f)<p&&(i.vertical="middle"),g(h(c),h(d))>g(h(e),h(f))?i.important="horizontal":i.important="vertical",b.using.call(this,a,i)}),k.offset(a.extend(A,{using:j}))})},a.ui.position={fit:{left:function(a,b){var c,d=b.within,e=d.isWindow?d.scrollLeft:d.offset.left,f=d.width,h=a.left-b.collisionPosition.marginLeft,i=e-h,j=h+b.collisionWidth-f-e;b.collisionWidth>f?i>0&&j<=0?(c=a.left+i+b.collisionWidth-f-e,a.left+=i-c):j>0&&i<=0?a.left=e:i>j?a.left=e+f-b.collisionWidth:a.left=e:i>0?a.left+=i:j>0?a.left-=j:a.left=g(a.left-h,a.left)},top:function(a,b){var c,d=b.within,e=d.isWindow?d.scrollTop:d.offset.top,f=b.within.height,h=a.top-b.collisionPosition.marginTop,i=e-h,j=h+b.collisionHeight-f-e;b.collisionHeight>f?i>0&&j<=0?(c=a.top+i+b.collisionHeight-f-e,a.top+=i-c):j>0&&i<=0?a.top=e:i>j?a.top=e+f-b.collisionHeight:a.top=e:i>0?a.top+=i:j>0?a.top-=j:a.top=g(a.top-h,a.top)}},flip:{left:function(a,b){var c,d,e=b.within,f=e.offset.left+e.scrollLeft,g=e.width,i=e.isWindow?e.scrollLeft:e.offset.left,j=a.left-b.collisionPosition.marginLeft,k=j-i,l=j+b.collisionWidth-g-i,m="left"===b.my[0]?-b.elemWidth:"right"===b.my[0]?b.elemWidth:0,n="left"===b.at[0]?b.targetWidth:"right"===b.at[0]?-b.targetWidth:0,o=-2*b.offset[0];k<0?(c=a.left+m+n+o+b.collisionWidth-g-f,(c<0||c<h(k))&&(a.left+=m+n+o)):l>0&&(d=a.left-b.collisionPosition.marginLeft+m+n+o-i,(d>0||h(d)<l)&&(a.left+=m+n+o))},top:function(a,b){var c,d,e=b.within,f=e.offset.top+e.scrollTop,g=e.height,i=e.isWindow?e.scrollTop:e.offset.top,j=a.top-b.collisionPosition.marginTop,k=j-i,l=j+b.collisionHeight-g-i,m="top"===b.my[1],n=m?-b.elemHeight:"bottom"===b.my[1]?b.elemHeight:0,o="top"===b.at[1]?b.targetHeight:"bottom"===b.at[1]?-b.targetHeight:0,p=-2*b.offset[1];k<0?(d=a.top+n+o+p+b.collisionHeight-g-f,a.top+n+o+p>k&&(d<0||d<h(k))&&(a.top+=n+o+p)):l>0&&(c=a.top-b.collisionPosition.marginTop+n+o+p-i,a.top+n+o+p>l&&(c>0||h(c)<l)&&(a.top+=n+o+p))}},flipfit:{left:function(){a.ui.position.flip.left.apply(this,arguments),a.ui.position.fit.left.apply(this,arguments)},top:function(){a.ui.position.flip.top.apply(this,arguments),a.ui.position.fit.top.apply(this,arguments)}}},function(){var b,c,d,e,f,g=document.getElementsByTagName("body")[0],h=document.createElement("div");b=document.createElement(g?"div":"body"),d={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},g&&a.extend(d,{position:"absolute",left:"-1000px",top:"-1000px"});for(f in d)b.style[f]=d[f];b.appendChild(h),c=g||document.documentElement,c.insertBefore(b,c.firstChild),h.style.cssText="position: absolute; left: 10.7432222px;",e=a(h).offset().left,a.support.offsetFractions=e>10&&e<11,b.innerHTML="",c.removeChild(b)}()}(a),a}),define("widgets/popup",["jquery","lodash","jqueryui/widget","jqueryui/position"],function(a,b){"use strict";function c(a,b){this.element.removeClass(g).css(a).addClass(e+b.horizontal+" "+e+("center"===b.vertical?"middle":b.vertical))}for(var d=300,e="popup--tailed--",f=["center","left","middle","right","bottom","top"],g="",h=f.length;h--;)g+=e+f[h]+" ";return a.widget("ted.popup",{options:{position:{my:"center bottom-20",at:"center top",of:window,collision:"fit flip"},inverse:!1,tail:!0},_create:function(){this.options.position.using||(this.options.position.using=b.bind(c,this)),this.element.addClass("popup"+(this.options.tail?" popup--tailed":"")+(this.options.inverse?" popup--inverse":" inverse"))},_isOpen:!1,open:function(a){var b=this;b._trigger("beforeOpen",a)!==!1&&(b.position(),b._isOpen=!0,b.element.removeClass("popup--hide").addClass("popup--show"),b._trigger("open"))},close:function(a){var b=this,c=b.element;b._trigger("beforeClose",a)!==!1&&(b._isOpen=!1,c.addClass("popup--hide"),setTimeout(function(){b._isOpen||c.removeClass("popup--show")},d),b._trigger("close"))},position:function(){this.element.addClass("popup--positioning").position(this.options.position).removeClass("popup--positioning")}}),function(b,c){return a(b).popup(c)}}),define("widgets/tooltip",["jquery","lodash","jqueryui/widget","widgets/popup"],function(a){"use strict";var b;return a.widget("ted.tooltip",{options:{content:"",interactive:!1,interactiveTolerance:350,position:{},openDelay:0,supportTouch:!0,allowClick:!1},_create:function(){var c;b||(b=a(document.body)),this.element.addClass("tooltip"),this.options.position.of=this.element,this.popupObject=a("<div class=tooltip__popup>").append(this.options.content).popup(this.options).insertAfter(this.element),c=this.element,this.options.interactive&&(c=c.add(this.popupObject)),this._on(c,this._handleEvents),this._on(a("#shoji"),{click:function(b){!this._isOpened||this.options.interactive&&a(b.target).closest(this.popupObject).length||(this._isOpened=!1,this.popupObject.popup("close"))}})},_isHoverClickEnabled:!1,_isFirstTouch:!1,_isTouched:!1,_isMousedOver:!1,_handleEvents:{touchstart:function(){this._isTouched=!0,this._isHoverClickEnabled||(this._isFirstTouch=!0)},mouseover:function(a){var b=this,c=b.options.openDelay||0;!this.options.supportTouch&&this._isTouched||(this._isMousedOver=!0,this._isOpened&&(c=0),clearTimeout(this.timeout),this.timeout=setTimeout(function(){b._isMousedOver&&b.openPopup(a)},c))},mouseout:function(a){var b=this,c=this.options.interactiveTolerance||0;this._isMousedOver=!1,this._isOpened||(c=0),clearTimeout(this.timeout),this.timeout=setTimeout(function(){b._isMousedOver||b.closePopup(a)},c)},click:function(b){a(b.target).closest(this.element).length&&(!this.options.supportTouch&&this._isTouched||(this.openPopup(b),!this._isFirstTouch&&this._isHoverClickEnabled&&this._trigger("hoverclick",b),this._isFirstTouch=!1),this.options.allowClick||(b.preventDefault(),b.stopPropagation()))},popupopen:function(){this._isHoverClickEnabled=!0},popupclose:function(){this._isHoverClickEnabled=!1}},_setOption:function(a,b){"content"===a&&this.popupObject.html(b)},openPopup:function(a){this._isOpened=!0,this.popupObject.popup("open",a)},closePopup:function(a){this.popupObject.popup("close",a),this._off(b,"click"),this._isOpened=!1},popup:function(){return this.popupObject}}),function(b,c){return a(b).tooltip(c)}}),define("widgets/volume",["jquery","widgets/slider","widgets/tooltip"],function(a){"use strict";var b="volume",c=b+"--muted",d=b+"-slider",e=d+"--muted",f=d+"__progress";return a.widget("ted.volume",a.ted.tooltip,{options:{content:"<div class="+d+">",interactive:!0,inverse:!0,interactiveTolerance:1e3,player:null,value:0},sliderElement:null,_create:function(){this._super(),this.element.addClass(b),this.sliderElement=this.popupObject.find("div."+d),this.sliderElement.slider({orientation:"vertical"}),this.options.player&&this._setPlayer(),this._on(this.sliderElement,this._handleSliderEvents),this.sliderElement.find("div.slider__progress").addClass(f)},_handleEvents:{volumehoverclick:function(){this.mute(!this.mute())}},_handleSliderEvents:{sliderchange:function(a,b){this.closePopup(a),this._trigger("change",a,b)},sliderslide:function(a,b){this.openPopup(a),this._trigger("slide",a,b)}},_setPlayer:function(){var b=this,c=a(this.options.player);this._on({volumemute:function(a,b){
c.player("mute",b.mute)},volumechange:function(a,b){c.player("volume",b.value)},volumeslide:function(a,b){c.player("volume",b.value)}}),c.on("playermuted",function(a,c){b.mute(c.muted)}).on("playervolume",function(a,c){b.value(c.volume)}),b.mute(c.player("mute")),b.value(c.player("volume"))},_isMuted:!1,mute:function(a){if(arguments.length){if(a=!!a,a===this._isMuted)return;this._isMuted=a;var b=a?"addClass":"removeClass";this.element[b](c),this.sliderElement[b](e),this._trigger("mute",null,{mute:a})}return this._isMuted},value:function(a){return arguments.length&&this.sliderElement.slider("value",a),this.sliderElement.slider("value")}}),function(b,c){return a(b).volume(c)}}),define("hbs!templates/playerOptions",["hbs","hbs/handlebars"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'\n<div style="margin:-15px 0">\n\n\n  <div class="Player-options__rate" style="display:none;margin:15px 0">\n    <h4 class="h10 m5" style="width:200px">Playback rate:</h4>\n\n    <ul class="sl p4">\n      <li class="Player-options__rate__item">\n        <label>\n          <input class="Player-options__rate__input" type=radio name="'+this.escapeExpression((e=null!=(e=b.id||(null!=a?a.id:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"id",hash:{},data:d}):e))+'-rate" value=1 checked>\n          &nbsp;\n          Normal\n        </label>\n      </li>\n\n      <li class="Player-options__rate__item">\n        <label>\n          <input class="Player-options__rate__input" type=radio name="'+this.escapeExpression((e=null!=(e=b.id||(null!=a?a.id:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"id",hash:{},data:d}):e))+'-rate" value=1.25>\n          &nbsp;\n          1.25x\n          <em>(fast)</em>\n        </label>\n      </li>\n\n      <li class="Player-options__rate__item">\n        <label>\n          <input class="Player-options__rate__input" type=radio name="'+this.escapeExpression((e=null!=(e=b.id||(null!=a?a.id:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"id",hash:{},data:d}):e))+'-rate" value=1.5>\n          &nbsp;\n          1.5x\n          <em>(faster)</em>\n        </label>\n      </li>\n\n      <li class="Player-options__rate__item">\n        <label>\n          <input class="Player-options__rate__input" type=radio name="'+this.escapeExpression((e=null!=(e=b.id||(null!=a?a.id:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"id",hash:{},data:d}):e))+'-rate" value=2>\n          &nbsp;\n          2x\n          <em>(fastest)</em>\n        </label>\n      </li>\n    </ul>\n  </div>\n\n\n  <div class="Player-options__pip" style="display:none;margin:15px 0">\n    <h4 class="h10 m5" style="width:200px">Picture-in-picture mode:</h4>\n\n    <ul class="sl p4">\n      <li class="Player-options__pip__item">\n        <label>\n          <input class="Player-options__pip__input" type=radio name="'+this.escapeExpression((e=null!=(e=b.id||(null!=a?a.id:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"id",hash:{},data:d}):e))+'-pip" value=off checked>\n          &nbsp;\n          Off\n        </label>\n      </li>\n\n      <li class="Player-options__pip__item">\n        <label>\n          <input class="Player-options__pip__input" type=radio name="'+this.escapeExpression((e=null!=(e=b.id||(null!=a?a.id:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"id",hash:{},data:d}):e))+'-pip" value=on>\n          &nbsp;\n          On\n        </label>\n      </li>\n    </ul>\n  </div>\n\n</div>\n'},useData:!0});return b.registerPartial("templates/playerOptions",c),c}),define("widgets/playerOptions",["jquery","hbs!templates/playerOptions","widgets/tooltip"],function(a,b){"use strict";var c=0,d="Player-options";a.widget("ted.playerOptions",a.ted.tooltip,{options:{interactive:!0,inverse:!0,player:null},_create:function(){this.options.content=b({id:"player-options-"+ ++c}),this._super(),this.element.addClass(d),this._on(this.popupObject,{"click input.Player-options__pip__input":function(b){this._trigger("popOut",b,{popOut:"on"===a(b.target).val()})},"click input.Player-options__rate__input":function(b){this._trigger("playbackRate",b,{playbackRate:+a(b.target).val()})}}),this.options.player&&(this._setupRate(),this._setupPip())},_setupRate:function(){var b=this,c=a(b.options.player);c.player("canPlaybackRate")&&(b._on({playeroptionsplaybackrate:function(a,b){c.player("playbackRate",b.playbackRate)}}),c.on("playerplaybackrate",function(a,c){b._setPlaybackRate(c.playbackRate)}),b._setPlaybackRate(c.player("playbackRate")),this.popupObject.find("div.Player-options__rate").show())},_setupPip:function(){var b=this,c=a(b.options.player);c.player("canPopOut")&&(b._on({playeroptionspopout:function(a,b){c.player("popOut",b.popOut)}}),c.on("playerpopout",function(a,c){b._setPopOut(c.popOut)}),b._setPopOut(c.player("popOut")),this.popupObject.find("div.Player-options__pip").show())},_setPlaybackRate:function(a){this.popupObject.find('input.Player-options__rate__input[value="'+a+'"]').prop("checked",!0)},_setPopOut:function(a){this.popupObject.find('input.Player-options__pip__input[value="'+(a?"on":"off")+'"]').prop("checked",!0)}})}),define("hbs!templates/subtitleCredits",["hbs","hbs/handlebars","templates/helpers/t"],function(a,b){var c=b.template({1:function(a,b,c,d){return"    "+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"transcript",{name:"t",hash:{},data:d}))+"\n"},3:function(a,b,c,d){return"    "+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"translation",{name:"t",hash:{},data:d}))+"\n"},5:function(a,b,c,d){var e;return"    "+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"by",{name:"t",hash:{},data:d}))+'\n    <a href="'+this.escapeExpression(this.lambda(null!=(e=null!=a?a.translator:a)?e.uri:e,a))+'" target="_blank">'+this.escapeExpression(this.lambda(null!=(e=null!=a?a.translator:a)?e.name:e,a))+"</a>"+(null!=(e=b.if.call(a,null!=(e=null!=a?a.reviewer:a)?e.name:e,{name:"if",hash:{},fn:this.program(6,d,0),inverse:this.noop,data:d}))?e:"")+"\n"},6:function(a,b,c,d){return","},8:function(a,b,c,d){var e;return"    "+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"reviewed by",{name:"t",hash:{},data:d}))+'\n    <a href="'+this.escapeExpression(this.lambda(null!=(e=null!=a?a.reviewer:a)?e.uri:e,a))+'" target="_blank">'+this.escapeExpression(this.lambda(null!=(e=null!=a?a.reviewer:a)?e.name:e,a))+"</a>.\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return"<div>\n  "+this.escapeExpression(this.lambda(null!=(e=null!=a?a.language:a)?e.name:e,a))+"\n\n"+(null!=(e=b.if.call(a,null!=a?a.isTranscript:a,{name:"if",hash:{},fn:this.program(1,d,0),inverse:this.program(3,d,0),data:d}))?e:"")+"\n"+(null!=(e=b.if.call(a,null!=(e=null!=a?a.translator:a)?e.name:e,{name:"if",hash:{},fn:this.program(5,d,0),inverse:this.noop,data:d}))?e:"")+"\n"+(null!=(e=b.if.call(a,null!=(e=null!=a?a.reviewer:a)?e.name:e,{name:"if",hash:{},fn:this.program(8,d,0),inverse:this.noop,data:d}))?e:"")+'\n  <a class="l3" href="/talks?language='+this.escapeExpression(this.lambda(null!=(e=null!=a?a.language:a)?e.code:e,a))+'" target="_blank">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"More talks in",{name:"t",hash:{},data:d}))+" "+this.escapeExpression(this.lambda(null!=(e=null!=a?a.language:a)?e.name:e,a))+"</a>\n</div>\n"},useData:!0});return b.registerPartial("templates/subtitleCredits",c),c}),define("widgets/subtitleCredits",["jquery","lodash","hbs!templates/subtitleCredits"],function(a,b,c){"use strict";var d="subtitle-credits",e=d+"--visible";return a.widget("ted.subtitleCredits",{options:{activeLanguage:!1,player:null,talkSlug:null},_create:function(){this.element.addClass(d),this.options.player&&this._setPlayer()},_setPlayer:function(){var a=this,b=a.options.player;this._on(a.options.player,{playersubtitle:function(b,c){a.activateLanguage(!!c.subtitle&&c.subtitle.languageCode)},playertalk:function(b,c){a.option("talkSlug",c.slug)}}),a._setOption("talkSlug",b.player("talk").slug);var c=b.player("subtitle");a.activateLanguage(!!c&&c.languageCode)},_setOption:function(a,b){this._super(a,b),"talkSlug"!==a&&"activeLanguage"!==a||this.activateLanguage(this.options.activeLanguage)},activateLanguage:function(c){c&&this.options.talkSlug?(this.options.activeLanguage=c,a.getJSON("/talks/"+this.options.talkSlug+"/caption_credits.json",{language:c}).then(b.bind(this.setSubtitleData,this),b.bind(this.hide,this))):this.hide(),this._trigger("activateLanguage",null,{languageCode:c})},setSubtitleData:function(a){return a.translator&&a.translator.name||a.reviewer&&a.reviewer.name?(a.isTranscript=a.languageCode===this.options.player.player("talk").nativeLanguage,this.element.html(c(a)),void this.show()):this.hide()},hide:function(){this._trigger("hide"),this.element.removeClass(e)},show:function(){this._trigger("show"),this.element.addClass(e)}}),function(b,c){return a(b).subtitleCredits(c)}}),define("widgets/hover",["jquery","lodash","jqueryui/widget"],function(a,b){"use strict";function c(a,b,c){return Math.abs(a[0]-b[0])>c||Math.abs(a[1]-b[1])>c}function d(a){a._hoverIsTouchTriggered=!1}var e=a(document);a.widget("ted.hover",{options:{hoverIdleDelay:4e3,hoverStartDelay:200,hoverStopDelay:400,hoverSwipeTolerance:5},hoverState:function(a){return b.isUndefined(a)||this._hoverChangeState(null,!!a),this._hoverIsOn},_hoverIsClicking:!1,_hoverIsOn:!1,_hoverIsTouchTriggered:!1,_hoverLastCoords:null,_hoverStartTimeout:null,_hoverIdleTimeout:null,_hoverStopTimeout:null,_hoverChangeStateBound:null,_hoverMoveChangeBound:null,_hoverMouseMoveThrottled:null,_hoverTouchOutBound:null,_create:function(){this._hoverInit()},_hoverEvents:function(){return{mouseenter:this._hoverMouseMoveThrottled,mousemove:this._hoverMouseMoveThrottled,mouseleave:this._hoverOut,touchstart:this._hoverTouchStart,touchend:this._hoverTouchEnd,touchmove:this._hoverTouchMove,touchcancel:this._hoverTouchCancel,mousedown:this._hoverMouseDown,mouseup:this._hoverMouseUp,click:this._hoverMouseClick}},_hoverMove:function(a){this._hoverIsOn?this._hoverMoveChange(a):this._hoverStartSetTimeout(a)},_hoverMoveChange:function(a){var b={x:a.pageX||null,y:a.pageY||null};"mousedown"!==a.type&&"touchstart"!==a.type&&this._hoverLastCoords&&b.x&&b.x===this._hoverLastCoords.x&&b.y===this._hoverLastCoords.y||(this._hoverLastCoords=b,this._hoverChangeState(a,!0),this._hoverIdleSetTimeout(a))},_hoverOut:function(a){this._hoverStartClearTimeout(),this._hoverStopSetTimeout(a)},_hoverMouseClick:function(a){this._hoverIsTouchTriggered||this._hoverIsOn&&this._trigger("tap",a)},_hoverMouseDown:function(){this._hoverIsTouchTriggered||(this._hoverIsClicking=!0,this._hoverIdleClearTimeout())},_hoverMouseMove:function(a){this._hoverIsTouchTriggered||this._hoverMove(a)},_hoverMouseUp:function(a){this._hoverIsTouchTriggered||(this._hoverIsClicking=!1,this._hoverIdleSetTimeout(a))},_hoverTouchStart:function(){this._hoverIsTouchTriggered=!0,this._hoverTouchStartCoords=null,this._hoverTouchEndCoords=null},_hoverTouchEnd:function(a){this._hoverTouchSafetyTimeout&&window.clearTimeout(this._hoverTouchSafetyTimeout),this._hoverTouchSafetyTimeout=b.delay(d,600,this),this._hoverTouchEndCoords&&c(this._hoverTouchStartCoords,this._hoverTouchEndCoords,this.options.hoverSwipeTolerance)||(this._hoverIsOn&&this._trigger("tap",a),this._hoverMoveChange(a))},_hoverTouchCancel:function(a){a.preventDefault()},_hoverTouchMove:function(a){var b=a.originalEvent.touches[0],c=[b.pageX,b.pageY];null===this._hoverTouchStartCoords?this._hoverTouchStartCoords=c:this._hoverTouchEndCoords=c,this._hoverIsOn&&this._hoverMove(a)},_hoverTouchOut:function(b){a(b.target).closest(this.element).length||this._hoverChangeState(b,!1)},_hoverChangeState:function(a,b){b=!!b,this._hoverIdleClearTimeout(),this._hoverStartClearTimeout(),this._hoverStopClearTimeout(),!b&&this._hoverIsClicking||b!==this._hoverIsOn&&(this._hoverIsOn=b,this[b?"_hoverStart":"_hoverStop"](a),b?this._on(e,{touchstart:this._hoverTouchOutBound}):this._off(e,"touchstart"))},_hoverStartSetTimeout:function(a){this._hoverStartTimeout||(this._hoverStartTimeout=b.delay(this._hoverMoveChangeBound,this.options.hoverStartDelay,a))},_hoverStartClearTimeout:function(){this._hoverStartTimeout&&(window.clearTimeout(this._hoverStartTimeout),this._hoverStartTimeout=null)},_hoverStopSetTimeout:function(a){this._hoverStopClearTimeout(),this._hoverStopTimeout=b.delay(this._hoverChangeStateBound,this.options.hoverStopDelay,a,!1)},_hoverStopClearTimeout:function(){this._hoverStopTimeout&&(window.clearTimeout(this._hoverStopTimeout),this._hoverStopTimeout=null)},_hoverIdleSetTimeout:function(a){this._hoverIdleClearTimeout(),!this._hoverIsClicking&&this.options.hoverIdleDelay&&(this._hoverIdleTimeout=b.delay(this._hoverChangeStateBound,this.options.hoverIdleDelay,a,!1))},_hoverIdleClearTimeout:function(){this._hoverIdleTimeout&&(window.clearTimeout(this._hoverIdleTimeout),this._hoverIdleTimeout=null)},_hoverInit:function(){this._hoverChangeStateBound=b.bind(this._hoverChangeState,this),this._hoverMoveChangeBound=b.bind(this._hoverMoveChange,this),this._hoverTouchOutBound=b.bind(this._hoverTouchOut,this),this._hoverMouseMoveThrottled=b.throttle(b.bind(this._hoverMouseMove,this),100,{leading:!0,trailing:!1}),this._on(this._hoverEvents())},_hoverDestroy:function(){this._off(this._hoverEvents())},_hoverStart:function(a){this._trigger("start",a)},_hoverStop:function(a){this._trigger("stop",a)}})}),define("widgets/controls",["jquery","lodash","utils/formatDuration","utils/is_mobile","views/subtitle-modal","hbs!templates/controlsMaxi","hbs!templates/controlsMini","hbs!templates/controlsMaxiDetail","widgets/scrubber","widgets/volume","widgets/playerOptions","widgets/subtitleCredits","widgets/hover"],function(a,b,c,d,e,f,g,h){"use strict";function i(a,b){return function(c){a.call(b,c)!==!1&&c.preventDefault()}}function j(a){return a=b.clone(a),a.filmed&&(a.filmed*=1e3),(a.index||0===a.index)&&(a.index+=1),a}var k="controls",l=k+"--fullscreen",m=k+"--with-credits",n=k+"--no-languages",o=k+"--hover",p=k+"--playing",q=k+"--paused",r=k+"--postrolling",s=k+"--unskipable",t=k+"__detail",u={maxi:f,mini:g};return a.widget("ted.controls",a.ted.hover,{options:{hover:!0,hoverStopDelay:3e3,isTranscript:!1,player:null,postrollDuration:null,template:"maxi"},_create:function(){var e=this,f=this.options.template;f=this.options.template=u[f]||f;var g=a(f({options:this.options})).filter("div."+k);this.element.addClass(g.attr("class")).html(g.html());var h={};b.forOwn(this._buttonHandlers,function(a,b){h["click a."+k+"__"+b]=i(a,e)}),this._on(h);var j=this.element.find("span.controls__time--elapsed"),l=this.element.find("span.controls__time--duration");e.scrubber=this.element.find("div.controls__scrubber").scrubber({player:this.options.player,progress:function(a,b){e.scrubber&&!e.scrubber.scrubber("isSeeking")&&j.text(c(b.playhead)),l.text(c(b.duration))},slide:function(a,b){e.scrubber&&e.scrubber.scrubber("isSeeking")&&j.text(c(b.cursor))}}),this.volume=this.element.find("a.controls__volume").volume({player:this.options.player}),this._initSubtitles(),this.credits=this.element.find("div.controls__meta__credits"),this.credits.length&&this.credits.subtitleCredits({player:this.options.player}),this.playerOptions=this.element.find("a.controls__options").playerOptions({player:this.options.player}),this.details=this.element.find("div."+t),this._on(this.credits,{subtitlecreditsshow:function(){e.element.addClass(m)},subtitlecreditshide:function(){e.element.removeClass(m)}}),this.options.player.on("playerplay",b.bind(this._onPlay,this)),this.options.player.on("playerpause",b.bind(this._onPause,this)),this.options.player.on("playercomplete",b.bind(this._onPause,this)),this.options.player.on("playertalk",b.bind(this._onTalk,this)),this.options.player.on("playerenterfullscreen",b.bind(this._onEnterFullScreen,this)),this.options.player.on("playerexitfullscreen",b.bind(this._onExitFullScreen,this)),this.options.player.on("playerpostrollduration",b.bind(this._onTakeoverPostrollDuration,this)),this.options.player.on("playerpostrollremaining",b.bind(this._onPostrollRemaining,this)),this.options.player.on("playerpostrollremaining",b.bind(this._onTakeoverPostrollRemaining,this)),this.options.player.on("playerpostrollcomplete",b.bind(this._onTakeoverPostrollComplete,this)),this._onTalk(),this.options.player.player("canFullScreen")&&this.element.addClass(k+"--can-fullscreen"),(this.options.player.player("canPlaybackRate")||this.options.player.player("canPopOut"))&&this.element.addClass(k+"--can-options"),this.options.player.player("canSubtitle")&&this.element.addClass(k+"--can-subtitle"),d()||this.element.addClass(k+"--can-volume"),this.options.player.on("touchstart",function(a){e._hoverMove(a)}),this.options.hover&&this._hoverInit()},_buttonHandlers:{play:function(){this.options.player.player("play")},pause:function(){this.options.player.player("pause")},fullscreen:function(){this.options.player.player("toggleFullScreen")},skip:function(){this.options.player.player("playNext")}},_hoverStart:function(){this.element.addClass(o)},_hoverStop:function(){this.element.removeClass(o)},_onEnterFullScreen:function(){this.element.addClass(l)},_onExitFullScreen:function(){this.element.removeClass(l)},_onPlay:function(){this.element.addClass(p).removeClass(q)},_onPause:function(){this.element.addClass(q).removeClass(p)},_onTalk:function(){var a=this.options.player.player("talk"),c=this.options.player.player("talks").length,d=a.index>=c-1;this.element[a.languages.length?"removeClass":"addClass"](n),this.details.length&&this.details.html(h(b.extend(j(a),{isPlaylist:c>1,talksCount:c}))),this.element[d?"addClass":"removeClass"](s)},_onTakeoverPostrollPlaying:function(){this.options.postrollDuration>0&&this.options.postrollRemaining>0&&this.element.addClass(r)},_onTakeoverPostrollDuration:function(a,b){this.options.postrollDuration=b.postrollDuration,this._onTakeoverPostrollPlaying()},_onTakeoverPostrollRemaining:function(a,b){this.options.postrollRemaining=b.postrollRemaining,this._onTakeoverPostrollPlaying()},_onTakeoverPostrollComplete:function(){this.options.postrollDuration=0,this.options.postrollRemaining=0,this.$postrollProgress&&this.$postrollProgress.width("100%"),this.element.removeClass(r)},_onPostrollRemaining:function(a,b){this.$postrollProgress||(this.$postrollProgress=this.element.find("div.controls__postbar__progress"),this.$postrollTime=this.element.find("span.controls__adtime__value")),this.$postrollProgress.width(100*(1-b.postrollRemaining/this.options.postrollDuration)+"%"),this.$postrollTime.text(c(b.postrollRemaining))},_initSubtitles:function(){var a=this.element.find("a.controls__subtitles"),b=this.options.player;if(a.length&&b.player("canSubtitle")){var c=new e;this.subtitles=c;var d;b.on({playersubtitle:function(a,b){d=!!(b&&b.subtitle&&b.subtitle.languageCode)&&b.subtitle.languageCode,c.state.set("selected",d)},playertalk:function(a,b){c.state.set("languages",b.languages)}});var f=b.player("subtitle");c.state.set("selected",f&&f.languageCode),c.state.set("languages",b.player("talk").languages),c.render(),c.state.on("change:selected",function(a,e){var f=String(d);e=String(e);var g=e!==f,h=!!e&&g;g&&(b.player("subtitle",e),c.close()),h&&b.player("play")}),a.on("click",function(a){a.preventDefault(),c.open()})}}}),function(b,c){return a(b).controls(c)}}),define("widgets/player/ga-tracker",["lodash","Modernizr","lib/ga"],function(a,b,c){"use strict";function d(a){this._data={currentPlayerTime:null,hasPlayed:!1,hasRequested:!1,lastPlayedTalkId:null,lastChangedTalkId:null,lastLanguageCode:null,marks:null,markableProgress:[25,50,75,95],markableTimes:[10,30],postRolling:!1},this._widget=a,this._resetMarks(),this._addHandlers()}return d.prototype._resetMarks=function(){this._data.marks={times:{},progress:{},ads:{}}},d.prototype._incrementTalkViews=function(){var a=require("Cookies").get("__utma");if(a&&b.localstorage){var d=+a.split(".").pop(),e=window.localStorage,f="talkViews",g=(e.getItem(f)||"").split("|");2===g.length&&+g[0]===d?g[1]=+g[1]+1:g=[d,1],e.setItem(f,g.join("|")),c.set("metric1",g[1])}},d.prototype._onTalkChange=function(){this._data.postRolling=!1,this._resetMarks(),this._incrementTalkViews()},d.prototype._addHandlers=function(){var a=this,b={playererror:function(a,b){var d=b.error,e="abortive"===d.severity;(e||"fatal"===d.severity)&&c.sendEvent("player",e?"error.abort":"error.fatal",d.message)},playerprolongedrebuffer:function(a,b){b.duration&&b.duration%2e3&&c.sendEvent("player.talk","prolongedRebuffer",b.duration)},playerenterfullscreen:function(){c.sendEvent("player","enterFullScreen")},playerexitfullscreen:function(){c.sendEvent("player","exitFullScreen")},playerplay:function(){var b=a._widget.options.currentTalk.id;c.sendEvent("player","start",a._data.hasPlayed?"subsequent":"initial"),a._data.hasPlayed=!0,a._data.lastPlayedTalkId!==b&&(c.sendEvent("player.talk","start",b),a._data.lastPlayedTalkId=b)},playerplaybackrate:function(a,b){c.sendEvent("player","playbackRate",b.playbackRate),c.setDimension("playbackRate",b.playbackRate)},playerplaytoken:function(a,b){c.setDimension("playToken",b.playToken)},playerpause:function(){c.sendEvent("player","pause",Math.round(a._data.currentPlayerTime))},playerpopout:function(a,b){c.sendEvent("player","popOut",b.popOut?"on":"off")},playerready:function(){var b=a._widget.mode();c.sendEvent("player","initialize",b,{nonInteraction:1}),c.setDimension("playerMode",b)},playerrequestnext:function(){c.sendEvent("player","next",a._data.postRolling?"postroll":"talk")},playerrequestplay:function(){c.sendEvent("player","request",a._data.hasRequested?"subsequent":"initial"),a._data.hasRequested=!0},playerprogress:function(b,d){var e=100*d.progress,f=0,g=-1,h=a._data.markableProgress.length;if(!a._widget.player.postrolling)for(;a._data.marks&&++g<h&&f<e;)f=a._data.markableProgress[g],e>=f&&!a._data.marks.progress[f]&&(a._data.currentPlayerTime>a._widget.options.startTrackingAt&&c.sendEvent("player","progressPct",f+"%"),a._data.marks.progress[f]=!0)},playertalkcomplete:function(){a._data.marks&&!a._data.marks.progress[100]&&(c.sendEvent("player","progressPct","100%"),a._data.marks.progress[100]=!0,c.sendEvent("player.talk","complete",a._widget.options.currentTalk.id))},playercurrenttime:function(b,d){var e=d.currentTime,f=0,g=-1,h=a._data.markableTimes.length;if(a._data.currentPlayerTime=e,!a._widget.player.postrolling)for(;a._data.marks&&++g<h&&f<e;)f=a._data.markableTimes[g],e>=f&&!a._data.marks.times[f]&&(f>a._widget.options.startTrackingAt&&c.sendEvent("player","progressTime",f+" seconds"),a._data.marks.times[f]=!0)},playerprerollstart:function(){a._data.marks&&!a._data.marks.ads.prerollStart&&(c.sendEvent("player.preRoll","cardStart"),a._data.marks.ads.prerollStart=!0)},playerprerollblock:function(){a._data.marks&&!a._data.marks.ads.prerollBlock&&(c.sendEvent("player.preRoll","cardBlock"),a._data.marks.ads.prerollBlock=!0)},playerpostrollstart:function(){a._data.postRolling=!0,a._data.marks&&!a._data.marks.ads.postrollStart&&(c.sendEvent("player.postRoll","adStart"),a._data.marks.ads.postrollStart=!0)},playerpostrollcomplete:function(){a._data.postRolling=!1,a._data.marks&&!a._data.marks.ads.postrollComplete&&(c.sendEvent("player.postRoll","adComplete"),a._data.marks.ads.postrollStart=!0)},playeradblock:function(){c.sendEvent("player","adBlock")},playersubtitle:function(b,d){var e=String(d.subtitle&&d.subtitle.languageCode);e!==a._data.lastLanguageCode&&(e?c.sendEvent("player.subtitle","setLanguage",e):c.sendEvent("player.subtitle","disable")),a._data.lastLanguageCode=e},playertalk:function(b,c){var d=c.id;a._data.lastChangedTalkId!==d&&(a._onTalkChange(),a._data.lastChangedTalkId=d)}};this._handlers=b,this._widget._on(b)},d}),define("widgets/player/ted-tracker",["jquery","lodash","lib/currentUserId","utils/ted"],function(a,b,c,d){"use strict";function e(a){var b=d("zone")||{};this._data={lastMetaTalkId:null,lastPlayTalkId:null,vmAPIKey:b.api_key||"unknown"},this._widget=a,this._addHandlers()}return e.prototype._sendVM=function(c){var d=b.extend({},c,{share_token:this._widget.options.shareToken});a.post("/talks/"+this._widget.talk().id+"/views",{view:d},null,"json")},e.prototype._recordViewID=function(){this._widget.options.recordInIdentity&&c.get()&&a.post("/talks/"+this._widget.talk().id+"/user_views",{},null,"json")},e.prototype._recordViewVM=function(){var a=this._widget.mode();if("hls"===a&&this._sendVM({apikey:this._data.vmAPIKey,format:"hls",quality:"variant",service:"ted_player_html5_hls"}),"hlsjs"===a&&this._sendVM({apikey:this._data.vmAPIKey,format:"hls",quality:"variant",service:"ted_player_html5_hlsjs"}),"flash"===a&&this._sendVM({apikey:this._data.vmAPIKey,format:"hls",quality:"variant",service:"ted_player_flash_hls"}),"h264"===a){var b=this._widget.options.currentTalk.resources.h264[0].bitrate;this._sendVM({apikey:this._data.vmAPIKey,format:"mp4",quality:b?b+"k":"variant",service:"ted_player_html5_mp4"})}},e.prototype._onTalkPlay=function(){this._recordViewID(),this._recordViewVM()},e.prototype._addHandlers=function(){var a=this,b={playerrequestplay:function(){a._widget._ytPlayer&&a._widget._ytPlayer.playVideo&&a._sendVM({apikey:"botw",service:"botw"})},playerplay:function(){var b=a._widget.options.currentTalk.id;a._data.lastPlayTalkId!==b&&(a._onTalkPlay(),a._data.lastPlayTalkId=b)}};this._handlers=b,this._widget._on(b)},e});var ns_=window.ns_=window.ns_||{};ns_.StreamSense=ns_.StreamSense||function(){function a(a,b){var d=a||"",e="undefined",f=k.comScore||k.sitestat||function(a){var b,d,f,g,h,j="comScore=",m=l.cookie,n="",o="indexOf",p="substring",r="length",s=c.browserAcceptsLargeURLs()?q.URL_LENGTH_LIMIT:q.RESTRICTED_URL_LENGTH_LIMIT,t="&ns_",u="&",v=k.encodeURIComponent||escape;if(m[o](j)+1)for(g=0,f=m.split(";"),h=f[r];g<h;g++)d=f[g][o](j),d+1&&(n=u+unescape(f[g][p](d+j[r])));a+=t+"_t="+ +new Date+t+"c="+(l.characterSet||l.defaultCharset||"")+n,a.length>s&&a.indexOf(u)>0&&(b=a.substr(0,s-8).lastIndexOf(u),a=(a.substring(0,b)+t+"cut="+v(a.substring(b+1))).substr(0,s)),i.httpGet(a),typeof ns_p===e&&(ns_p={src:a}),ns_p.lastMeasurement=a};if(typeof b!==e){var g=[],h=k.encodeURIComponent||escape;for(var j in b)b.hasOwnProperty(j)&&g.push(h(j)+"="+h(b[j]));/[\?\&]$/.test(d)||(d+="&"),d+=g.join("&")}return f(d)}function b(a,b){for(var d,e=k.encodeURIComponent||escape,f=[],g=q.LABELS_ORDER,h=a.split("?"),i=h[0],j=h[1],m=j.split("&"),n=0,o=m.length;n<o;n++){var p=m[n].split("="),r=unescape(p[0]),s=unescape(p[1]);r&&(b[r]=s)}for(var t={},n=0,o=g.length;n<o;n++){var u=g[n];if(b.hasOwnProperty(u)){var v=b[u];"undefined"!=typeof v&&null!=v&&(t[u]=!0,f.push(e(u)+"="+e(b[u])))}}for(var u in b)if(!t[u]&&b.hasOwnProperty(u)){var v=b[u];"undefined"!=typeof v&&null!=v&&f.push(e(u)+"="+e(b[u]))}d=i+"?"+f.join("&"),d=d+(d.indexOf("&c8=")<0?"&c8="+e(l.title):"")+(d.indexOf("&c7=")<0?"&c7="+e(l.URL):"")+(d.indexOf("&c9=")<0?"&c9="+e(l.referrer):"");var w=c.browserAcceptsLargeURLs()?q.URL_LENGTH_LIMIT:q.RESTRICTED_URL_LENGTH_LIMIT;if(d.length>w&&d.indexOf("&")>0){var x=d.substr(0,w-8).lastIndexOf("&");d=(d.substring(0,x)+"&ns_cut="+e(d.substring(x+1))).substr(0,w)}return d}var c=function(){var a={uid:function(){var a=1;return function(){return+new Date+"_"+a++}}(),filter:function(a,b){var c={};for(var d in b)b.hasOwnProperty(d)&&a(b[d])&&(c[d]=b[d]);return c},extend:function(a){var b,c=arguments.length;a=a||{};for(var d=1;d<c;d++)if(b=arguments[d])for(var e in b)b.hasOwnProperty(e)&&(a[e]=b[e]);return a},getString:function(a,b){var c=String(a);return null==a?b||"na":c},getLong:function(a,b){var c=Number(a);return null==a||isNaN(c)?b||0:c},getInteger:function(a,b){var c=Number(a);return null==a||isNaN(c)?b||0:c},getBoolean:function(a,b){var c="true"==String(a).toLowerCase();return null==a?b||!1:c},isNotEmpty:function(a){return"undefined"!=typeof a&&null!=a&&"undefined"!=typeof a.length&&a.length>0},indexOf:function(b,c){var d=-1;return a.forEach(c,function(a,c){a==b&&(d=c)}),d},forEach:function(a,b,c){try{if("function"==typeof b)if(c="undefined"!=typeof c?c:null,"number"!=typeof a.length||"undefined"==typeof a[0]){var d="undefined"!=typeof a.__proto__;for(var e in a)(!d||d&&"undefined"==typeof a.__proto__[e])&&"function"!=typeof a[e]&&b.call(c,a[e],e)}else for(var e=0,f=a.length;e<f;e++)b.call(c,a[e],e)}catch(a){}},regionMatches:function(a,b,c,d,e){if(b<0||d<0||b+e>a.length||d+e>c.length)return!1;for(;--e>=0;){var f=a.charAt(b++),g=c.charAt(d++);if(f!=g)return!1}return!0},size:function(a){var b,c=0;for(var b in a)a.hasOwnProperty(b)&&c++;return c},log:function(a,b){if("undefined"!=typeof b&&b){var c=new Date,d=c.getHours()+":"+c.getMinutes()+":"+c.getSeconds();console.log(d,a)}},isTrue:function(a){return"undefined"!=typeof a&&("string"==typeof a?(a=a.toLowerCase(),"true"===a||"1"===a||"on"===a):!!a)},toString:function(b){if("undefined"==typeof b)return"undefined";if("string"==typeof b)return b;if("[object Array]"===Object.prototype.toString.call(b))return b.join(",");if(a.size(b)>0){var c="";for(var d in b)b.hasOwnProperty(d)&&(c+=d+":"+b[d]+";");return c}return b.toString()},exists:function(a){return"undefined"!=typeof a&&null!=a},firstGreaterThan0:function(){for(var a=0,b=arguments.length;a<b;a++){var c=arguments[a];if(c>0)return c}return 0},cloneObject:function(a){if(null==a||"object"!=typeof a)return a;var b=a.constructor();for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},safeGet:function(b,c){return c=a.exists(c)?c:"",a.exists(b)?b:c},getBrowserName:function(){var a,b,c=navigator.userAgent,d=navigator.appName;return(b=c.indexOf("Opera"))!=-1||(b=c.indexOf("OPR/"))!=-1?d="Opera":(b=c.indexOf("Android"))!=-1?d="Android":(b=c.indexOf("Chrome"))!=-1?d="Chrome":(b=c.indexOf("Safari"))!=-1?d="Safari":(b=c.indexOf("Firefox"))!=-1?d="Firefox":(b=c.indexOf("IEMobile"))!=-1?d="Internet Explorer Mobile":"Microsoft Internet Explorer"==d||"Netscape"==d?d="Internet Explorer":(a=c.lastIndexOf(" ")+1)<(b=c.lastIndexOf("/"))&&(d=c.substring(a,b),d.toLowerCase()==d.toUpperCase()&&(d=navigator.appName)),d},getBrowserFullVersion:function(){var a,b,c,d,e,f=navigator.userAgent,g=navigator.appName,h=""+parseFloat(navigator.appVersion);return(c=f.indexOf("Opera"))!=-1?(h=f.substring(c+6),(c=f.indexOf("Version"))!=-1&&(h=f.substring(c+8))):(c=f.indexOf("OPR/"))!=-1?h=f.substring(c+4):(c=f.indexOf("Android"))!=-1?h=f.substring(c+11):(c=f.indexOf("Chrome"))!=-1?h=f.substring(c+7):(c=f.indexOf("Safari"))!=-1?(h=f.substring(c+7),(c=f.indexOf("Version"))!=-1&&(h=f.substring(c+8))):(c=f.indexOf("Firefox"))!=-1?h=f.substring(c+8):"Microsoft Internet Explorer"==g?(e=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),null!=e.exec(f)&&(h=parseFloat(RegExp.$1))):"Netscape"==g?(e=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),null!=e.exec(f)&&(h=parseFloat(RegExp.$1))):(b=f.lastIndexOf(" ")+1)<(c=f.lastIndexOf("/"))&&(h=f.substring(c+1)),h=h.toString(),(d=h.indexOf(";"))!=-1&&(h=h.substring(0,d)),(d=h.indexOf(" "))!=-1&&(h=h.substring(0,d)),(d=h.indexOf(")"))!=-1&&(h=h.substring(0,d)),a=parseInt(""+h,10),isNaN(a)&&(h=""+parseFloat(navigator.appVersion)),h},browserAcceptsLargeURLs:function(){return null===window.ActiveXObject||!0}};return a}(),d=function(){var a="cs_",b=function(){var b="undefined"!=typeof localStorage?localStorage:{};c.extend(this,{get:function(c){return b[a+c]},set:function(c,d){b[a+c]=d},has:function(c){return a+c in b},remove:function(c){delete b[a+c]},clear:function(){for(var a in b)b.hasOwnProperty(a)&&delete b[a]}})};return b}(),e=function(a,b){var c=new Image;c.onload=function(){b&&b(200)},c.onerror=function(){b&&b()},c.src=a},f=function(a,b,c){c&&setTimeout(c,0)},g=function(){return{dir:function(a){return null},append:function(a,b,c){},write:function(a,b,c){},deleteFile:function(a,b){return!1},read:function(a,b){return null}}}(),h=function(a,b){"undefined"!=typeof engine&&b&&setTimeout(b,0);var c=engine.createHttpClient(),d=c.createRequest("GET",a,null);d.start(),b&&setTimeout(b,0);
},i=function(){var a={PLATFORM:"generic",httpGet:e,httpPost:f,Storage:d,IO:g,getCrossPublisherId:function(){return null},getAppName:function(){return Constants.UNKNOWN_VALUE},getAppVersion:function(a){return Constants.UNKNOWN_VALUE},getVisitorId:function(){return this.getDeviceName()+ +new Date+~~(1e3*Math.random())},getVisitorIdSuffix:function(){return"72"},getDeviceName:function(){return""},getPlatformVersion:function(){return""},getPlatformName:function(){return"js"},getRuntimeName:function(){return""},getRuntimeVersion:function(){return""},getResolution:function(){return""},getLanguage:function(){return""},getPackageName:function(){return""},isConnectionAvailable:function(){return!0},isCompatible:function(){return!0},autoSelect:function(){},isCrossPublisherIdChanged:function(){return!1}};return a}(),j=function(){function a(){return"undefined"!=typeof engine&&"undefined"!=typeof engine.stats}function b(){return c.isNotEmpty(engine.stats.device.id)?engine.stats.device.id:c.isNotEmpty(engine.stats.network.mac)?engine.stats.network.mac:null}function e(){if(null==i){var a=b();null!=a?(i=a,j="31",k=a):(i=+new Date+~~(1e3*Math.random()),j="72",k=null)}}var i=null,j=null,k=null;return{PLATFORM:"trilithium",httpGet:h,httpPost:f,Storage:d,IO:g,getCrossPublisherId:function(){return e(),k},getAppName:function(){return c.isNotEmpty(engine.stats.application.name)?engine.stats.application.name:Constants.UNKNOWN_VALUE},getAppVersion:function(a){return c.isNotEmpty(engine.stats.application.version)?engine.stats.application.version:Constants.UNKNOWN_VALUE},getVisitorId:function(){return e(),i},getVisitorIdSuffix:function(){return j},getDeviceName:function(){return c.safeGet(engine.stats.device.platform,"")},getPlatformVersion:function(){return c.safeGet(engine.stats.device.version,"")},getPlatformName:function(){return"js"},getRuntimeName:function(){return"trilithium"},getRuntimeVersion:function(){return""},getResolution:function(){return"undefined"!=typeof screen&&"undefined"!=typeof screen.height&&"undefined"!=typeof screen.width?screen.height+"x"+screen.width:""},getLanguage:function(){return""},getPackageName:function(){return""},isConnectionAvailable:function(){return!0},isCompatible:a}}();i.autoSelect=function(){j.isCompatible()&&c.extend(i,j)};var k,l,m="undefined"!=typeof window&&"undefined"!=typeof document;m?(k=window,l=document):(k={},l={location:{href:""},title:"",URL:"",referrer:"",cookie:""});var c=c||{};c.filterMap=function(a,b){for(var d in a)c.indexOf(d,b)==-1&&delete a[d]},c.getKeys=function(a,b){var c,d=[];for(c in a)(!b||b.test(c))&&a.hasOwnProperty(c)&&(d[d.length]=c);return d};var n=function(){var a=["play","pause","end","buffer","keep-alive","hb","custom","ad_play","ad_pause","ad_end","ad_click"];return{PLAY:0,PAUSE:1,END:2,BUFFER:3,KEEP_ALIVE:4,HEART_BEAT:5,CUSTOM:6,AD_PLAY:7,AD_PAUSE:8,AD_END:9,AD_CLICK:10,toString:function(b){return a[b]}}}(),o=function(){var a=[n.END,n.PLAY,n.PAUSE,n.BUFFER];return{IDLE:0,PLAYING:1,PAUSED:2,BUFFERING:3,toEventType:function(b){return a[b]}}}(),p={ADPLAY:n.AD_PLAY,ADPAUSE:n.AD_PAUSE,ADEND:n.AD_END,ADCLICK:n.AD_CLICK},q={STREAMSENSE_VERSION:"4.1412.05",DEFAULT_PLAYERNAME:"streamsense",DEFAULT_HEARTBEAT_INTERVAL:[{playingtime:6e4,interval:1e4},{playingtime:null,interval:6e4}],DEFAULT_KEEP_ALIVE_INTERVAL:12e5,DEFAULT_PAUSED_ON_BUFFERING_INTERVAL:500,C1_VALUE:"19",C10_VALUE:"js",NS_AP_C12M_VALUE:"1",NS_NC_VALUE:"1",PAGE_NAME_LABEL:"name",RESTRICTED_URL_LENGTH_LIMIT:2048,URL_LENGTH_LIMIT:4096,LABELS_ORDER:["c1","c2","ca2","cb2","cc2","cd2","ns_site","ca_ns_site","cb_ns_site","cc_ns_site","cd_ns_site","ns_vsite","ca_ns_vsite","cb_ns_vsite","cc_ns_vsite","cd_ns_vsite","ns_ap_an","ca_ns_ap_an","cb_ns_ap_an","cc_ns_ap_an","cd_ns_ap_an","ns_ap_pn","ns_ap_pv","c12","ca12","cb12","cc12","cd12","ns_ak","ns_ns_ap_hw","name","ns_ap_ni","ns_ap_ec","ns_ap_ev","ns_ap_device","ns_ap_id","ns_ap_csf","ns_ap_bi","ns_ap_pfm","ns_ap_pfv","ns_ap_ver","ca_ns_ap_ver","cb_ns_ap_ver","cc_ns_ap_ver","cd_ns_ap_ver","ns_ap_sv","ns_ap_cv","ns_type","ca_ns_type","cb_ns_type","cc_ns_type","cd_ns_type","ns_radio","ns_nc","ns_ap_ui","ca_ns_ap_ui","cb_ns_ap_ui","cc_ns_ap_ui","cd_ns_ap_ui","ns_ap_gs","ns_st_sv","ns_st_pv","ns_st_it","ns_st_id","ns_st_ec","ns_st_sp","ns_st_sq","ns_st_cn","ns_st_ev","ns_st_po","ns_st_cl","ns_st_el","ns_st_pb","ns_st_hc","ns_st_mp","ca_ns_st_mp","cb_ns_st_mp","cc_ns_st_mp","cd_ns_st_mp","ns_st_mv","ca_ns_st_mv","cb_ns_st_mv","cc_ns_st_mv","cd_ns_st_mv","ns_st_pn","ns_st_tp","ns_st_pt","ns_st_pa","ns_st_ad","ns_st_li","ns_st_ci","ns_ap_jb","ns_ap_res","ns_ap_c12m","ns_ap_install","ns_ap_updated","ns_ap_lastrun","ns_ap_cs","ns_ap_runs","ns_ap_usage","ns_ap_fg","ns_ap_ft","ns_ap_dft","ns_ap_bt","ns_ap_dbt","ns_ap_dit","ns_ap_as","ns_ap_das","ns_ap_it","ns_ap_uc","ns_ap_aus","ns_ap_daus","ns_ap_us","ns_ap_dus","ns_ap_ut","ns_ap_oc","ns_ap_uxc","ns_ap_uxs","ns_ap_lang","ns_ap_ar","ns_ap_miss","ns_ts","ns_st_ca","ns_st_cp","ns_st_er","ca_ns_st_er","cb_ns_st_er","cc_ns_st_er","cd_ns_st_er","ns_st_pe","ns_st_ui","ca_ns_st_ui","cb_ns_st_ui","cc_ns_st_ui","cd_ns_st_ui","ns_st_bc","ns_st_bt","ns_st_bp","ns_st_pc","ns_st_pp","ns_st_br","ns_st_ub","ns_st_vo","ns_st_ws","ns_st_pl","ns_st_pr","ns_st_ep","ns_st_ty","ns_st_ct","ns_st_cs","ns_st_ge","ns_st_st","ns_st_dt","ns_st_de","ns_st_pu","ns_st_cu","ns_st_fee","ns_ap_i1","ns_ap_i2","ns_ap_i3","ns_ap_i4","ns_ap_i5","ns_ap_i6","c3","ca3","cb3","cc3","cd3","c4","ca4","cb4","cc4","cd4","c5","ca5","cb5","cc5","cd5","c6","ca6","cb6","cc6","cd6","c10","c11","c13","c14","c15","c16","c7","c8","c9"]},r=function(){var a=function(){function a(a,b){var c=b[a];null!=c&&(d[a]=c)}var b,d,e=this,f=0,g=0,h=0,i=0,j=0,k=0;c.extend(this,{reset:function(a){null!=a&&a.length>0?c.filterMap(d,a):d={},d.hasOwnProperty("ns_st_cl")||(d.ns_st_cl="0"),d.hasOwnProperty("ns_st_pn")||(d.ns_st_pn="1"),d.hasOwnProperty("ns_st_tp")||(d.ns_st_tp="1"),e.setPauses(0),e.setStarts(0),e.setBufferingTime(0),e.setBufferingTimestamp(-1),e.setPlaybackTime(0),e.setPlaybackTimestamp(-1)},setLabels:function(a,b){null!=a&&c.extend(d,a),e.setRegisters(d,b)},getLabels:function(){return d},setLabel:function(a,b){var c={};c[a]=b,e.setLabels(c,null)},getLabel:function(a){return d[a]},getClipId:function(){return("undefined"==typeof b||null==b)&&e.setClipId("1"),b},setClipId:function(a){b=a},setRegisters:function(b,c){var d=b.ns_st_cn;null!=d&&(e.setClipId(d),delete b.ns_st_cn),d=b.ns_st_bt,null!=d&&(h=Number(d),delete b.ns_st_bt),a("ns_st_cl",b),a("ns_st_pn",b),a("ns_st_tp",b),a("ns_st_ub",b),a("ns_st_br",b),c!=o.PLAYING&&null!=c||(d=b.ns_st_sq,null!=d&&(g=Number(d),delete b.ns_st_sq)),c!=o.BUFFERING&&(d=b.ns_st_pt,null!=d&&(j=Number(d),delete b.ns_st_pt)),c!=o.PAUSED&&c!=o.IDLE&&null!=c||(d=b.ns_st_pc,null!=d&&(f=Number(d),delete b.ns_st_pc))},createLabels:function(a,b){var d=b||{};return d.ns_st_cn=e.getClipId(),d.ns_st_bt=String(e.getBufferingTime()),a!=n.PLAY&&null!=a||(d.ns_st_sq=String(g)),a!=n.PAUSE&&a!=n.END&&a!=n.KEEP_ALIVE&&a!=n.HEART_BEAT&&null!=a||(d.ns_st_pt=String(e.getPlaybackTime()),d.ns_st_pc=String(f)),c.extend(d,e.getLabels()),d},incrementPauses:function(){f++},incrementStarts:function(){g++},getBufferingTime:function(){var a=h;return i>=0&&(a+=+new Date-i),a},setBufferingTime:function(a){h=a},getPlaybackTime:function(){var a=j;return k>=0&&(a+=+new Date-k),a},setPlaybackTime:function(a){j=a},getPlaybackTimestamp:function(){return k},setPlaybackTimestamp:function(a){k=a},getBufferingTimestamp:function(){return i},setBufferingTimestamp:function(a){i=a},getPauses:function(){return f},setPauses:function(a){f=a},getStarts:function(){return g},setStarts:function(a){g=a}}),d={},e.reset()};return a}(),s=function(){var a=function(){var a,b,d=this,e=null,f=0,g=0,h=0,i=0,j=0,k=0,l=!1;c.extend(this,{reset:function(a){null!=a&&a.length>0?c.filterMap(b,a):b={},d.setPlaylistId(+new Date+"_"+k),d.setBufferingTime(0),d.setPlaybackTime(0),d.setPauses(0),d.setStarts(0),d.setRebufferCount(0),l=!1},setLabels:function(a,e){null!=a&&c.extend(b,a),d.setRegisters(b,e)},getLabels:function(){return b},setLabel:function(a,b){var c={};c[a]=b,d.setLabels(c,null)},getLabel:function(a){return b[a]},getClip:function(){return e},getPlaylistId:function(){return a},setPlaylistId:function(b){a=b},setRegisters:function(b,c){var d=b.ns_st_sp;null!=d&&(f=Number(d),delete b.ns_st_sp),d=b.ns_st_bc,null!=d&&(h=Number(d),delete b.ns_st_bc),d=b.ns_st_bp,null!=d&&(i=Number(d),delete b.ns_st_bp),d=b.ns_st_id,null!=d&&(a=d,delete b.ns_st_id),c!=o.BUFFERING&&(d=b.ns_st_pa,null!=d&&(j=Number(d),delete b.ns_st_pa)),c!=o.PAUSED&&c!=o.IDLE&&null!=c||(d=b.ns_st_pp,null!=d&&(g=Number(d),delete b.ns_st_pp))},createLabels:function(b,e){var i=e||{};return i.ns_st_bp=String(d.getBufferingTime()),i.ns_st_sp=String(f),i.ns_st_id=String(a),h>0&&(i.ns_st_bc=String(h)),b!=n.PAUSE&&b!=n.END&&b!=n.KEEP_ALIVE&&b!=n.HEART_BEAT&&null!=b||(i.ns_st_pa=String(d.getPlaybackTime()),i.ns_st_pp=String(g)),b!=n.PLAY&&null!=b||d.didFirstPlayOccurred()||(i.ns_st_pb="1",d.setFirstPlayOccurred(!0)),c.extend(i,d.getLabels()),i},incrementStarts:function(){f++},incrementPauses:function(){g++,e.incrementPauses()},setPlaylistCounter:function(a){k=a},incrementPlaylistCounter:function(){k++},addPlaybackTime:function(a){if(e.getPlaybackTimestamp()>=0){var b=a-e.getPlaybackTimestamp();e.setPlaybackTimestamp(-1),e.setPlaybackTime(e.getPlaybackTime()+b),d.setPlaybackTime(d.getPlaybackTime()+b)}},addBufferingTime:function(a){if(e.getBufferingTimestamp()>=0){var b=a-e.getBufferingTimestamp();e.setBufferingTimestamp(-1),e.setBufferingTime(e.getBufferingTime()+b),d.setBufferingTime(d.getBufferingTime()+b)}},getBufferingTime:function(){var a=i;return e.getBufferingTimestamp()>=0&&(a+=+new Date-e.getBufferingTimestamp()),a},setBufferingTime:function(a){i=a},getPlaybackTime:function(){var a=j;return e.getPlaybackTimestamp()>=0&&(a+=+new Date-e.getPlaybackTimestamp()),a},setPlaybackTime:function(a){j=a},getStarts:function(){return f},setStarts:function(a){f=a},getPauses:function(){return g},setPauses:function(a){g=a},getRebufferCount:function(){return h},incrementRebufferCount:function(){h++},setRebufferCount:function(a){h=a},didFirstPlayOccurred:function(){return l},setFirstPlayOccurred:function(a){l=a}}),e=new r,b={},d.reset()};return a}(),t=function(){var d=function(d,e){function f(a){var b=0;if(null!=ma)for(var c=0;c<ma.length;c++){var d=ma[c],e=d.playingtime;if(!e||a<e){b=d.interval;break}}return b}function g(){l();var a=f(ja.getClip().getPlaybackTime());if(a>0){var b=pa>0?pa:a;Z=setTimeout(k,b)}pa=0}function h(){l();var a=f(ja.getClip().getPlaybackTime());pa=a-ja.getClip().getPlaybackTime()%a,null!=Z&&l()}function j(){pa=0,ra=0,qa=0}function k(){qa++;var a=N(n.HEART_BEAT,null);B(a),pa=0,g()}function l(){null!=Z&&(clearTimeout(Z),Z=null)}function m(){r(),Y=setTimeout(p,na)}function p(){var a=N(n.KEEP_ALIVE,null);B(a),ia++,m()}function r(){null!=Y&&(clearTimeout(Y),Y=null)}function t(){v(),da.isPauseOnBufferingEnabled()&&G(o.PAUSED)&&(X=setTimeout(u,oa))}function u(){if($==o.PLAYING){ja.incrementRebufferCount(),ja.incrementPauses();var a=N(n.PAUSE,null);B(a),ia++,$=o.PAUSED}}function v(){null!=X&&(clearTimeout(X),X=null)}function w(a){return a==o.PLAYING||a==o.PAUSED}function x(){T&&(clearTimeout(T),T=null)}function y(a){return a==n.PLAY?o.PLAYING:a==n.PAUSE?o.PAUSED:a==n.BUFFER?o.BUFFERING:a==n.END?o.IDLE:null}function z(a,b,d){if(x(),d)T=setTimeout(function(a,b){return function(){z(a,b)}}(a,b),d);else if(J(a)){var e=L(),f=ga,g=I(b),h=f>=0?g-f:0;E(L(),b),F(a,b),M(L()),K(a);for(var i=0,j=ca.length;i<j;i++)ca[i](e,a,b,h);A(b),ja.setRegisters(b,a),ja.getClip().setRegisters(b,a);var k=N(o.toEventType(a),b);c.extend(k,b),G(V)&&(B(k),$=V,ia++)}}function A(a){var b=a.ns_st_mp;null!=b&&(_=b,delete a.ns_st_mp),b=a.ns_st_mv,null!=b&&(aa=b,delete a.ns_st_mv),b=a.ns_st_ec,null!=b&&(ia=Number(b),delete a.ns_st_ec)}function B(a,c){void 0===c&&(c=!0),c&&D(a);var d=da.getPixelURL();if(W){if(!C()){var e=ta.am,f=ta.et,g=e.newApplicationMeasurement(W,f.HIDDEN,a,d);W.getQueue().offer(g)}}else d&&i.httpGet(b(d,a))}function C(){var a=W.getAppContext(),b=W.getSalt(),c=W.getPixelURL();return null==a||null==b||0==b.length||null==c||0==c.length}function D(a){ba=N(null),c.extend(ba,a)}function E(a,b){var d=I(b);if(a==o.PLAYING)ja.addPlaybackTime(d),h(),r();else if(a==o.BUFFERING)ja.addBufferingTime(d),v();else if(a==o.IDLE){var e=c.getKeys(ja.getClip().getLabels());ja.getClip().reset(e)}}function F(a,b){var c=I(b),d=H(b);ha=d,a==o.PLAYING?(g(),m(),ja.getClip().setPlaybackTimestamp(c),G(a)&&(ja.getClip().incrementStarts(),ja.getStarts()<1&&ja.setStarts(1))):a==o.PAUSED?G(a)&&ja.incrementPauses():a==o.BUFFERING?(ja.getClip().setBufferingTimestamp(c),la&&t()):a==o.IDLE&&j()}function G(a){return(a!=o.PAUSED&&a!=o.IDLE||$!=o.IDLE&&null!=$)&&(a!=o.BUFFERING&&$!=a)}function H(a){var b=-1;return a.hasOwnProperty("ns_st_po")&&(b=c.getInteger(a.ns_st_po)),b}function I(a){var b=-1;return a.hasOwnProperty("ns_ts")&&(b=Number(a.ns_ts)),b}function J(a){return null!=a&&L()!=a}function K(a){V=a,ga=+new Date}function L(){return V}function M(a){U=a}function N(){var a,b;1==arguments.length?(a=o.toEventType(V),b=arguments[0]):(a=arguments[0],b=arguments[1]);var d={};if("undefined"!=typeof document){var e=document;d.c7=e.URL,d.c8=e.title,d.c9=e.referrer}return null!=b&&c.extend(d,b),d.hasOwnProperty("ns_ts")||(d.ns_ts=String(+new Date)),null!=a&&!d.hasOwnProperty("ns_st_ev")&&(d.ns_st_ev=n.toString(a)),da.isPersistentLabelsShared()&&W&&c.extend(d,W.getLabels()),c.extend(d,da.getLabels()),O(a,d),ja.createLabels(a,d),ja.getClip().createLabels(a,d),d.hasOwnProperty("ns_st_mp")||(d.ns_st_mp=_),d.hasOwnProperty("ns_st_mv")||(d.ns_st_mv=aa),d.hasOwnProperty("ns_st_ub")||(d.ns_st_ub="0"),d.hasOwnProperty("ns_st_br")||(d.ns_st_br="0"),d.hasOwnProperty("ns_st_pn")||(d.ns_st_pn="1"),d.hasOwnProperty("ns_st_tp")||(d.ns_st_tp="1"),d.hasOwnProperty("ns_st_it")||(d.ns_st_it="c"),d.ns_st_sv=q.STREAMSENSE_VERSION,d.ns_type="hidden",d}function O(a,b){var d=b||{};if(d.ns_st_ec=String(ia),!d.hasOwnProperty("ns_st_po")){var e=ha,f=I(d);(a==n.PLAY||a==n.KEEP_ALIVE||a==n.HEART_BEAT||null==a&&V==o.PLAYING)&&(e+=f-ja.getClip().getPlaybackTimestamp()),d.ns_st_po=c.getInteger(e)}return a==n.HEART_BEAT&&(d.ns_st_hc=String(qa)),d}function P(a){var b=I(a);b<0&&(a.ns_ts=String(+new Date))}function Q(a,b,c){b=b||{},b.ns_st_ad=1,a>=n.AD_PLAY&&a<=n.AD_CLICK&&da.notify(a,b,c)}function R(a,b){da.notify(n.CUSTOM,a,b)}var S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da=this,ea=500,fa=null,ga=0,ha=0,ia=0,ja=null,ka=!0,la=!0,ma=q.DEFAULT_HEARTBEAT_INTERVAL,na=q.DEFAULT_KEEP_ALIVE_INTERVAL,oa=q.DEFAULT_PAUSED_ON_BUFFERING_INTERVAL,pa=0,qa=0,ra=0,sa=!1,ta={};i.autoSelect(),c.extend(this,{reset:function(a){ja.reset(a),ja.setPlaylistCounter(0),ja.setPlaylistId(+new Date+"_1"),ja.getClip().reset(a),null==a||a.isEmpty()?S={}:c.filterMap(S,a),ia=1,qa=0,h(),j(),r(),v(),x(),V=o.IDLE,U=null,ga=-1,$=null,_=q.DEFAULT_PLAYERNAME,aa=q.STREAMSENSE_VERSION,ba=null},setPauseOnBufferingInterval:function(a){oa=a},getPauseOnBufferingInterval:function(){return oa},setKeepAliveInterval:function(a){na=a},getKeepAliveInterval:function(){return na},setHeartbeatIntervals:function(a){ma=a},notify:function(){var a,b,d,e;b=arguments[0],3==arguments.length?(d=arguments[1],e=arguments[2]):(d={},e=arguments[1]),a=y(b);var f=c.extend({},d);if(P(f),f.hasOwnProperty("ns_st_po")||(f.ns_st_po=c.getInteger(e).toString()),b==n.PLAY||b==n.PAUSE||b==n.BUFFER||b==n.END)da.isPausePlaySwitchDelayEnabled()&&w(V)&&w(a)&&(V!=o.PLAYING||a!=o.PAUSED||T)?z(a,f,ea):z(a,f);else{var g=N(b,f);c.extend(g,f),B(g,!1),ia++}},getLabels:function(){return S},getState:function(){return V},setLabels:function(a){null!=a&&(null==S?S=a:c.extend(S,a))},getLabel:function(a){return S[a]},setLabel:function(a,b){null==b?delete S[a]:S[a]=b},setPixelURL:function(a){if(null==a||0==a.length)return null;var b=decodeURIComponent||unescape,c=a.indexOf("?");if(c>=0){if(c<a.length-1){for(var d=a.substring(c+1).split("&"),e=0,f=d.length;e<f;e++){var g=d[e],h=g.split("=");2==h.length?da.setLabel(h[0],b(h[1])):1==h.length&&da.setLabel(q.PAGE_NAME_LABEL,b(h[0]))}a=a.substring(0,c+1)}}else a+="?";return fa=a},getPixelURL:function(){return fa?fa:"undefined"!=typeof ns_p&&"string"==typeof ns_p.src?fa=ns_p.src.replace(/&amp;/,"&").replace(/&ns__t=\d+/,""):"string"==typeof ns_pixelUrl?fa=ns_pixelUrl.replace(/&amp;/,"&").replace(/&ns__t=\d+/,""):null},isPersistentLabelsShared:function(){return ka},setPersistentLabelsShared:function(a){ka=a},isPauseOnBufferingEnabled:function(){return la},setPauseOnBufferingEnabled:function(a){la=a},isPausePlaySwitchDelayEnabled:function(){return sa},setPausePlaySwitchDelayEnabled:function(a){sa=a},setPausePlaySwitchDelay:function(a){a&&a>0&&(ea=a)},getPausePlaySwitchDelay:function(){return ea},setClip:function(a,b){var c=!1;return V==o.IDLE&&(ja.getClip().reset(),ja.getClip().setLabels(a,null),b&&ja.incrementStarts(),c=!0),c},setPlaylist:function(a){var b=!1;return V==o.IDLE&&(ja.incrementPlaylistCounter(),ja.reset(),ja.getClip().reset(),ja.setLabels(a,null),b=!0),b},importState:function(a){reset();var b=c.extend({},a);ja.setRegisters(b,null),ja.getClip().setRegisters(b,null),A(b),ia++},exportState:function(){return ba},getVersion:function(){return q.STREAMSENSE_VERSION},addListener:function(a){ca.push(a)},removeListener:function(a){ca.splice(c.indexOf(a,ca),1)},getClip:function(){return ja.getClip()},getPlaylist:function(){return ja}}),c.extend(this,{adNotify:Q,customNotify:R,viewNotify:function(b,c){b=b||da.getPixelURL(),b&&a(b,c)}}),ns_.comScore&&(ta=ns_.comScore.exports,W=ta.c()),S={},ia=1,V=o.IDLE,ja=new s,X=null,la=!0,Z=null,qa=0,j(),Y=null,T=null,sa=!1,$=null,ha=0,ca=[],da.reset(),d&&da.setLabels(d),e&&da.setPixelURL(e)};return function(a){function b(a,b){return w[y]||e(a,b)}function d(){y=-1;for(var a=0;a<=x;a++)if(w.hasOwnProperty(a)){y=a;break}return ns_.StreamSense.activeIndex=y,y}function e(a,b){return a=a||null,b=b||null,a&&"object"==typeof a&&(b=a,a=null),w[++x]=new ns_.StreamSense(b,a),d(),w[x]}function f(){var a=!1,b=y;if("number"==typeof arguments[0]&&isFinite(arguments[0]))b=arguments[0];else if(arguments[0]instanceof ns_.StreamSense)for(var c in w)if(w[c]===arguments[0]){b=c;break}return w.hasOwnProperty(b)&&(a=w[b],delete w[b],a.reset(),d()),a}function g(a){return a=a||{},b().setPlaylist(a),b().getPlaylist()}function h(a,c,d){return a=a||{},"number"==typeof c&&(a.ns_st_cn=c),b().setClip(a,d),b().getClip()}function i(a,c,d){return"undefined"!=typeof a&&(d=d||null,c=c||{},b().notify(a,c,d))}function j(a){"undefined"!=typeof a&&b().setLabels(a)}function k(){return b().getLabels()}function l(a){"undefined"!=typeof a&&b().getPlaylist().setLabels(a)}function m(){return b().getPlaylist().getLabels()}function n(a){"undefined"!=typeof a&&b().getClip().setLabels(a)}function o(){return b().getClip().getLabels()}function p(a){return b().reset(a||{})}function q(a){return b().getPlaylist().reset(a||{})}function r(a){return b().getClip().reset(a||{})}function s(a){return a=a||{},b().viewNotify(null,a)}function t(a,c){return arguments.length>2&&(a=arguments[1],c=arguments[2]),a=a||{},"number"==typeof c&&(a.ns_st_po=c),b().customNotify(a,c)}function u(){return b().exportState()}function v(a){b().importState(a)}var w={},x=-1,y=-1;c.extend(a,{activeIndex:y,newInstance:e,new:e,destroyInstance:f,destroy:f,newPlaylist:g,newClip:h,notify:i,setLabels:j,getLabels:k,setPlaylistLabels:l,getPlaylistLabels:m,setClipLabels:n,getClipLabels:o,resetInstance:p,resetPlaylist:q,resetClip:r,viewEvent:s,customEvent:t,exportState:u,importState:v})}(d),d}();return t.AdEvents=p,t.PlayerEvents=n,ns_.StreamingTag=ns_.StreamingTag||function(){var a=function(){var a=function(a){function b(){if(!ns_.comScore&&c.exists(a))if(u=c.isTrue(a.debug),c.exists(a.customerC2)){var b=a.secure?"https://sb":"http"+("s"==document.location.href.charAt(4)?"s://sb":"://b");s.setPixelURL(b+".scorecardresearch.com/p?c1=2"),s.setLabel("c2",a.customerC2)}else s.setPixelURL(""),u&&console.log("Warning: customerC2 is not provided (or incorrect) in the StreamingTag configuration.");s.setLabel("ns_st_it","r")}function d(a){return c.exists(a)||(a={}),c.exists(a.ns_st_ci)||(a.ns_st_ci="0"),c.exists(a.c3)||(a.c3="*null"),c.exists(a.c4)||(a.c4="*null"),c.exists(a.c6)||(a.c6="*null"),a}function e(a){return m>0&&a>=m?p+=a-m:p=0,p}function f(a){s.getState()!=o.IDLE&&s.getState()!=o.PAUSED?s.notify(n.END,e(a)):s.getState()==o.PAUSED&&s.notify(n.END,p)}function g(a){return h("ns_st_ci",q,a)&&h("c3",q,a)&&h("c4",q,a)&&h("c6",q,a)}function h(a,b,d){if(c.exists(a)&&c.exists(b)&&c.exists(d)){var e=b[a],f=d[a];return c.exists(e)&&c.exists(f)&&e===f}return!1}function i(a,b){f(a),l++;var d={ns_st_cn:l,ns_st_pn:"1",ns_st_tp:"0"};c.extend(d,b),s.setClip(d),q=b,m=a,p=0,s.notify(n.PLAY,p)}function j(a){var b=+new Date;f(b),l++,a=d(a);var e={ns_st_cn:l,ns_st_pn:"1",ns_st_tp:"1",ns_st_ad:"1"};c.extend(e,a),s.setClip(e),p=0,s.notify(n.PLAY,p),m=b,r=!1}function k(a,b){var c=+new Date;a=d(a),w==v.None&&(w=b),r&&w==b&&g(a)?(s.getClip().setLabels(a),s.getState()!=o.PLAYING&&(m=c,s.notify(n.PLAY,p))):i(c,a),r=!0,w=b}var l=0,m=0,p=0,q=null,r=!1,s=new t,u=!1,v={None:0,AudioContent:1,VideoContent:2},w=v.None;c.extend(this,{playAdvertisement:function(){u&&console&&console.warn("Calling deprecated function 'playAdvertisement'. Please call 'playVideoAdvertisement' or 'playAudioAdvertisement' functions instead.");var a={ns_st_ct:"va"};j(a)},playVideoAdvertisement:function(a){var b={ns_st_ct:"va"};a&&c.extend(b,a),j(b)},playAudioAdvertisement:function(a){var b={ns_st_ct:"aa"};a&&c.extend(b,a),j(b)},playContentPart:function(a){u&&console&&console.warn("Calling deprecated function 'playContentPart'. Please call 'playVideoContentPart' or 'playAudioContentPart' functions instead.");var b={ns_st_ct:"vc"};a&&c.extend(b,a),k(b,v.VideoContent)},playVideoContentPart:function(a){var b={ns_st_ct:"vc"};a&&c.extend(b,a),k(b,v.VideoContent)},playAudioContentPart:function(a){var b={ns_st_ct:"ac"};a&&c.extend(b,a),k(b,v.AudioContent)},stop:function(){var a=+new Date;s.notify(n.PAUSE,e(a))}}),b()};return function(a){}(a),a}();return a}(),t}(),define("vendor/stream_sense",[],function(){"use strict";return window.ns_}),define("lib/videoMetrix",["lodash","utils/ted","vendor/stream_sense","exports"],function(a,b,c,d){"use strict";d.init=function(a){this._init(),this._setContext(a)},d.start=function(){this._play()},d.stop=function(){this._tag&&this._tag.stop()},d.startAd=function(){this._asset.isInAd=!0,this._play()},d.stopAd=function(){this._asset.isInAd=!1,this._play()},d._meta=null,d._asset=null,d._tag=null,d._init=a.once(function(){d._tag=new c.StreamingTag({customerC2:b("csClientId")})}),d._setContext=function(a){var b={};a.talkId&&(b.ns_st_ci=a.talkId),this._meta=b,this._asset={isInAd:!1,isVideo:!0}},d._reset=function(){d._meta=null,d._asset=null,d._tag=null},d._play=function(){this._tag&&(this._asset.isInAd?this._asset.isVideo?this._tag.playVideoAdvertisement():this._tag.playAudioAdvertisement():this._asset.isVideo?this._tag.playVideoContentPart(this._meta):this._tag.playAudioContentPart(this._meta))}}),define("widgets/player/cs-tracker",["jquery","utils/ted","lib/videoMetrix"],function(a,b,c){"use strict";function d(b){b._isInternal&&(this._data={lastMetaTalkId:null,lastPlayTalkId:null},this._widget=b,this._addHandlers(),a(window).unload(function(){c.stop()}))}return d.prototype._sendViewBeacon=function(a){var c=window.COMSCORE;c&&c.beacon&&c.beacon({c1:"1",c2:b("csClientId"),c5:"02",c6:a})},d.prototype._sendPostrollBeacon=function(){var a=window.COMSCORE;a&&a.beacon&&a.beacon({c1:"1",c2:b("csClientId"),c5:"10"})},d.prototype._onTalkPlay=function(a){this._sendViewBeacon(a)},d.prototype._addHandlers=function(){var a=this,b={playertalk:function(a,b){c.init({talkId:b.id})},playerplay:function(){var b=a._widget.options.currentTalk.id;a._data.lastPlayTalkId!==b&&(a._onTalkPlay(b),a._data.lastPlayTalkId=b),c.start()},playerpause:function(){c.stop()},playercomplete:function(){c.stop()},playerprerollstart:function(){c.startAd()},playerprerollcomplete:function(){c.stopAd()},playerpostrollstart:function(){a._sendPostrollBeacon(),c.startAd()},playerpostrollcomplete:function(){c.stopAd()}};this._handlers=b,this._widget._on(b)},d}),define("lib/abby",["utils/ted","exports"],function(a,b){"use strict";b.getTests=function(){var b=a("abby");return b&&b.tests||{}},b.getVariation=function(a){return b.getTests()[a]},b.isVariation=function(a,c){return b.getVariation(a)===c}}),define("widgets/player/qa-tracker",["jquery","lodash","lib/abby","lib/errorCollector","utils/is_mobile"],function(a,b,c,d,e){"use strict";function f(a){return b.isUndefined(a)?"":a>9999?"9999":(a<0?"-":"")+("0000"+Math.floor(Math.abs(a))).slice(-4)+(""+a%1).slice(1,6)}function g(a){return b.isUndefined(a)?"":a}function h(a,c){return a!==-1&&!b.isUndefined(a)&&!b.isUndefined(c)&&a!==c&&(c===-1?"dynamic":c>a?"up":"down")}function i(a){this._widget=a,this._resetMarks(),this._addHandlers()}return i.prototype._log=function(b){var h="unknown";this.marks.talkComplete?h="complete":this.marks.playable?h="playable":this.marks.playable===!1&&(h="unplayable");var i="unknown";this.marks.rebuffering?i="rebuffering":this.marks.buffering&&(i="buffering");var j;"unplayable"===h&&this.marks.bufferingStarted&&this.marks.requested&&this.marks.bufferingStarted>this.marks.requested&&(j=(+new Date-+this.marks.bufferingStarted)/1e3);var k=a.extend({context:"ted-com-player-qa",pev:"014",playerMode:this._widget.mode(),bufferState:h,bufferType:i,bufferDuration:f(j),bufferFuture:f(this.marks.bufferFuture),bufferPast:f(this.marks.bufferPast),intolerantBufferFuture:f(this.marks.intolerantBufferFuture),intolerantBufferPast:f(this.marks.intolerantBufferPast),currentTime:f(this.marks.currentTime),playbackRate:this._widget.playbackRate(),playToken:g(this.marks.playToken),levelCurrent:g(this.marks.levelCurrent),levelNext:g(this.marks.levelNext),levelLoad:g(this.marks.levelLoad),levelNextLoad:g(this.marks.levelNextLoad),deviceType:e()?"mobile":"desktop",error:!1,throttled:!1,talkId:this.marks.talkId,message:"Video QA Event",multiple:!1},b||{});if(k.multiple||!this.marks[k.message]){this.marks[k.message]=!0;var l=c.getVariation("html5_video");if("desktop"===k.deviceType){switch(k.hvv=l,l){case"a":if("flash"!==k.playerMode)return;break;case"b":case"c":case"d":if("hlsjs"!==k.playerMode)return;break;default:return}delete k.multiple,d.log(k.message,k)}}},i.prototype._resetMarks=function(){this.marks={currentTime:"",talkId:""}},i.prototype._addHandlers=function(){function a(){b.marks.playable&&b.marks.started&&b._log({message:"Play Start"})}var b=this,c={playercurrenttime:function(a,c){b.marks.currentTime=c.currentTime},playertalk:function(a,c){b.marks.talkId=c.id},playerbufferunplayable:function(){b.marks.playable=!1,b.marks.bufferingStarted=new Date},playerbufferplayable:function(){b.marks.playable=!0,b.marks.bufferingStarted=null,b.marks.buffering=!1,b.marks.rebuffering=!1,a()},playerplaytoken:function(a,c){b.marks.playToken=c.playToken},playerprolongedbuffer:function(a,c){var d=c.duration;b.marks.buffering=!0,!b.marks.talkComplete&&d&&d%2e3&&b._log({message:"Prolonged Buffer: "+d})},playerprolongedrebuffer:function(a,c){var d=c.duration;b.marks.rebuffering=!0,!b.marks.talkComplete&&d&&d%2e3&&b._log({message:"Prolonged Rebuffer: "+d})},playererror:function(a,c){c.error&&"Error playing video"===c.error.message&&3===c.error.code&&b._log({message:"Decode Error"})},playermetricsdata:function(a,c){if(c&&c.metricsData){var d=c.metricsData,e=b.marks.levelLoad,f=b.marks.levelNextLoad;b.marks.bandwidth=d.bandwidth,b.marks.bufferFuture=d.bufferLength,b.marks.bufferPast=d.backBufferLength,b.marks.intolerantBufferFuture=d.intolerantBufferLength,b.marks.intolerantBufferPast=d.intolerantBackBufferLength,b.marks.levelCurrent=d.currentLevel,b.marks.levelNext=d.nextLevel,b.marks.levelLoad=d.loadLevel,b.marks.levelNextLoad=d.nextLoadLevel;var g=h(f,d.nextLoadLevel);g&&b._log({multiple:!0,message:"Load Level Switching",levelDirection:g});var i=h(e,d.loadLevel);i&&b._log({multiple:!0,message:"Load Level Switched",levelDirection:i})}},playerrequestplay:function(){b.marks.requested=b.marks.requested||new Date,b._log({message:"Play Request"})},playerplay:function(){b.marks.started=!0,a()},playertalkcomplete:function(){b.marks.talkComplete=!0,b._log({message:"Talk Complete"})}};b._widget._on(c),b._widget._on(window,{beforeunload:function(){b.marks.requested&&b._log({message:"Talk Exit"})}})},i}),define("utils/f",[],function(){"use strict";var a=function(a,b){var c=Array.prototype.slice.call(arguments,2);return function(){return a[b].apply(a,c)}};return a.create=function(a){return function(){var b=arguments,c=function(){return a.apply(this,b)};return c.prototype=a.prototype,new c}},a.get=function(a){return function(b){return b.get&&"function"==typeof b.get?b.get(a):b[a]&&"function"==typeof b[a]?b[a].call(b):b[a]}},a.splat=function(){var b=Array.prototype.slice.call(arguments);return function(c){for(var d=[],e=0;e<b.length;e++)d.push(a.get(b[e]).call(c));return d}},a.send=function(a){var b=Array.prototype.slice.call(arguments,1);return function(c){return c[a].apply(c,b)}},a.and=function(){var a=Array.prototype.slice.call(arguments);return function(b){for(var c=!0,d=0;d<a.length;d++)c=c&&a[d].call(null,b);return c}},a.not=function(a){return function(){return!a.apply(null,arguments)}},a.ascending=function(a,b){return a-b},a.descending=function(a,b){return b-a},a.truthy=function(a){return!!a},a.falsey=a.not(a.truthy),a}),define("player/topicFactory",["jquery"],function(a){"use strict";function b(c,d,e){var f,g;for(f=0,g=d.length;f<g;f++)a.isArray(d[f])?b(c,d[f],e):d[f].apply(c,e)}return function(c){var d={};return function(e){var f,g=e&&d[e];if(!g){f=a.Callbacks(c&&c.hasOwnProperty(e)?c[e]:"memory"),g={publish:f.fire,subscribe:f.add,unsubscribe:f.remove,once:function(){function a(){b(f,c,arguments),f.remove(a)}var c=arguments;return f.add(a)},publishUnique:function(){var a;return!!window.JSON&&function(){var b=Array.prototype.slice.call(arguments,0),c=JSON.stringify(b);c!==a&&(f.fire.apply(f,b),a=c)}}()};var h=null;f.add(function(a){h=a}),g.read=function(){return h},e&&(d[e]=g)}return g}}}),define("player/getFlashVars",["jquery"],function(a){"use strict";function b(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c+"="+encodeURIComponent(a[c]));return b.join("&")}return function(a){var c=a.options;return b({serviceHost:"https://www.ted.com",volume:a.config.get("volume"),autoplay:0,supressSubtitles:!c.customSubtitles,fullscreenEnabled:a.canFullScreen?0:1})}}),function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define("ted-master-ad-interface",["exports"],b):b(a.mai=a.mai||{})}(this,function(a){"use strict";function b(a){if(a&&"undefined"!=typeof Image){var b=new Image;b.src=a}}function c(a,b){var c=new XMLHttpRequest;if("withCredentials"in c)c.withCredentials=!0,c.open(a,b,!0);else{if("undefined"==typeof XDomainRequest)throw new Error("No CORS/XHR support");c=new XDomainRequest,c.open(a,b)}return c}function d(a){return new Promise(function(b,d){var e=void 0,f=setTimeout(function(){d(new Error("Request timed out"))},5e3);try{e=c("GET",a,!0)}catch(a){d(a)}e.addEventListener("readystatechange",function(){4===e.readyState&&(clearTimeout(f),200===e.status?b(e):d(new Error("HTTP status: "+e.status+"; message: "+e.statusText)))}),e.send()})}function e(a){return new Promise(function(b,c){d(a).then(function(a){try{var d=JSON.parse(a.response);b(d)}catch(a){c(new Error("JSON response could not be parsed"))}}).catch(c)})}function f(a){return new Promise(function(b,c){d(a).then(function(a){var d=void 0,e=void 0;try{"undefined"!=typeof DOMParser?(d=new DOMParser,e=d.parseFromString(a.responseText,"text/xml")):"undefined"!=typeof ActiveXObject?(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(a.responseText)):c(new Error("XML parsing unavailable"));
}catch(a){e=void 0}e?b(e):c(new Error("XML response could not be parsed"))}).catch(c)})}function g(a){return String(a).replace(/[!+#*~;^()<>[\]]/g,"-")}function h(a){return g(a).replace(" ","-")}function i(){return Math.floor(999999*Math.random())}function j(a){return a.map(function(a){return a[0]+"x"+a[1]}).join("|")}function k(a){return a.split("|").map(function(a){return a.split("x").map(function(a){return parseInt(a,10)})})}function l(a){return Object.getOwnPropertyNames(a).map(function(b){return ua(h(b))+"="+ua(g(a[b]))}).join("&")}function m(a){var b={};return a.split("&").forEach(function(a){var c=a.split("=",2),d=la(c,2),e=d[0],f=d[1];b[va(e)]=va(f)}),b}function n(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};["adUnitId","sizes"].forEach(function(b){if(!a[b])throw new Error("'"+b+"' is a required option")});var b={iu:a.adUnitId,sz:j(a.sizes)};if(a.targeting){var c=l(a.targeting);c&&(b.t=c)}return b}function o(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",b={};return a.split("&").forEach(function(a){var c=a.split("=",2),d=la(c,2),e=d[0],f=d[1];switch(e){case"iu":b.adUnitId=va(f);break;case"sz":b.sizes=k(va(f));break;case"t":b.targeting=m(va(f))}}),b}function p(a){var b=Object.getOwnPropertyNames(a).map(function(b){return ua(b)+"="+ua(a[b])});return b.push("c="+i()),"https://pubads.g.doubleclick.net/gampad/adx?"+b.join("&")}function q(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return p(n(a))}function r(a){var b=String(a).match(/\?[^#]*/);return b&&b[0]||""}function s(a,b){var c=r(a).match(new RegExp("[?&]"+za(b)+"=([^&]*)"));return Aa(c&&c[1]||"")}function t(a,b){return!!r(a).match(new RegExp("[?&]"+za(b)+"(?:[?[&=].*)?$"))}function u(a,b,c){return""+String(a).match(/[^#]*/)[0]+(String(a).includes("?")?"&":"?")+za(b)+"="+za(c)}function v(){return"undefined"!=typeof location&&location||""}function w(a){return s(v(),a)}function x(a){return t(v(),a)}function y(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(a){return a};return(a||[]).reduce(function(a,c,d){var e=a;return e[b(d)]=c,e},{})}function z(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=Object.getOwnPropertyNames(a).map(function(b){return Fa(b)+"="+Fa(a[b])});return b.join("&")}function A(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=ta.extends({context:"mai",location:"undefined"==typeof window?"unknown":window.location.href},a);return"https://error-collector.ted.com/?"+z(b)}function B(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};b(A(a))}function C(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a&&!a.startsWith("https://")&&B(ta.extends({error:"insecure",url:a},b))}function D(a){function b(){"complete"===document.readyState&&(a(),document.removeEventListener("readystatechange",b))}document.addEventListener("readystatechange",b),b()}function E(a){var b=a.unitId,c=a.sizes,d=a.targeting,e=a.lineItemId,f=(new Date).getTime(),g={gdfp_req:"1",correlator:Math.floor(999999*Math.random()),output:"json_html",callback:"callbackProxy",impl:"fif",eid:"108809080,108809155,21060003",sc:"0",sfv:"1-0-6",iu:b,sz:(c||[]).map(function(a){return a.join("x")}).join(","),scp:Object.getOwnPropertyNames(d||{}).map(function(a){return a+"="+d[a]}).join("&"),cookie_enabled:"1",lmt:Math.floor(f/1e3),dt:f,cc:"100",frm:"20",biw:"1362",bih:"949",oid:"3",adx:"931",ady:"555",adk:"4270558784",gut:"v2",ifi:"2",u_tz:"-480",u_his:"1",u_java:"true",u_h:"1050",u_w:"1680",u_ah:"987",u_aw:"1680",u_cd:"24",u_nplug:"1",u_nmime:"43",u_sd:"2",flash:"0",url:window.location.href,dssz:"26",icsg:"544",std:"36",vrg:"110",vrp:"110",ga_vid:"544535009.1465231494",ga_sid:"1487263339",ga_hid:"447020018",userAgent:window.navigator.userAgent,lid:e,base_url:"https://securepubads.g.doubleclick.net/gampad/ads"},h=Object.getOwnPropertyNames(g).map(function(a){return Qa(a)+"="+Qa(g[a])}).join("&");return"https://www.google.com/dfp#delivery/AdSimulator/"+h}function F(a){return"https://www.google.com/dfp/main#delivery/LineItemDetail/lineItemId="+a}function G(a){return"https://www.google.com/dfp/main#delivery/CreativeDetail/creativeId="+a}function H(a){return"https://www.google.com/dfp#delivery/TroubleshootingTools/videoTag="+Qa(a)}function I(a){return o(String(a).split("?").pop())||{}}function J(a){return a.wrapper?J(a.wrapper):a}function K(a){var b=I(a.masterUrl),c=I(a.master&&a.master.prerollUrl),d=a.postrollError&&a.postrollError.wrapper||a.postroll,e=d&&J(d);return{isError:a.masterError||a.prerollError||a.postrollError,masterError:a.masterError&&a.masterError.message,prerollError:a.prerollError&&a.prerollError.message,postrollError:a.postrollError&&a.postrollError.message,masterUrl:a.masterUrl,masterAdSimulatorUrl:E({unitId:b.adUnitId,sizes:b.sizes,targeting:b.targeting,lineItemId:a.master.lineItemId}),masterAdUnitId:b.adUnitId||"",masterAdTargeting:b.targeting||{},masterAdSizes:(b.sizes||[]).map(function(a){return a.join("x")}).join(", "),masterLineItemId:a.master.lineItemId,masterCreativeId:a.master.creativeId,masterTargetingValue:a.master.companionTargetingValue,prerollUrl:a.master.prerollUrl&&a.addAdUnitToUrl(a.master.prerollUrl),prerollAdSimulatorUrl:E({unitId:b.adUnitId,sizes:c.sizes,targeting:c.targeting,lineItemId:a.preroll.lineItemId}),prerollLineItemId:a.preroll.lineItemId,prerollCreativeId:a.preroll.creativeId,prerollMdpi:a.preroll.mdpiCreative,prerollHdpi:a.preroll.hdpiCreative,prerollXhdpi:a.preroll.xhdpiCreative,prerollXxhdpi:a.preroll.xxhdpiCreative,prerollParameter:a.preroll.hlsParamValue||"",postrollUrl:a.master.postrollUrl&&a.addAdUnitToUrl(a.master.postrollUrl),postrollAdSystem:d.adSystem||"",postrollAdId:d.adId||"",postrollAdTitle:d.adTitle||"",postrollIsGdfp:"GDFP"===e.adSystem,postrollLineItemId:e.lineItemId||"",postrollCreativeId:e.creativeId||"",postrollParameter:e.hlsParamValue||""}}function L(a){var b=K(a);return'\n    <div style="background:#EAEAEA; border:1px solid #DBDBDB; border-radius:5px; margin:10px; overflow:hidden; padding:10px;">\n      <div style="'+Oa+" background:"+(b.isError?"#500":"#555")+'; color:#FFF;">Master</div>\n\n      <div style="'+Ja+'">Request:</div>\n\n      <div style="'+Ka+'">\n        <a href="'+b.masterAdSimulatorUrl+'" target=_blank>Open in Ad Request Simulator</a>\n      </div>\n\n      <div style="'+Ka+'">\n        <span style="'+Ma+'">Ad Request URL:</span>\n        <a href="'+b.masterUrl+'">'+b.masterUrl+'</a>\n      </div>\n\n      <div style="'+Ka+'">\n        <span style="'+Ma+'">Ad Unit:</span>\n        '+b.masterAdUnitId+'\n      </div>\n\n      <div style="'+Ka+'">\n        <span style="'+Ma+'">Creative Size:</span>\n        [ '+b.masterAdSizes+' ]\n      </div>\n\n      <div style="'+Ka+'">\n        <span style="'+Ma+'">Key/Value Pairs:</span>\n        <table style="border-collapse:collapse; margin:0 0 10px -5px;">\n          <thead>\n            <tr style="border-bottom:1px solid #CCC;">\n              <th style="border-right: 1px solid #CCC; '+Pa+'">Key:</th>\n              <th style="'+Pa+'">Value:</th>\n            </tr>\n          </thead>\n          <tbody>\n            '+Object.entries(b.masterAdTargeting).map(function(a){var b=la(a,2),c=b[0],d=b[1];return'\n              <tr>\n                <td style="border-right:1px solid #CCC; '+Pa+'">'+c+'</td>\n                <td style="'+Pa+'">'+d+"</td>\n              </tr>\n            "}).join("")+'\n          </tbody>\n        </table>\n      </div>\n\n      <div style="'+Ja+'">Response:</div>\n\n      '+(b.masterError?'\n        <div style="'+La+'">\n          <strong>Error:</strong><br />\n          '+b.masterError+"\n        </div>\n      ":'\n        <div style="'+Ka+'">\n          <span style="'+Ma+'">Line Item ID:</span>\n          <a href="'+F(b.masterLineItemId)+'" target="_blank">'+b.masterLineItemId+'</a>\n        </div>\n\n        <div style="'+Ka+'">\n          <span style="'+Ma+'">Creative ID:</span>\n          <a href="'+G(b.masterCreativeId)+'" target="_blank">'+b.masterCreativeId+'</a>\n        </div>\n\n        <div style="'+Ka+'">\n          <span style="'+Ma+'">Targeting Value:</span>\n          "'+b.masterTargetingValue+'"\n        </div>\n\n        <!-- ---------- ---------- Preroll ---------- ---------- -->\n\n        <div style="'+Na+'">\n          <div style="'+Oa+' background:#CCC;">Preroll</div>\n\n          <div style="'+Ka+'">\n            <a href="'+b.prerollAdSimulatorUrl+'" target=_blank>Open in Ad Request Simulator</a>\n          </div>\n\n          <div style="'+Ka+'">\n            <span style="'+Ma+'">Ad Request:</span>\n            <a href="'+b.prerollUrl+'">'+b.prerollUrl+"</a>\n          </div>\n\n          "+(b.prerollError?'\n            <div style="'+La+'">\n              <strong>Error:</strong><br />\n              '+b.prerollError+"\n            </div>\n          ":"\n            "+(b.prerollLineItemId?'\n              <div style="'+Ka+'">\n                <span style="'+Ma+'">Line Item ID:</span>\n                <a href="'+F(b.prerollLineItemId)+'" target="_blank">'+b.prerollLineItemId+'</a>\n              </div>\n\n              <div style="'+Ka+'">\n                <span style="'+Ma+'">Creative ID:</span>\n                <a href="'+G(b.prerollCreativeId)+'" target="_blank">'+b.prerollCreativeId+"</a>\n              </div>\n            ":"")+'\n\n            <div style="'+Ka+'">\n              <span style="'+Ma+'">Creatives:</span>\n              '+(b.prerollMdpi?'<a href="'+b.prerollMdpi+'">MDPI</a>':"")+"\n              "+(b.prerollHdpi?'<a href="'+b.prerollHdpi+'">HDPI</a>':"")+"\n              "+(b.prerollXhdpi?'<a href="'+b.prerollXhdpi+'">XHDPI</a>':"")+"\n              "+(b.prerollXxhdpi?'<a href="'+b.prerollXxhdpi+'">XXHDPI</a>':"")+'\n            </div>\n\n            <div style="'+Ka+'">\n              <span style="'+Ma+'">Preroll Parameter:</span>\n              '+b.prerollParameter+"\n            </div>\n          ")+'\n        </div>\n\n        <!-- ---------- ---------- Postroll ---------- ---------- -->\n\n        <div style="'+Na+'">\n          <div style="'+Oa+' background:#CCC;">Postroll</div>\n\n          <div style="'+Ka+'">\n            <a href="'+H(b.postrollUrl)+'" target=_blank>Open in Delivery Inspector</a>\n          </div>\n\n          <div style="'+Ka+'">\n            <span style="'+Ma+'">Ad Request:</span>\n            <a href="'+b.postrollUrl+'">'+b.postrollUrl+"</a>\n          </div>\n\n          "+(b.postrollError?'\n            <div style="'+La+'">\n              <strong>Error:</strong><br />\n              '+b.postrollError+"\n            </div>\n          ":"")+"\n\n          "+(b.postrollIsGdfp?'\n            <div style="'+Ka+'">\n              <span style="'+Ma+'">Line Item ID:</span>\n              <a href="'+F(b.postrollLineItemId)+'" target="_blank">'+b.postrollLineItemId+'</a>\n            </div>\n\n            <div style="'+Ka+'">\n              <span style="'+Ma+'">Creative ID:</span>\n              <a href="'+G(b.postrollCreativeId)+'" target="_blank">'+b.postrollCreativeId+'</a>\n            </div>\n\n            <div style="'+Ka+'">\n              <span style="'+Ma+'">Postroll Parameter:</span>\n              '+b.postrollParameter+"\n            </div>\n          ":"")+'\n\n          <hr />\n\n          <div style="'+Ka+'">\n            <span style="'+Ma+'">Postroll Ad System:</span>\n            '+b.postrollAdSystem+'\n          </div>\n\n          <div style="'+Ka+'">\n            <span style="'+Ma+'">Postroll Ad ID:</span>\n            '+b.postrollAdId+'\n          </div>\n\n          <div style="'+Ka+'">\n            <span style="'+Ma+'">Postroll Ad Title:</span>\n            '+b.postrollAdTitle+"\n          </div>\n        </div>\n      ")+"\n    </div>\n  "}function M(a){var b=document.createElement("div");return b.innerHTML=L(a),b}function N(a){Ta=a,Sa&&Ra.append(M(a))}function O(){return Sa?void Ra.show():(Ra.render(),Sa=!0,void(Ta&&N(Ta)))}function P(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=new Ha(a,c),e=w("dfptest");return e&&(b.dfptest=e),d.loadMaster(b).then(function(){return Promise.all([d.loadPreroll(),d.loadPostroll()])}).then(function(){return d.checkSecurity()}).then(function(){return N(d)}).catch(function(a){throw N(d),a}).then(function(){return d.getData()})}var Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},R=function(){var a="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(b,c,d,e){var f=b&&b.defaultProps,g=arguments.length-3;if(c||0===g||(c={}),c&&f)for(var h in f)void 0===c[h]&&(c[h]=f[h]);else c||(c=f||{});if(1===g)c.children=e;else if(g>1){for(var i=Array(g),j=0;j<g;j++)i[j]=arguments[j+3];c.children=i}return{$$typeof:a,type:b,key:void 0===d?null:""+d,ref:null,props:c,_owner:null}}}(),S=function(a){if("function"==typeof Symbol){if(Symbol.asyncIterator){var b=a[Symbol.asyncIterator];if(null!=b)return b.call(a)}if(Symbol.iterator)return a[Symbol.iterator]()}throw new TypeError("Object is not async iterable")},T=function(){function a(a){this.value=a}function b(b){function c(a,b){return new Promise(function(c,e){var h={key:a,arg:b,resolve:c,reject:e,next:null};g?g=g.next=h:(f=g=h,d(a,b))})}function d(c,f){try{var g=b[c](f),h=g.value;h instanceof a?Promise.resolve(h.value).then(function(a){d("next",a)},function(a){d("throw",a)}):e(g.done?"return":"normal",g.value)}catch(a){e("throw",a)}}function e(a,b){switch(a){case"return":f.resolve({value:b,done:!0});break;case"throw":f.reject(b);break;default:f.resolve({value:b,done:!1})}f=f.next,f?d(f.key,f.arg):g=null}var f,g;this._invoke=c,"function"!=typeof b.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(b.prototype[Symbol.asyncIterator]=function(){return this}),b.prototype.next=function(a){return this._invoke("next",a)},b.prototype.throw=function(a){return this._invoke("throw",a)},b.prototype.return=function(a){return this._invoke("return",a)},{wrap:function(a){return function(){return new b(a.apply(this,arguments))}},await:function(b){return new a(b)}}}(),U=function(a,b){function c(c,d){return e=!0,d=new Promise(function(b){b(a[c](d))}),{done:!1,value:b(d)}}var d={},e=!1;return"function"==typeof Symbol&&Symbol.iterator&&(d[Symbol.iterator]=function(){return this}),d.next=function(a){return e?(e=!1,a):c("next",a)},"function"==typeof a.throw&&(d.throw=function(a){if(e)throw e=!1,a;return c("throw",a)}),"function"==typeof a.return&&(d.return=function(a){return c("return",a)}),d},V=function(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(a){return void c(a)}return g.done?void a(h):Promise.resolve(h).then(function(a){d("next",a)},function(a){d("throw",a)})}return d("next")})}},W=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},X=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Y=function(a,b){for(var c in b){var d=b[c];d.configurable=d.enumerable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,c,d)}return a},Z=function(a,b){for(var c=Object.getOwnPropertyNames(b),d=0;d<c.length;d++){var e=c[d],f=Object.getOwnPropertyDescriptor(b,e);f&&f.configurable&&void 0===a[e]&&Object.defineProperty(a,e,f)}return a},$=function(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a},_=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},aa=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},ba=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)},ca=function(a,b){return null!=b&&"undefined"!=typeof Symbol&&b[Symbol.hasInstance]?b[Symbol.hasInstance](a):a instanceof b},da=function(a){return a&&a.__esModule?a:{default:a}},ea=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b},fa=function(a,b){if(a!==b)throw new TypeError("Cannot instantiate an arrow function")},ga=function(a){if(null==a)throw new TypeError("Cannot destructure undefined")},ha=function(a,b){var c={};for(var d in a)b.indexOf(d)>=0||Object.prototype.hasOwnProperty.call(a,d)&&(c[d]=a[d]);return c},ia=function(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b},ja="undefined"==typeof global?self:global,ka=function a(b,c,d,e){var f=Object.getOwnPropertyDescriptor(b,c);if(void 0===f){var g=Object.getPrototypeOf(b);null!==g&&a(g,c,d,e)}else if("value"in f&&f.writable)f.value=d;else{var h=f.set;void 0!==h&&h.call(e,d)}return d},la=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),ma=function(a,b){if(Array.isArray(a))return a;if(Symbol.iterator in Object(a)){for(var c,d=[],e=a[Symbol.iterator]();!(c=e.next()).done&&(d.push(c.value),!b||d.length!==b););return d}throw new TypeError("Invalid attempt to destructure non-iterable instance")},na=function(a,b){return Object.freeze(Object.defineProperties(a,{raw:{value:Object.freeze(b)}}))},oa=function(a,b){return a.raw=b,a},pa=function(a,b,c){if(a===c)throw new ReferenceError(b+" is not defined - temporal dead zone");return a},qa={},ra=function(a){return Array.isArray(a)?a:Array.from(a)},sa=function(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)},ta=Object.freeze({jsx:R,asyncIterator:S,asyncGenerator:T,asyncGeneratorDelegate:U,asyncToGenerator:V,classCallCheck:W,createClass:X,defineEnumerableProperties:Y,defaults:Z,defineProperty:$,get:aa,inherits:ba,interopRequireDefault:da,interopRequireWildcard:ea,newArrowCheck:fa,objectDestructuringEmpty:ga,objectWithoutProperties:ha,possibleConstructorReturn:ia,selfGlobal:ja,set:ka,slicedToArray:la,slicedToArrayLoose:ma,taggedTemplateLiteral:na,taggedTemplateLiteralLoose:oa,temporalRef:pa,temporalUndefined:qa,toArray:ra,toConsumableArray:sa,typeof:Q,extends:_,instanceof:ca}),ua=encodeURIComponent,va=decodeURIComponent,wa=function(){function a(b){W(this,a),b.ad&&(this.lineItemId=b.ad.lineItemId,this.creativeId=b.ad.creativeId,this.prerollUrl=b.ad.prerollURL,this.postrollUrl=b.ad.postrollURL,this.companionTargetingValue=b.ad.target,this.impressionUrl=b.ad.impression)}return X(a,null,[{key:"makeUrl",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b={sizes:[[2,2]]},c=q(ta.extends(b,a));return c+"&unviewed_position_start=1"}},{key:"fromUrl",value:function(c){return e(c).then(function(b){return new a(b)}).then(function(a){return b(a.impressionUrl),a})}},{key:"fromOptions",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.fromUrl(this.makeUrl(a))}}]),a}(),xa=function(){function a(b){W(this,a);var c=b.preroll;if(c){this.lineItemId=c.lineItemId,this.creativeId=c.creativeId,this.impressions=a.getImpressions(c),this.clickDestination=c.click,this.hlsParamValue=c.ios_preroll;var d=c.creative||{};this.mdpiCreative=d.mdpi,this.hdpiCreative=d.hdpi,this.xhdpiCreative=d.xhdpi,this.xxhdpiCreative=d.xxhdpi}}return X(a,null,[{key:"getImpressions",value:function(a){var b=[];return a.impression&&b.push(a.impression),a.third_party_impressions&&a.third_party_impressions.length>0&&(b=b.concat(a.third_party_impressions)),b}},{key:"fromUrl",value:function(b){return e(b).then(function(b){return new a(b)})}}]),a}(),ya=function(){function a(){W(this,a)}return X(a,null,[{key:"fromUrl",value:function(){return new Promise(function(b){var c=new a;b(c)})}}]),a}(),za=encodeURIComponent,Aa=decodeURIComponent,Ba=function a(){W(this,a)};Ba.getXmlEls=function(a,b){return Array.from(b.getElementsByTagName(a))},Ba.getXmlAttr=function(a,b){return(Array.from(a.attributes).find(function(a){return a.name===b})||{}).value},Ba.getXmlText=function(a){return(a&&(a.textContent||a.text||a.childNodes&&a.childNodes[0]&&a.childNodes[0].nodeValue)||"").trim()};var Ca="VAST wrapper limit reached",Da=5,Ea=function(a){function c(a){W(this,c);var b=ia(this,(c.__proto__||Object.getPrototypeOf(c)).call(this)),d=Ba.getXmlEls("Ad",a)[0];if(!d)throw new Error("Empty or invalid VAST response");b.adId=Ba.getXmlAttr(d,"id");var e=Ba.getXmlText(Ba.getXmlEls("AdSystem",d)[0]);e&&(b.adSystem=e),"GDFP"===e&&(b.lineItemId=b.adId),b.q0Impressions=[],b.q1Impressions=[],b.q2Impressions=[],b.q3Impressions=[],b.q4Impressions=[],b.pauseImpressions=[],b.resumeImpressions=[],b.muteImpressions=[],b.unmuteImpressions=[],b.skipImpressions=[],b.errorImpressions=[],b.clickImpressions=[],b.mediaFiles=[],Ba.getXmlEls("Impression",d).forEach(function(a){var c=Ba.getXmlText(a);c&&b.q0Impressions.push(c)}),Ba.getXmlEls("Error",d).forEach(function(a){var c=Ba.getXmlText(a);c&&b.errorImpressions.push(c)});var f=Ba.getXmlEls("Creative",a).find(function(a){return Ba.getXmlEls("Linear",a).length>0});f&&b.applyCreative(c.extractCreative(f));var g=Ba.getXmlText(Ba.getXmlEls("VASTAdTagURI",a)[0]);g&&(b.adTag=g);var h=Ba.getXmlText(Ba.getXmlEls("AdTitle",a)[0]);return h&&(b.adTitle=h),b}return ba(c,a),X(c,[{key:"applyCreative",value:function(a){var b=this;this.creativeId=a.id,this.clickImpressions=this.clickImpressions.concat(a.clickTrackings),this.clickDestination=a.clickThrough,this.adParameters=a.adParameters,this.hlsParamValue=a.hlsParamValue,a.hlsParamValue?this.type="stitched":a.mediaFiles.find(function(a){return"VPAID"===a.apiFramework})?this.type="vpaid":this.type="vast","stitched"!==this.type&&(this.mediaFiles=a.mediaFiles),a.trackingEvents.forEach(function(a){var c=a.event,d=a.uri;switch(c){case"start":case"creativeView":b.q0Impressions.push(d);break;case"firstQuartile":b.q1Impressions.push(d);break;case"midpoint":b.q2Impressions.push(d);break;case"thirdQuartile":b.q3Impressions.push(d);break;case"complete":b.q4Impressions.push(d);break;case"pause":case"resume":case"mute":case"unmute":case"skip":b[c+"Impressions"].push(d)}})}},{key:"getCollectedProperty",value:function(a){return[].concat(this.wrapper?this.wrapper.getCollectedProperty(a):[],this[a]||[])}},{key:"getWrapper",value:function(){return c.rewrap(this)}}],[{key:"extractCreative",value:function(a){var b=Ba.getXmlAttr(a,"id"),d=[];Ba.getXmlEls("Tracking",a).forEach(function(a){d.push({event:Ba.getXmlAttr(a,"event"),uri:Ba.getXmlText(a)})});var e=[];Ba.getXmlEls("ClickTracking",a).forEach(function(a){var b=Ba.getXmlText(a);b&&e.push(b)});var f=Ba.getXmlText(Ba.getXmlEls("ClickThrough",a)[0])||void 0,g=Ba.getXmlText(Ba.getXmlEls("AdParameters",a)[0])||void 0,h=String(g).match(/postroll=([^&]+)/),i=h?h[1]:void 0,j=[];return Ba.getXmlEls("MediaFile",a).forEach(function(a){j.push(c.extractMediaFile(a))}),{id:b,trackingEvents:d,clickTrackings:e,clickThrough:f,adParameters:g,hlsParamValue:i,mediaFiles:j}}},{key:"rewrap",value:function(a){return a.wrapper?c.rewrap(a.wrapper):a}},{key:"extractMediaFile",value:function(a){var b={uri:Ba.getXmlText(a)};return["delivery","type","codec","id","apiFramework"].forEach(function(c){var d=Ba.getXmlAttr(a,c);d&&(b[c]=String(d))}),["width","height","bitrate","minBitrate","maxBitrate"].forEach(function(c){var d=Ba.getXmlAttr(a,c);d&&(b[c]=parseInt(d,10))}),["scalable","maintainAspectRatio"].forEach(function(c){var d=Ba.getXmlAttr(a,c);d&&(b[c]="true"===d)}),b}},{key:"fromWrapper",value:function(a){return a.wrapperLevel=a.wrapperLevel||0,a.wrapperLevel>=Da?new Promise(function(a,b){b(new Error(Ca))}):f(a.adTag).then(function(b){var d=new c(b);return d.wrapper=a,d.wrapperLevel=a.wrapperLevel+1,d.adTag?c.fromWrapper(d):d}).catch(function(c){var d=c.message===Ca;throw a.errorImpressions.forEach(function(a){return b(a.replace("[ERRORCODE]",d?"302":"300"))}),c.wrapper=c.wrapper||a,c})}},{key:"fromData",value:function(a){var b=new c(a);return b.adTag?c.fromWrapper(b):b}},{key:"augmentUrl",value:function(a){var b=String(a);return b.includes("//pubads.g.doubleclick.net")&&!s(b,"url")&&(b=u(b,"url",v())),b}},{key:"fromUrl",value:function(a){return f(c.augmentUrl(a)).then(c.fromData)}}]),c}(Ba),Fa=encodeURIComponent,Ga=encodeURIComponent,Ha=function(){function a(b){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};W(this,a),this.adUnitId=b,this.expectedPostrollType=c.postrollType||"vast",this.master={},this.preroll={},this.postroll={},this.masterUrl=void 0,this.masterError=void 0,this.prerollError=void 0,this.postrollError=void 0}return X(a,[{key:"getHlsParams",value:function(){var a=[],b=this.postroll,c=this.preroll;return c.hlsParamValue&&a.push("preroll="+Ga(c.hlsParamValue)),b.hlsParamValue&&a.push("postroll="+Ga(b.hlsParamValue)),a.join("&")}},{key:"getPostrollType",value:function(){return this.postroll&&this.postroll.type||this.expectedPostrollType}},{key:"getPostrollConstructor",value:function(){switch(this.expectedPostrollType){case"ima":return ya;case"stitched":return Ea;case"vast":return Ea;case"vpaid":return Ea;default:throw new Error("Unrecognized postroll type: "+this.expectedPostrollType)}}},{key:"getPostrollMediaFiles",value:function(){return[].concat(this.postroll.mediaFiles||[]).map(function(a){var b=a.type,c=a.width,d=a.height,e=a.bitrate,f=a.uri;return{type:b,width:c,height:d,bitrate:e,url:f}})}},{key:"getPostrollCollection",value:function(a){var b=this.postroll;return[].concat(b.getCollectedProperty?b.getCollectedProperty(a):b[a]||[])}},{key:"getPostrollWrapper",value:function(){return this.postroll&&this.postroll.getWrapper&&this.postroll.getWrapper()||this.postroll}},{key:"getData",value:function(){var a=this.master,b=this.preroll,c=this.postroll;return{lineItemId:a.lineItemId,creativeId:a.creativeId,prerollUrl:a.prerollUrl&&this.addAdUnitToUrl(a.prerollUrl),prerollImpressions:[].concat(b.impressions||[]),prerollClickDestination:b.clickDestination,postrollType:this.getPostrollType(),postrollUrl:a.postrollUrl&&this.addAdUnitToUrl(a.postrollUrl),postrollQ0Impressions:this.getPostrollCollection("q0Impressions"),postrollQ1Impressions:this.getPostrollCollection("q1Impressions"),postrollQ2Impressions:this.getPostrollCollection("q2Impressions"),postrollQ3Impressions:this.getPostrollCollection("q3Impressions"),postrollQ4Impressions:this.getPostrollCollection("q4Impressions"),postrollPauseImpressions:this.getPostrollCollection("pauseImpressions"),postrollResumeImpressions:this.getPostrollCollection("resumeImpressions"),postrollMuteImpressions:this.getPostrollCollection("muteImpressions"),postrollUnmuteImpressions:this.getPostrollCollection("unmuteImpressions"),postrollSkipImpressions:this.getPostrollCollection("skipImpressions"),postrollErrorImpressions:this.getPostrollCollection("errorImpressions"),postrollClickImpressions:this.getPostrollCollection("clickImpressions"),postrollClickDestination:c.clickDestination,postrollMediaFiles:this.getPostrollMediaFiles(),postrollAdParameters:c.adParameters,companionTargetingValue:a.companionTargetingValue,hlsParams:this.getHlsParams()}}},{key:"getSecurityChecks",value:function(){var a=this.getData();return ta.extends({"master view impression":this.master.impressionUrl,"preroll ad request":a.prerollUrl,"preroll click destination":a.prerollClickDestination,"postroll ad request":a.postrollUrl,"postroll click destination":a.postrollClickDestination},y(a.prerollImpressions,function(a){return"preroll view impression "+(a+1)}),y(a.postrollQ0Impressions,function(a){return"postroll q0 impression "+(a+1)}),y(a.postrollQ1Impressions,function(a){return"postroll q1 impression "+(a+1)}),y(a.postrollQ2Impressions,function(a){return"postroll q2 impression "+(a+1)}),y(a.postrollQ3Impressions,function(a){return"postroll q3 impression "+(a+1)}),y(a.postrollQ4Impressions,function(a){return"postroll q4 impression "+(a+1)}),y(a.postrollPauseImpressions,function(a){return"postroll pause impression "+(a+1)}),y(a.postrollResumeImpressions,function(a){return"postroll resume impression "+(a+1)}),y(a.postrollMuteImpressions,function(a){return"postroll mute impression "+(a+1)}),y(a.postrollUnmuteImpressions,function(a){return"postroll unmute impression "+(a+1)}),y(a.postrollSkipImpressions,function(a){return"postroll skip impression "+(a+1)}),y(a.postrollErrorImpressions,function(a){return"postroll error impression "+(a+1)}),y(a.postrollClickImpressions,function(a){return"postroll click impression "+(a+1)}),y(a.postrollMediaFiles.map(function(a){return a.url}),function(a){return"postroll media file "+(a+1)}))}},{key:"addAdUnitToUrl",value:function(a){return a.replace("{adUnit}",this.adUnitId)}},{key:"checkSecurity",value:function(){var a=this.master,b=this.preroll,c=this.postroll,d=this.getSecurityChecks(),e=this.getPostrollWrapper();Object.getOwnPropertyNames(d).forEach(function(f){C(d[f],{message:f+" is insecure",master_line_item_id:a&&a.lineItemId||"",master_creative_id:a&&a.creativeId||"",preroll_line_item_id:b&&b.lineItemId||"",preroll_creative_id:b&&b.creativeId||"",postroll_line_item_id:e&&e.lineItemId||"",postroll_creative_id:e&&e.creativeId||"",postroll_ad_system:c&&c.adSystem||"",postroll_ad_id:c&&c.adId||"",postroll_ad_title:c&&c.adTitle||""})})}},{key:"loadMaster",value:function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.masterUrl=wa.makeUrl({adUnitId:this.adUnitId,targeting:b}),wa.fromUrl(this.masterUrl).then(function(b){return a.master=b,a}).catch(function(b){throw a.masterError=b,b})}},{key:"loadPreroll",value:function(){var a=this,b=this.addAdUnitToUrl(this.master.prerollUrl);return xa.fromUrl(b).then(function(b){return a.preroll=b,a}).catch(function(b){return a.prerollError=b,a})}},{key:"loadPostroll",value:function(){var a=this,b=this.addAdUnitToUrl(this.master.postrollUrl),c=this.getPostrollConstructor();return c.fromUrl(b).then(function(b){return a.postroll=b,a}).catch(function(b){return a.postrollError=b,a})}}]),a}(),Ia=function(){function a(){W(this,a)}return X(a,[{key:"render",value:function(){var a=this;if(!this.rendered){this.rendered=!0,this.showing=!0;var b=document.createElement("div");ta.extends(b.style,{position:"fixed",bottom:"0",right:"0",transition:"0.3s right",width:"calc(100% - 2rem)",height:"200px",background:"#F5F5F5",borderLeft:"1px solid #CCC",borderTop:"1px solid #CCC",zIndex:99999999}),this.wrapper=b;var c=document.createElement("div");ta.extends(c.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",overflowY:"scroll",color:"#333",font:"13px/17px Helvetica,Arial,sans-serif",fontWeight:300}),c.innerHTML='<h3 style="margin:10px;">Master Ad Debugger</h3>',b.appendChild(c),this.content=c;var d=document.createElement("div");ta.extends(d.style,{display:"inline-block",background:"#F5F5F5",border:"1px solid #CCC",borderBottom:"none",color:"#666",font:"0.8rem/1.8rem Helvetica,Arial,sans-serif",letterSpacing:"0.2ex",verticalAlign:"middle",cursor:"pointer",padding:"0 0.5rem",
height:"1.8rem",position:"absolute",left:"-1.8rem",top:"-1px",transformOrigin:"top left",transform:"rotate(270deg) translateX(-100%)"}),d.innerHTML="MAD ",b.appendChild(d),d.addEventListener("click",function(){a.toggle()}),D(function(){return document.body.appendChild(b)})}}},{key:"show",value:function(){this.wrapper.style.right="0",this.showing=!0}},{key:"hide",value:function(){this.wrapper.style.right="calc(-100% + 2rem)",this.showing=!1}},{key:"toggle",value:function(){this.showing?this.hide():this.show()}},{key:"append",value:function(a){this.render(),this.content.appendChild(a)}}]),a}(),Ja="font-weight:bold; margin-bottom:5px;",Ka="display:block; margin-bottom:2px; white-space:nowrap; overflow-x:hidden;",La=Ka+" color:#C00;",Ma="color:#777;",Na="background:#E0E0E0; border:1px solid #CCC; border-radius:5px; margin:10px 0; padding:10px;",Oa="margin:-10px -10px 10px; padding:8px 10px;",Pa="font-weight:lighter; text-align:left; padding:2px 5px;",Qa=encodeURIComponent,Ra=new Ia,Sa=void 0,Ta=void 0;x("mad")&&O(),("undefined"!=typeof window&&window||{}).debugMasterAd=function(){return O(),window.console&&window.console.log&&window.console.log("%c The Master Ad Debugger is now open at the bottom of the main page!","background:#0000EF;color:white;padding:2px 6px"),Ta},a.loadAd=P,a.default=P,Object.defineProperty(a,"__esModule",{value:!0})}),define("player/postroll-client/action-overrides",["jquery"],function(a){"use strict";function b(b,d){this.player=b,this.isActive=!1,this.actions={};var e=a.extend({},c,d||{});for(var f in e)e.hasOwnProperty(f)&&this.override(f,e[f])}var c={play:a.noop,pause:a.noop,volume:a.noop,mute:a.noop,subtitle:a.noop,seek:a.noop,contentTime:a.noop,playNext:a.noop,playPrev:a.noop,playTalk:a.noop,popOut:a.noop},d=[];return a.extend(b.prototype,{activate:function(){this.isActive=!0},deactivate:function(){this.isActive=!1},override:function(a,b){var c=this,e=c.player[a]||function(){};if(!c.actions.hasOwnProperty(a)){var f=function(){return(c.isActive&&c.actions[a]?c.actions[a]:e).apply(c.player,d.slice.apply(arguments))};f.early=e.early,f.sourcer=e.sourcer,c.player[a]=f}"undefined"!=typeof b&&(c.actions[a]=b)}}),b}),define("player/postroll-client/fire-impression",["jquery"],function(a){"use strict";var b={};return b.byKey=function(c,d,e){if(c){var f=c[d];if(f){if(e=e||b.atUrl,c[d]=null,!a.isArray(f))return void e(f);for(var g=f.length;g--;)e(f[g])}}},b.byProgress=function(a,c){c>0&&b.byKey(a,"postrollQ0Impressions"),c>=.25&&b.byKey(a,"postrollQ1Impressions"),c>=.5&&b.byKey(a,"postrollQ2Impressions"),c>=.75&&b.byKey(a,"postrollQ3Impressions"),c>=1&&b.byKey(a,"postrollQ4Impressions")},b.atUrl=function(a){(new Image).src=a},b.postrollErrors=function(a,c){b.byKey(a,"postrollErrorImpressions",function(a){b.atUrl(a.replace("[ERRORCODE]",c?c:"900"))})},b}),define("player/clickOverlay",["jquery"],function(a){"use strict";function b(){var b=this;b.$el=a('<a href="#" target="_blank"></a>').css({display:"none",position:"absolute",top:"0",left:"0",width:"100%",height:"100%"}).on("click",function(){b._onClick()})}return a.extend(b.prototype,{show:function(a,b){a&&(this.clickImpressions="string"==typeof b?[b]:b,this.$el.attr("href",a).css("display","block"))},hide:function(){this.$el.hide()},_onClick:function(){if(this.clickImpressions&&this.clickImpressions.length){var a=this.clickImpressions,c=a.length;for(this.clickImpressions=[];c--;)b.fireImpression(a[c])}}}),b.fireImpression=function(a){(new Image).src=a},b.forPlayer=function(c){return c._clickOverlay||(c._clickOverlay=new b,a(c.el).after(c._clickOverlay.$el)),c._clickOverlay},b}),define("player/throttle",["jquery"],function(a){"use strict";return function(b,c,d,e){var f,g=0;"boolean"!=typeof c&&(e=d,d=c,c=void 0);var h=function(){function a(){g=+new Date,d.apply(i,k)}function h(){f=void 0}var i=this,j=+new Date-g,k=arguments;e&&!f&&a(),f&&clearTimeout(f),void 0===e&&j>b?a():c!==!0&&(f=setTimeout(e?h:a,void 0===e?b-j:b))};return a.guid&&(h.guid=d.guid=d.guid||a.guid++),h}}),define("player/postroll-client/vast-handler",["jquery","./action-overrides","./fire-impression","../clickOverlay","../throttle"],function(a,b,c,d,e){"use strict";function f(a){this.player=a,this.isListening=!1,this.isRolling=!1}var g=function(){var a=document.createElement("video");return function(b){return!!(b&&a.canPlayType&&a.canPlayType(b).replace(/^no$/,""))}}();return a.extend(f.prototype,{abandonAd:function(){this.isRolling?this.onAdEnded():this.clearAd()},clearAd:function(){this.maiAd=null},loadAd:function(b){this.clearAd(),b&&"vast"===b.postrollType&&(this.maiAd=a.extend(!0,{},b))},hasAd:function(){return!(!this.maiAd||!this.getPlayableMediaUrl())},startAd:function(){this.player._unsetSource(),this.addListeners(),this.onAdStart();var a=this.getPlayableMediaUrl();return a?(this.player.el.src=a,void this.player.el.play()):(this.log("No playable media found"),c.postrollErrors(this.maiAd,"403"),void this.onAdError())},getPlayableMediaUrl:function(){var a=(this.maiAd&&this.maiAd.postrollMediaFiles||[]).filter(function(a){return g(a.type)}),b=a&&a.length;if(b){var c=a[0].url,d=a[0].width;if(1===b)return c;for(var e=this.player.el,f=Math.min(1280,e.width||e.clientWidth||e.offsetwidth||320),h=Math.min((this.player.topic("metricsData.bitrate").read()||0)/1024,1100);b--;)a[b].width<f&&a[b].width>d&&a[b].bitrate<=h&&(c=a[b].url,d=a[b].width);return c}},getActionOverrides:function(){var a=this;if(a.actionOverrides)return a.actionOverrides;var c={play:function(){a.player.el.play()},pause:function(){a.player.el.pause()},volume:!1,mute:!1};return a.actionOverrides=new b(a.player,c),a.actionOverrides},addListeners:function(){function b(){g===Number(g)&&(d.player.topic("postrollDuration").publishUnique(g),f===Number(f)&&(d.player.topic("postrollRemaining").publishUnique(Math.max(g-f,0)),f>=.5&&c.byProgress(d.maiAd,(f+1)/g)))}var d=this;if(!d.isListening){d.isListening=!0;var f,g,h=d.player.el,i=a(h);i.on("timeupdate",e(200,function(){d.isRolling?(f=h.currentTime,b()):f=null})),i.on("durationchange",function(){d.isRolling?(g=h.duration,b()):g=null}),i.on("ended",function(){d.isRolling&&(c.byKey(d.maiAd,"postrollQ0Impressions"),c.byKey(d.maiAd,"postrollQ1Impressions"),c.byKey(d.maiAd,"postrollQ2Impressions"),c.byKey(d.maiAd,"postrollQ3Impressions"),c.byKey(d.maiAd,"postrollQ4Impressions"),d.onAdComplete()),f=null,g=null}),i.on("error",function(){d.isRolling&&(d.log("Error encountered during media playback"),c.postrollErrors(d.maiAd,"405"),d.onAdError()),f=null,g=null})}},log:function(a,b){this.player.throwError({type:"vast",message:"VAST: "+a,postrollMedia:this.getPlayableMediaUrl()||this.maiAd&&this.maiAd.mediaFiles&&this.maiAd.mediaFiles.length&&this.maiAd.mediaFiles[0].url||"",status:b&&b.message?b.message:""})},onAdStart:function(){this.player.topic("postrollStart").publish(),this.getActionOverrides().activate(),this.isRolling=!0,d.forPlayer(this.player).show(this.maiAd.postrollClickDestination,this.maiAd.postrollClickImpressions)},onAdComplete:function(){this.onAdEnded()},onAdError:function(){c.postrollErrors(this.maiAd,"900"),this.onAdEnded()},onAdEnded:function(){this.getActionOverrides().deactivate(),this.player.topic("postrollComplete").publish(),this.clearAd(),d.forPlayer(this.player).hide(),this.isRolling=!1}}),f}),function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define("vpaid-html5-client",[],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.VPAIDHTML5Client=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a,b,c){}function e(a,b,c){Object.defineProperty(a,b,{writable:!1,configurable:!1,value:c})}var f=["handshakeVersion","initAd","startAd","stopAd","skipAd","resizeAd","pauseAd","resumeAd","expandAd","collapseAd","subscribe","unsubscribe"],g=["AdLoaded","AdStarted","AdStopped","AdSkipped","AdSkippableStateChange","AdSizeChange","AdLinearChange","AdDurationChange","AdExpandedChange","AdRemainingTimeChange","AdVolumeChange","AdImpression","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdClickThru","AdInteraction","AdUserAcceptInvitation","AdUserMinimize","AdUserClose","AdPaused","AdPlaying","AdLog","AdError"],h=["getAdLinear","getAdWidth","getAdHeight","getAdExpanded","getAdSkippableState","getAdRemainingTime","getAdDuration","getAdVolume","getAdCompanions","getAdIcons"],i=["setAdVolume"];d.prototype.handshakeVersion=function(a,b){},d.prototype.initAd=function(a,b,c,d,e,f,g){},d.prototype.startAd=function(a){},d.prototype.stopAd=function(a){},d.prototype.skipAd=function(a){},d.prototype.resizeAd=function(a,b,c,d){},d.prototype.pauseAd=function(a){},d.prototype.resumeAd=function(a){},d.prototype.expandAd=function(a){},d.prototype.collapseAd=function(a){},d.prototype.subscribe=function(a,b,c){},d.prototype.unsubscribe=function(a,b){},d.prototype.getAdLinear=function(a){},d.prototype.getAdWidth=function(a){},d.prototype.getAdHeight=function(a){},d.prototype.getAdExpanded=function(a){},d.prototype.getAdSkippableState=function(a){},d.prototype.getAdRemainingTime=function(a){},d.prototype.getAdDuration=function(a){},d.prototype.getAdVolume=function(a){},d.prototype.getAdCompanions=function(a){},d.prototype.getAdIcons=function(a){},d.prototype.setAdVolume=function(a,b){},e(d,"METHODS",f),e(d,"GETTERS",h),e(d,"SETTERS",i),e(d,"EVENTS",g);var j=f.filter(function(a){return["skipAd"].indexOf(a)===-1});e(d,"checkVPAIDInterface",function(a){var b=j.every(function(b){return"function"==typeof a[b]});return b}),b.exports=d},{}],2:[function(a,b,c){"use strict";function d(a,b,c,d){this._isValid=k(a),this._isValid&&(this._creative=a,this._el=b,this._videoEl=c,this._iframe=d,this._subscribers=new j,l.setFullSizeStyle(b),e.call(this))}function e(){if(o.forEach(function(a){this._creative.subscribe(g.bind(this,a),a)}.bind(this)),this._creative.subscribe(f.bind(this),n),this._videoEl){var a=this._iframe.contentDocument.documentElement,b=this._videoEl;a.addEventListener("click",function(c){c.target===a&&b.click()})}}function f(a,b,c){this._subscribers.triggerSync(n,{url:a,id:b,playerHandles:c})}function g(a){this._subscribers.trigger(a,Array.prototype.slice(arguments,1))}function h(a,b,c,d){a?a(c,d):c&&b.trigger(m,c)}var i=a("./IVPAIDAdUnit"),j=a("./subscriber"),k=i.checkVPAIDInterface,l=a("./utils"),m=(i.METHODS,"AdError"),n="AdClickThru",o=i.EVENTS.filter(function(a){return a!=n});d.prototype=Object.create(i.prototype),d.prototype.isValidVPAIDAd=function(){return this._isValid},i.METHODS.forEach(function(a){var b=["subscribe","unsubscribe","initAd"];b.indexOf(a)===-1&&(d.prototype[a]=function(){var b=i.prototype[a].length,c=Array.prototype.slice.call(arguments),d=b===c.length?c.pop():void 0;setTimeout(function(){var b,e=null;try{b=this._creative[a].apply(this._creative,c)}catch(a){e=a}h(d,this._subscribers,e,b)}.bind(this),0)})}),d.prototype.initAd=function(a,b,c,d,e,f,g){e=e||{},f=l.extend({slot:this._el,videoSlot:this._videoEl},f||{}),setTimeout(function(){var i;try{this._creative.initAd(a,b,c,d,e,f)}catch(a){i=a}h(g,this._subscribers,i)}.bind(this),0)},d.prototype.subscribe=function(a,b,c){this._subscribers.subscribe(b,a,c)},d.prototype.unsubscribe=function(a,b){this._subscribers.unsubscribe(b,a)},d.prototype.on=d.prototype.subscribe,d.prototype.off=d.prototype.unsubscribe,i.GETTERS.forEach(function(a){d.prototype[a]=function(b){setTimeout(function(){var c,d=null;try{c=this._creative[a]()}catch(a){d=a}h(b,this._subscribers,d,c)}.bind(this),0)}}),d.prototype.setAdVolume=function(a,b){setTimeout(function(){var c,d=null;try{this._creative.setAdVolume(a),c=this._creative.getAdVolume()}catch(a){d=a}d||(d=l.validate(c===a,"failed to apply volume: "+a)),h(b,this._subscribers,d,c)}.bind(this),0)},d.prototype._destroy=function(){this.stopAd(),this._subscribers.unsubscribeAll()},b.exports=d},{"./IVPAIDAdUnit":1,"./subscriber":4,"./utils":5}],3:[function(a,b,c){"use strict";function d(a,b,c,d){c=c||{},this._id=n(),this._destroyed=!1,this._frameContainer=m.createElementInEl(a,"div"),this._videoEl=b,this._vpaidOptions=d||{timeout:1e4},this._templateConfig={template:c.template||p,extraOptions:c.extraOptions||{}}}function e(a){var b=this[a];b&&b.parentNode&&(b.parentNode.removeChild(b),delete this[a])}function f(){h.call(this),delete this._adUnit}function g(){h.call(this),j.call(this)}function h(){e.call(this,"_frame"),i.call(this)}function i(){this._onLoad&&(window.removeEventListener("message",this._onLoad),delete this._onLoad)}function j(){this._adUnit&&(this._adUnit.stopAd(),delete this._adUnit)}function k(){if(this._destroyed)throw new Error("VPAIDHTML5Client already destroyed!")}function l(){var a=window.parent.location;return a.origin||a.protocol+"//"+a.hostname+(a.port?":"+a.port:"")}var m=a("./utils"),n=m.unique("vpaidIframe"),o=a("./VPAIDAdUnit"),p='<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"></head><body style="margin:0;padding:0"><div class="ad-element"></div><script type="text/javascript" src="{{iframeURL_JS}}"></script><script type="text/javascript">window.parent.postMessage(\'{"event": "ready", "id": "{{iframeID}}"}\', \'{{origin}}\');</script></body></html>',q="AdStopped";d.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,g.call(this))},d.prototype.isDestroyed=function(){return this._destroyed},d.prototype.loadAdUnit=function(a,b){function c(a){if(a.origin===l()){try{var c=JSON.parse(a.data)}catch(a){return}if(c.id===e.getID()){var d,g,h;if(e._frame.contentWindow?(h=e._frame.contentWindow.getVPAIDAd,g=m.validate("function"==typeof h,"the ad didn't return a function to create an ad")):g="the iframe is not anymore in the DOM tree",!g){var j=e._frame.contentWindow.document.querySelector(".ad-element");d=new o(h(),j,e._videoEl,e._frame),d.subscribe(q,f.bind(e)),g=m.validate(d.isValidVPAIDAd(),"the add is not fully complaint with VPAID specification")}return e._adUnit=d,i.call(e),b(g,g?null:d),!0}}}function d(){b("timeout",null)}if(!this._onLoad){k.call(this),g.call(this);var e=this,h=m.createIframeWithContent(this._frameContainer,this._templateConfig.template,m.extend({iframeURL_JS:a,iframeID:this.getID(),origin:l()},this._templateConfig.extraOptions));this._frame=h,this._onLoad=m.callbackTimeout(this._vpaidOptions.timeout,c.bind(this),d.bind(this)),window.addEventListener("message",this._onLoad)}},d.prototype.unloadAdUnit=function(){g.call(this)},d.prototype.getID=function(){return this._id},b.exports=d,window.VPAIDHTML5Client=d},{"./VPAIDAdUnit":2,"./utils":5}],4:[function(a,b,c){"use strict";function d(){this._subscribers={}}d.prototype.subscribe=function(a,b,c){this.isHandlerAttached(a,b)||this.get(b).push({handler:a,context:c,eventName:b})},d.prototype.unsubscribe=function(a,b){this._subscribers[b]=this.get(b).filter(function(b){return a!==b.handler})},d.prototype.unsubscribeAll=function(){this._subscribers={}},d.prototype.trigger=function(a,b){var c=this,d=this.get(a).concat(this.get("*"));d.forEach(function(a){setTimeout(function(){c.isHandlerAttached(a.handler,a.eventName)&&a.handler.call(a.context,b)},0)})},d.prototype.triggerSync=function(a,b){var c=this.get(a).concat(this.get("*"));c.forEach(function(a){a.handler.call(a.context,b)})},d.prototype.get=function(a){return this._subscribers[a]||(this._subscribers[a]=[]),this._subscribers[a]},d.prototype.isHandlerAttached=function(a,b){return this.get(b).some(function(b){return a===b.handler})},b.exports=d},{}],5:[function(a,b,c){"use strict";function d(){}function e(a,b){return a?null:new Error(b)}function f(a,b,c){var e,f;return f=setTimeout(function(){b=d,c()},a),e=function(){b.apply(this,arguments)&&clearTimeout(f)}}function g(a,b,c){var d=document.createElement(b);return c&&(d.id=c),a.appendChild(d),d}function h(a,b,c){var d=i(a,null,c.zIndex);if(l(d,k(b,c)))return d}function i(a,b,c){var d=document.createElement("iframe");return d.src=b||"about:blank",d.marginWidth="0",d.marginHeight="0",d.frameBorder="0",d.width="100%",d.height="100%",j(d),c&&(d.style.zIndex=c),d.setAttribute("SCROLLING","NO"),a.innerHTML="",a.appendChild(d),d}function j(a){a&&(a.style.position="absolute",a.style.left="0",a.style.top="0",a.style.margin="0px",a.style.padding="0px",a.style.border="none",a.style.width="100%",a.style.height="100%")}function k(a,b){return Object.keys(b).forEach(function(c){var d="object"==typeof d?JSON.stringify(b[c]):b[c];a=a.replace(new RegExp("{{"+c+"}}","g"),d)}),a}function l(a,b){var c=a.contentWindow&&a.contentWindow.document;return!!c&&(c.write(b),!0)}function m(a,b){return Object.keys(b).forEach(function(c){a[c]=b[c]}),a}function n(a){var b=-1;return function(){return a+"_"+ ++b}}b.exports={noop:d,validate:e,callbackTimeout:f,createElementInEl:g,createIframeWithContent:h,createIframe:i,setFullSizeStyle:j,simpleTemplate:k,setIframeContent:l,extend:m,unique:n}},{}]},{},[3])(3)}),define("player/postroll-client/vpaid-handler",["jquery","./action-overrides","./fire-impression","../throttle","vpaid-html5-client"],function(a,b,c,d,e){"use strict";function f(b){this.actionOverrides=null,this.adUnit=null,this.client=null,this.isListening=null,this.isRolling=!1,this.maiAd=null,this.player=b,this.tickInterval=null,this.$overlay=null,this.adTimeouts={},this.boundAdDurationCallback=a.proxy(this.unboundAdDurationCallback,this),this.boundAdRemainingTimeCallback=a.proxy(this.unboundAdRemainingTimeCallback,this),this.boundAdVolumeCallback=a.proxy(this.unboundAdVolumeCallback,this)}function g(a){return a=Number(a),a<1e-4&&(a=0),a>.9999&&(a=1),a}var h="HANDSHAKE_TO_VERSION",i="INIT_AD_TO_AD_LOADED",j="START_AD_TO_AD_STARTED";return a.extend(f.prototype,{abandonAd:function(){this.isRolling?this.onAdEnded():this.clearAd()},clearAd:function(){this.client&&this.adUnit&&this.client.unloadAdUnit(),this.adUnit=null,this.maiAd=null},loadAd:function(b){var c=this;if(c.clearAd(),b&&"vpaid"===b.postrollType){c.maiAd=a.extend(!0,{},b);var d=c.getMediaUrl(),e=c.getClient();d?e.loadAdUnit(d,function(a,b){a?(c.logIfRolling("Error loading ad unit for "+d,a),c.onAdError()):c.adUnit=b}):c.clearAd()}},hasAd:function(){return!(!this.maiAd||!this.getMediaUrl())},startAd:function(){var a=this;return a.player._unsetSource(),a.addElementListeners(),a.player.topic("postrollStart").publish(),a.getActionOverrides().activate(),a.resetTicking(),a.isRolling=!0,a.adUnit?void a.rollAdUnit():a.onAdError()},getMediaUrl:function(){var a=(this.maiAd.postrollMediaFiles||[]).filter(function(a){return"application/javascript"===a.type});if(a&&a[0])return a[0].url},getClient:function(){return this.client||(this.$overlay=a("<div></div>").css({position:"absolute",top:"0",left:"0",width:"100%",height:"100%"}).hide(),a(this.player.el).after(this.$overlay),this.client=new e(this.$overlay.get(0),this.player.el)),this.client},getActionOverrides:function(){var a=this;if(a.actionOverrides)return a.actionOverrides;var c={play:function(){a.adUnit&&a.adUnit.resumeAd()},pause:function(){a.adUnit&&a.adUnit.pauseAd()},volume:function(b){a.adUnit&&a.setVolume(b)},mute:function(b){a.adUnit&&a.setMute(!!b)}};return a.actionOverrides=new b(a.player,c),a.actionOverrides},getViewSize:function(){var a=this.player.el,b=a.height||a.clientHeight||a.offsetHeight,c=a.width||a.clientWidth||a.offsetwidth,d="normal";return b<320&&(d="thumbnail"),this.player.isFullScreen&&(d="fullscreen"),{width:c,height:b,viewMode:d}},setVolume:function(a){a=g(a),this.player.el.muted=0===a,this.adUnit.setAdVolume(a)},setMute:function(a){this.setVolume(a?0:this.player.topic("volume").read()||1)},resetTicking:function(){var a=this;a.stopTicking(),a.tickInterval=setInterval(function(){a.onAdTick()},200)},stopTicking:function(){this.tickInterval&&(clearInterval(this.tickInterval),this.tickInterval=null)},addElementListeners:function(){function b(){c.isRolling&&c.onViewResize()}var c=this;c.isListening||(c.isListening=!0,a(window).on("resize",d(200,b)),c.player.topic("enterFullScreen").subscribe(b),c.player.topic("exitFullScreen").subscribe(b))},unboundAdDurationCallback:function(a,b){a||Number(b)===b&&this.player.topic("postrollDuration").publishUnique(b)},unboundAdRemainingTimeCallback:function(a,b){a||Number(b)===b&&b>=0&&this.player.topic("postrollRemaining").publishUnique(b)},unboundAdVolumeCallback:function(a,b){if(!a){b=g(b);var c=b<=0;this.player.topic("muted").publishUnique(c),b>0&&this.player.topic("volume").publishUnique(b)}},log:function(a,b){this.player.throwError({type:"vpaid",message:"VPAID: "+a,status:b&&b.message?b.message:""})},logIfRolling:function(a,b){this.isRolling&&this.log(a,b)},clearAdTimeout:function(a){this.adTimeouts[a]&&(window.clearTimeout(this.adTimeouts[a]),this.adTimeouts[a]=null)},startAdTimeout:function(a){var b=this;b.adTimeouts[a]&&b.clearAdTimeout(a),b.adTimeouts[a]=window.setTimeout(function(){b.logIfRolling("Timeout expired: "+a),b.onAdError()},3e3)},onAdComplete:function(){this.onAdEnded()},onAdError:function(){this.isRolling&&this.player._unsetSource(),this.onAdEnded()},onAdEnded:function(){this.$overlay&&this.$overlay.hide(),this.stopTicking(),this.getActionOverrides().deactivate(),this.isRolling&&this.player.topic("postrollComplete").publish(),this.clearAd(),this.isRolling=!1},onAdTick:function(){this.tickInterval&&this.adUnit&&(this.adUnit.getAdDuration(this.boundAdDurationCallback),this.adUnit.getAdRemainingTime(this.boundAdRemainingTimeCallback))},onViewResize:function(){if(this.adUnit){var a=this.getViewSize();this.adUnit.resizeAd(a.width,a.height,a.viewMode)}},rollAdUnit:function(){var a=this,b=a.adUnit;b.subscribe("AdDurationChange",function(){a.onAdTick()}),b.subscribe("AdClickThru",function(){c.byKey(a.maiAd,"postrollClickImpressions")}),b.subscribe("AdError",function(b){a.isRolling&&(a.log("AdError event received",b),c.postrollErrors(a.maiAd,"901")),a.onAdError()}),b.subscribe("AdImpression",function(){}),b.subscribe("AdPaused",function(){c.byKey(a.maiAd,"postrollPauseImpressions")}),b.subscribe("AdPlaying",function(){c.byKey(a.maiAd,"postrollResumeImpressions")}),b.subscribe("AdSkipped",function(){a.onAdComplete()}),b.subscribe("AdStopped",function(){a.onAdComplete()}),b.subscribe("AdVideoComplete",function(){c.byKey(a.maiAd,"postrollQ4Impressions"),a.onAdComplete()}),b.subscribe("AdVideoStart",function(){c.byKey(a.maiAd,"postrollQ0Impressions");var b=a.player.topic("muted").read(),d=a.player.topic("volume").read();d&&!b?a.setVolume(d):a.setMute(!0),a.$overlay.show()}),b.subscribe("AdVideoFirstQuartile",function(){c.byKey(a.maiAd,"postrollQ1Impressions")}),b.subscribe("AdVideoMidpoint",function(){c.byKey(a.maiAd,"postrollQ2Impressions")}),b.subscribe("AdVideoThirdQuartile",function(){c.byKey(a.maiAd,"postrollQ3Impressions")}),b.subscribe("AdVolumeChange",function(){a.adUnit.getAdVolume(a.boundAdVolumeCallback)}),b.subscribe("AdStarted",function(){a.clearAdTimeout(j)}),b.subscribe("AdLoaded",function(){a.clearAdTimeout(i),a.startAdTimeout(j),b.startAd(function(b){b&&(a.logIfRolling("Start ad callback received error",b),a.onAdError())})}),a.startAdTimeout(h),b.handshakeVersion("2.0",function(c){if(a.clearAdTimeout(h),c)return a.logIfRolling("Error in handshake",c),a.onAdError();var d=a.getViewSize(),e=a.maiAd.postrollAdParameters;a.startAdTimeout(i),b.initAd(d.width,d.height,d.viewMode,-1,{AdParameters:e},{},function(b){b&&(a.logIfRolling("Error initializing ad",b),a.onAdError())})})}}),f}),define("player/postroll-client/index",["jquery","./vast-handler","./vpaid-handler"],function(a,b,c){"use strict";function d(a){this._player=a,this._vast=new b(a),this._vpaid=new c(a)}return a.extend(d.prototype,{abandon:function(){this._vast.abandonAd(),this._vpaid.abandonAd()},clearAd:function(){this._vast.clearAd(),this._vpaid.clearAd()},loadAd:function(a){this._vast.loadAd(a),this._vpaid.loadAd(a)},hasAd:function(){return this._vast.hasAd()||this._vpaid.hasAd()},startAd:function(){this._vast.hasAd()?this._vast.startAd():this._vpaid.hasAd()&&this._vpaid.startAd()}}),d.forPlayer=function(a){return a._postrollClient||(a._postrollClient=new d(a)),a._postrollClient},d}),define("player/hlsInitTalk",["jquery","ted-master-ad-interface","./postroll-client/index"],function(a,b,c){"use strict";function d(a,b,c){c&&(b+=(b.indexOf("?")===-1?"?":"&")+c),a._setSource(b)}return function(e,f){var g,h,i=new a.Deferred,j=i.promise();try{g=e.currentTalk.resources.hls.stream,h=e.currentTalk.resources.hls.adUrl}catch(a){return e.throwError({type:"init",message:"Missing HLS stream resource.",severity:"fatal"}),i.reject(),j}if(!e.options.mai)return d(e,g),i.resolve(),j;var k,l=e.currentTalk.resources.hls,m={postrollType:e.options.maiPostrollType},n=l.maiTargeting||{};try{k=e.options.maiAdUnitId}catch(a){return e.throwError({type:"init",message:"Missing MAI ad unit ID.",severity:"fatal"}),i.reject(),j}var o=c.forPlayer(e);return e.maiAd=void 0,o.clearAd(),b.loadAd(k,n,m).then(function(a){e.maiAd=a,o.loadAd(a),e.topic("ad").publish({type:"master",target:a.companionTargetingValue}),d(e,g,a.hlsParams),i.resolve()}).catch(function(a){e.throwError({message:"Error retrieving MAI ad",status:"MAI: "+a.message}),d(e,g),i.resolve()}),j}}),define("player/replaceElement",["jquery","./getFlashVars","./hlsInitTalk","../vendor/swfobject"],function(a,b,c,d){"use strict";function e(a){return a.id||(a.id="ted-player-"+j++),a.id}function f(a){var c={bgcolor:"#000000",quality:"high",wmode:"opaque",allowscriptaccess:"always",allowfullscreen:"true"},f=a.options,g=e(f.el);if("OBJECT"!==f.el.nodeName){var h=b(a),i=f.attrs;c.flashvars=h,i.data=f.swf,d.createSWF(i,c,g)}a.el=document.getElementById(g),a.topic("ready.dom").publish()}function g(b){var c,d=b.options,f=a("<video>"),g=e(d.el);b.currentTalk=d.talks[0],c=b.currentTalk.resources.h264[0].file,f.attr(d.attrs),f.attr("preload","none"),f.attr("id",g),a(d.el).replaceWith(f),b.el=f[0],b._setSource(c),b.topic("ready.dom").publish()}function h(b){var d=b.options,f=a("<video>"),g=e(d.el);b.currentTalk=d.talks[0],f.attr(d.attrs),f.attr("id",g),a(d.el).replaceWith(f),b.el=f[0],c(b,f).always(function(){b.topic("ready.dom").publish()})}function i(b){var d=b.options,f=a("<video>"),g=e(d.el);b.currentTalk=d.talks[0],f.attr(d.attrs),f.attr("id",g),f.attr("crossorigin","anonymous"),a(d.el).replaceWith(f),b.el=f[0],c(b,f).always(function(){b.topic("ready.dom").publish()})}var j=Math.floor(9999*Math.random()),k={flash:f,h264:g,hls:h,hlsjs:i};return function(a){return k[a.mode]?k[a.mode](a):void a.throwError({type:"init",message:"Cannot replace element for unrecognized player mode: "+a.mode,severity:"fatal"})}}),function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define("hlsjs",[],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Hls=a()}}(function(){var a;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||a<0||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;var k=new Error('Uncaught, unspecified "error" event. ('+b+")");throw k.context=b,k}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:f=Array.prototype.slice.call(arguments,1),c.apply(this,f)}else if(g(c))for(f=Array.prototype.slice.call(arguments,1),j=c.slice(),d=j.length,i=0;i<d;i++)j[i].apply(this,f);return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned&&(c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())),this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-- >0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(d<0)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else if(c)for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.prototype.listenerCount=function(a){if(this._events){var b=this._events[a];if(e(b))return 1;if(b)return b.length}return 0},d.listenerCount=function(a,b){return a.listenerCount(b)}},{}],2:[function(b,c,d){!function(b){var e=/^((?:[^\/;?#]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,f=/^([^\/;?#]*)(.*)$/,g=/(?:\/|^)\.(?=\/)/g,h=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,i={buildAbsoluteURL:function(a,b,c){if(c=c||{},a=a.trim(),b=b.trim(),!b){if(!c.alwaysNormalize)return a;var d=this.parseURL(a);if(!g)throw new Error("Error trying to parse base URL.");return d.path=i.normalizePath(d.path),i.buildURLFromParts(d)}var e=this.parseURL(b);if(!e)throw new Error("Error trying to parse relative URL.");if(e.scheme)return c.alwaysNormalize?(e.path=i.normalizePath(e.path),i.buildURLFromParts(e)):b;var g=this.parseURL(a);if(!g)throw new Error("Error trying to parse base URL.");
if(!g.netLoc&&g.path&&"/"!==g.path[0]){var h=f.exec(g.path);g.netLoc=h[1],g.path=h[2]}g.netLoc&&!g.path&&(g.path="/");var j={scheme:g.scheme,netLoc:e.netLoc,path:null,params:e.params,query:e.query,fragment:e.fragment};if(!e.netLoc&&(j.netLoc=g.netLoc,"/"!==e.path[0]))if(e.path){var k=g.path,l=k.substring(0,k.lastIndexOf("/")+1)+e.path;j.path=i.normalizePath(l)}else j.path=g.path,e.params||(j.params=g.params,e.query||(j.query=g.query));return null===j.path&&(j.path=c.alwaysNormalize?i.normalizePath(e.path):e.path),i.buildURLFromParts(j)},parseURL:function(a){var b=e.exec(a);return b?{scheme:b[1]||"",netLoc:b[2]||"",path:b[3]||"",params:b[4]||"",query:b[5]||"",fragment:b[6]||""}:null},normalizePath:function(a){for(a=a.split("").reverse().join("").replace(g,"");a.length!==(a=a.replace(h,"")).length;);return a.split("").reverse().join("")},buildURLFromParts:function(a){return a.scheme+a.netLoc+a.path+a.params+a.query+a.fragment}};"object"==typeof d&&"object"==typeof c?c.exports=i:"function"==typeof a&&a.amd?a([],function(){return i}):"object"==typeof d?d.URLToolkit=i:b.URLToolkit=i}(this)},{}],3:[function(a,b,c){var d=arguments[3],e=arguments[4],f=arguments[5],g=JSON.stringify;b.exports=function(a,b){function c(a){q[a]=!0;for(var b in e[a][1]){var d=e[a][1][b];q[d]||c(d)}}for(var h,i=Object.keys(f),j=0,k=i.length;j<k;j++){var l=i[j],m=f[l].exports;if(m===a||m&&m.default===a){h=l;break}}if(!h){h=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var n={},j=0,k=i.length;j<k;j++){var l=i[j];n[l]=l}e[h]=[Function(["require","module","exports"],"("+a+")(self)"),n]}var o=Math.floor(Math.pow(16,8)*Math.random()).toString(16),p={};p[h]=h,e[o]=[Function(["require"],"var f = require("+g(h)+");(f.default ? f.default : f)(self);"),p];var q={};c(o);var r="("+d+")({"+Object.keys(q).map(function(a){return g(a)+":["+e[a][0]+","+g(e[a][1])+"]"}).join(",")+"},{},["+g(o)+"])",s=window.URL||window.webkitURL||window.mozURL||window.msURL,t=new Blob([r],{type:"text/javascript"});if(b&&b.bare)return t;var u=s.createObjectURL(t),v=new Worker(u);return v.objectURL=u,v}},{}],4:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0}),c.hlsDefaultConfig=void 0;var e=a(5),f=d(e),g=a(8),h=d(g),i=a(9),j=d(i),k=a(10),l=d(k),m=a(58),n=d(m),o=a(7),p=d(o),q=a(6),r=d(q),s=a(50),t=d(s),u=a(16),v=d(u),w=a(15),x=d(w),y=a(14),z=d(y);c.hlsDefaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,maxSeekHole:2,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.2,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:n.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:f.default,bufferController:h.default,capLevelController:j.default,fpsController:l.default,audioStreamController:r.default,audioTrackController:p.default,subtitleStreamController:z.default,subtitleTrackController:x.default,timelineController:v.default,cueHandler:t.default,enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",stretchShortVideoTrack:!1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0}},{10:10,14:14,15:15,16:16,5:5,50:50,58:58,6:6,7:7,8:8,9:9}],5:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(35),j=d(i),k=a(34),l=d(k),m=a(37),n=d(m),o=a(33),p=a(53),q=a(51),r=d(q),s=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,j.default.FRAG_LOADING,j.default.FRAG_LOADED,j.default.FRAG_BUFFERED,j.default.ERROR));return c.lastLoadedFragLevel=0,c._nextAutoLevel=-1,c.hls=a,c.onCheck=c._abandonRulesCheck.bind(c),c}return g(b,a),h(b,[{key:"destroy",value:function(){this.clearTimer(),l.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(a){var b=a.frag;if("main"===b.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this._bwEstimator){var c=this.hls,d=a.frag.level,e=c.levels[d].details.live,f=c.config,g=void 0,h=void 0;e?(g=f.abrEwmaFastLive,h=f.abrEwmaSlowLive):(g=f.abrEwmaFastVoD,h=f.abrEwmaSlowVoD),this._bwEstimator=new r.default(c,h,g,f.abrEwmaDefaultEstimate)}this.fragCurrent=b}}},{key:"_abandonRulesCheck",value:function(){var a=this.hls,b=a.media,c=this.fragCurrent,d=c.loader,e=a.minAutoLevel;if(!d||d.stats&&d.stats.aborted)return p.logger.warn("frag loader destroy or aborted, disarm abandonRules"),void this.clearTimer();var f=d.stats;if(b&&(!b.paused&&0!==b.playbackRate||!b.readyState)&&c.autoLevel&&c.level){var g=performance.now()-f.trequest,h=Math.abs(b.playbackRate);if(g>500*c.duration/h){var i=a.levels,k=Math.max(1,f.bw?f.bw/8:1e3*f.loaded/g),l=i[c.level],m=l.realBitrate?Math.max(l.realBitrate,l.bitrate):l.bitrate,o=f.total?f.total:Math.max(f.loaded,Math.round(c.duration*m/8)),q=b.currentTime,r=(o-f.loaded)/k,s=(n.default.bufferInfo(b,q,a.config.maxBufferHole).end-q)/h;if(s<2*c.duration/h&&r>s){var t=void 0,u=void 0;for(u=c.level-1;u>e;u--){var v=i[u].realBitrate?Math.max(i[u].realBitrate,i[u].bitrate):i[u].bitrate;if(t=c.duration*v/(6.4*k),t<s)break}t<r&&(p.logger.warn("loading too slow, abort fragment loading and switch to level "+u+":fragLoadedDelay["+u+"]<fragLoadedDelay["+(c.level-1)+"];bufferStarvationDelay:"+t.toFixed(1)+"<"+r.toFixed(1)+":"+s.toFixed(1)),a.nextLoadLevel=u,this._bwEstimator.sample(g,f.loaded),d.abort(),this.clearTimer(),a.trigger(j.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:c,stats:f}))}}}}},{key:"onFragLoaded",value:function(a){var b=a.frag;if("main"===b.type&&!isNaN(b.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=b.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var c=this.hls.levels[b.level],d=(c.loaded?c.loaded.bytes:0)+a.stats.loaded,e=(c.loaded?c.loaded.duration:0)+a.frag.duration;c.loaded={bytes:d,duration:e},c.realBitrate=Math.round(8*d/e)}if(a.frag.bitrateTest){var f=a.stats;f.tparsed=f.tbuffered=f.tload,this.onFragBuffered(a)}}}},{key:"onFragBuffered",value:function(a){var b=a.stats,c=a.frag;if(!(b.aborted===!0||1!==c.loadCounter||"main"!==c.type||isNaN(c.sn)||c.bitrateTest&&b.tload!==b.tbuffered)){var d=b.tparsed-b.trequest;p.logger.log("latency/loading/parsing/append/kbps:"+Math.round(b.tfirst-b.trequest)+"/"+Math.round(b.tload-b.tfirst)+"/"+Math.round(b.tparsed-b.tload)+"/"+Math.round(b.tbuffered-b.tparsed)+"/"+Math.round(8*b.loaded/(b.tbuffered-b.trequest))),this._bwEstimator.sample(d,b.loaded),b.bwEstimate=this._bwEstimator.getEstimate(),c.bitrateTest?this.bitrateTestDelay=d/1e3:this.bitrateTestDelay=0}}},{key:"onError",value:function(a){switch(a.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}}},{key:"clearTimer",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"_findBestLevel",value:function(a,b,c,d,e,f,g,h,i){for(var j=e;j>=d;j--){var k=i[j],l=k.details,m=l?l.totalduration/l.fragments.length:b,n=!!l&&l.live,o=void 0;o=j<=a?g*c:h*c;var q=i[j].realBitrate?Math.max(i[j].realBitrate,i[j].bitrate):i[j].bitrate,r=q*m/o;if(p.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+j+"/"+Math.round(o)+"/"+q+"/"+m+"/"+f+"/"+r),o>q&&(!r||n||r<f))return j}return-1}},{key:"nextAutoLevel",get:function(){var a=this._nextAutoLevel,b=this._bwEstimator;if(!(a===-1||b&&b.canEstimate()))return a;var c=this._nextABRAutoLevel;return a!==-1&&(c=Math.min(a,c)),c},set:function(a){this._nextAutoLevel=a}},{key:"_nextABRAutoLevel",get:function(){var a=this.hls,b=a.maxAutoLevel,c=a.levels,d=a.config,e=a.minAutoLevel,f=a.media,g=this.lastLoadedFragLevel,h=this.fragCurrent?this.fragCurrent.duration:0,i=f?f.currentTime:0,j=f&&0!==f.playbackRate?Math.abs(f.playbackRate):1,k=this._bwEstimator?this._bwEstimator.getEstimate():d.abrEwmaDefaultEstimate,l=(n.default.bufferInfo(f,i,d.maxBufferHole).end-i)/j,m=this._findBestLevel(g,h,k,e,b,l,d.abrBandWidthFactor,d.abrBandWidthUpFactor,c);if(m>=0)return m;p.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var o=h?Math.min(h,d.maxStarvationDelay):d.maxStarvationDelay,q=d.abrBandWidthFactor,r=d.abrBandWidthUpFactor;if(0===l){var s=this.bitrateTestDelay;if(s){var t=h?Math.min(h,d.maxLoadingDelay):d.maxLoadingDelay;o=t-s,p.logger.trace("bitrate test took "+Math.round(1e3*s)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*o)+" ms"),q=r=1}}return m=this._findBestLevel(g,h,k,e,b,l+o,q,r,c),Math.max(m,0)}}]),b}(l.default);c.default=s},{33:33,34:34,35:35,37:37,51:51,53:53}],6:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(48),j=d(i),k=a(37),l=d(k),m=a(25),n=d(m),o=a(35),p=d(o),q=a(34),r=d(q),s=a(38),t=d(s),u=a(54),v=d(u),w=a(33),x=a(53),y={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"},z=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,p.default.MEDIA_ATTACHED,p.default.MEDIA_DETACHING,p.default.AUDIO_TRACKS_UPDATED,p.default.AUDIO_TRACK_SWITCHING,p.default.AUDIO_TRACK_LOADED,p.default.KEY_LOADED,p.default.FRAG_LOADED,p.default.FRAG_PARSING_INIT_SEGMENT,p.default.FRAG_PARSING_DATA,p.default.FRAG_PARSED,p.default.ERROR,p.default.BUFFER_CREATED,p.default.BUFFER_APPENDED,p.default.BUFFER_FLUSHED,p.default.INIT_PTS_FOUND));return c.config=a.config,c.audioCodecSwap=!1,c.ticks=0,c._state=y.STOPPED,c.ontick=c.tick.bind(c),c.initPTS=[],c.waitingFragment=null,c}return g(b,a),h(b,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),r.default.prototype.destroy.call(this),this.state=y.STOPPED}},{key:"onInitPtsFound",value:function(a){var b=a.id,c=a.frag.cc,d=a.initPTS;"main"===b&&(this.initPTS[c]=d,x.logger.log("InitPTS for cc:"+c+" found from video track:"+d),this.state===y.WAITING_INIT_PTS&&(x.logger.log("sending pending audio frag to demuxer"),this.state=y.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null))}},{key:"startLoad",value:function(a){if(this.tracks){var b=this.lastCurrentTime;this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.fragLoadError=0,b>0&&a===-1?(x.logger.log("audio:override startPosition with lastCurrentTime @"+b.toFixed(3)),this.state=y.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:a,this.state=y.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=a,this.state=y.STOPPED}},{key:"stopLoad",value:function(){var a=this.fragCurrent;a&&(a.loader&&a.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=y.STOPPED}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){var a,b,c,d=this.hls,e=d.config;switch(this.state){case y.ERROR:case y.PAUSED:case y.BUFFER_FLUSHING:break;case y.STARTING:this.state=y.WAITING_TRACK,this.loadedmetadata=!1;break;case y.IDLE:var f=this.tracks;if(!f)break;if(!this.media&&(this.startFragRequested||!e.startFragPrefetch))break;a=this.loadedmetadata?this.media.currentTime:this.nextLoadPosition;var g=this.mediaBuffer?this.mediaBuffer:this.media,h=l.default.bufferInfo(g,a,e.maxBufferHole),i=h.len,k=h.end,m=this.fragPrevious,n=e.maxMaxBufferLength,o=this.audioSwitch,q=this.trackId;if((i<n||o)&&q<f.length){if(c=f[q].details,"undefined"==typeof c){this.state=y.WAITING_TRACK;break}if(!o&&!c.live&&m&&m.sn===c.endSN&&(!this.media.seeking||this.media.duration-k<m.duration/2)){this.hls.trigger(p.default.BUFFER_EOS,{type:"audio"}),this.state=y.ENDED;break}var r=c.fragments,s=r.length,t=r[0].start,u=r[s-1].start+r[s-1].duration,v=void 0;if(o)if(c.live&&!c.PTSKnown)x.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),k=0;else if(k=a,c.PTSKnown&&a<t){if(!(h.end>t||h.nextStart))return;x.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=t+.05}if(c.initSegment&&!c.initSegment.data)v=c.initSegment;else if(k<=t){if(v=r[0],c.live&&v.loadIdx&&v.loadIdx===this.fragLoadIdx){var z=h.nextStart?h.nextStart:t;return x.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(z+.05)),void(this.media.currentTime=z+.05)}}else{var A=void 0,B=e.maxFragLookUpTolerance,C=m?r[m.sn-r[0].sn+1]:void 0,D=function(a){var b=Math.min(B,a.duration);return a.start+a.duration-b<=k?1:a.start-b>k&&a.start?-1:0};k<u?(k>u-B&&(B=0),A=C&&!D(C)?C:j.default.search(r,D)):A=r[s-1],A&&(v=A,t=A.start,m&&v.level===m.level&&v.sn===m.sn&&(v.sn<c.endSN?(v=r[v.sn+1-c.startSN],x.logger.log("SN just loaded, load next one: "+v.sn)):v=null))}if(v)if(v.decryptdata&&null!=v.decryptdata.uri&&null==v.decryptdata.key)x.logger.log("Loading key for "+v.sn+" of ["+c.startSN+" ,"+c.endSN+"],track "+q),this.state=y.KEY_LOADING,d.trigger(p.default.KEY_LOADING,{frag:v});else{if(x.logger.log("Loading "+v.sn+" of ["+c.startSN+" ,"+c.endSN+"],track "+q+", currentTime:"+a+",bufferEnd:"+k.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,v.loadCounter){v.loadCounter++;var E=e.fragLoadingLoopThreshold;if(v.loadCounter>E&&Math.abs(this.fragLoadIdx-v.loadIdx)<E)return void d.trigger(p.default.ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:v})}else v.loadCounter=1;v.loadIdx=this.fragLoadIdx,this.fragCurrent=v,this.startFragRequested=!0,isNaN(v.sn)||(this.nextLoadPosition=v.start+v.duration),d.trigger(p.default.FRAG_LOADING,{frag:v}),this.state=y.FRAG_LOADING}}break;case y.WAITING_TRACK:b=this.tracks[this.trackId],b&&b.details&&(this.state=y.IDLE);break;case y.FRAG_LOADING_WAITING_RETRY:var F=performance.now(),G=this.retryDate;g=this.media;var H=g&&g.seeking;(!G||F>=G||H)&&(x.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=y.IDLE);break;case y.WAITING_INIT_PTS:case y.STOPPED:case y.FRAG_LOADING:case y.PARSING:case y.PARSED:case y.ENDED:}}},{key:"onMediaAttached",value:function(a){var b=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),b.addEventListener("seeking",this.onvseeking),b.addEventListener("ended",this.onvended);var c=this.config;this.tracks&&c.autoStartLoad&&this.startLoad(c.startPosition)}},{key:"onMediaDetaching",value:function(){var a=this.media;a&&a.ended&&(x.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var b=this.tracks;b&&b.forEach(function(a){a.details&&a.details.fragments.forEach(function(a){a.loadCounter=void 0})}),a&&(a.removeEventListener("seeking",this.onvseeking),a.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){this.state===y.ENDED&&(this.state=y.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()}},{key:"onMediaEnded",value:function(){this.startPosition=this.lastCurrentTime=0}},{key:"onAudioTracksUpdated",value:function(a){x.logger.log("audio tracks updated"),this.tracks=a.audioTracks}},{key:"onAudioTrackSwitching",value:function(a){var b=!!a.url;this.trackId=a.id,this.state=y.IDLE,this.fragCurrent=null,this.state=y.PAUSED,this.waitingFragment=null,b?this.timer||(this.timer=setInterval(this.ontick,100)):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),b&&(this.audioSwitch=!0,this.state=y.IDLE,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold)),this.tick()}},{key:"onAudioTrackLoaded",value:function(a){var b=a.details,c=a.id,d=this.tracks[c],e=b.totalduration,f=0;if(x.logger.log("track "+c+" loaded ["+b.startSN+","+b.endSN+"],duration:"+e),b.live){var g=d.details;g&&b.fragments.length>0?(t.default.mergeDetails(g,b),f=b.fragments[0].start,b.PTSKnown?x.logger.log("live audio playlist sliding:"+f.toFixed(3)):x.logger.log("live audio playlist - outdated PTS, unknown sliding")):(b.PTSKnown=!1,x.logger.log("live audio playlist - first load, unknown sliding"))}else b.PTSKnown=!1;if(d.details=b,!this.startFragRequested){if(this.startPosition===-1){var h=b.startTimeOffset;isNaN(h)?this.startPosition=0:(x.logger.log("start time offset found in playlist, adjust startPosition to "+h),this.startPosition=h)}this.nextLoadPosition=this.startPosition}this.state===y.WAITING_TRACK&&(this.state=y.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===y.KEY_LOADING&&(this.state=y.IDLE,this.tick())}},{key:"onFragLoaded",value:function(a){var b=this.fragCurrent,c=a.frag;if(this.state===y.FRAG_LOADING&&b&&"audio"===c.type&&c.level===b.level&&c.sn===b.sn){var d=this.tracks[this.trackId],e=d.details,f=e.totalduration,g=b.level,h=b.sn,i=b.cc,j=this.config.defaultAudioCodec||d.audioCodec||"mp4a.40.2",k=this.stats=a.stats;if("initSegment"===h)this.state=y.IDLE,k.tparsed=k.tbuffered=performance.now(),e.initSegment.data=a.payload,this.hls.trigger(p.default.FRAG_BUFFERED,{stats:k,frag:b,id:"audio"}),this.tick();else{this.state=y.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new n.default(this.hls,"audio"));var l=this.initPTS[i],m=e.initSegment?e.initSegment.data:[];if(e.initSegment||void 0!==l){this.pendingBuffering=!0,x.logger.log("Demuxing "+h+" of ["+e.startSN+" ,"+e.endSN+"],track "+g);var o=!1;this.demuxer.push(a.payload,m,j,null,b,f,o,l)}else x.logger.log("unknown video PTS for continuity counter "+i+", waiting for video PTS before demuxing audio frag "+h+" of ["+e.startSN+" ,"+e.endSN+"],track "+g),this.waitingFragment=a,this.state=y.WAITING_INIT_PTS}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(a){var b=this.fragCurrent,c=a.frag;if(b&&"audio"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===y.PARSING){var d=a.tracks,e=void 0;if(d.video&&delete d.video,e=d.audio){e.levelCodec="mp4a.40.2",e.id=a.id,this.hls.trigger(p.default.BUFFER_CODECS,d),x.logger.log("audio track:audio,container:"+e.container+",codecs[level/parsed]=["+e.levelCodec+"/"+e.codec+"]");var f=e.initSegment;if(f){var g={type:"audio",data:f,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[g]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(p.default.BUFFER_APPENDING,g))}this.tick()}}}},{key:"onFragParsingData",value:function(a){var b=this,c=this.fragCurrent,d=a.frag;if(c&&"audio"===a.id&&"audio"===a.type&&d.sn===c.sn&&d.level===c.level&&this.state===y.PARSING){var e=this.trackId,f=this.tracks[e],g=this.hls;isNaN(a.endPTS)&&(a.endPTS=a.startPTS+c.duration,a.endDTS=a.startDTS+c.duration),x.logger.log("parsed "+a.type+",PTS:["+a.startPTS.toFixed(3)+","+a.endPTS.toFixed(3)+"],DTS:["+a.startDTS.toFixed(3)+"/"+a.endDTS.toFixed(3)+"],nb:"+a.nb),t.default.updateFragPTSDTS(f.details,c,a.startPTS,a.endPTS);var h=this.audioSwitch,i=this.media,j=!1;if(h&&i)if(i.readyState){var k=i.currentTime;x.logger.log("switching audio track : currentTime:"+k),k>=a.startPTS&&(x.logger.log("switching audio track : flushing all audio"),this.state=y.BUFFER_FLUSHING,g.trigger(p.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),j=!0,this.audioSwitch=!1,g.trigger(p.default.AUDIO_TRACK_SWITCHED,{id:e}))}else this.audioSwitch=!1,g.trigger(p.default.AUDIO_TRACK_SWITCHED,{id:e});var l=this.pendingData;this.audioSwitch||([a.data1,a.data2].forEach(function(b){b&&b.length&&l.push({type:a.type,data:b,parent:"audio",content:"data"})}),!j&&l.length&&(l.forEach(function(a){b.state===y.PARSING&&(b.pendingBuffering=!0,b.hls.trigger(p.default.BUFFER_APPENDING,a))}),this.pendingData=[],this.appended=!0)),this.tick()}}},{key:"onFragParsed",value:function(a){var b=this.fragCurrent,c=a.frag;b&&"audio"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===y.PARSING&&(this.stats.tparsed=performance.now(),this.state=y.PARSED,this._checkAppendedParsed())}},{key:"onBufferCreated",value:function(a){var b=a.tracks.audio;b&&(this.mediaBuffer=b.buffer,this.loadedmetadata=!0)}},{key:"onBufferAppended",value:function(a){if("audio"===a.parent){var b=this.state;b!==y.PARSING&&b!==y.PARSED||(this.pendingBuffering=a.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){if(!(this.state!==y.PARSED||this.appended&&this.pendingBuffering)){var a=this.fragCurrent,b=this.stats,c=this.hls;if(a){this.fragPrevious=a,b.tbuffered=performance.now(),c.trigger(p.default.FRAG_BUFFERED,{stats:b,frag:a,id:"audio"});var d=this.mediaBuffer?this.mediaBuffer:this.media;x.logger.log("audio buffered : "+v.default.toString(d.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,c.trigger(p.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=y.IDLE}this.tick()}}},{key:"onError",value:function(a){var b=a.frag;if(!b||"audio"===b.type)switch(a.details){case w.ErrorDetails.FRAG_LOAD_ERROR:case w.ErrorDetails.FRAG_LOAD_TIMEOUT:if(!a.fatal){var c=this.fragLoadError;c?c++:c=1;var d=this.config;if(c<=d.fragLoadingMaxRetry){this.fragLoadError=c,b.loadCounter=0;var e=Math.min(Math.pow(2,c-1)*d.fragLoadingRetryDelay,d.fragLoadingMaxRetryTimeout);x.logger.warn("audioStreamController: frag loading failed, retry in "+e+" ms"),this.retryDate=performance.now()+e,this.state=y.FRAG_LOADING_WAITING_RETRY}else x.logger.error("audioStreamController: "+a.details+" reaches max retry, redispatch as fatal ..."),a.fatal=!0,this.state=y.ERROR}break;case w.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case w.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case w.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case w.ErrorDetails.KEY_LOAD_ERROR:case w.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==y.ERROR&&(this.state=a.fatal?y.ERROR:y.IDLE,x.logger.warn("audioStreamController: "+a.details+" while loading frag,switch to "+this.state+" state ..."));break;case w.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===a.parent&&(this.state===y.PARSING||this.state===y.PARSED)){var f=this.mediaBuffer,g=this.media.currentTime,h=f&&l.default.isBuffered(f,g)&&l.default.isBuffered(f,g+.5);if(h){var i=this.config;i.maxMaxBufferLength>=i.maxBufferLength&&(i.maxMaxBufferLength/=2,x.logger.warn("audio:reduce max buffer length to "+i.maxMaxBufferLength+"s"),this.fragLoadIdx+=2*i.fragLoadingLoopThreshold),this.state=y.IDLE}else x.logger.warn("buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=y.BUFFER_FLUSHING,this.hls.trigger(p.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}}},{key:"onBufferFlushed",value:function(){var a=this,b=this.pendingData;b&&b.length?(x.logger.log("appending pending audio data on Buffer Flushed"),b.forEach(function(b){a.hls.trigger(p.default.BUFFER_APPENDING,b)}),this.appended=!0,this.pendingData=[],this.state=y.PARSED):(this.state=y.IDLE,this.fragPrevious=null,this.tick())}},{key:"state",set:function(a){if(this.state!==a){var b=this.state;this._state=a,x.logger.log("audio stream:"+b+"->"+a)}},get:function(){return this._state}}]),b}(r.default);c.default=z},{25:25,33:33,34:34,35:35,37:37,38:38,48:48,53:53,54:54}],7:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(35),j=d(i),k=a(34),l=d(k),m=a(53),n=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,j.default.MANIFEST_LOADING,j.default.MANIFEST_LOADED,j.default.AUDIO_TRACK_LOADED));return c.ticks=0,c.ontick=c.tick.bind(c),c}return g(b,a),h(b,[{key:"destroy",value:function(){l.default.prototype.destroy.call(this)}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){this.updateTrack(this.trackId)}},{key:"onManifestLoading",value:function(){this.tracks=[],this.trackId=-1}},{key:"onManifestLoaded",value:function(a){var b=this,c=a.audioTracks||[],d=!1;this.tracks=c,this.hls.trigger(j.default.AUDIO_TRACKS_UPDATED,{audioTracks:c});var e=0;c.forEach(function(a){return a.default?(b.audioTrack=e,void(d=!0)):void e++}),d===!1&&c.length&&(m.logger.log("no default audio track defined, use first audio track as default"),this.audioTrack=0)}},{key:"onAudioTrackLoaded",value:function(a){a.id<this.tracks.length&&(m.logger.log("audioTrack "+a.id+" loaded"),this.tracks[a.id].details=a.details,a.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*a.details.targetduration)),!a.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))}},{key:"setAudioTrackInternal",value:function(a){if(a>=0&&a<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=a,m.logger.log("switching to audioTrack "+a);var b=this.tracks[a],c=this.hls,d=b.type,e=b.url,f={id:a,type:d,url:e};c.trigger(j.default.AUDIO_TRACK_SWITCH,f),c.trigger(j.default.AUDIO_TRACK_SWITCHING,f);var g=b.details;!e||void 0!==g&&g.live!==!0||(m.logger.log("(re)loading playlist for audioTrack "+a),c.trigger(j.default.AUDIO_TRACK_LOADING,{url:e,id:a}))}}},{key:"updateTrack",value:function(a){if(a>=0&&a<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=a,m.logger.log("updating audioTrack "+a);var b=this.tracks[a],c=b.url,d=b.details;!c||void 0!==d&&d.live!==!0||(m.logger.log("(re)loading playlist for audioTrack "+a),this.hls.trigger(j.default.AUDIO_TRACK_LOADING,{url:c,id:a}))}}},{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this.trackId},set:function(a){this.trackId===a&&void 0!==this.tracks[a].details||this.setAudioTrackInternal(a)}}]),b}(l.default);c.default=n},{34:34,35:35,53:53}],8:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(35),j=d(i),k=a(34),l=d(k),m=a(53),n=a(33),o=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,j.default.MEDIA_ATTACHING,j.default.MEDIA_DETACHING,j.default.MANIFEST_PARSED,j.default.BUFFER_RESET,j.default.BUFFER_APPENDING,j.default.BUFFER_CODECS,j.default.BUFFER_EOS,j.default.BUFFER_FLUSHING,j.default.LEVEL_PTS_UPDATED,j.default.LEVEL_UPDATED));return c._msDuration=null,c._levelDuration=null,c.onsbue=c.onSBUpdateEnd.bind(c),c.onsbe=c.onSBUpdateError.bind(c),c.pendingTracks={},c.tracks={},c}return g(b,a),h(b,[{key:"destroy",value:function(){l.default.prototype.destroy.call(this)}},{key:"onLevelPtsUpdated",value:function(a){var b=a.type,c=this.tracks.audio;if("audio"===b&&c&&"audio/mpeg"===c.container){var d=this.sourceBuffer.audio,e=Math.abs(d.timestampOffset-a.start);if(e>.1){var f=d.updating;try{d.abort()}catch(a){f=!0,m.logger.warn("can not abort audio buffer: "+a)}f?this.audioTimestampOffset=a.start:(m.logger.warn("change mpeg audio timestamp offset from "+d.timestampOffset+" to "+a.start),d.timestampOffset=a.start)}}}},{key:"onManifestParsed",value:function(a){var b=a.audio,c=a.video,d=0;a.altAudio&&(b||c)&&(d=(b?1:0)+(c?1:0),m.logger.log(d+" sourceBuffer(s) expected")),this.sourceBufferNb=d}},{key:"onMediaAttaching",value:function(a){var b=this.media=a.media;if(b){var c=this.mediaSource=new MediaSource;
this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),c.addEventListener("sourceopen",this.onmso),c.addEventListener("sourceended",this.onmse),c.addEventListener("sourceclose",this.onmsc),b.src=URL.createObjectURL(c)}}},{key:"onMediaDetaching",value:function(){m.logger.log("media source detaching");var a=this.mediaSource;if(a){if("open"===a.readyState)try{a.endOfStream()}catch(a){m.logger.warn("onMediaDetaching:"+a.message+" while calling endOfStream")}a.removeEventListener("sourceopen",this.onmso),a.removeEventListener("sourceended",this.onmse),a.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this.media.src),this.media.removeAttribute("src"),this.media.load()),this.mediaSource=null,this.media=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(j.default.MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function(){m.logger.log("media source opened"),this.hls.trigger(j.default.MEDIA_ATTACHED,{media:this.media});var a=this.mediaSource;a&&a.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()}},{key:"checkPendingTracks",value:function(){var a=this.pendingTracks,b=Object.keys(a).length;b&&(this.sourceBufferNb<=b||0===this.sourceBufferNb)&&(this.createSourceBuffers(a),this.pendingTracks={},this.doAppending())}},{key:"onMediaSourceClose",value:function(){m.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){m.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function(){if(this.audioTimestampOffset){var a=this.sourceBuffer.audio;m.logger.warn("change mpeg audio timestamp offset from "+a.timestampOffset+" to "+this.audioTimestampOffset),a.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var b=this.parent,c=this.segments.reduce(function(a,c){return c.parent===b?a+1:a},0);this.hls.trigger(j.default.BUFFER_APPENDED,{parent:b,pending:c}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()}},{key:"onSBUpdateError",value:function(a){m.logger.error("sourceBuffer error:",a),this.hls.trigger(j.default.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferReset",value:function(){var a=this.sourceBuffer;for(var b in a){var c=a[b];try{this.mediaSource.removeSourceBuffer(c),c.removeEventListener("updateend",this.onsbue),c.removeEventListener("error",this.onsbe)}catch(a){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}},{key:"onBufferCodecs",value:function(a){if(0===Object.keys(this.sourceBuffer).length){for(var b in a)this.pendingTracks[b]=a[b];var c=this.mediaSource;c&&"open"===c.readyState&&this.checkPendingTracks()}}},{key:"createSourceBuffers",value:function(a){var b=this.sourceBuffer,c=this.mediaSource;for(var d in a)if(!b[d]){var e=a[d],f=e.levelCodec||e.codec,g=e.container+";codecs="+f;m.logger.log("creating sourceBuffer("+g+")");try{var h=b[d]=c.addSourceBuffer(g);h.addEventListener("updateend",this.onsbue),h.addEventListener("error",this.onsbe),this.tracks[d]={codec:f,container:e.container},e.buffer=h}catch(a){m.logger.error("error while trying to add sourceBuffer:"+a.message),this.hls.trigger(j.default.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:a,mimeType:g})}}this.hls.trigger(j.default.BUFFER_CREATED,{tracks:a})}},{key:"onBufferAppending",value:function(a){this._needsFlush||(this.segments?this.segments.push(a):this.segments=[a],this.doAppending())}},{key:"onBufferAppendFail",value:function(a){m.logger.error("sourceBuffer error:",a.event),this.hls.trigger(j.default.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferEos",value:function(a){var b=this.sourceBuffer,c=a.type;for(var d in b)c&&d!==c||b[d].ended||(b[d].ended=!0,m.logger.log(d+" sourceBuffer now EOS"));this.checkEos()}},{key:"checkEos",value:function(){var a=this.sourceBuffer,b=this.mediaSource;if(!b||"open"!==b.readyState)return void(this._needsEos=!1);for(var c in a){var d=a[c];if(!d.ended)return;if(d.updating)return void(this._needsEos=!0)}m.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{b.endOfStream()}catch(a){m.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}},{key:"onBufferFlushing",value:function(a){this.flushRange.push({start:a.startOffset,end:a.endOffset,type:a.type}),this.flushBufferCounter=0,this.doFlush()}},{key:"onLevelUpdated",value:function(a){var b=a.details;0!==b.fragments.length&&(this._levelDuration=b.totalduration+b.fragments[0].start,this.updateMediaElementDuration())}},{key:"updateMediaElementDuration",value:function(){var a=this.media,b=this.mediaSource,c=this.sourceBuffer,d=this._levelDuration;if(null!==d&&a&&b&&c&&0!==a.readyState&&"open"===b.readyState){for(var e in c)if(c[e].updating)return;null===this._msDuration&&(this._msDuration=b.duration);var f=a.duration;(d>this._msDuration&&d>f||f===1/0||isNaN(f))&&(m.logger.log("Updating mediasource duration to "+d.toFixed(3)),this._msDuration=b.duration=d)}}},{key:"doFlush",value:function(){for(;this.flushRange.length;){var a=this.flushRange[0];if(!this.flushBuffer(a.start,a.end,a.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var b=0,c=this.sourceBuffer;try{for(var d in c)b+=c[d].buffered.length}catch(a){m.logger.error("error while accessing sourceBuffer.buffered")}this.appended=b,this.hls.trigger(j.default.BUFFER_FLUSHED)}}},{key:"doAppending",value:function(){var a=this.hls,b=this.sourceBuffer,c=this.segments;if(Object.keys(b).length){if(this.media.error)return this.segments=[],void m.logger.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(c&&c.length){var d=c.shift();try{var e=d.type,f=b[e];f?f.updating?c.unshift(d):(f.ended=!1,this.parent=d.parent,f.appendBuffer(d.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(b){m.logger.error("error while trying to append buffer:"+b.message),c.unshift(d);var g={type:n.ErrorTypes.MEDIA_ERROR,parent:d.parent};if(22===b.code)return this.segments=[],g.details=n.ErrorDetails.BUFFER_FULL_ERROR,g.fatal=!1,void a.trigger(j.default.ERROR,g);if(this.appendError?this.appendError++:this.appendError=1,g.details=n.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>a.config.appendErrorMaxRetry)return m.logger.log("fail "+a.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),c=[],g.fatal=!0,void a.trigger(j.default.ERROR,g);g.fatal=!1,a.trigger(j.default.ERROR,g)}}}}},{key:"flushBuffer",value:function(a,b,c){var d,e,f,g,h,i,j=this.sourceBuffer;if(Object.keys(j).length){if(m.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+a+"/"+b),this.flushBufferCounter<this.appended){for(var k in j)if(!c||k===c){if(d=j[k],d.ended=!1,d.updating)return m.logger.warn("cannot flush, sb updating in progress"),!1;try{for(e=0;e<d.buffered.length;e++)if(f=d.buffered.start(e),g=d.buffered.end(e),navigator.userAgent.toLowerCase().indexOf("firefox")!==-1&&b===Number.POSITIVE_INFINITY?(h=a,i=b):(h=Math.max(f,a),i=Math.min(g,b)),Math.min(i,g)-h>.5)return this.flushBufferCounter++,m.logger.log("flush "+k+" ["+h+","+i+"], of ["+f+","+g+"], pos:"+this.media.currentTime),d.remove(h,i),!1}catch(a){m.logger.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else m.logger.warn("abort flushing too many retries");m.logger.log("buffer flushed")}return!0}}]),b}(l.default);c.default=o},{33:33,34:34,35:35,53:53}],9:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(35),j=d(i),k=a(34),l=d(k),m=function(a){function b(a){return e(this,b),f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,j.default.FPS_DROP_LEVEL_CAPPING,j.default.MEDIA_ATTACHING,j.default.MANIFEST_PARSED))}return g(b,a),h(b,[{key:"destroy",value:function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))}},{key:"onFpsDropLevelCapping",value:function(a){this.restrictedLevels||(this.restrictedLevels=[]),this.isLevelRestricted(a.droppedLevel)||this.restrictedLevels.push(a.droppedLevel)}},{key:"onMediaAttaching",value:function(a){this.media=a.media instanceof HTMLVideoElement?a.media:null}},{key:"onManifestParsed",value:function(a){var b=this.hls;b.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=a.levels,b.firstLevel=this.getMaxLevel(a.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"detectPlayerSize",value:function(){if(this.media){var a=this.levels?this.levels.length:0;if(a){var b=this.hls;b.autoLevelCapping=this.getMaxLevel(a-1),b.autoLevelCapping>this.autoLevelCapping&&b.streamController.nextLevelSwitch(),this.autoLevelCapping=b.autoLevelCapping}}}},{key:"getMaxLevel",value:function(a){var b=0,c=void 0,d=void 0,e=this.mediaWidth,f=this.mediaHeight,g=0,h=0;for(c=0;c<=a&&(d=this.levels[c],!this.isLevelRestricted(c))&&(b=c,g=d.width,h=d.height,!(e<=g||f<=h));c++);return b}},{key:"isLevelRestricted",value:function(a){return!(!this.restrictedLevels||this.restrictedLevels.indexOf(a)===-1)}},{key:"contentScaleFactor",get:function(){var a=1;try{a=window.devicePixelRatio}catch(a){}return a}},{key:"mediaWidth",get:function(){var a=void 0,b=this.media;return b&&(a=b.width||b.clientWidth||b.offsetWidth,a*=this.contentScaleFactor),a}},{key:"mediaHeight",get:function(){var a=void 0,b=this.media;return b&&(a=b.height||b.clientHeight||b.offsetHeight,a*=this.contentScaleFactor),a}}]),b}(l.default);c.default=m},{34:34,35:35}],10:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(35),j=d(i),k=a(34),l=d(k),m=a(53),n=function(a){function b(a){return e(this,b),f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,j.default.MEDIA_ATTACHING))}return g(b,a),h(b,[{key:"destroy",value:function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1}},{key:"onMediaAttaching",value:function(a){var b=this.hls.config;if(b.capLevelOnFPSDrop){var c=this.video=a.media instanceof HTMLVideoElement?a.media:null;"function"==typeof c.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),b.fpsDroppedMonitoringPeriod)}}},{key:"checkFPS",value:function(a,b,c){var d=performance.now();if(b){if(this.lastTime){var e=d-this.lastTime,f=c-this.lastDroppedFrames,g=b-this.lastDecodedFrames,h=1e3*f/e,i=this.hls;if(i.trigger(j.default.FPS_DROP,{currentDropped:f,currentDecoded:g,totalDroppedFrames:c}),h>0&&f>i.config.fpsDroppedMonitoringThreshold*g){var k=i.currentLevel;m.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+k),k>0&&(i.autoLevelCapping===-1||i.autoLevelCapping>=k)&&(k-=1,i.trigger(j.default.FPS_DROP_LEVEL_CAPPING,{level:k,droppedLevel:i.currentLevel}),i.autoLevelCapping=k,i.streamController.nextLevelSwitch())}}this.lastTime=d,this.lastDroppedFrames=c,this.lastDecodedFrames=b}}},{key:"checkFPSInterval",value:function(){var a=this.video;if(a)if(this.isVideoPlaybackQualityAvailable){var b=a.getVideoPlaybackQuality();this.checkFPS(a,b.totalVideoFrames,b.droppedVideoFrames)}else this.checkFPS(a,a.webkitDecodedFrameCount,a.webkitDroppedFrameCount)}}]),b}(l.default);c.default=n},{34:34,35:35,53:53}],11:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(35),j=d(i),k=a(34),l=d(k),m=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,j.default.MEDIA_ATTACHED,j.default.MEDIA_DETACHING,j.default.FRAG_PARSING_METADATA));return c.id3Track=void 0,c.media=void 0,c}return g(b,a),h(b,[{key:"destroy",value:function(){l.default.prototype.destroy.call(this)}},{key:"onMediaAttached",value:function(a){this.media=a.media,this.media&&(this.id3Track=this.media.addTextTrack("metadata","id3"),this.id3Track.mode="hidden")}},{key:"onMediaDetaching",value:function(){this.media=void 0}},{key:"onFragParsingMetadata",value:function(a){var b=a.frag,c=a.samples,d=b.start,e=b.start+b.duration;d===e&&(e+=1e-4);for(var f=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,g=0;g<c.length;g++){var h=this.parseID3Frame(c[g].data),i=this.decodeID3Frame(h);if(i){var j=new f(d,e,"");j.value=i,this.id3Track.addCue(j)}}}},{key:"parseID3Frame",value:function(a){if(!(a.length<21)&&73===a[0]&&68===a[1]&&51===a[2]){var b=String.fromCharCode(a[10],a[11],a[12],a[13]);return a=a.subarray(20),{type:b,data:a}}}},{key:"decodeID3Frame",value:function(a){return"TXXX"===a.type?this.decodeTxxxFrame(a):"PRIV"===a.type?this.decodePrivFrame(a):"T"===a.type[0]?this.decodeTextFrame(a):void 0}},{key:"decodeTxxxFrame",value:function(a){if(!(a.size<2)&&3===a.data[0]){var b=1,c=this.utf8ArrayToStr(a.data.subarray(b));b+=c.length+1;var d=this.utf8ArrayToStr(a.data.subarray(b));return{key:"TXXX",description:c,data:d}}}},{key:"decodeTextFrame",value:function(a){if(!(a.size<2)&&3===a.data[0]){var b=a.data.subarray(1);return{key:a.type,data:this.utf8ArrayToStr(b)}}}},{key:"decodePrivFrame",value:function(a){if(!(a.size<2)){var b=this.utf8ArrayToStr(a.data),c=a.data.subarray(b.length+1);return{key:"PRIV",info:b,data:c.buffer}}}},{key:"utf8ArrayToStr",value:function(a){for(var b=void 0,c=void 0,d="",e=0,f=a.length;e<f;){var g=a[e++];switch(g>>4){case 0:return d;case 1:case 2:case 3:case 4:case 5:case 6:case 7:d+=String.fromCharCode(g);break;case 12:case 13:b=a[e++],d+=String.fromCharCode((31&g)<<6|63&b);break;case 14:b=a[e++],c=a[e++],d+=String.fromCharCode((15&g)<<12|(63&b)<<6|(63&c)<<0)}}return d}}]),b}(l.default);c.default=m},{34:34,35:35}],12:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(35),j=d(i),k=a(34),l=d(k),m=a(53),n=a(33),o=a(37),p=d(o),q=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,j.default.MANIFEST_LOADED,j.default.LEVEL_LOADED,j.default.FRAG_LOADED,j.default.ERROR));return c.ontick=c.tick.bind(c),c._manualLevel=-1,c}return g(b,a),h(b,[{key:"destroy",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this._manualLevel=-1}},{key:"startLoad",value:function(){this.canload=!0;var a=this._levels;a&&a.forEach(function(a){a.loadError=0;var b=a.details;b&&b.live&&(a.details=void 0)}),this.timer&&this.tick()}},{key:"stopLoad",value:function(){this.canload=!1}},{key:"onManifestLoaded",value:function(a){var b,c=[],d=[],e={},f=!1,g=!1,h=this.hls,i=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),k=function(a,b){return MediaSource.isTypeSupported(a+"/mp4;codecs="+b)};if(a.levels.forEach(function(a){a.videoCodec&&(f=!0),i&&a.audioCodec&&a.audioCodec.indexOf("mp4a.40.34")!==-1&&(a.audioCodec=void 0),(a.audioCodec||a.attrs&&a.attrs.AUDIO)&&(g=!0);var b=e[a.bitrate];void 0===b?(e[a.bitrate]=c.length,a.url=[a.url],a.urlId=0,c.push(a)):c[b].url.push(a.url)}),f&&g?c.forEach(function(a){a.videoCodec&&d.push(a)}):d=c,d=d.filter(function(a){var b=a.audioCodec,c=a.videoCodec;return(!b||k("audio",b))&&(!c||k("video",c))}),d.length){b=d[0].bitrate,d.sort(function(a,b){return a.bitrate-b.bitrate}),this._levels=d;for(var l=0;l<d.length;l++)if(d[l].bitrate===b){this._firstLevel=l,m.logger.log("manifest loaded,"+d.length+" level(s) found, first bitrate:"+b);break}h.trigger(j.default.MANIFEST_PARSED,{levels:d,firstLevel:this._firstLevel,stats:a.stats,audio:g,video:f,altAudio:a.audioTracks.length>0})}else h.trigger(j.default.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:h.url,reason:"no level with compatible codecs found in manifest"})}},{key:"setLevelInternal",value:function(a){var b=this._levels,c=this.hls;if(a>=0&&a<b.length){if(this.timer&&(clearTimeout(this.timer),this.timer=null),this._level!==a){m.logger.log("switching to level "+a),this._level=a;var d=b[a];d.level=a,c.trigger(j.default.LEVEL_SWITCH,d),c.trigger(j.default.LEVEL_SWITCHING,d)}var e=b[a],f=e.details;if(!f||f.live===!0){var g=e.urlId;c.trigger(j.default.LEVEL_LOADING,{url:e.url[g],level:a,id:g})}}else c.trigger(j.default.ERROR,{type:n.ErrorTypes.OTHER_ERROR,details:n.ErrorDetails.LEVEL_SWITCH_ERROR,level:a,fatal:!1,reason:"invalid level idx"})}},{key:"onError",value:function(a){if(!a.fatal){var b=a.details,c=this.hls,d=void 0,e=void 0,f=!1;switch(b){case n.ErrorDetails.FRAG_LOAD_ERROR:case n.ErrorDetails.FRAG_LOAD_TIMEOUT:case n.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case n.ErrorDetails.KEY_LOAD_ERROR:case n.ErrorDetails.KEY_LOAD_TIMEOUT:d=a.frag.level;break;case n.ErrorDetails.LEVEL_LOAD_ERROR:case n.ErrorDetails.LEVEL_LOAD_TIMEOUT:d=a.context.level,f=!0;break;case n.ErrorDetails.REMUX_ALLOC_ERROR:d=a.level}if(void 0!==d){e=this._levels[d],e.loadError?e.loadError++:e.loadError=1;var g=e.url.length;if(g>1&&e.loadError<g)e.urlId=(e.urlId+1)%g,e.details=void 0,m.logger.warn("level controller,"+b+" for level "+d+": switching to redundant stream id "+e.urlId);else{var h=this._manualLevel===-1&&d;if(h)m.logger.warn("level controller,"+b+": switch-down for next fragment"),c.nextAutoLevel=Math.max(0,d-1);else if(e&&e.details&&e.details.live)m.logger.warn("level controller,"+b+" on live stream, discard"),f&&(this._level=void 0);else if(b===n.ErrorDetails.LEVEL_LOAD_ERROR||b===n.ErrorDetails.LEVEL_LOAD_TIMEOUT){var i=c.media,j=i&&p.default.isBuffered(i,i.currentTime)&&p.default.isBuffered(i,i.currentTime+.5);if(j){var k=c.config.levelLoadingRetryDelay;m.logger.warn("level controller,"+b+", but media buffered, retry in "+k+"ms"),this.timer=setTimeout(this.ontick,k),a.levelRetry=!0}else m.logger.error("cannot recover "+b+" error"),this._level=void 0,this.timer&&(clearTimeout(this.timer),this.timer=null),a.fatal=!0}}}}}},{key:"onFragLoaded",value:function(a){var b=a.frag;if(b&&"main"===b.type){var c=this._levels[b.level];c&&(c.loadError=0)}}},{key:"onLevelLoaded",value:function(a){var b=a.level;if(b===this._level){var c=this._levels[b];c.loadError=0;var d=a.details;if(d.live){var e=1e3*(d.averagetargetduration?d.averagetargetduration:d.targetduration),f=c.details;f&&d.endSN===f.endSN&&(e/=2,m.logger.log("same live playlist, reload twice faster")),e-=performance.now()-a.stats.trequest,e=Math.max(1e3,Math.round(e)),m.logger.log("live playlist, reload in "+e+" ms"),this.timer=setTimeout(this.ontick,e)}else this.timer=null}}},{key:"tick",value:function(){var a=this._level;if(void 0!==a&&this.canload){var b=this._levels[a];if(b&&b.url){var c=b.urlId;this.hls.trigger(j.default.LEVEL_LOADING,{url:b.url[c],level:a,id:c})}}}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._level},set:function(a){var b=this._levels;b&&b.length>a&&(this._level===a&&void 0!==b[a].details||this.setLevelInternal(a))}},{key:"manualLevel",get:function(){return this._manualLevel},set:function(a){this._manualLevel=a,void 0===this._startLevel&&(this._startLevel=a),a!==-1&&(this.level=a)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(a){this._firstLevel=a}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var a=this.hls.config.startLevel;return void 0!==a?a:this._firstLevel}return this._startLevel},set:function(a){this._startLevel=a}},{key:"nextLoadLevel",get:function(){return this._manualLevel!==-1?this._manualLevel:this.hls.nextAutoLevel},set:function(a){this.level=a,this._manualLevel===-1&&(this.hls.nextAutoLevel=a)}}]),b}(l.default);c.default=q},{33:33,34:34,35:35,37:37,53:53}],13:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(48),j=d(i),k=a(37),l=d(k),m=a(25),n=d(m),o=a(35),p=d(o),q=a(34),r=d(q),s=a(38),t=d(s),u=a(54),v=d(u),w=a(33),x=a(53),y={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},z=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,p.default.MEDIA_ATTACHED,p.default.MEDIA_DETACHING,p.default.MANIFEST_LOADING,p.default.MANIFEST_PARSED,p.default.LEVEL_LOADED,p.default.KEY_LOADED,p.default.FRAG_LOADED,p.default.FRAG_LOAD_EMERGENCY_ABORTED,p.default.FRAG_PARSING_INIT_SEGMENT,p.default.FRAG_PARSING_DATA,p.default.FRAG_PARSED,p.default.ERROR,p.default.AUDIO_TRACK_SWITCHING,p.default.AUDIO_TRACK_SWITCHED,p.default.BUFFER_CREATED,p.default.BUFFER_APPENDED,p.default.BUFFER_FLUSHED));return c.config=a.config,c.audioCodecSwap=!1,c.ticks=0,c._state=y.STOPPED,c.ontick=c.tick.bind(c),c}return g(b,a),h(b,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),r.default.prototype.destroy.call(this),this.state=y.STOPPED}},{key:"startLoad",value:function(a){if(this.levels){var b=this.lastCurrentTime,c=this.hls;if(this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var d=c.startLevel;d===-1&&(d=0,this.bitrateTest=!0),this.level=c.nextLoadLevel=d,this.loadedmetadata=!1}b>0&&a===-1&&(x.logger.log("override startPosition with lastCurrentTime @"+b.toFixed(3)),a=b),this.state=y.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=a,this.tick()}else this.forceStartLoad=!0,this.state=y.STOPPED}},{key:"stopLoad",value:function(){var a=this.fragCurrent;a&&(a.loader&&a.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=y.STOPPED,this.forceStartLoad=!1}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){switch(this.state){case y.ERROR:break;case y.BUFFER_FLUSHING:this.fragLoadError=0;break;case y.IDLE:this._doTickIdle();break;case y.WAITING_LEVEL:var a=this.levels[this.level];a&&a.details&&(this.state=y.IDLE);break;case y.FRAG_LOADING_WAITING_RETRY:var b=performance.now(),c=this.retryDate;(!c||b>=c||this.media&&this.media.seeking)&&(x.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=y.IDLE);break;case y.ERROR:case y.STOPPED:case y.FRAG_LOADING:case y.PARSING:case y.PARSED:case y.ENDED:}this._checkBuffer(),this._checkFragmentChanged()}},{key:"_doTickIdle",value:function(){var a=this.hls,b=a.config,c=this.media;if(void 0===this.levelLastLoaded||c||!this.startFragRequested&&b.startFragPrefetch){var d=void 0;d=this.loadedmetadata?c.currentTime:this.nextLoadPosition;var e=a.nextLoadLevel,f=this.levels[e],g=f.bitrate,h=void 0;h=g?Math.max(8*b.maxBufferSize/g,b.maxBufferLength):b.maxBufferLength,h=Math.min(h,b.maxMaxBufferLength);var i=l.default.bufferInfo(this.mediaBuffer?this.mediaBuffer:c,d,b.maxBufferHole),j=i.len;if(!(j>=h)){x.logger.trace("buffer length of "+j.toFixed(3)+" is below max of "+h.toFixed(3)+". checking for more payload ..."),this.level=a.nextLoadLevel=e;var k=f.details;if("undefined"==typeof k||k.live&&this.levelLastLoaded!==e)return void(this.state=y.WAITING_LEVEL);var m=this.fragPrevious;if(!k.live&&m&&m.sn===k.endSN){var n=Math.min(c.duration,m.start+m.duration);if(n-Math.max(i.end,m.start)<=Math.max(.2,m.duration/2)){var o={};return this.altAudio&&(o.type="video"),this.hls.trigger(p.default.BUFFER_EOS,o),void(this.state=y.ENDED)}}this._fetchPayloadOrEos(d,i,k)}}}},{key:"_fetchPayloadOrEos",value:function(a,b,c){var d=this.fragPrevious,e=this.level,f=c.fragments,g=f.length;if(0!==g){var h=f[0].start,i=f[g-1].start+f[g-1].duration,j=b.end,k=void 0;if(c.initSegment&&!c.initSegment.data)k=c.initSegment;else if(c.live){var l=this.config.initialLiveManifestSize;if(g<l)return void x.logger.warn("Can not start playback of a level, reason: not enough fragments "+g+" < "+l);if(k=this._ensureFragmentAtLivePoint(c,j,h,i,d,f,g),null===k)return}else j<h&&(k=f[0]);k||(k=this._findFragment(h,d,g,f,j,i,c)),k&&this._loadFragmentOrKey(k,e,c,a,j)}}},{key:"_ensureFragmentAtLivePoint",value:function(a,b,c,d,e,f,g){var h=this.hls.config,i=this.media,j=void 0,k=void 0!==h.liveMaxLatencyDuration?h.liveMaxLatencyDuration:h.liveMaxLatencyDurationCount*a.targetduration;if(b<Math.max(c-h.maxFragLookUpTolerance,d-k)){var l=this.liveSyncPosition=this.computeLivePosition(c,a);x.logger.log("buffer end: "+b.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+l.toFixed(3)),b=l,i&&i.readyState&&i.duration>l&&(i.currentTime=l)}if(a.PTSKnown&&b>d&&i&&i.readyState)return null;if(this.startFragRequested&&!a.PTSKnown){if(e){var m=e.sn+1;m>=a.startSN&&m<=a.endSN&&(j=f[m-a.startSN],x.logger.log("live playlist, switching playlist, load frag with next SN: "+j.sn))}j||(j=f[Math.min(g-1,Math.round(g/2))],x.logger.log("live playlist, switching playlist, unknown, load middle frag : "+j.sn))}return j}},{key:"_findFragment",value:function(a,b,c,d,e,f,g){var h=this.hls.config,i=void 0,k=void 0,l=h.maxFragLookUpTolerance,m=b?d[b.sn-d[0].sn+1]:void 0,n=function(a){var b=Math.min(l,a.duration);return a.start+a.duration-b<=e?1:a.start-b>e&&a.start?-1:0};if(e<f?(e>f-l&&(l=0),k=m&&!n(m)?m:j.default.search(d,n)):k=d[c-1],k){i=k;var o=i.sn-g.startSN,p=b&&i.level===b.level,q=d[o-1],r=d[o+1];if(p&&i.sn===b.sn)if(i.sn<g.endSN){var s=b.deltaPTS;s&&s>h.maxBufferHole&&b.dropped&&o?(i=q,x.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),b.loadCounter--):(i=r,x.logger.log("SN just loaded, load next one: "+i.sn))}else i=null;else i.dropped&&!p&&(r&&r.backtracked?(x.logger.warn("Already backtracked from fragment "+(o+1)+", will not backtrack to fragment "+o+". Loading fragment "+(o+1)),i=r):(x.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),i.dropped=0,q?(q.loadCounter&&q.loadCounter--,i=q):i=null))}return i}},{key:"_loadFragmentOrKey",value:function(a,b,c,d,e){var f=this.hls,g=f.config;if(!a.decryptdata||null==a.decryptdata.uri||null!=a.decryptdata.key){if(x.logger.log("Loading "+a.sn+" of ["+c.startSN+" ,"+c.endSN+"],level "+b+", currentTime:"+d.toFixed(3)+",bufferEnd:"+e.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,a.loadCounter){a.loadCounter++;var h=g.fragLoadingLoopThreshold;if(a.loadCounter>h&&Math.abs(this.fragLoadIdx-a.loadIdx)<h)return void f.trigger(p.default.ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:a})}else a.loadCounter=1;return a.loadIdx=this.fragLoadIdx,this.fragCurrent=a,this.startFragRequested=!0,isNaN(a.sn)||(this.nextLoadPosition=a.start+a.duration),a.autoLevel=f.autoLevelEnabled,a.bitrateTest=this.bitrateTest,f.trigger(p.default.FRAG_LOADING,{frag:a}),this.demuxer||(this.demuxer=new n.default(f,"main")),void(this.state=y.FRAG_LOADING)}x.logger.log("Loading key for "+a.sn+" of ["+c.startSN+" ,"+c.endSN+"],level "+b),this.state=y.KEY_LOADING,f.trigger(p.default.KEY_LOADING,{frag:a})}},{key:"getBufferedFrag",value:function(a){return j.default.search(this._bufferedFrags,function(b){
return a<b.startPTS?-1:a>b.endPTS?1:0})}},{key:"followingBufferedFrag",value:function(a){return a?this.getBufferedFrag(a.endPTS+.5):null}},{key:"_checkFragmentChanged",value:function(){var a,b,c=this.media;if(c&&c.readyState&&c.seeking===!1&&(b=c.currentTime,b>c.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=b),l.default.isBuffered(c,b)?a=this.getBufferedFrag(b):l.default.isBuffered(c,b+.1)&&(a=this.getBufferedFrag(b+.1)),a)){var d=a;if(d!==this.fragPlaying){this.hls.trigger(p.default.FRAG_CHANGED,{frag:d});var e=d.level;this.fragPlaying&&this.fragPlaying.level===e||this.hls.trigger(p.default.LEVEL_SWITCHED,{level:e}),this.fragPlaying=d}}}},{key:"immediateLevelSwitch",value:function(){if(x.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var a=this.media,b=void 0;a?(b=a.paused,a.pause()):b=!0,this.previouslyPaused=b}var c=this.fragCurrent;c&&c.loader&&c.loader.abort(),this.fragCurrent=null,this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}},{key:"immediateLevelSwitchEnd",value:function(){var a=this.media;a&&a.buffered.length&&(this.immediateSwitch=!1,l.default.isBuffered(a,a.currentTime)&&(a.currentTime-=1e-4),this.previouslyPaused||a.play())}},{key:"nextLevelSwitch",value:function(){var a=this.media;if(a&&a.readyState){var b=void 0,c=void 0,d=void 0;if(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,c=this.getBufferedFrag(a.currentTime),c&&c.startPTS>1&&this.flushMainBuffer(0,c.startPTS-1),a.paused)b=0;else{var e=this.hls.nextLoadLevel,f=this.levels[e],g=this.fragLastKbps;b=g&&this.fragCurrent?this.fragCurrent.duration*f.bitrate/(1e3*g)+1:0}if(d=this.getBufferedFrag(a.currentTime+b),d&&(d=this.followingBufferedFrag(d))){var h=this.fragCurrent;h&&h.loader&&h.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(d.startPTS,Number.POSITIVE_INFINITY)}}}},{key:"flushMainBuffer",value:function(a,b){this.state=y.BUFFER_FLUSHING;var c={startOffset:a,endOffset:b};this.altAudio&&(c.type="video"),this.hls.trigger(p.default.BUFFER_FLUSHING,c)}},{key:"onMediaAttached",value:function(a){var b=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),b.addEventListener("seeking",this.onvseeking),b.addEventListener("seeked",this.onvseeked),b.addEventListener("ended",this.onvended);var c=this.config;this.levels&&c.autoStartLoad&&this.hls.startLoad(c.startPosition)}},{key:"onMediaDetaching",value:function(){var a=this.media;a&&a.ended&&(x.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var b=this.levels;b&&b.forEach(function(a){a.details&&a.details.fragments.forEach(function(a){a.loadCounter=void 0,a.backtracked=void 0})}),a&&(a.removeEventListener("seeking",this.onvseeking),a.removeEventListener("seeked",this.onvseeked),a.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){var a=this.media,b=a?a.currentTime:void 0,c=this.config;x.logger.log("media seeking to "+b.toFixed(3));var d=this.mediaBuffer?this.mediaBuffer:a,e=l.default.bufferInfo(d,b,this.config.maxBufferHole);if(this.state===y.FRAG_LOADING){var f=this.fragCurrent;if(0===e.len&&f){var g=c.maxFragLookUpTolerance,h=f.start-g,i=f.start+f.duration+g;b<h||b>i?(f.loader&&(x.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),f.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=y.IDLE):x.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===y.ENDED&&(0===e.len&&(this.fragPrevious=0),this.state=y.IDLE);a&&(this.lastCurrentTime=b),this.state!==y.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*c.fragLoadingLoopThreshold),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=b),this.tick()}},{key:"onMediaSeeked",value:function(){x.logger.log("media seeked to "+this.media.currentTime.toFixed(3)),this.tick()}},{key:"onMediaEnded",value:function(){x.logger.log("media ended"),this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoading",value:function(){x.logger.log("trigger BUFFER_RESET"),this.hls.trigger(p.default.BUFFER_RESET),this._bufferedFrags=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0}},{key:"onManifestParsed",value:function(a){var b,c=!1,d=!1;a.levels.forEach(function(a){b=a.audioCodec,b&&(b.indexOf("mp4a.40.2")!==-1&&(c=!0),b.indexOf("mp4a.40.5")!==-1&&(d=!0))}),this.audioCodecSwitch=c&&d,this.audioCodecSwitch&&x.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=a.levels,this.startLevelLoaded=!1,this.startFragRequested=!1;var e=this.config;(e.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(e.startPosition)}},{key:"onLevelLoaded",value:function(a){var b=a.details,c=a.level,d=this.levels[c],e=b.totalduration,f=0;if(x.logger.log("level "+c+" loaded ["+b.startSN+","+b.endSN+"],duration:"+e),this.levelLastLoaded=c,b.live){var g=d.details;g&&b.fragments.length>0?(t.default.mergeDetails(g,b),f=b.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(f,g),b.PTSKnown?x.logger.log("live playlist sliding:"+f.toFixed(3)):x.logger.log("live playlist - outdated PTS, unknown sliding")):(b.PTSKnown=!1,x.logger.log("live playlist - first load, unknown sliding"))}else b.PTSKnown=!1;if(d.details=b,this.hls.trigger(p.default.LEVEL_UPDATED,{details:b,level:c}),this.startFragRequested===!1){if(this.startPosition===-1||this.lastCurrentTime===-1){var h=b.startTimeOffset;isNaN(h)?b.live?(this.startPosition=this.computeLivePosition(f,b),x.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(h<0&&(x.logger.log("negative start time offset "+h+", count from end of last fragment"),h=f+e+h),x.logger.log("start time offset found in playlist, adjust startPosition to "+h),this.startPosition=h),this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===y.WAITING_LEVEL&&(this.state=y.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===y.KEY_LOADING&&(this.state=y.IDLE,this.tick())}},{key:"onFragLoaded",value:function(a){var b=this.fragCurrent,c=a.frag;if(this.state===y.FRAG_LOADING&&b&&"main"===c.type&&c.level===b.level&&c.sn===b.sn){var d=a.stats,e=this.levels[b.level],f=e.details;if(x.logger.log("Loaded  "+b.sn+" of ["+f.startSN+" ,"+f.endSN+"],level "+b.level),this.bitrateTest=!1,this.stats=d,c.bitrateTest===!0&&this.hls.nextLoadLevel)this.state=y.IDLE,this.startFragRequested=!1,d.tparsed=d.tbuffered=performance.now(),this.hls.trigger(p.default.FRAG_BUFFERED,{stats:d,frag:b,id:"main"}),this.tick();else if("initSegment"===c.sn)this.state=y.IDLE,d.tparsed=d.tbuffered=performance.now(),f.initSegment.data=a.payload,this.hls.trigger(p.default.FRAG_BUFFERED,{stats:d,frag:b,id:"main"}),this.tick();else{this.state=y.PARSING;var g=f.totalduration,h=b.level,i=b.sn,j=this.config.defaultAudioCodec||e.audioCodec;this.audioCodecSwap&&(x.logger.log("swapping playlist audio codec"),void 0===j&&(j=this.lastAudioCodec),j&&(j=j.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5")),this.pendingBuffering=!0,this.appended=!1,x.logger.log("Parsing "+i+" of ["+f.startSN+" ,"+f.endSN+"],level "+h+", cc "+b.cc);var k=this.demuxer;k||(k=this.demuxer=new n.default(this.hls,"main"));var l=this.media,m=l&&l.seeking,o=!m&&(f.PTSKnown||!f.live),q=f.initSegment?f.initSegment.data:[];k.push(a.payload,q,j,e.videoCodec,b,g,o,void 0)}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(a){var b=this.fragCurrent,c=a.frag;if(b&&"main"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===y.PARSING){var d,e,f=a.tracks;if(f.audio&&this.altAudio&&delete f.audio,e=f.audio){var g=this.levels[this.level].audioCodec,h=navigator.userAgent.toLowerCase();g&&this.audioCodecSwap&&(x.logger.log("swapping playlist audio codec"),g=g.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==e.metadata.channelCount&&h.indexOf("firefox")===-1&&(g="mp4a.40.5"),h.indexOf("android")!==-1&&"audio/mpeg"!==e.container&&(g="mp4a.40.2",x.logger.log("Android: force audio codec to "+g)),e.levelCodec=g,e.id=a.id}e=f.video,e&&(e.levelCodec=this.levels[this.level].videoCodec,e.id=a.id),this.hls.trigger(p.default.BUFFER_CODECS,f);for(d in f){e=f[d],x.logger.log("main track:"+d+",container:"+e.container+",codecs[level/parsed]=["+e.levelCodec+"/"+e.codec+"]");var i=e.initSegment;i&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(p.default.BUFFER_APPENDING,{type:d,data:i,parent:"main",content:"initSegment"}))}this.tick()}}},{key:"onFragParsingData",value:function(a){var b=this,c=this.fragCurrent,d=a.frag;if(c&&"main"===a.id&&d.sn===c.sn&&d.level===c.level&&("audio"!==a.type||!this.altAudio)&&this.state===y.PARSING){var e=this.levels[this.level],f=c;if(isNaN(a.endPTS)&&(a.endPTS=a.startPTS+c.duration,a.endDTS=a.startDTS+c.duration),x.logger.log("Parsed "+a.type+",PTS:["+a.startPTS.toFixed(3)+","+a.endPTS.toFixed(3)+"],DTS:["+a.startDTS.toFixed(3)+"/"+a.endDTS.toFixed(3)+"],nb:"+a.nb+",dropped:"+(a.dropped||0)),"video"===a.type)if(f.dropped=a.dropped,f.dropped){if(!f.backtracked)return f.backtracked=!0,this.nextLoadPosition=a.startPTS,this.state=y.IDLE,void this.tick();x.logger.warn("Already backtracked on this fragment, appending with the gap")}else f.backtracked=!1;var g=t.default.updateFragPTSDTS(e.details,f,a.startPTS,a.endPTS,a.startDTS,a.endDTS),h=this.hls;h.trigger(p.default.LEVEL_PTS_UPDATED,{details:e.details,level:this.level,drift:g,type:a.type,start:a.startPTS,end:a.endPTS}),[a.data1,a.data2].forEach(function(c){c&&c.length&&b.state===y.PARSING&&(b.appended=!0,b.pendingBuffering=!0,h.trigger(p.default.BUFFER_APPENDING,{type:a.type,data:c,parent:"main",content:"data"}))}),this.tick()}}},{key:"onFragParsed",value:function(a){var b=this.fragCurrent,c=a.frag;b&&"main"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===y.PARSING&&(this.stats.tparsed=performance.now(),this.state=y.PARSED,this._checkAppendedParsed())}},{key:"onAudioTrackSwitching",value:function(a){var b=!!a.url,c=a.id;if(!b){if(this.mediaBuffer!==this.media){x.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var d=this.fragCurrent;d.loader&&(x.logger.log("switching to main audio track, cancel main fragment load"),d.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=y.IDLE}var e=this.hls;e.trigger(p.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),e.trigger(p.default.AUDIO_TRACK_SWITCHED,{id:c}),this.altAudio=!1}}},{key:"onAudioTrackSwitched",value:function(a){var b=a.id,c=!!this.hls.audioTracks[b].url;if(c){var d=this.videoBuffer;d&&this.mediaBuffer!==d&&(x.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=d)}this.altAudio=c,this.tick()}},{key:"onBufferCreated",value:function(a){var b=a.tracks,c=void 0,d=void 0,e=!1;for(var f in b){var g=b[f];"main"===g.id?(d=f,c=g,"video"===f&&(this.videoBuffer=b[f].buffer)):e=!0}e&&c?(x.logger.log("alternate track found, use "+d+".buffered to schedule main fragment loading"),this.mediaBuffer=c.buffer):this.mediaBuffer=this.media}},{key:"onBufferAppended",value:function(a){if("main"===a.parent){var b=this.state;b!==y.PARSING&&b!==y.PARSED||(this.pendingBuffering=a.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){if(!(this.state!==y.PARSED||this.appended&&this.pendingBuffering)){var a=this.fragCurrent;if(a){var b=this.mediaBuffer?this.mediaBuffer:this.media;x.logger.log("main buffered : "+v.default.toString(b.buffered));var c=this._bufferedFrags.filter(function(a){return l.default.isBuffered(b,(a.startPTS+a.endPTS)/2)});c.push(a),this._bufferedFrags=c.sort(function(a,b){return a.startPTS-b.startPTS}),this.fragPrevious=a;var d=this.stats;d.tbuffered=performance.now(),this.fragLastKbps=Math.round(8*d.total/(d.tbuffered-d.tfirst)),this.hls.trigger(p.default.FRAG_BUFFERED,{stats:d,frag:a,id:"main"}),this.state=y.IDLE}this.tick()}}},{key:"onError",value:function(a){var b=a.frag||this.fragCurrent;if(!b||"main"===b.type){var c=this.media,d=c&&l.default.isBuffered(c,c.currentTime)&&l.default.isBuffered(c,c.currentTime+.5);switch(a.details){case w.ErrorDetails.FRAG_LOAD_ERROR:case w.ErrorDetails.FRAG_LOAD_TIMEOUT:case w.ErrorDetails.KEY_LOAD_ERROR:case w.ErrorDetails.KEY_LOAD_TIMEOUT:if(!a.fatal){var e=this.fragLoadError;e?e++:e=1;var f=this.config;if(e<=f.fragLoadingMaxRetry||d||b.autoLevel&&b.level){this.fragLoadError=e,b.loadCounter=0;var g=Math.min(Math.pow(2,e-1)*f.fragLoadingRetryDelay,f.fragLoadingMaxRetryTimeout);x.logger.warn("mediaController: frag loading failed, retry in "+g+" ms"),this.retryDate=performance.now()+g,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.state=y.FRAG_LOADING_WAITING_RETRY}else x.logger.error("mediaController: "+a.details+" reaches max retry, redispatch as fatal ..."),a.fatal=!0,this.state=y.ERROR}break;case w.ErrorDetails.FRAG_LOOP_LOADING_ERROR:a.fatal||(d?(this._reduceMaxBufferLength(b.duration),this.state=y.IDLE):b.autoLevel&&0!==b.level||(a.fatal=!0,this.state=y.ERROR));break;case w.ErrorDetails.LEVEL_LOAD_ERROR:case w.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==y.ERROR&&(a.fatal?(this.state=y.ERROR,x.logger.warn("streamController: "+a.details+",switch to "+this.state+" state ...")):a.levelRetry||this.state!==y.WAITING_LEVEL||(this.state=y.IDLE));break;case w.ErrorDetails.BUFFER_FULL_ERROR:"main"!==a.parent||this.state!==y.PARSING&&this.state!==y.PARSED||(d?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=y.IDLE):(x.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}}},{key:"_reduceMaxBufferLength",value:function(a){var b=this.config;b.maxMaxBufferLength>=a&&(b.maxMaxBufferLength/=2,x.logger.warn("main:reduce max buffer length to "+b.maxMaxBufferLength+"s"),this.fragLoadIdx+=2*b.fragLoadingLoopThreshold)}},{key:"_checkBuffer",value:function(){var a=this.media;if(a&&a.readyState){var b=a.currentTime,c=this.mediaBuffer?this.mediaBuffer:a,d=c.buffered;if(!this.loadedmetadata&&d.length){this.loadedmetadata=!0;var e=a.seeking?b:this.startPosition,f=l.default.isBuffered(c,e);b===e&&f||(x.logger.log("target start position:"+e),f||(e=d.start(0),x.logger.log("target start position not buffered, seek to buffered.start(0) "+e)),x.logger.log("adjust currentTime from "+b+" to "+e),a.currentTime=e)}else if(this.immediateSwitch)this.immediateLevelSwitchEnd();else{var g=l.default.bufferInfo(a,b,0),h=!(a.paused||a.ended||0===a.buffered.length),i=.5,j=b!==this.lastCurrentTime,k=this.config;if(j)this.stallReported&&(x.logger.warn("playback not stuck anymore @"+b+", after "+Math.round(performance.now()-this.stalled)+"ms"),this.stallReported=!1),this.stalled=void 0,this.nudgeRetry=0;else if(h){var m=performance.now(),n=this.hls;if(this.stalled){var o=m-this.stalled,q=g.len,r=this.nudgeRetry||0;if(q<=i&&o>1e3*k.lowBufferWatchdogPeriod){this.stallReported||(this.stallReported=!0,x.logger.warn("playback stalling in low buffer @"+b),n.trigger(p.default.ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:q}));var s=g.nextStart,t=s-b;if(s&&t<k.maxSeekHole&&t>0){this.nudgeRetry=++r;var u=r*k.nudgeOffset;x.logger.log("adjust currentTime from "+a.currentTime+" to next buffered @ "+s+" + nudge "+u),a.currentTime=s+u,this.stalled=void 0,n.trigger(p.default.ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:s+u-b})}}else if(q>i&&o>1e3*k.highBufferWatchdogPeriod)if(this.stallReported||(this.stallReported=!0,x.logger.warn("playback stalling in high buffer @"+b),n.trigger(p.default.ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:q})),this.stalled=void 0,this.nudgeRetry=++r,r<k.nudgeMaxRetry){var v=a.currentTime,y=v+r*k.nudgeOffset;x.logger.log("adjust currentTime from "+v+" to "+y),a.currentTime=y,n.trigger(p.default.ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else x.logger.error("still stuck in high buffer @"+b+" after "+k.nudgeMaxRetry+", raise fatal error"),n.trigger(p.default.ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}else this.stalled=m,this.stallReported=!1}}}}},{key:"onFragLoadEmergencyAborted",value:function(){this.state=y.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()}},{key:"onBufferFlushed",value:function(){var a=this.mediaBuffer?this.mediaBuffer:this.media;this._bufferedFrags=this._bufferedFrags.filter(function(b){return l.default.isBuffered(a,(b.startPTS+b.endPTS)/2)}),this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=y.IDLE,this.fragPrevious=null}},{key:"swapAudioCodec",value:function(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"computeLivePosition",value:function(a,b){var c=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*b.targetduration;return a+Math.max(0,b.totalduration-c)}},{key:"state",set:function(a){if(this.state!==a){var b=this.state;this._state=a,x.logger.log("main stream:"+b+"->"+a),this.hls.trigger(p.default.STREAM_STATE_TRANSITION,{previousState:b,nextState:a})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var a=this.media;if(a){var b=this.getBufferedFrag(a.currentTime);if(b)return b.level}return-1}},{key:"nextBufferedFrag",get:function(){var a=this.media;return a?this.followingBufferedFrag(this.getBufferedFrag(a.currentTime)):null}},{key:"nextLevel",get:function(){var a=this.nextBufferedFrag;return a?a.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(a){this._liveSyncPosition=a}}]),b}(r.default);c.default=z},{25:25,33:33,34:34,35:35,37:37,38:38,48:48,53:53,54:54}],14:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(35),j=d(i),k=a(34),l=d(k),m=a(53),n=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,j.default.ERROR,j.default.SUBTITLE_TRACKS_UPDATED,j.default.SUBTITLE_TRACK_SWITCH,j.default.SUBTITLE_TRACK_LOADED,j.default.SUBTITLE_FRAG_PROCESSED));return c.config=a.config,c.vttFragSNsProcessed={},c.vttFragQueues=void 0,c.currentlyProcessing=null,c.currentTrackId=-1,c}return g(b,a),h(b,[{key:"destroy",value:function(){l.default.prototype.destroy.call(this)}},{key:"clearVttFragQueues",value:function(){var a=this;this.vttFragQueues={},this.tracks.forEach(function(b){a.vttFragQueues[b.id]=[]})}},{key:"nextFrag",value:function(){if(null===this.currentlyProcessing&&this.currentTrackId>-1&&this.vttFragQueues[this.currentTrackId].length){var a=this.currentlyProcessing=this.vttFragQueues[this.currentTrackId].shift();this.hls.trigger(j.default.FRAG_LOADING,{frag:a})}}},{key:"onSubtitleFragProcessed",value:function(a){a.success&&this.vttFragSNsProcessed[a.frag.trackId].push(a.frag.sn),this.currentlyProcessing=null,this.nextFrag()}},{key:"onError",value:function(a){var b=a.frag;b&&"subtitle"!==b.type||this.currentlyProcessing&&(this.currentlyProcessing=null,this.nextFrag())}},{key:"onSubtitleTracksUpdated",value:function(a){var b=this;m.logger.log("subtitle tracks updated"),this.tracks=a.subtitleTracks,this.clearVttFragQueues(),this.vttFragSNsProcessed={},this.tracks.forEach(function(a){b.vttFragSNsProcessed[a.id]=[]})}},{key:"onSubtitleTrackSwitch",value:function(a){this.currentTrackId=a.id,this.clearVttFragQueues()}},{key:"onSubtitleTrackLoaded",value:function(a){var b=this.vttFragSNsProcessed[a.id],c=this.vttFragQueues[a.id],d=this.currentlyProcessing?this.currentlyProcessing.sn:-1,e=function(a){return b.indexOf(a.sn)>-1},f=function(a){return c.some(function(b){return b.sn===a.sn})};a.details.fragments.forEach(function(b){e(b)||b.sn===d||f(b)||(b.trackId=a.id,c.push(b))}),this.nextFrag()}}]),b}(l.default);c.default=n},{34:34,35:35,53:53}],15:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function h(a){for(var b=[],c=0;c<a.length;c++)"subtitles"===a[c].kind&&b.push(a[c]);return b}Object.defineProperty(c,"__esModule",{value:!0});var i=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),j=a(35),k=d(j),l=a(34),m=d(l),n=a(53),o=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,k.default.MEDIA_ATTACHED,k.default.MEDIA_DETACHING,k.default.MANIFEST_LOADING,k.default.MANIFEST_LOADED,k.default.SUBTITLE_TRACK_LOADED));return c.tracks=[],c.trackId=-1,c.media=void 0,c}return g(b,a),i(b,[{key:"destroy",value:function(){m.default.prototype.destroy.call(this)}},{key:"onMediaAttached",value:function(a){var b=this;this.media=a.media,this.media&&this.media.textTracks.addEventListener("change",function(){if(b.media){for(var a=-1,c=h(b.media.textTracks),d=0;d<c.length;d++)"showing"===c[d].mode&&(a=d);b.subtitleTrack=a}})}},{key:"onMediaDetaching",value:function(){this.media=void 0}},{key:"onManifestLoading",value:function(){this.tracks=[],this.trackId=-1}},{key:"onManifestLoaded",value:function(a){var b=this,c=a.subtitles||[],d=!1;this.tracks=c,this.trackId=-1,this.hls.trigger(k.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:c}),c.forEach(function(a){a.default&&(b.subtitleTrack=a.id,d=!0)})}},{key:"onTick",value:function(){var a=this.trackId,b=this.tracks[a];if(b){var c=b.details;void 0!==c&&c.live!==!0||(n.logger.log("(re)loading playlist for subtitle track "+a),this.hls.trigger(k.default.SUBTITLE_TRACK_LOADING,{url:b.url,id:a}))}}},{key:"onSubtitleTrackLoaded",value:function(a){var b=this;a.id<this.tracks.length&&(n.logger.log("subtitle track "+a.id+" loaded"),this.tracks[a.id].details=a.details,a.details.live&&!this.timer&&(this.timer=setInterval(function(){b.onTick()},1e3*a.details.targetduration,this)),!a.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))}},{key:"setSubtitleTrackInternal",value:function(a){if(a>=0&&a<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=a,n.logger.log("switching to subtitle track "+a);var b=this.tracks[a];this.hls.trigger(k.default.SUBTITLE_TRACK_SWITCH,{id:a});var c=b.details;void 0!==c&&c.live!==!0||(n.logger.log("(re)loading playlist for subtitle track "+a),this.hls.trigger(k.default.SUBTITLE_TRACK_LOADING,{url:b.url,id:a}))}}},{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(a){this.trackId!==a&&this.setSubtitleTrackInternal(a)}}]),b}(m.default);c.default=o},{34:34,35:35,53:53}],16:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function h(a){if(a&&a.cues)for(;a.cues.length>0;)a.removeCue(a.cues[0])}function i(a,b){return a&&a.label===b.name&&!(a.textTrack1||a.textTrack2)}function j(a,b,c,d){return Math.min(b,d)-Math.max(a,c)}Object.defineProperty(c,"__esModule",{value:!0});var k=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),l=a(35),m=d(l),n=a(34),o=d(n),p=a(49),q=d(p),r=a(57),s=d(r),t=a(53),u=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,m.default.MEDIA_ATTACHING,m.default.MEDIA_DETACHING,m.default.FRAG_PARSING_USERDATA,m.default.MANIFEST_LOADING,m.default.MANIFEST_LOADED,m.default.FRAG_LOADED,m.default.LEVEL_SWITCHING,m.default.INIT_PTS_FOUND));if(c.hls=a,c.config=a.config,c.enabled=!0,c.Cues=a.config.cueHandler,c.textTracks=[],c.tracks=[],c.unparsedVttFrags=[],c.initPTS=void 0,c.cueRanges=[],c.config.enableCEA708Captions){var d=c,g=function(a,b){var c=null;try{c=new window.Event("addtrack")}catch(a){c=document.createEvent("Event"),c.initEvent("addtrack",!1,!1)}c.track=a,b.dispatchEvent(c)},i={newCue:function(a,b,c){if(!d.textTrack1){var e=d.getExistingTrack("1");if(e)d.textTrack1=e,h(d.textTrack1),g(d.textTrack1,d.media);else{var f=d.createTextTrack("captions",d.config.captionsTextTrack1Label,d.config.captionsTextTrack1LanguageCode);f&&(f.textTrack1=!0,d.textTrack1=f)}}d.addCues("textTrack1",a,b,c)}},j={newCue:function(a,b,c){if(!d.textTrack2){var e=d.getExistingTrack("2");if(e)d.textTrack2=e,h(d.textTrack2),g(d.textTrack2,d.media);else{var f=d.createTextTrack("captions",d.config.captionsTextTrack2Label,d.config.captionsTextTrack1LanguageCode);f&&(f.textTrack2=!0,d.textTrack2=f)}}d.addCues("textTrack2",a,b,c)}};c.cea608Parser=new q.default(0,i,j)}return c}return g(b,a),k(b,[{key:"addCues",value:function(a,b,c,d){for(var e=this.cueRanges,f=!1,g=e.length;g--;){var h=e[g],i=j(h[0],h[1],b,c);if(i>=0&&(h[0]=Math.min(h[0],b),h[1]=Math.max(h[1],c),f=!0,i/(c-b)>.5))return}f||e.push([b,c]),this.Cues.newCue(this[a],b,c,d)}},{key:"onInitPtsFound",value:function(a){var b=this;"undefined"==typeof this.initPTS&&(this.initPTS=a.initPTS),this.unparsedVttFrags.length&&(this.unparsedVttFrags.forEach(function(a){b.onFragLoaded(a)}),this.unparsedVttFrags=[])}},{key:"getExistingTrack",value:function(a){var b=this.media;if(b)for(var c=0;c<b.textTracks.length;c++){var d=b.textTracks[c],e="textTrack"+a;if(d[e]===!0)return d}return null}},{key:"createTextTrack",value:function(a,b,c){var d=this.media;if(d)return d.addTextTrack(a,b,c)}},{key:"destroy",value:function(){o.default.prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(a){this.media=a.media}},{key:"onMediaDetaching",value:function(){h(this.textTrack1),h(this.textTrack2)}},{key:"onManifestLoading",value:function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0};var a=this.media;if(a){var b=a.textTracks;if(b)for(var c=0;c<b.length;c++)h(b[c])}}},{key:"onManifestLoaded",value:function(a){var b=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=void 0,this.cueRanges=[],this.config.enableWebVTT){this.tracks=a.subtitles||[];var c=this.media?this.media.textTracks:[];this.tracks.forEach(function(a,d){var e=void 0;if(d<c.length){var f=c[d];i(f,a)&&(e=f)}e||(e=b.createTextTrack("subtitles",a.name,a.lang)),e.mode=a.default?"showing":"hidden",b.textTracks.push(e)})}}},{key:"onLevelSwitching",value:function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions}},{key:"onFragLoaded",value:function(a){var b=a.frag,c=a.payload;if("main"===b.type){var d=b.sn;d!==this.lastSn+1&&this.cea608Parser.reset(),this.lastSn=d}else if("subtitle"===b.type)if(c.byteLength){if("undefined"==typeof this.initPTS)return void this.unparsedVttFrags.push(a);var e=this.vttCCs;e[b.cc]||(e[b.cc]={start:b.start,prevCC:this.prevCC,new:!0},this.prevCC=b.cc);var f=this.textTracks,g=this.hls;s.default.parse(c,this.initPTS,e,b.cc,function(a){var c=f[b.trackId];a.forEach(function(a){c.cues.getCueById(a.id)||c.addCue(a)}),g.trigger(m.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:b})},function(a){t.logger.log("Failed to parse VTT cue: "+a),g.trigger(m.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:b})})}else this.hls.trigger(m.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:b})}},{key:"onFragParsingUserdata",value:function(a){if(this.enabled&&this.config.enableCEA708Captions)for(var b=0;b<a.samples.length;b++){var c=this.extractCea608Data(a.samples[b].bytes);this.cea608Parser.addData(a.samples[b].pts,c)}}},{key:"extractCea608Data",value:function(a){for(var b,c,d,e,f,g=31&a[0],h=2,i=[],j=0;j<g;j++)b=a[h++],c=127&a[h++],d=127&a[h++],e=0!==(4&b),f=3&b,0===c&&0===d||e&&0===f&&(i.push(c),i.push(d));return i}}]),b}(o.default);c.default=u},{34:34,35:35,49:49,53:53,57:57}],17:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b,c){d(this,a),this.subtle=b,this.aesIV=c}return e(a,[{key:"decrypt",value:function(a,b){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},b,a)}}]),a}();c.default=f},{}],18:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(){d(this,a),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return e(a,[{key:"uint8ArrayToUint32Array_",value:function(a){for(var b=new DataView(a),c=new Uint32Array(4),d=0;d<4;d++)c[d]=b.getUint32(4*d);return c}},{key:"initTable",value:function(){var a=this.sBox,b=this.invSBox,c=this.subMix,d=c[0],e=c[1],f=c[2],g=c[3],h=this.invSubMix,i=h[0],j=h[1],k=h[2],l=h[3],m=new Uint32Array(256),n=0,o=0,p=0;
for(p=0;p<256;p++)p<128?m[p]=p<<1:m[p]=p<<1^283;for(p=0;p<256;p++){var q=o^o<<1^o<<2^o<<3^o<<4;q=q>>>8^255&q^99,a[n]=q,b[q]=n;var r=m[n],s=m[r],t=m[s],u=257*m[q]^16843008*q;d[n]=u<<24|u>>>8,e[n]=u<<16|u>>>16,f[n]=u<<8|u>>>24,g[n]=u,u=16843009*t^65537*s^257*r^16843008*n,i[q]=u<<24|u>>>8,j[q]=u<<16|u>>>16,k[q]=u<<8|u>>>24,l[q]=u,n?(n=r^m[m[m[t^r]]],o^=m[m[o]]):n=o=1}}},{key:"expandKey",value:function(a){for(var b=this.uint8ArrayToUint32Array_(a),c=!0,d=0;d<b.length&&c;)c=b[d]===this.key[d],d++;if(!c){this.key=b;var e=this.keySize=b.length;if(4!==e&&6!==e&&8!==e)throw new Error("Invalid aes key size="+e);var f=this.ksRows=4*(e+6+1),g=void 0,h=void 0,i=this.keySchedule=new Uint32Array(f),j=this.invKeySchedule=new Uint32Array(f),k=this.sBox,l=this.rcon,m=this.invSubMix,n=m[0],o=m[1],p=m[2],q=m[3],r=void 0,s=void 0;for(g=0;g<f;g++)g<e?r=i[g]=b[g]:(s=r,g%e===0?(s=s<<8|s>>>24,s=k[s>>>24]<<24|k[s>>>16&255]<<16|k[s>>>8&255]<<8|k[255&s],s^=l[g/e|0]<<24):e>6&&g%e===4&&(s=k[s>>>24]<<24|k[s>>>16&255]<<16|k[s>>>8&255]<<8|k[255&s]),i[g]=r=(i[g-e]^s)>>>0);for(h=0;h<f;h++)g=f-h,s=3&h?i[g]:i[g-4],h<4||g<=4?j[h]=s:j[h]=n[k[s>>>24]]^o[k[s>>>16&255]]^p[k[s>>>8&255]]^q[k[255&s]],j[h]=j[h]>>>0}}},{key:"networkToHostOrderSwap",value:function(a){return a<<24|(65280&a)<<8|(16711680&a)>>8|a>>>24}},{key:"decrypt",value:function(a,b,c){for(var d,e,f=this.keySize+6,g=this.invKeySchedule,h=this.invSBox,i=this.invSubMix,j=i[0],k=i[1],l=i[2],m=i[3],n=this.uint8ArrayToUint32Array_(c),o=n[0],p=n[1],q=n[2],r=n[3],s=new Int32Array(a),t=new Int32Array(s.length),u=void 0,v=void 0,w=void 0,x=void 0,y=void 0,z=void 0,A=void 0,B=void 0,C=void 0,D=void 0,E=void 0,F=void 0,G=this.networkToHostOrderSwap;b<s.length;){for(C=G(s[b]),D=G(s[b+1]),E=G(s[b+2]),F=G(s[b+3]),y=C^g[0],z=F^g[1],A=E^g[2],B=D^g[3],d=4,e=1;e<f;e++)u=j[y>>>24]^k[z>>16&255]^l[A>>8&255]^m[255&B]^g[d],v=j[z>>>24]^k[A>>16&255]^l[B>>8&255]^m[255&y]^g[d+1],w=j[A>>>24]^k[B>>16&255]^l[y>>8&255]^m[255&z]^g[d+2],x=j[B>>>24]^k[y>>16&255]^l[z>>8&255]^m[255&A]^g[d+3],y=u,z=v,A=w,B=x,d+=4;u=h[y>>>24]<<24^h[z>>16&255]<<16^h[A>>8&255]<<8^h[255&B]^g[d],v=h[z>>>24]<<24^h[A>>16&255]<<16^h[B>>8&255]<<8^h[255&y]^g[d+1],w=h[A>>>24]<<24^h[B>>16&255]<<16^h[y>>8&255]<<8^h[255&z]^g[d+2],x=h[B>>>24]<<24^h[y>>16&255]<<16^h[z>>8&255]<<8^h[255&A]^g[d+3],d+=3,t[b]=G(u^o),t[b+1]=G(x^p),t[b+2]=G(w^q),t[b+3]=G(v^r),o=C,p=D,q=E,r=F,b+=4}return t.buffer}},{key:"destroy",value:function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0}}]),a}();c.default=f},{}],19:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(17),h=d(g),i=a(20),j=d(i),k=a(18),l=d(k),m=a(33),n=a(53),o=function(){function a(b,c){e(this,a),this.observer=b,this.config=c,this.logEnabled=!0;try{var d=crypto?crypto:self.crypto;this.subtle=d.subtle||d.webkitSubtle}catch(a){}this.disableWebCrypto=!this.subtle}return f(a,[{key:"isSync",value:function(){return this.disableWebCrypto&&this.config.enableSoftwareAES}},{key:"decrypt",value:function(a,b,c,d){var e=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(n.logger.log("JS AES decrypt"),this.logEnabled=!1);var f=this.decryptor;f||(this.decryptor=f=new l.default),f.expandKey(b),d(f.decrypt(a,0,c))}else{this.logEnabled&&(n.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var g=this.subtle;this.key!==b&&(this.key=b,this.fastAesKey=new j.default(g,b)),this.fastAesKey.expandKey().then(function(f){var i=new h.default(g,c);i.decrypt(a,f).catch(function(f){e.onWebCryptoError(f,a,b,c,d)}).then(function(a){d(a)})}).catch(function(f){e.onWebCryptoError(f,a,b,c,d)})}}},{key:"onWebCryptoError",value:function(a,b,c,d,e){this.config.enableSoftwareAES?(n.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(b,c,d,e)):(n.logger.error("decrypting error : "+a.message),this.observer.trigger(Event.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:a.message}))}},{key:"destroy",value:function(){var a=this.decryptor;a&&(a.destroy(),this.decryptor=void 0)}}]),a}();c.default=o},{17:17,18:18,20:20,33:33,53:53}],20:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b,c){d(this,a),this.subtle=b,this.key=c}return e(a,[{key:"expandKey",value:function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}]),a}();c.default=f},{}],21:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(22),h=d(g),i=a(53),j=a(27),k=d(j),l=function(){function a(b,c,d){e(this,a),this.observer=b,this.config=d,this.remuxer=c}return f(a,[{key:"resetInitSegment",value:function(a,b,c,d){this._audioTrack={container:"audio/adts",type:"audio",id:-1,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:b,duration:d,inputTimeScale:9e4}}},{key:"resetTimeStamp",value:function(){}},{key:"append",value:function(a,b,c,d){var e,f,g,j,l,m,n,o,p,q,r=new k.default(a),s=90*r.timeStamp;for(e=this._audioTrack,m=r.length,p=a.length;m<p-1&&(255!==a[m]||240!==(246&a[m+1]));m++);for(e.samplerate||(f=h.default.getAudioConfig(this.observer,a,m,e.manifestCodec),e.config=f.config,e.samplerate=f.samplerate,e.channelCount=f.channelCount,e.codec=f.codec,i.logger.log("parsed codec:"+e.codec+",rate:"+f.samplerate+",nb channel:"+f.channelCount)),l=0,j=9216e4/e.samplerate;m+5<p&&(n=1&a[m+1]?7:9,g=(3&a[m+3])<<11|a[m+4]<<3|(224&a[m+5])>>>5,g-=n,g>0&&m+n+g<=p);)for(o=s+l*j,q={unit:a.subarray(m+n,m+n+g),pts:o,dts:o},e.samples.push(q),e.len+=g,m+=g+n,l++;m<p-1&&(255!==a[m]||240!==(246&a[m+1]));m++);this.remuxer.remux(e,{samples:[]},{samples:[{pts:s,dts:s,data:r.payload}],inputTimeScale:9e4},{samples:[]},b,c,d)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(a){var b,c,d=new k.default(a);if(d.hasTimeStamp)for(b=d.length,c=Math.min(a.length-1,b+100);b<c;b++)if(255===a[b]&&240===(246&a[b+1]))return!0;return!1}}]),a}();c.default=l},{22:22,27:27,53:53}],22:[function(a,b,c){"use strict";var d=a(53),e=a(33),f={getAudioConfig:function(a,b,c,f){var g,h,i,j,k,l=navigator.userAgent.toLowerCase(),m=f,n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return g=((192&b[c+2])>>>6)+1,h=(60&b[c+2])>>>2,h>n.length-1?void a.trigger(Event.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+h}):(j=(1&b[c+2])<<2,j|=(192&b[c+3])>>>6,d.logger.log("manifest codec:"+f+",ADTS data:type:"+g+",sampleingIndex:"+h+"["+n[h]+"Hz],channelConfig:"+j),/firefox/i.test(l)?h>=6?(g=5,k=new Array(4),i=h-3):(g=2,k=new Array(2),i=h):l.indexOf("android")!==-1?(g=2,k=new Array(2),i=h):(g=5,k=new Array(4),f&&(f.indexOf("mp4a.40.29")!==-1||f.indexOf("mp4a.40.5")!==-1)||!f&&h>=6?i=h-3:((f&&f.indexOf("mp4a.40.2")!==-1&&h>=6&&1===j||!f&&1===j)&&(g=2,k=new Array(2)),i=h)),k[0]=g<<3,k[0]|=(14&h)>>1,k[1]|=(1&h)<<7,k[1]|=j<<3,5===g&&(k[1]|=(14&i)>>1,k[2]=(1&i)<<7,k[2]|=8,k[3]=0),{config:k,samplerate:n[h],channelCount:j,codec:"mp4a.40."+g,manifestCodec:m})}};b.exports=f},{33:33,53:53}],23:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(35),h=d(g),i=a(33),j=a(19),k=d(j),l=a(21),m=d(l),n=a(29),o=d(n),p=a(32),q=d(p),r=a(28),s=d(r),t=a(45),u=d(t),v=a(46),w=d(v),x=function(){function a(b,c,d,f){e(this,a),this.observer=b,this.typeSupported=c,this.config=d,this.vendor=f}return f(a,[{key:"destroy",value:function(){var a=this.demuxer;a&&a.destroy()}},{key:"push",value:function(a,b,c,d,e,f,g,i,j,l,m,n){if(a.byteLength>0&&null!=b&&null!=b.key&&"AES-128"===b.method){var o=this.decrypter;null==o&&(o=this.decrypter=new k.default(this.observer,this.config));var p,q=this;try{p=performance.now()}catch(a){p=Date.now()}o.decrypt(a,b.key.buffer,b.iv.buffer,function(a){var k;try{k=performance.now()}catch(a){k=Date.now()}q.observer.trigger(h.default.FRAG_DECRYPTED,{stats:{tstart:p,tdecrypt:k}}),q.pushDecrypted(new Uint8Array(a),b,new Uint8Array(c),d,e,f,g,i,j,l,m,n)})}else this.pushDecrypted(new Uint8Array(a),b,new Uint8Array(c),d,e,f,g,i,j,l,m,n)}},{key:"pushDecrypted",value:function(a,b,c,d,e,f,g,j,k,l,n,p){var r=this.demuxer;if(!r||g&&!this.probe(a)){var t=this.observer,v=this.typeSupported,x=this.config,y=[{demux:q.default,remux:u.default},{demux:s.default,remux:u.default},{demux:m.default,remux:u.default},{demux:o.default,remux:w.default}];for(var z in y){var A=y[z],B=A.demux.probe;if(B(a)){var C=this.remuxer=new A.remux(t,x,v,this.vendor);r=new A.demux(t,C,x,v),this.probe=B;break}}if(!r)return void t.trigger(h.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=r}var D=this.remuxer;(g||j)&&(r.resetInitSegment(c,d,e,l),D.resetInitSegment()),g&&(r.resetTimeStamp(),D.resetTimeStamp(p)),"function"==typeof r.setDecryptData&&r.setDecryptData(b),r.append(a,f,k,n)}}]),a}();c.default=x},{19:19,21:21,28:28,29:29,32:32,33:33,35:35,45:45,46:46}],24:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0});var e=a(23),f=d(e),g=a(35),h=d(g),i=a(53),j=a(1),k=d(j),l=function(a){var b=new k.default;b.trigger=function(a){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];b.emit.apply(b,[a,a].concat(d))},b.off=function(a){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];b.removeListener.apply(b,[a].concat(d))};var c=function(b,c){a.postMessage({event:b,data:c})};a.addEventListener("message",function(d){var e=d.data;switch(e.cmd){case"init":var g=JSON.parse(e.config);a.demuxer=new f.default(b,e.typeSupported,g,e.vendor);try{(0,i.enableLogs)(g.debug===!0)}catch(a){console.warn("demuxerWorker: unable to enable logs")}c("init",null);break;case"demux":a.demuxer.push(e.data,e.decryptdata,e.initSegment,e.audioCodec,e.videoCodec,e.timeOffset,e.discontinuity,e.trackSwitch,e.contiguous,e.duration,e.accurateTimeOffset,e.defaultInitPTS)}}),b.on(h.default.FRAG_DECRYPTED,c),b.on(h.default.FRAG_PARSING_INIT_SEGMENT,c),b.on(h.default.FRAG_PARSED,c),b.on(h.default.ERROR,c),b.on(h.default.FRAG_PARSING_METADATA,c),b.on(h.default.FRAG_PARSING_USERDATA,c),b.on(h.default.INIT_PTS_FOUND,c),b.on(h.default.FRAG_PARSING_DATA,function(b,c){var d=[],e={event:b,data:c};c.data1&&(e.data1=c.data1.buffer,d.push(c.data1.buffer),delete c.data1),c.data2&&(e.data2=c.data2.buffer,d.push(c.data2.buffer),delete c.data2),a.postMessage(e,d)})};c.default=l},{1:1,23:23,35:35,53:53}],25:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(35),h=d(g),i=a(23),j=d(i),k=a(24),l=d(k),m=a(53),n=a(33),o=a(1),p=d(o),q=function(){function b(c,d){e(this,b),this.hls=c,this.id=d;var f=this.observer=new p.default,g=c.config;f.trigger=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];f.emit.apply(f,[a,a].concat(c))},f.off=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];f.removeListener.apply(f,[a].concat(c))};var i=function(a,b){b=b||{},b.frag=this.frag,b.id=this.id,c.trigger(a,b)}.bind(this);f.on(h.default.FRAG_DECRYPTED,i),f.on(h.default.FRAG_PARSING_INIT_SEGMENT,i),f.on(h.default.FRAG_PARSING_DATA,i),f.on(h.default.FRAG_PARSED,i),f.on(h.default.ERROR,i),f.on(h.default.FRAG_PARSING_METADATA,i),f.on(h.default.FRAG_PARSING_USERDATA,i),f.on(h.default.INIT_PTS_FOUND,i);var k={mp4:MediaSource.isTypeSupported("video/mp4"),mpeg:MediaSource.isTypeSupported("audio/mpeg"),mp3:MediaSource.isTypeSupported('audio/mp4; codecs="mp3"')},o=navigator.vendor;if(g.enableWorker&&"undefined"!=typeof Worker){m.logger.log("demuxing in webworker");var q=void 0;try{var r=a(3);q=this.w=r(l.default),this.onwmsg=this.onWorkerMessage.bind(this),q.addEventListener("message",this.onwmsg),q.onerror=function(a){c.trigger(h.default.ERROR,{type:n.ErrorTypes.OTHER_ERROR,details:n.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:a.message+" ("+a.filename+":"+a.lineno+")"}})},q.postMessage({cmd:"init",typeSupported:k,vendor:o,id:d,config:JSON.stringify(g)})}catch(a){m.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),q&&URL.revokeObjectURL(q.objectURL),this.demuxer=new j.default(f,k,g,o),this.w=void 0}}else this.demuxer=new j.default(f,k,g,o)}return f(b,[{key:"destroy",value:function(){var a=this.w;if(a)a.removeEventListener("message",this.onwmsg),a.terminate(),this.w=null;else{var b=this.demuxer;b&&(b.destroy(),this.demuxer=null)}var c=this.observer;c&&(c.removeAllListeners(),this.observer=null)}},{key:"push",value:function(a,b,c,d,e,f,g,h){var i=this.w,j=isNaN(e.startDTS)?e.start:e.startDTS,k=e.decryptdata,l=this.frag,n=!(l&&e.cc===l.cc),o=!(l&&e.level===l.level),p=l&&e.sn===l.sn+1,q=!o&&p;if(n&&m.logger.log(this.id+":discontinuity detected"),o&&m.logger.log(this.id+":switch detected"),this.frag=e,i)i.postMessage({cmd:"demux",data:a,decryptdata:k,initSegment:b,audioCodec:c,videoCodec:d,timeOffset:j,discontinuity:n,trackSwitch:o,contiguous:q,duration:f,accurateTimeOffset:g,defaultInitPTS:h},[a]);else{var r=this.demuxer;r&&r.push(a,k,b,c,d,j,n,o,q,f,g,h)}}},{key:"onWorkerMessage",value:function(a){var b=a.data,c=this.hls;switch(b.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case h.default.FRAG_PARSING_DATA:b.data.data1=new Uint8Array(b.data1),b.data2&&(b.data.data2=new Uint8Array(b.data2));default:b.data=b.data||{},b.data.frag=this.frag,b.data.id=this.id,c.trigger(b.event,b.data)}}}]),b}();c.default=q},{1:1,23:23,24:24,3:3,33:33,35:35,53:53}],26:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a(53),g=function(){function a(b){d(this,a),this.data=b,this.bytesAvailable=b.byteLength,this.word=0,this.bitsAvailable=0}return e(a,[{key:"loadWord",value:function(){var a=this.data,b=this.bytesAvailable,c=a.byteLength-b,d=new Uint8Array(4),e=Math.min(4,b);if(0===e)throw new Error("no bytes available");d.set(a.subarray(c,c+e)),this.word=new DataView(d.buffer).getUint32(0),this.bitsAvailable=8*e,this.bytesAvailable-=e}},{key:"skipBits",value:function(a){var b;this.bitsAvailable>a?(this.word<<=a,this.bitsAvailable-=a):(a-=this.bitsAvailable,b=a>>3,a-=b>>3,this.bytesAvailable-=b,this.loadWord(),this.word<<=a,this.bitsAvailable-=a)}},{key:"readBits",value:function(a){var b=Math.min(this.bitsAvailable,a),c=this.word>>>32-b;return a>32&&f.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=b,this.bitsAvailable>0?this.word<<=b:this.bytesAvailable>0&&this.loadWord(),b=a-b,b>0&&this.bitsAvailable?c<<b|this.readBits(b):c}},{key:"skipLZ",value:function(){var a;for(a=0;a<this.bitsAvailable;++a)if(0!==(this.word&2147483648>>>a))return this.word<<=a,this.bitsAvailable-=a,a;return this.loadWord(),a+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var a=this.skipLZ();return this.readBits(a+1)-1}},{key:"readEG",value:function(){var a=this.readUEG();return 1&a?1+a>>>1:-1*(a>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(a){var b,c,d=8,e=8;for(b=0;b<a;b++)0!==e&&(c=this.readEG(),e=(d+c+256)%256),d=0===e?d:e}},{key:"readSPS",value:function(){var a,b,c,d,e,f,g,h,i,j=0,k=0,l=0,m=0,n=this.readUByte.bind(this),o=this.readBits.bind(this),p=this.readUEG.bind(this),q=this.readBoolean.bind(this),r=this.skipBits.bind(this),s=this.skipEG.bind(this),t=this.skipUEG.bind(this),u=this.skipScalingList.bind(this);if(n(),a=n(),b=o(5),r(3),c=n(),t(),100===a||110===a||122===a||244===a||44===a||83===a||86===a||118===a||128===a){var v=p();if(3===v&&r(1),t(),t(),r(1),q())for(h=3!==v?8:12,i=0;i<h;i++)q()&&u(i<6?16:64)}t();var w=p();if(0===w)p();else if(1===w)for(r(1),s(),s(),d=p(),i=0;i<d;i++)s();t(),r(1),e=p(),f=p(),g=o(1),0===g&&r(1),r(1),q()&&(j=p(),k=p(),l=p(),m=p());var x=[1,1];if(q()&&q()){var y=n();switch(y){case 1:x=[1,1];break;case 2:x=[12,11];break;case 3:x=[10,11];break;case 4:x=[16,11];break;case 5:x=[40,33];break;case 6:x=[24,11];break;case 7:x=[20,11];break;case 8:x=[32,11];break;case 9:x=[80,33];break;case 10:x=[18,11];break;case 11:x=[15,11];break;case 12:x=[64,33];break;case 13:x=[160,99];break;case 14:x=[4,3];break;case 15:x=[3,2];break;case 16:x=[2,1];break;case 255:x=[n()<<8|n(),n()<<8|n()]}}return{width:Math.ceil(16*(e+1)-2*j-2*k),height:(2-g)*(f+1)*16-(g?2:4)*(l+m),pixelRatio:x}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),a}();c.default=g},{53:53}],27:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a(53),g=function(){function a(b){d(this,a),this._hasTimeStamp=!1,this._length=0;for(var c,e,g,h,i,j,k,l,m=0;;)if(k=this.readUTF(b,m,3),m+=3,"ID3"===k)m+=3,c=127&b[m++],e=127&b[m++],g=127&b[m++],h=127&b[m++],i=(c<<21)+(e<<14)+(g<<7)+h,j=m+i,this._parseID3Frames(b,m,j),m=j;else{if("3DI"!==k)return m-=3,l=m,void(l&&(this.hasTimeStamp||f.logger.warn("ID3 tag found, but no timestamp"),this._length=l,this._payload=b.subarray(0,l)));m+=7,f.logger.log("3DI footer found, end: "+m)}}return e(a,[{key:"readUTF",value:function(a,b,c){var d="",e=b,f=b+c;do d+=String.fromCharCode(a[e++]);while(e<f);return d}},{key:"_parseID3Frames",value:function(a,b,c){for(var d,e,g,h,i;b+8<=c;)switch(d=this.readUTF(a,b,4),b+=4,e=a[b++]<<24+a[b++]<<16+a[b++]<<8+a[b++],h=a[b++]<<8+a[b++],g=b,d){case"PRIV":if("com.apple.streaming.transportStreamTimestamp"===this.readUTF(a,b,44)){b+=44,b+=4;var j=1&a[b++];this._hasTimeStamp=!0,i=((a[b++]<<23)+(a[b++]<<15)+(a[b++]<<7)+a[b++])/45,j&&(i+=47721858.84),i=Math.round(i),f.logger.trace("ID3 timestamp found: "+i),this._timeStamp=i}}}},{key:"hasTimeStamp",get:function(){return this._hasTimeStamp}},{key:"timeStamp",get:function(){return this._timeStamp}},{key:"length",get:function(){return this._length}},{key:"payload",get:function(){return this._payload}}]),a}();c.default=g},{53:53}],28:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(27),h=d(g),i=a(30),j=d(i),k=function(){function a(b,c,d){e(this,a),this.observer=b,this.config=d,this.remuxer=c}return f(a,[{key:"resetInitSegment",value:function(a,b,c,d){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:b,duration:d,inputTimeScale:9e4}}},{key:"resetTimeStamp",value:function(){}},{key:"append",value:function(a,b,c,d){var e,f,g=new h.default(a),i=90*g.timeStamp,k=g.length;for(e=k,f=a.length;e<f-1&&(255!==a[e]||224!==(224&a[e+1])||0===(6&a[e+1]));e++);j.default.parse(this._audioTrack,a,g.length,i),this.remuxer.remux(this._audioTrack,{samples:[]},{samples:[{pts:i,dts:i,data:g.payload}],inputTimeScale:9e4},{samples:[]},b,c,d)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(a){var b,c,d=new h.default(a);if(d.hasTimeStamp)for(b=d.length,c=Math.min(a.length-1,b+100);b<c;b++)if(255===a[b]&&224===(224&a[b+1])&&0!==(6&a[b+1]))return!0;return!1}}]),a}();c.default=k},{27:27,30:30}],29:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(35),h=d(g),i=function(){function a(b,c){e(this,a),this.observer=b,this.remuxer=c}return f(a,[{key:"resetTimeStamp",value:function(){}},{key:"resetInitSegment",value:function(b,c,d,e){var f=this.initData=a.parseInitSegment(b),g={};f.audio&&(g.audio={container:"audio/mp4",codec:c,initSegment:b}),f.video&&(g.video={container:"video/mp4",codec:d,initSegment:b}),this.observer.trigger(h.default.FRAG_PARSING_INIT_SEGMENT,{tracks:g})}},{key:"append",value:function(b,c,d,e){var f=this.initData,g=a.startDTS(f,b);this.remuxer.remux(f.audio,f.video,null,null,g,d,e,b)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(b){if(b.length>=8){var c=a.bin2str(b.subarray(4,8));return["moof","ftyp","styp"].indexOf(c)>=0}return!1}},{key:"bin2str",value:function(a){return String.fromCharCode.apply(null,a)}},{key:"findBox",value:function(b,c){var d,e,f,g,h,i=[];if(!c.length)return null;for(d=0;d<b.byteLength;)e=b[d]<<24,e|=b[d+1]<<16,e|=b[d+2]<<8,e|=b[d+3],f=a.bin2str(b.subarray(d+4,d+8)),g=e>1?d+e:b.byteLength,f===c[0]&&(1===c.length?i.push(b.subarray(d+8,g)):(h=a.findBox(b.subarray(d+8,g),c.slice(1)),h.length&&(i=i.concat(h)))),d=g;return i}},{key:"parseInitSegment",value:function(b){var c=[],d=a.findBox(b,["moov","trak"]);return d.forEach(function(b){var d=a.findBox(b,["tkhd"])[0];if(d){var e=d[0],f=0===e?12:20,g=d[f]<<24|d[f+1]<<16|d[f+2]<<8|d[f+3];g=g<0?4294967296+g:g;var h=a.findBox(b,["mdia","mdhd"])[0];if(h){e=h[0],f=0===e?12:20;var i=h[f]<<24|h[f+1]<<16|h[f+2]<<8|h[f+3],j=a.findBox(b,["mdia","hdlr"])[0];if(j){var k=a.bin2str(j.subarray(8,12)),l={soun:"audio",vide:"video"}[k];l&&(c[g]={timescale:i,type:l},c[l]={timescale:i,id:g})}}}}),c}},{key:"startDTS",value:function(b,c){var d,e,f;return d=a.findBox(c,["moof","traf"]),e=[].concat.apply([],d.map(function(c){return a.findBox(c,["tfhd"]).map(function(d){var e,f,g;return e=d[4]<<24|d[5]<<16|d[6]<<8|d[7],f=b[e].timescale||9e4,g=a.findBox(c,["tfdt"]).map(function(a){var b,c;return b=a[0],c=a[4]<<24|a[5]<<16|a[6]<<8|a[7],1===b&&(c*=Math.pow(2,32),c+=a[8]<<24|a[9]<<16|a[10]<<8|a[11]),c})[0],g=g||1/0,g/f})})),f=Math.min.apply(null,e),isFinite(f)?f:0}}]),a}();c.default=i},{35:35}],30:[function(a,b,c){"use strict";var d=a(53),e={onFrame:function(a,b,c,d,e,f,g){var h=10368e4/d,i=g+f*h;a.config=[],a.channelCount=e,a.samplerate=d,a.samples.push({unit:b,pts:i,dts:i}),a.len+=b.length},onNoise:function(a){d.logger.warn("mpeg audio has noise: "+a.length+" bytes")},parseFrames:function(a,b,c,d,e,f){var g=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],h=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3];if(c+2>d)return-1;if(255===b[c]||224===(224&b[c+1])){if(c+24>d)return-1;var i=b[c+1]>>3&3,j=b[c+1]>>1&3,k=b[c+2]>>4&15,l=b[c+2]>>2&3,m=!!(2&b[c+2]);if(1!==i&&0!==k&&15!==k&&3!==l){var n=3===i?3-j:3===j?3:4,o=1e3*g[14*n+k-1],p=3===i?0:2===i?1:2,q=h[3*p+l],r=m?1:0,s=b[c+3]>>6===3?1:2,t=3===j?(3===i?12:6)*o/q+r<<2:(3===i?144:72)*o/q+r|0;return c+t>d?-1:(this.onFrame(a,b.subarray(c,c+t),o,q,s,e,f),t)}}for(var u=c+2;u<d;){if(255===b[u-1]&&224===(224&b[u]))return this.onNoise(b.subarray(c,u-1)),u-c-1;u++}return-1},parse:function(a,b,c,d){for(var e,f=b.length,g=0;c<f&&(e=this.parseFrames(a,b,c,f,g++,d))>0;)c+=e}};b.exports=e},{53:53}],31:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(19),h=d(g),i=function(){function a(b,c,d,f){e(this,a),this.decryptdata=d,this.discardEPB=f,this.decrypter=new h.default(b,c)}return f(a,[{key:"decryptBuffer",value:function(a,b){this.decrypter.decrypt(a,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,b)}},{key:"decryptAacSample",value:function(a,b,c,d){var e=a[b].unit,f=e.subarray(16,e.length-e.length%16),g=f.buffer.slice(f.byteOffset,f.byteOffset+f.length),h=this;this.decryptBuffer(g,function(f){f=new Uint8Array(f),e.set(f,16),d||h.decryptAacSamples(a,b+1,c)})}},{key:"decryptAacSamples",value:function(a,b,c){for(;;b++){if(b>=a.length)return void c();if(!(a[b].unit.length<32)){var d=this.decrypter.isSync();if(this.decryptAacSample(a,b,c,d),!d)return}}}},{key:"getAvcEncryptedData",value:function(a){for(var b=16*Math.floor((a.length-48)/160)+16,c=new Int8Array(b),d=0,e=32;e<=a.length-16;e+=160,d+=16)c.set(a.subarray(e,e+16),d);return c}},{key:"getAvcDecryptedUnit",value:function(a,b){b=new Uint8Array(b);for(var c=0,d=32;d<=a.length-16;d+=160,c+=16)a.set(b.subarray(c,c+16),d);return a}},{key:"decryptAvcSample",value:function(a,b,c,d,e,f){var g=this.discardEPB(e.data),h=this.getAvcEncryptedData(g),i=this;this.decryptBuffer(h.buffer,function(h){e.data=i.getAvcDecryptedUnit(g,h),f||i.decryptAvcSamples(a,b,c+1,d)})}},{key:"decryptAvcSamples",value:function(a,b,c,d){for(;;b++,c=0){if(b>=a.length)return void d();for(var e=a[b].units;!(c>=e.length);c++){var f=e[c];if(!(f.length<=48||1!==f.type&&5!==f.type)){var g=this.decrypter.isSync();if(this.decryptAvcSample(a,b,c,d,f,g),!g)return}}}}}]),a}();c.default=i},{19:19}],32:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(22),h=d(g),i=a(30),j=d(i),k=a(35),l=d(k),m=a(26),n=d(m),o=a(31),p=d(o),q=a(53),r=a(33),s=function(){function a(b,c,d,f){e(this,a),this.observer=b,this.config=d,this.typeSupported=f,this.remuxer=c,this.sampleAes=null}return f(a,[{key:"setDecryptData",value:function(a){null!=a&&null!=a.key&&"SAMPLE-AES"===a.method?this.sampleAes=new p.default(this.observer,this.config,a,this.discardEPB):this.sampleAes=null}},{key:"resetInitSegment",value:function(a,b,c,d){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack={container:"video/mp2t",type:"video",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:0},this._audioTrack={container:"video/mp2t",type:"audio",id:-1,inputTimeScale:9e4,duration:d,sequenceNumber:0,samples:[],len:0,isAAC:!0},this._id3Track={type:"id3",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0},this._txtTrack={type:"text",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0},this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=b,this.videoCodec=c,this._duration=d}},{key:"resetTimeStamp",value:function(){}},{key:"append",value:function(a,b,c,d){var e,f,g,h,i,j,k=a.length,m=!1;this.contiguous=c;var n=this.pmtParsed,o=this._avcTrack,p=this._audioTrack,s=this._id3Track,t=o.id,u=p.id,v=s.id,w=this._pmtId,x=o.pesData,y=p.pesData,z=s.pesData,A=this._parsePAT,B=this._parsePMT,C=this._parsePES,D=this._parseAVCPES.bind(this),E=this._parseAACPES.bind(this),F=this._parseMPEGPES.bind(this),G=this._parseID3PES.bind(this);for(k-=k%188,e=0;e<k;e+=188)if(71===a[e]){if(f=!!(64&a[e+1]),g=((31&a[e+1])<<8)+a[e+2],h=(48&a[e+3])>>4,h>1){if(i=e+5+a[e+4],i===e+188)continue}else i=e+4;switch(g){case t:f&&(x&&(j=C(x))&&D(j,!1),x={data:[],size:0}),x&&(x.data.push(a.subarray(i,e+188)),x.size+=e+188-i);break;case u:f&&(y&&(j=C(y))&&(p.isAAC?E(j):F(j)),y={data:[],size:0}),y&&(y.data.push(a.subarray(i,e+188)),y.size+=e+188-i);break;case v:f&&(z&&(j=C(z))&&G(j),z={data:[],size:0}),z&&(z.data.push(a.subarray(i,e+188)),z.size+=e+188-i);break;case 0:f&&(i+=a[i]+1),w=this._pmtId=A(a,i);break;case w:f&&(i+=a[i]+1);var H=B(a,i,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,null!=this.sampleAes);t=H.avc,t>0&&(o.id=t),u=H.audio,u>0&&(p.id=u,p.isAAC=H.isAAC),v=H.id3,v>0&&(s.id=v),m&&!n&&(q.logger.log("reparse from beginning"),m=!1,e=-188),n=this.pmtParsed=!0;break;case 17:case 8191:break;default:m=!0}}else this.observer.trigger(l.default.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});x&&(j=C(x))?(D(j,!0),o.pesData=null):o.pesData=x,y&&(j=C(y))?(p.isAAC?E(j):F(j),p.pesData=null):(y&&y.size&&q.logger.log("last AAC PES packet truncated,might overlap between fragments"),p.pesData=y),z&&(j=C(z))?(G(j),s.pesData=null):s.pesData=z,null==this.sampleAes?this.remuxer.remux(p,o,s,this._txtTrack,b,c,d):this.decryptAndRemux(p,o,s,this._txtTrack,b,c,d)}},{key:"decryptAndRemux",value:function(a,b,c,d,e,f,g){if(a.samples&&a.isAAC){var h=this;this.sampleAes.decryptAacSamples(a.samples,0,function(){h.decryptAndRemuxAvc(a,b,c,d,e,f,g)})}else this.decryptAndRemuxAvc(a,b,c,d,e,f,g)}},{key:"decryptAndRemuxAvc",
value:function(a,b,c,d,e,f,g){if(b.samples){var h=this;this.sampleAes.decryptAvcSamples(b.samples,0,0,function(){h.remuxer.remux(a,b,c,d,e,f,g)})}else this.remuxer.remux(a,b,c,d,e,f,g)}},{key:"destroy",value:function(){this._initPTS=this._initDTS=void 0,this._duration=0}},{key:"_parsePAT",value:function(a,b){return(31&a[b+10])<<8|a[b+11]}},{key:"_parsePMT",value:function(a,b,c,d){var e,f,g,h,i={audio:-1,avc:-1,id3:-1,isAAC:!0};for(e=(15&a[b+1])<<8|a[b+2],f=b+3+e-4,g=(15&a[b+10])<<8|a[b+11],b+=12+g;b<f;){switch(h=(31&a[b+1])<<8|a[b+2],a[b]){case 207:if(!d){q.logger.log("unkown stream type:"+a[b]);break}case 15:i.audio===-1&&(i.audio=h);break;case 21:i.id3===-1&&(i.id3=h);break;case 219:if(!d){q.logger.log("unkown stream type:"+a[b]);break}case 27:i.avc===-1&&(i.avc=h);break;case 3:case 4:c?i.audio===-1&&(i.audio=h,i.isAAC=!1):q.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:q.logger.warn("HEVC stream type found, not supported for now");break;default:q.logger.log("unkown stream type:"+a[b])}b+=((15&a[b+3])<<8|a[b+4])+5}return i}},{key:"_parsePES",value:function(a){var b,c,d,e,f,g,h,i,j,k=0,l=a.data;if(!a||0===a.size)return null;for(;l[0].length<19&&l.length>1;){var m=new Uint8Array(l[0].length+l[1].length);m.set(l[0]),m.set(l[1],l[0].length),l[0]=m,l.splice(1,1)}if(b=l[0],d=(b[0]<<16)+(b[1]<<8)+b[2],1===d){if(e=(b[4]<<8)+b[5],e&&e>a.size-6)return null;c=b[7],192&c&&(h=536870912*(14&b[9])+4194304*(255&b[10])+16384*(254&b[11])+128*(255&b[12])+(254&b[13])/2,h>4294967295&&(h-=8589934592),64&c?(i=536870912*(14&b[14])+4194304*(255&b[15])+16384*(254&b[16])+128*(255&b[17])+(254&b[18])/2,i>4294967295&&(i-=8589934592),h-i>54e5&&(q.logger.warn(Math.round((h-i)/9e4)+"s delta between PTS and DTS, align them"),h=i)):i=h),f=b[8],j=f+9,a.size-=j,g=new Uint8Array(a.size);for(var n=0,o=l.length;n<o;n++){b=l[n];var p=b.byteLength;if(j){if(j>p){j-=p;continue}b=b.subarray(j),p-=j,j=0}g.set(b,k),k+=p}return e&&(e-=f+3),{data:g,pts:h,dts:i,len:e}}return null}},{key:"pushAccesUnit",value:function(a,b){if(a.units.length&&a.frame){var c=b.samples,d=c.length;!this.config.forceKeyFrameOnDiscontinuity||a.key===!0||b.sps&&(d||this.contiguous)?(a.id=d,c.push(a)):b.dropped++}a.debug.length&&q.logger.log(a.pts+"/"+a.dts+":"+a.debug)}},{key:"_parseAVCPES",value:function(a,b){var c,d,e,f=this,g=this._avcTrack,h=this._parseAVCNALu(a.data),i=!1,j=this.avcSample;a.data=null,h.forEach(function(b){switch(b.type){case 1:d=!0,i&&j&&(j.debug+="NDR "),j.frame=!0;var h=b.data;if(h.length>4){var k=new n.default(h).readSliceType();2!==k&&4!==k&&7!==k&&9!==k||(j.key=!0)}break;case 5:d=!0,j||(j=f.avcSample=f._createAVCSample(!0,a.pts,a.dts,"")),i&&(j.debug+="IDR "),j.key=!0,j.frame=!0;break;case 6:d=!0,i&&j&&(j.debug+="SEI "),c=new n.default(f.discardEPB(b.data)),c.readUByte();for(var l=0,m=0,o=!1,p=0;!o&&c.bytesAvailable>1;){l=0;do p=c.readUByte(),l+=p;while(255===p);m=0;do p=c.readUByte(),m+=p;while(255===p);if(4===l&&0!==c.bytesAvailable){o=!0;var q=c.readUByte();if(181===q){var r=c.readUShort();if(49===r){var s=c.readUInt();if(1195456820===s){var t=c.readUByte();if(3===t){var u=c.readUByte(),v=c.readUByte(),w=31&u,x=[u,v];for(e=0;e<w;e++)x.push(c.readUByte()),x.push(c.readUByte()),x.push(c.readUByte());f._insertSampleInOrder(f._txtTrack.samples,{type:3,pts:a.pts,bytes:x})}}}}}else if(m<c.bytesAvailable)for(e=0;e<m;e++)c.readUByte()}break;case 7:if(d=!0,i&&j&&(j.debug+="SPS "),!g.sps){c=new n.default(b.data);var y=c.readSPS();g.width=y.width,g.height=y.height,g.pixelRatio=y.pixelRatio,g.sps=[b.data],g.duration=f._duration;var z=b.data.subarray(1,4),A="avc1.";for(e=0;e<3;e++){var B=z[e].toString(16);B.length<2&&(B="0"+B),A+=B}g.codec=A}break;case 8:d=!0,i&&j&&(j.debug+="PPS "),g.pps||(g.pps=[b.data]);break;case 9:d=!1,j&&f.pushAccesUnit(j,g),j=f.avcSample=f._createAVCSample(!1,a.pts,a.dts,i?"AUD ":"");break;case 12:d=!1;break;default:d=!1,j&&(j.debug+="unknown NAL "+b.type+" ")}if(j&&d){var C=j.units;C.push(b)}}),b&&j&&(this.pushAccesUnit(j,g),this.avcSample=null)}},{key:"_createAVCSample",value:function(a,b,c,d){return{key:a,pts:b,dts:c,units:[],debug:d}}},{key:"_insertSampleInOrder",value:function(a,b){var c=a.length;if(c>0){if(b.pts>=a[c-1].pts)a.push(b);else for(var d=c-1;d>=0;d--)if(b.pts<a[d].pts){a.splice(d,0,b);break}}else a.push(b)}},{key:"_getLastNalUnit",value:function(){var a=this.avcSample,b=void 0;if(!a||0===a.units.length){var c=this._avcTrack,d=c.samples;a=d[d.length-1]}if(a){var e=a.units;b=e[e.length-1]}return b}},{key:"_parseAVCNALu",value:function(a){var b,c,d,e,f,g=0,h=a.byteLength,i=this._avcTrack,j=i.naluState||0,k=j,l=[],m=-1;for(j===-1&&(m=0,f=31&a[0],j=0,g=1);g<h;)if(b=a[g++],j)if(1!==j)if(b)if(1===b){if(m>=0)d={data:a.subarray(m,g-j-1),type:f},l.push(d);else{var n=this._getLastNalUnit();if(n&&(k&&g<=4-k&&n.state&&(n.data=n.data.subarray(0,n.data.byteLength-k)),c=g-j-1,c>0)){var o=new Uint8Array(n.data.byteLength+c);o.set(n.data,0),o.set(a.subarray(0,c),n.data.byteLength),n.data=o}}g<h?(e=31&a[g],m=g,f=e,j=0):j=-1}else j=0;else j=3;else j=b?0:2;else j=b?0:1;if(m>=0&&j>=0&&(d={data:a.subarray(m,h),type:f,state:j},l.push(d)),0===l.length){var p=this._getLastNalUnit();if(p){var q=new Uint8Array(p.data.byteLength+a.byteLength);q.set(p.data,0),q.set(a,p.data.byteLength),p.data=q}}return i.naluState=j,l}},{key:"discardEPB",value:function(a){for(var b,c,d=a.byteLength,e=[],f=1;f<d-2;)0===a[f]&&0===a[f+1]&&3===a[f+2]?(e.push(f+2),f+=2):f++;if(0===e.length)return a;b=d-e.length,c=new Uint8Array(b);var g=0;for(f=0;f<b;g++,f++)g===e[0]&&(g++,e.shift()),c[f]=a[g];return c}},{key:"_parseAACPES",value:function(a){var b,c,d,e,f,g,i,j,k,m=this._audioTrack,n=a.data,o=a.pts,p=0,s=this.aacOverFlow,t=this.aacLastPTS;if(s){var u=new Uint8Array(s.byteLength+n.byteLength);u.set(s,0),u.set(n,s.byteLength),n=u}for(f=p,j=n.length;f<j-1&&(255!==n[f]||240!==(240&n[f+1]));f++);if(f){var v,w;if(f<j-1?(v="AAC PES did not start with ADTS header,offset:"+f,w=!1):(v="no ADTS header found in AAC PES",w=!0),q.logger.warn("parsing error:"+v),this.observer.trigger(l.default.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.FRAG_PARSING_ERROR,fatal:w,reason:v}),w)return}if(!m.samplerate){var x=this.audioCodec;b=h.default.getAudioConfig(this.observer,n,f,x),m.config=b.config,m.samplerate=b.samplerate,m.channelCount=b.channelCount,m.codec=b.codec,m.manifestCodec=b.manifestCodec,q.logger.log("parsed codec:"+m.codec+",rate:"+b.samplerate+",nb channel:"+b.channelCount)}if(e=0,d=9216e4/m.samplerate,s&&t){var y=t+d;Math.abs(y-o)>1&&(q.logger.log("AAC: align PTS for overlapping frames by "+Math.round((y-o)/90)),o=y)}for(;f+5<j&&(g=1&n[f+1]?7:9,c=(3&n[f+3])<<11|n[f+4]<<3|(224&n[f+5])>>>5,c-=g,c>0&&f+g+c<=j);)for(i=o+e*d,k={unit:n.subarray(f+g,f+g+c),pts:i,dts:i},m.samples.push(k),m.len+=c,f+=c+g,e++;f<j-1&&(255!==n[f]||240!==(240&n[f+1]));f++);s=f<j?n.subarray(f,j):null,this.aacOverFlow=s,this.aacLastPTS=i}},{key:"_parseMPEGPES",value:function(a){j.default.parse(this._audioTrack,a.data,0,a.pts)}},{key:"_parseID3PES",value:function(a){this._id3Track.samples.push(a)}}],[{key:"probe",value:function(a){return a.length>=564&&71===a[0]&&71===a[188]&&71===a[376]}}]),a}();c.default=s},{22:22,26:26,30:30,31:31,33:33,35:35,53:53}],33:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});c.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},c.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException",WEBVTT_EXCEPTION:"webVTTException"}},{}],34:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a(53),i=a(33),j=a(35),k=d(j),l=function(){function a(b){e(this,a),this.hls=b,this.onEvent=this.onEvent.bind(this);for(var c=arguments.length,d=Array(c>1?c-1:0),f=1;f<c;f++)d[f-1]=arguments[f];this.handledEvents=d,this.useGenericHandler=!0,this.registerListeners()}return g(a,[{key:"destroy",value:function(){this.unregisterListeners()}},{key:"isEventHandler",value:function(){return"object"===f(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(a){if("hlsEventGeneric"===a)throw new Error("Forbidden event name: "+a);this.hls.on(a,this.onEvent)}.bind(this))}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(a){this.hls.off(a,this.onEvent)}.bind(this))}},{key:"onEvent",value:function(a,b){this.onEventGeneric(a,b)}},{key:"onEventGeneric",value:function(a,b){var c=function(a,b){var c="on"+a.replace("hls","");if("function"!=typeof this[c])throw new Error("Event "+a+" has no generic handler in this "+this.constructor.name+" class (tried "+c+")");return this[c].bind(this,b)};try{c.call(this,a,b).call()}catch(b){h.logger.error("internal error happened while processing "+a+":"+b.message),this.hls.trigger(k.default.ERROR,{type:i.ErrorTypes.OTHER_ERROR,details:i.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:a,err:b})}}}]),a}();c.default=l},{33:33,35:35,53:53}],35:[function(a,b,c){"use strict";b.exports={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCH:"hlsLevelSwitch",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},{}],36:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(){d(this,a)}return e(a,null,[{key:"getSilentFrame",value:function(a,b){switch(a){case"mp4a.40.2":if(1===b)return new Uint8Array([0,200,0,128,35,128]);if(2===b)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===b)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===b)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===b)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),a}();c.default=f},{}],37:[function(a,b,c){"use strict";var d={isBuffered:function(a,b){if(a)for(var c=a.buffered,d=0;d<c.length;d++)if(b>=c.start(d)&&b<=c.end(d))return!0;return!1},bufferInfo:function(a,b,c){if(a){var d,e=a.buffered,f=[];for(d=0;d<e.length;d++)f.push({start:e.start(d),end:e.end(d)});return this.bufferedInfo(f,b,c)}return{len:0,start:b,end:b,nextStart:void 0}},bufferedInfo:function(a,b,c){var d,e,f,g,h,i=[];for(a.sort(function(a,b){var c=a.start-b.start;return c?c:b.end-a.end}),h=0;h<a.length;h++){var j=i.length;if(j){var k=i[j-1].end;a[h].start-k<c?a[h].end>k&&(i[j-1].end=a[h].end):i.push(a[h])}else i.push(a[h])}for(h=0,d=0,e=f=b;h<i.length;h++){var l=i[h].start,m=i[h].end;if(b+c>=l&&b<m)e=l,f=m,d=f-b;else if(b+c<l){g=l;break}}return{len:d,start:e,end:f,nextStart:g}}};b.exports=d},{}],38:[function(a,b,c){"use strict";var d=a(53),e={mergeDetails:function(a,b){var c,f=Math.max(a.startSN,b.startSN)-b.startSN,g=Math.min(a.endSN,b.endSN)-b.startSN,h=b.startSN-a.startSN,i=a.fragments,j=b.fragments,k=0;if(g<f)return void(b.PTSKnown=!1);for(var l=f;l<=g;l++){var m=i[h+l],n=j[l];n&&m&&(k=m.cc-n.cc,isNaN(m.startPTS)||(n.start=n.startPTS=m.startPTS,n.endPTS=m.endPTS,n.duration=m.duration,c=n))}if(k)for(d.logger.log("discontinuity sliding from playlist, take drift into account"),l=0;l<j.length;l++)j[l].cc+=k;if(c)e.updateFragPTSDTS(b,c,c.startPTS,c.endPTS,c.startDTS,c.endDTS);else if(h>=0&&h<i.length){var o=i[h].start;for(l=0;l<j.length;l++)j[l].start+=o}b.PTSKnown=a.PTSKnown},updateFragPTSDTS:function(a,b,c,d,f,g){if(!isNaN(b.startPTS)){var h=Math.abs(b.startPTS-c);isNaN(b.deltaPTS)?b.deltaPTS=h:b.deltaPTS=Math.max(h,b.deltaPTS),c=Math.min(c,b.startPTS),d=Math.max(d,b.endPTS),f=Math.min(f,b.startDTS),g=Math.max(g,b.endDTS)}var i=c-b.start;b.start=b.startPTS=c,b.endPTS=d,b.startDTS=f,b.endDTS=g,b.duration=d-c;var j=b.sn;if(!a||j<a.startSN||j>a.endSN)return 0;var k,l,m;for(k=j-a.startSN,l=a.fragments,b=l[k],m=k;m>0;m--)e.updatePTS(l,m,m-1);for(m=k;m<l.length-1;m++)e.updatePTS(l,m,m+1);return a.PTSKnown=!0,i},updatePTS:function(a,b,c){var e=a[b],f=a[c],g=f.startPTS;isNaN(g)?c>b?f.start=e.start+e.duration:f.start=Math.max(e.start-f.duration,0):c>b?(e.duration=g-e.start,e.duration<0&&d.logger.warn("negative duration computed for frag "+e.sn+",level "+e.level+", there should be some duration drift between playlist and fragment!")):(f.duration=e.start-g,f.duration<0&&d.logger.warn("negative duration computed for frag "+f.sn+",level "+f.level+", there should be some duration drift between playlist and fragment!"))}};b.exports=e},{53:53}],39:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(2),h=d(g),i=a(35),j=d(i),k=a(33),l=a(43),m=d(l),n=a(41),o=d(n),p=a(42),q=d(p),r=a(13),s=d(r),t=a(12),u=d(t),v=a(11),w=d(v),x=a(53),y=a(1),z=d(y),A=a(4),B=function(){function a(){var b=this,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e(this,a);var d=a.DefaultConfig;if((c.liveSyncDurationCount||c.liveMaxLatencyDurationCount)&&(c.liveSyncDuration||c.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var f in d)f in c||(c[f]=d[f]);if(void 0!==c.liveMaxLatencyDurationCount&&c.liveMaxLatencyDurationCount<=c.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==c.liveMaxLatencyDuration&&(c.liveMaxLatencyDuration<=c.liveSyncDuration||void 0===c.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');(0,x.enableLogs)(c.debug),this.config=c,this._autoLevelCapping=-1;var g=this.observer=new z.default;g.trigger=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];g.emit.apply(g,[a,a].concat(c))},g.off=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];g.removeListener.apply(g,[a].concat(c))},this.on=g.on.bind(g),this.off=g.off.bind(g),this.trigger=g.trigger.bind(g);var h=this.abrController=new c.abrController(this),i=new c.bufferController(this),j=new c.capLevelController(this),k=new c.fpsController(this),l=new m.default(this),n=new o.default(this),p=new q.default(this),r=new w.default(this),t=this.levelController=new u.default(this),v=this.streamController=new s.default(this),y=[t,v],A=c.audioStreamController;A&&y.push(new A(this)),this.networkControllers=y;var B=[l,n,p,h,i,j,k,r];if(A=c.audioTrackController){var C=new A(this);this.audioTrackController=C,B.push(C)}if(A=c.subtitleTrackController){var D=new A(this);this.subtitleTrackController=D,B.push(D)}[c.subtitleStreamController,c.timelineController].forEach(function(a){a&&B.push(new a(b))}),this.coreComponents=B}return f(a,null,[{key:"isSupported",value:function(){return window.MediaSource=window.MediaSource||window.WebKitMediaSource,window.MediaSource&&"function"==typeof window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"version",get:function(){return"0.7.7"}},{key:"Events",get:function(){return j.default}},{key:"ErrorTypes",get:function(){return k.ErrorTypes}},{key:"ErrorDetails",get:function(){return k.ErrorDetails}},{key:"DefaultConfig",get:function(){return a.defaultConfig?a.defaultConfig:A.hlsDefaultConfig},set:function(b){a.defaultConfig=b}}]),f(a,[{key:"destroy",value:function(){x.logger.log("destroy"),this.trigger(j.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(a){a.destroy()}),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1}},{key:"attachMedia",value:function(a){x.logger.log("attachMedia"),this.media=a,this.trigger(j.default.MEDIA_ATTACHING,{media:a})}},{key:"detachMedia",value:function(){x.logger.log("detachMedia"),this.trigger(j.default.MEDIA_DETACHING),this.media=null}},{key:"loadSource",value:function(a){a=h.default.buildAbsoluteURL(window.location.href,a,{alwaysNormalize:!0}),x.logger.log("loadSource:"+a),this.url=a,this.trigger(j.default.MANIFEST_LOADING,{url:a})}},{key:"startLoad",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;x.logger.log("startLoad("+a+")"),this.networkControllers.forEach(function(b){b.startLoad(a)})}},{key:"stopLoad",value:function(){x.logger.log("stopLoad"),this.networkControllers.forEach(function(a){a.stopLoad()})}},{key:"swapAudioCodec",value:function(){x.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){x.logger.log("recoverMediaError");var a=this.media;this.detachMedia(),this.attachMedia(a)}},{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(a){x.logger.log("set currentLevel:"+a),this.loadLevel=a,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(a){x.logger.log("set nextLevel:"+a),this.levelController.manualLevel=a,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(a){x.logger.log("set loadLevel:"+a),this.levelController.manualLevel=a}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(a){this.levelController.nextLoadLevel=a}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(a){x.logger.log("set firstLevel:"+a),this.levelController.firstLevel=a}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(a){x.logger.log("set startLevel:"+a);var b=this;a!==-1&&(a=Math.max(a,b.minAutoLevel)),b.levelController.startLevel=a}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(a){x.logger.log("set autoLevelCapping:"+a),this._autoLevelCapping=a}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var a=this,b=a.levels,c=a.config.minAutoBitrate,d=b?b.length:0,e=0;e<d;e++){var f=b[e].realBitrate?Math.max(b[e].realBitrate,b[e].bitrate):b[e].bitrate;if(f>c)return e}return 0}},{key:"maxAutoLevel",get:function(){var a=this,b=a.levels,c=a.autoLevelCapping,d=void 0;return d=c===-1&&b&&b.length?b.length-1:c}},{key:"nextAutoLevel",get:function(){var a=this;return Math.min(Math.max(a.abrController.nextAutoLevel,a.minAutoLevel),a.maxAutoLevel)},set:function(a){var b=this;b.abrController.nextAutoLevel=Math.max(b.minAutoLevel,a)}},{key:"audioTracks",get:function(){var a=this.audioTrackController;return a?a.audioTracks:[]}},{key:"audioTrack",get:function(){var a=this.audioTrackController;return a?a.audioTrack:-1},set:function(a){var b=this.audioTrackController;b&&(b.audioTrack=a)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var a=this.subtitleTrackController;return a?a.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var a=this.subtitleTrackController;return a?a.subtitleTrack:-1},set:function(a){var b=this.subtitleTrackController;b&&(b.subtitleTrack=a)}}]),a}();c.default=B},{1:1,11:11,12:12,13:13,2:2,33:33,35:35,4:4,41:41,42:42,43:43,53:53}],40:[function(a,b,c){"use strict";b.exports=a(39).default},{39:39}],41:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(35),j=d(i),k=a(34),l=d(k),m=a(33),n=a(53),o=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,j.default.FRAG_LOADING));return c.loaders={},c}return g(b,a),h(b,[{key:"destroy",value:function(){var a=this.loaders;for(var b in a){var c=a[b];c&&c.destroy()}this.loaders={},l.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(a){var b=a.frag,c=b.type,d=this.loaders[c],e=this.hls.config;b.loaded=0,d&&(n.logger.warn("abort previous fragment loader for type:"+c),d.abort()),d=this.loaders[c]=b.loader="undefined"!=typeof e.fLoader?new e.fLoader(e):new e.loader(e);var f=void 0,g=void 0,h=void 0;f={url:b.url,frag:b,responseType:"arraybuffer",progressData:!1};var i=b.byteRangeStartOffset,j=b.byteRangeEndOffset;isNaN(i)||isNaN(j)||(f.rangeStart=i,f.rangeEnd=j),g={timeout:e.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:e.fragLoadingMaxRetryTimeout},h={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},d.load(f,g,h)}},{key:"loadsuccess",value:function(a,b,c){var d=a.data,e=c.frag;e.loader=void 0,this.loaders[e.type]=void 0,this.hls.trigger(j.default.FRAG_LOADED,{payload:d,frag:e,stats:b})}},{key:"loaderror",value:function(a,b){var c=b.loader;c&&c.abort(),this.loaders[b.type]=void 0,this.hls.trigger(j.default.ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:b.frag,response:a})}},{key:"loadtimeout",value:function(a,b){var c=b.loader;c&&c.abort(),this.loaders[b.type]=void 0,this.hls.trigger(j.default.ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:b.frag})}},{key:"loadprogress",value:function(a,b,c){var d=b.frag;d.loaded=a.loaded,this.hls.trigger(j.default.FRAG_LOAD_PROGRESS,{frag:d,stats:a})}}]),b}(l.default);c.default=o},{33:33,34:34,35:35,53:53}],42:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(35),j=d(i),k=a(34),l=d(k),m=a(33),n=a(53),o=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,j.default.KEY_LOADING));return c.loaders={},c.decryptkey=null,c.decrypturl=null,c}return g(b,a),h(b,[{key:"destroy",value:function(){for(var a in this.loaders){var b=this.loaders[a];b&&b.destroy()}this.loaders={},l.default.prototype.destroy.call(this)}},{key:"onKeyLoading",value:function(a){var b=a.frag,c=b.type,d=this.loaders[c],e=b.decryptdata,f=e.uri;if(f!==this.decrypturl||null===this.decryptkey){var g=this.hls.config;d&&(n.logger.warn("abort previous key loader for type:"+c),d.abort()),b.loader=this.loaders[c]=new g.loader(g),this.decrypturl=f,this.decryptkey=null;var h=void 0,i=void 0,k=void 0;h={url:f,frag:b,responseType:"arraybuffer"},i={timeout:g.fragLoadingTimeOut,maxRetry:g.fragLoadingMaxRetry,retryDelay:g.fragLoadingRetryDelay,maxRetryDelay:g.fragLoadingMaxRetryTimeout},k={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},b.loader.load(h,i,k)}else this.decryptkey&&(e.key=this.decryptkey,this.hls.trigger(j.default.KEY_LOADED,{frag:b}))}},{key:"loadsuccess",value:function(a,b,c){var d=c.frag;this.decryptkey=d.decryptdata.key=new Uint8Array(a.data),d.loader=void 0,this.loaders[d.type]=void 0,this.hls.trigger(j.default.KEY_LOADED,{frag:d})}},{key:"loaderror",value:function(a,b){var c=b.frag,d=c.loader;d&&d.abort(),this.loaders[b.type]=void 0,this.hls.trigger(j.default.ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:c,response:a})}},{key:"loadtimeout",value:function(a,b){var c=b.frag,d=c.loader;d&&d.abort(),this.loaders[b.type]=void 0,this.hls.trigger(j.default.ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:c})}}]),b}(l.default);c.default=o},{33:33,34:34,35:35,53:53}],43:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function g(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(2),j=d(i),k=a(35),l=d(k),m=a(34),n=d(m),o=a(33),p=a(47),q=d(p),r=a(53),s=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,t=/#EXT-X-MEDIA:(.*)/g,u=/#EXTINF:(\d*(?:\.\d+)?)(?:,(.*))?|(?!#)(\S.+)|#EXT-X-BYTERANGE: *(.+)|#EXT-X-PROGRAM-DATE-TIME:(.+)|#.*/g,v=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,w=function(){function a(){g(this,a),this.method=null,this.key=null,this.iv=null,this._uri=null}return h(a,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=j.default.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),a}(),x=function(){function a(){g(this,a),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[]}return h(a,[{key:"createInitializationVector",
value:function(a){for(var b=new Uint8Array(16),c=12;c<16;c++)b[c]=a>>8*(15-c)&255;return b}},{key:"fragmentDecryptdataFromLevelkey",value:function(a,b){var c=a;return a&&a.method&&a.uri&&!a.iv&&(c=new w,c.method=a.method,c.baseuri=a.baseuri,c.reluri=a.reluri,c.iv=this.createInitializationVector(b)),c}},{key:"cloneObj",value:function(a){return JSON.parse(JSON.stringify(a))}},{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=j.default.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(a){this._url=a}},{key:"programDateTime",get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){if(!this._byteRange){var a=this._byteRange=[];if(this.rawByteRange){var b=this.rawByteRange.split("@",2);if(1===b.length){var c=this.lastByteRangeEndOffset;a[0]=c?c:0}else a[0]=parseInt(b[1]);a[1]=parseInt(b[0])+a[0]}}return this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}]),a}(),y=function(a){function b(a){g(this,b);var c=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,l.default.MANIFEST_LOADING,l.default.LEVEL_LOADING,l.default.AUDIO_TRACK_LOADING,l.default.SUBTITLE_TRACK_LOADING));return c.loaders={},c}return f(b,a),h(b,[{key:"destroy",value:function(){for(var a in this.loaders){var b=this.loaders[a];b&&b.destroy()}this.loaders={},n.default.prototype.destroy.call(this)}},{key:"onManifestLoading",value:function(a){this.load(a.url,{type:"manifest"})}},{key:"onLevelLoading",value:function(a){this.load(a.url,{type:"level",level:a.level,id:a.id})}},{key:"onAudioTrackLoading",value:function(a){this.load(a.url,{type:"audioTrack",id:a.id})}},{key:"onSubtitleTrackLoading",value:function(a){this.load(a.url,{type:"subtitleTrack",id:a.id})}},{key:"load",value:function(a,b){var c=this.loaders[b.type];if(c){var d=c.context;if(d&&d.url===a)return void r.logger.trace("playlist request ongoing");r.logger.warn("abort previous loader for type:"+b.type),c.abort()}var e=this.hls.config,f=void 0,g=void 0,h=void 0,i=void 0;"manifest"===b.type?(f=e.manifestLoadingMaxRetry,g=e.manifestLoadingTimeOut,h=e.manifestLoadingRetryDelay,i=e.manifestLoadingMaxRetryTimeout):(f=e.levelLoadingMaxRetry,g=e.levelLoadingTimeOut,h=e.levelLoadingRetryDelay,i=e.levelLoadingMaxRetryTimeout,r.logger.log("loading playlist for "+b.type+" "+(b.level||b.id))),c=this.loaders[b.type]=b.loader="undefined"!=typeof e.pLoader?new e.pLoader(e):new e.loader(e),b.url=a,b.responseType="";var j=void 0,k=void 0;j={timeout:g,maxRetry:f,retryDelay:h,maxRetryDelay:i},k={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},c.load(b,j,k)}},{key:"resolve",value:function(a,b){return j.default.buildAbsoluteURL(b,a,{alwaysNormalize:!0})}},{key:"parseMasterPlaylist",value:function(a,b){var c=[],d=void 0;for(s.lastIndex=0;null!=(d=s.exec(a));){var e={},f=e.attrs=new q.default(d[1]);e.url=this.resolve(d[2],b);var g=f.decimalResolution("RESOLUTION");g&&(e.width=g.width,e.height=g.height),e.bitrate=f.decimalInteger("AVERAGE-BANDWIDTH")||f.decimalInteger("BANDWIDTH"),e.name=f.NAME;var h=f.CODECS;if(h){h=h.split(/[ ,]+/);for(var i=0;i<h.length;i++){var j=h[i];j.indexOf("avc1")!==-1?e.videoCodec=this.avc1toavcoti(j):e.audioCodec=j}}c.push(e)}return c}},{key:"parseMasterPlaylistMedia",value:function(a,b,c){var d=void 0,e=[],f=0;for(t.lastIndex=0;null!=(d=t.exec(a));){var g={},h=new q.default(d[1]);h.TYPE===c&&(g.groupId=h["GROUP-ID"],g.name=h.NAME,g.type=c,g.default="YES"===h.DEFAULT,g.autoselect="YES"===h.AUTOSELECT,g.forced="YES"===h.FORCED,h.URI&&(g.url=this.resolve(h.URI,b)),g.lang=h.LANGUAGE,g.name||(g.name=g.lang),g.id=f++,e.push(g))}return e}},{key:"avc1toavcoti",value:function(a){var b,c=a.split(".");return c.length>2?(b=c.shift()+".",b+=parseInt(c.shift()).toString(16),b+=("000"+parseInt(c.shift()).toString(16)).substr(-4)):b=a,b}},{key:"parseLevelPlaylist",value:function(a,b,c,d){var e,f,g=0,h=0,i={type:null,version:null,url:b,fragments:[],live:!0,startSN:0},j=new w,k=0,l=null,m=new x;for(u.lastIndex=0;null!==(e=u.exec(a));){var n=e[1];if(n){m.duration=parseFloat(n);var o=(" "+e[2]).slice(1);m.title=o?o:null,m.tagList.push(o?["INF",n,o]:["INF",n])}else if(e[3]){if(!isNaN(m.duration)){var p=g++;m.type=d,m.start=h,m.levelkey=j,m.sn=p,m.level=c,m.cc=k,m.baseurl=b,m.relurl=(" "+e[3]).slice(1),i.fragments.push(m),l=m,h+=m.duration,m=new x}}else if(e[4]){if(m.rawByteRange=(" "+e[4]).slice(1),l){var s=l.byteRangeEndOffset;s&&(m.lastByteRangeEndOffset=s)}}else if(e[5])m.rawProgramDateTime=(" "+e[5]).slice(1),m.tagList.push(["PROGRAM-DATE-TIME",m.rawProgramDateTime]);else{for(e=e[0].match(v),f=1;f<e.length&&void 0===e[f];f++);var t=(" "+e[f+1]).slice(1),y=(" "+e[f+2]).slice(1);switch(e[f]){case"#":m.tagList.push(y?[t,y]:[t]);break;case"PLAYLIST-TYPE":i.type=t.toUpperCase();break;case"MEDIA-SEQUENCE":g=i.startSN=parseInt(t);break;case"TARGETDURATION":i.targetduration=parseFloat(t);break;case"VERSION":i.version=parseInt(t);break;case"EXTM3U":break;case"ENDLIST":i.live=!1;break;case"DIS":k++,m.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":k=parseInt(t);break;case"KEY":var z=t,A=new q.default(z),B=A.enumeratedString("METHOD"),C=A.URI,D=A.hexadecimalInteger("IV");B&&(j=new w,C&&["AES-128","SAMPLE-AES"].indexOf(B)>=0&&(j.method=B,j.baseuri=b,j.reluri=C,j.key=null,j.iv=D));break;case"START":var E=t,F=new q.default(E),G=F.decimalFloatingPoint("TIME-OFFSET");isNaN(G)||(i.startTimeOffset=G);break;case"MAP":var H=new q.default(t);m.relurl=H.URI,m.rawByteRange=H.BYTERANGE,m.baseurl=b,m.level=c,m.type=d,m.sn="initSegment",i.initSegment=m,m=new x;break;default:r.logger.warn("line parsed but not handled: "+e)}}}return m=l,m&&!m.relurl&&(i.fragments.pop(),h-=m.duration),i.totalduration=h,i.averagetargetduration=h/i.fragments.length,i.endSN=g-1,i}},{key:"loadsuccess",value:function(a,b,c){var d=a.data,e=a.url,f=c.type,g=c.id,h=c.level,i=this.hls;if(this.loaders[f]=void 0,void 0!==e&&0!==e.indexOf("data:")||(e=c.url),b.tload=performance.now(),0===d.indexOf("#EXTM3U"))if(d.indexOf("#EXTINF:")>0){var j="audioTrack"!==f&&"subtitleTrack"!==f,k=isNaN(h)?isNaN(g)?0:g:h,m=this.parseLevelPlaylist(d,e,k,"audioTrack"===f?"audio":"subtitleTrack"===f?"subtitle":"main");m.tload=b.tload,"manifest"===f&&i.trigger(l.default.MANIFEST_LOADED,{levels:[{url:e,details:m}],audioTracks:[],url:e,stats:b}),b.tparsed=performance.now(),m.targetduration?j?i.trigger(l.default.LEVEL_LOADED,{details:m,level:h||0,id:g||0,stats:b}):"audioTrack"===f?i.trigger(l.default.AUDIO_TRACK_LOADED,{details:m,id:g,stats:b}):"subtitleTrack"===f&&i.trigger(l.default.SUBTITLE_TRACK_LOADED,{details:m,id:g,stats:b}):i.trigger(l.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e,reason:"invalid targetduration"})}else{var n=this.parseMasterPlaylist(d,e);if(n.length){var p=this.parseMasterPlaylistMedia(d,e,"AUDIO"),q=this.parseMasterPlaylistMedia(d,e,"SUBTITLES");if(p.length){var s=!1;p.forEach(function(a){a.url||(s=!0)}),s===!1&&n[0].audioCodec&&!n[0].attrs.AUDIO&&(r.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main"}))}i.trigger(l.default.MANIFEST_LOADED,{levels:n,audioTracks:p,subtitles:q,url:e,stats:b})}else i.trigger(l.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e,reason:"no level found in manifest"})}else i.trigger(l.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e,reason:"no EXTM3U delimiter"})}},{key:"loaderror",value:function(a,b){var c,d,e=b.loader;switch(b.type){case"manifest":c=o.ErrorDetails.MANIFEST_LOAD_ERROR,d=!0;break;case"level":c=o.ErrorDetails.LEVEL_LOAD_ERROR,d=!1;break;case"audioTrack":c=o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,d=!1}e&&(e.abort(),this.loaders[b.type]=void 0),this.hls.trigger(l.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:c,fatal:d,url:e.url,loader:e,response:a,context:b})}},{key:"loadtimeout",value:function(a,b){var c,d,e=b.loader;switch(b.type){case"manifest":c=o.ErrorDetails.MANIFEST_LOAD_TIMEOUT,d=!0;break;case"level":c=o.ErrorDetails.LEVEL_LOAD_TIMEOUT,d=!1;break;case"audioTrack":c=o.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT,d=!1}e&&(e.abort(),this.loaders[b.type]=void 0),this.hls.trigger(l.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:c,fatal:d,url:e.url,loader:e,context:b})}}]),b}(n.default);c.default=y},{2:2,33:33,34:34,35:35,47:47,53:53}],44:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=Math.pow(2,32)-1,g=function(){function a(){d(this,a)}return e(a,null,[{key:"init",value:function(){a.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var b;for(b in a.types)a.types.hasOwnProperty(b)&&(a.types[b]=[b.charCodeAt(0),b.charCodeAt(1),b.charCodeAt(2),b.charCodeAt(3)]);var c=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),d=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);a.HDLR_TYPES={video:c,audio:d};var e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),f=new Uint8Array([0,0,0,0,0,0,0,0]);a.STTS=a.STSC=a.STCO=f,a.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),a.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),a.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),a.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var g=new Uint8Array([105,115,111,109]),h=new Uint8Array([97,118,99,49]),i=new Uint8Array([0,0,0,1]);a.FTYP=a.box(a.types.ftyp,g,i,g,h),a.DINF=a.box(a.types.dinf,a.box(a.types.dref,e))}},{key:"box",value:function(a){for(var b,c=Array.prototype.slice.call(arguments,1),d=8,e=c.length,f=e;e--;)d+=c[e].byteLength;for(b=new Uint8Array(d),b[0]=d>>24&255,b[1]=d>>16&255,b[2]=d>>8&255,b[3]=255&d,b.set(a,4),e=0,d=8;e<f;e++)b.set(c[e],d),d+=c[e].byteLength;return b}},{key:"hdlr",value:function(b){return a.box(a.types.hdlr,a.HDLR_TYPES[b])}},{key:"mdat",value:function(b){return a.box(a.types.mdat,b)}},{key:"mdhd",value:function(b,c){c*=b;var d=Math.floor(c/(f+1)),e=Math.floor(c%(f+1));return a.box(a.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,255&b,d>>24,d>>16&255,d>>8&255,255&d,e>>24,e>>16&255,e>>8&255,255&e,85,196,0,0]))}},{key:"mdia",value:function(b){return a.box(a.types.mdia,a.mdhd(b.timescale,b.duration),a.hdlr(b.type),a.minf(b))}},{key:"mfhd",value:function(b){return a.box(a.types.mfhd,new Uint8Array([0,0,0,0,b>>24,b>>16&255,b>>8&255,255&b]))}},{key:"minf",value:function(b){return"audio"===b.type?a.box(a.types.minf,a.box(a.types.smhd,a.SMHD),a.DINF,a.stbl(b)):a.box(a.types.minf,a.box(a.types.vmhd,a.VMHD),a.DINF,a.stbl(b))}},{key:"moof",value:function(b,c,d){return a.box(a.types.moof,a.mfhd(b),a.traf(d,c))}},{key:"moov",value:function(b){for(var c=b.length,d=[];c--;)d[c]=a.trak(b[c]);return a.box.apply(null,[a.types.moov,a.mvhd(b[0].timescale,b[0].duration)].concat(d).concat(a.mvex(b)))}},{key:"mvex",value:function(b){for(var c=b.length,d=[];c--;)d[c]=a.trex(b[c]);return a.box.apply(null,[a.types.mvex].concat(d))}},{key:"mvhd",value:function(b,c){c*=b;var d=Math.floor(c/(f+1)),e=Math.floor(c%(f+1)),g=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,255&b,d>>24,d>>16&255,d>>8&255,255&d,e>>24,e>>16&255,e>>8&255,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return a.box(a.types.mvhd,g)}},{key:"sdtp",value:function(b){var c,d,e=b.samples||[],f=new Uint8Array(4+e.length);for(d=0;d<e.length;d++)c=e[d].flags,f[d+4]=c.dependsOn<<4|c.isDependedOn<<2|c.hasRedundancy;return a.box(a.types.sdtp,f)}},{key:"stbl",value:function(b){return a.box(a.types.stbl,a.stsd(b),a.box(a.types.stts,a.STTS),a.box(a.types.stsc,a.STSC),a.box(a.types.stsz,a.STSZ),a.box(a.types.stco,a.STCO))}},{key:"avc1",value:function(b){var c,d,e,f=[],g=[];for(c=0;c<b.sps.length;c++)d=b.sps[c],e=d.byteLength,f.push(e>>>8&255),f.push(255&e),f=f.concat(Array.prototype.slice.call(d));for(c=0;c<b.pps.length;c++)d=b.pps[c],e=d.byteLength,g.push(e>>>8&255),g.push(255&e),g=g.concat(Array.prototype.slice.call(d));var h=a.box(a.types.avcC,new Uint8Array([1,f[3],f[4],f[5],255,224|b.sps.length].concat(f).concat([b.pps.length]).concat(g))),i=b.width,j=b.height,k=b.pixelRatio[0],l=b.pixelRatio[1];return a.box(a.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>8&255,255&i,j>>8&255,255&j,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h,a.box(a.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),a.box(a.types.pasp,new Uint8Array([k>>24,k>>16&255,k>>8&255,255&k,l>>24,l>>16&255,l>>8&255,255&l])))}},{key:"esds",value:function(a){var b=a.config.length;return new Uint8Array([0,0,0,0,3,23+b,0,1,0,4,15+b,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([b]).concat(a.config).concat([6,1,2]))}},{key:"mp4a",value:function(b){var c=b.samplerate;return a.box(a.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,c>>8&255,255&c,0,0]),a.box(a.types.esds,a.esds(b)))}},{key:"mp3",value:function(b){var c=b.samplerate;return a.box(a.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,c>>8&255,255&c,0,0]))}},{key:"stsd",value:function(b){return"audio"===b.type?b.isAAC||"mp3"!==b.codec?a.box(a.types.stsd,a.STSD,a.mp4a(b)):a.box(a.types.stsd,a.STSD,a.mp3(b)):a.box(a.types.stsd,a.STSD,a.avc1(b))}},{key:"tkhd",value:function(b){var c=b.id,d=b.duration*b.timescale,e=b.width,g=b.height,h=Math.floor(d/(f+1)),i=Math.floor(d%(f+1));return a.box(a.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,c>>24&255,c>>16&255,c>>8&255,255&c,0,0,0,0,h>>24,h>>16&255,h>>8&255,255&h,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,e>>8&255,255&e,0,0,g>>8&255,255&g,0,0]))}},{key:"traf",value:function(b,c){var d=a.sdtp(b),e=b.id,g=Math.floor(c/(f+1)),h=Math.floor(c%(f+1));return a.box(a.types.traf,a.box(a.types.tfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e])),a.box(a.types.tfdt,new Uint8Array([1,0,0,0,g>>24,g>>16&255,g>>8&255,255&g,h>>24,h>>16&255,h>>8&255,255&h])),a.trun(b,d.length+16+20+8+16+8+8),d)}},{key:"trak",value:function(b){return b.duration=b.duration||4294967295,a.box(a.types.trak,a.tkhd(b),a.mdia(b))}},{key:"trex",value:function(b){var c=b.id;return a.box(a.types.trex,new Uint8Array([0,0,0,0,c>>24,c>>16&255,c>>8&255,255&c,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(b,c){var d,e,f,g,h,i,j=b.samples||[],k=j.length,l=12+16*k,m=new Uint8Array(l);for(c+=8+l,m.set([0,0,15,1,k>>>24&255,k>>>16&255,k>>>8&255,255&k,c>>>24&255,c>>>16&255,c>>>8&255,255&c],0),d=0;d<k;d++)e=j[d],f=e.duration,g=e.size,h=e.flags,i=e.cts,m.set([f>>>24&255,f>>>16&255,f>>>8&255,255&f,g>>>24&255,g>>>16&255,g>>>8&255,255&g,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,61440&h.degradPrio,15&h.degradPrio,i>>>24&255,i>>>16&255,i>>>8&255,255&i],12+16*d);return a.box(a.types.trun,m)}},{key:"initSegment",value:function(b){a.types||a.init();var c,d=a.moov(b);return c=new Uint8Array(a.FTYP.byteLength+d.byteLength),c.set(a.FTYP),c.set(d,a.FTYP.byteLength),c}}]),a}();c.default=g},{}],45:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(36),h=d(g),i=a(35),j=d(i),k=a(53),l=a(44),m=d(l),n=a(33),o=function(){function a(b,c,d,f){e(this,a),this.observer=b,this.config=c,this.typeSupported=d;var g=navigator.userAgent;this.isSafari=f&&f.indexOf("Apple")>-1&&g&&!g.match("CriOS"),this.ISGenerated=!1}return f(a,[{key:"destroy",value:function(){}},{key:"resetTimeStamp",value:function(a){this._initPTS=this._initDTS=a}},{key:"resetInitSegment",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(a,b,c,d,e,f,g){if(this.ISGenerated||this.generateIS(a,b,e),this.ISGenerated)if(a.samples.length){a.timescale||(k.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(a,b,e));var h=this.remuxAudio(a,e,f,g);if(b.samples.length){var i=void 0;h&&(i=h.endPTS-h.startPTS),b.timescale||(k.logger.warn("regenerate InitSegment as video detected"),this.generateIS(a,b,e)),this.remuxVideo(b,e,f,i)}}else{var l=void 0;b.samples.length&&(l=this.remuxVideo(b,e,f)),l&&a.codec&&this.remuxEmptyAudio(a,e,f,l)}c.samples.length&&this.remuxID3(c,e),d.samples.length&&this.remuxText(d,e),this.observer.trigger(j.default.FRAG_PARSED)}},{key:"generateIS",value:function(a,b,c){var d,e,f=this.observer,g=a.samples,h=b.samples,i=this.typeSupported,l="audio/mp4",o={},p={tracks:o},q=void 0===this._initPTS;if(q&&(d=e=1/0),a.config&&g.length&&(a.timescale=a.samplerate,k.logger.log("audio sampling rate : "+a.samplerate),a.isAAC||(i.mpeg?(l="audio/mpeg",a.codec=""):i.mp3&&(a.codec="mp3")),o.audio={container:l,codec:a.codec,initSegment:!a.isAAC&&i.mpeg?new Uint8Array:m.default.initSegment([a]),metadata:{channelCount:a.channelCount}},q&&(d=e=g[0].pts-a.inputTimeScale*c)),b.sps&&b.pps&&h.length){var r=b.inputTimeScale;b.timescale=r,o.video={container:"video/mp4",codec:b.codec,initSegment:m.default.initSegment([b]),metadata:{width:b.width,height:b.height}},q&&(d=Math.min(d,h[0].pts-r*c),e=Math.min(e,h[0].dts-r*c),this.observer.trigger(j.default.INIT_PTS_FOUND,{initPTS:d}))}Object.keys(o).length?(f.trigger(j.default.FRAG_PARSING_INIT_SEGMENT,p),this.ISGenerated=!0,q&&(this._initPTS=d,this._initDTS=e)):f.trigger(j.default.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(a,b,c,d){var e,f,g,h,i,l,o,p,q=8,r=a.timescale,s=a.samples,t=[],u=s.length,v=this._PTSNormalize,w=this._initDTS;s.sort(function(a,b){var c=a.dts-b.dts,d=a.pts-b.pts;return c?c:d?d:a.id-b.id});var x=s.reduce(function(a,b){return Math.max(Math.min(a,b.pts-b.dts),-18e3)},0);if(x<0){k.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(x/90)+" ms to overcome this issue");for(var y=0;y<s.length;y++)s[y].dts+=x}var z=void 0;z=c?this.nextAvcDts:b*r;var A=s[0];i=Math.max(v(A.dts-w,z),0),h=Math.max(v(A.pts-w,z),0);var B=Math.round((i-z)/90);c&&B&&(B>1?k.logger.log("AVC:"+B+" ms hole between fragments detected,filling it"):B<-1&&k.logger.log("AVC:"+-B+" ms overlapping between fragments detected"),i=z,s[0].dts=i+w,h=Math.max(h-B,z),s[0].pts=h+w,k.logger.log("Video/PTS/DTS adjusted: "+Math.round(h/90)+"/"+Math.round(i/90)+",delta:"+B+" ms")),l=i,A=s[s.length-1],p=Math.max(v(A.dts-w,z),0),o=Math.max(v(A.pts-w,z),0),o=Math.max(o,p);var C=this.isSafari;C&&(e=Math.round((p-i)/(s.length-1)));for(var D=0,E=0,F=0;F<u;F++){for(var G=s[F],H=G.units,I=H.length,J=0,K=0;K<I;K++)J+=H[K].data.length;E+=J,D+=I,G.length=J,C?G.dts=i+F*e:G.dts=Math.max(v(G.dts-w,z),i),G.pts=Math.max(v(G.pts-w,z),G.dts)}var L=E+4*D+8;try{f=new Uint8Array(L)}catch(a){return void this.observer.trigger(j.default.ERROR,{type:n.ErrorTypes.MUX_ERROR,details:n.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:L,reason:"fail allocating video mdat "+L})}var M=new DataView(f.buffer);M.setUint32(0,L),f.set(m.default.types.mdat,4);for(var N=0;N<u;N++){for(var O=s[N],P=O.units,Q=0,R=void 0,S=0,T=P.length;S<T;S++){var U=P[S],V=U.data,W=U.data.byteLength;M.setUint32(q,W),q+=4,f.set(V,q),q+=W,Q+=4+W}if(C)R=Math.max(0,e*Math.round((O.pts-O.dts)/e));else{if(N<u-1)e=s[N+1].dts-O.dts;else{var X=this.config,Y=O.dts-s[N>0?N-1:N].dts;if(X.stretchShortVideoTrack){var Z=X.maxBufferHole,$=X.maxSeekHole,_=Math.floor(Math.min(Z,$)*r),aa=(d?h+d*r:this.nextAudioPts)-O.pts;aa>_?(e=aa-Y,e<0&&(e=Y),k.logger.log("It is approximately "+aa/90+" ms to the next segment; using duration "+e/90+" ms for the last video frame.")):e=Y}else e=Y}R=Math.round(O.pts-O.dts)}t.push({size:Q,duration:e,cts:R,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:O.key?2:1,isNonSync:O.key?0:1}})}this.nextAvcDts=p+e;var ba=a.dropped;if(a.len=0,a.nbNalu=0,a.dropped=0,t.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var ca=t[0].flags;ca.dependsOn=2,ca.isNonSync=0}a.samples=t,g=m.default.moof(a.sequenceNumber++,i,a),a.samples=[];var da={data1:g,data2:f,startPTS:h/r,endPTS:(o+e)/r,startDTS:i/r,endDTS:this.nextAvcDts/r,type:"video",nb:t.length,dropped:ba};return this.observer.trigger(j.default.FRAG_PARSING_DATA,da),da}},{key:"remuxAudio",value:function(a,b,c,d){var e,f,g,i,l,o,p,q,r,s,t,u,v,w,x,y,z=a.inputTimeScale,A=a.timescale,B=z/A,C=a.isAAC?1024:1152,D=C*B,E=this._PTSNormalize,F=this._initDTS,G=!a.isAAC&&this.typeSupported.mpeg,H=G?0:8,I=[],J=[];if(a.samples.sort(function(a,b){return a.pts-b.pts}),J=a.samples,y=this.nextAudioPts,c|=J.length&&y&&(d&&Math.abs(b-y/z)<.1||Math.abs(J[0].pts-y-F)<20*D),c||(y=b*z),d&&a.isAAC)for(var K=0,L=y;K<J.length;){var M=J[K],N=E(M.pts-F,y),O=N-L;if(O<=-D)k.logger.warn("Dropping audio frame @ "+(L/z).toFixed(3)+"s due to "+Math.round(Math.abs(1e3*O/z))+" ms overlap."),J.splice(K,1),a.len-=M.unit.length;else if(O>=D&&L){var P=Math.round(O/D);k.logger.warn("Injecting "+P+" audio frame @ "+(L/z).toFixed(3)+"s due to "+Math.round(1e3*O/z)+" ms gap.");for(var Q=0;Q<P;Q++)x=L+F,x=Math.max(x,F),w=h.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount),w||(k.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),w=M.unit.subarray()),J.splice(K,0,{unit:w,pts:x,dts:x}),a.len+=w.length,L+=D,K+=1;M.pts=M.dts=L+F,L+=D,K+=1}else Math.abs(O)>.1*D,L+=D,0===K?M.pts=M.dts=F+y:M.pts=M.dts=J[K-1].pts+D,K+=1}for(var R=0,S=J.length;R<S;R++){if(f=J[R],i=f.unit,s=f.pts-F,t=f.dts-F,void 0!==r)u=E(s,r),v=E(t,r),g.duration=Math.round((v-r)/B);else{u=E(s,y),v=E(t,y);var T=Math.round(1e3*(u-y)/z),U=0;if(c&&a.isAAC&&T){if(T>0)U=Math.round((u-y)/D),k.logger.log(T+" ms hole between AAC samples detected,filling it"),U>0&&(w=h.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount),w||(w=i.subarray()),a.len+=U*w.length);else if(T<-12){k.logger.log("drop overlapping AAC sample, expected/parsed/delta:"+(y/z).toFixed(3)+"s/"+(u/z).toFixed(3)+"s/"+-T+"ms"),a.len-=i.byteLength;continue}u=v=y}if(p=Math.max(0,u),q=Math.max(0,v),!(a.len>0))return;var V=G?a.len:a.len+8;try{l=new Uint8Array(V)}catch(a){return void this.observer.trigger(j.default.ERROR,{type:n.ErrorTypes.MUX_ERROR,details:n.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:V,reason:"fail allocating audio mdat "+V})}G||(e=new DataView(l.buffer),e.setUint32(0,V),l.set(m.default.types.mdat,4));for(var W=0;W<U;W++)x=u-(U-W)*D,w=h.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount),w||(k.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),w=i.subarray()),l.set(w,H),H+=w.byteLength,g={size:w.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},I.push(g)}l.set(i,H);var X=i.byteLength;H+=X,g={size:X,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},I.push(g),r=v}var Y=0,Z=I.length;if(Z>=2&&(Y=I[Z-2].duration,g.duration=Y),Z){this.nextAudioPts=u+B*Y,a.len=0,a.samples=I,o=G?new Uint8Array:m.default.moof(a.sequenceNumber++,q/B,a),a.samples=[];var $={data1:o,data2:l,startPTS:p/z,endPTS:this.nextAudioPts/z,startDTS:q/z,endDTS:(v+B*Y)/z,type:"audio",nb:Z};return this.observer.trigger(j.default.FRAG_PARSING_DATA,$),$}return null}},{key:"remuxEmptyAudio",value:function(a,b,c,d){var e=a.inputTimeScale,f=a.samplerate?a.samplerate:e,g=e/f,i=this.nextAudioPts,j=(void 0!==i?i:d.startDTS*e)+this._initDTS,l=d.endDTS*e+this._initDTS,m=1024,n=g*m,o=Math.ceil((l-j)/n),p=h.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);if(k.logger.warn("remux empty Audio"),!p)return void k.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");for(var q=[],r=0;r<o;r++){var s=j+r*n;q.push({unit:p,pts:s,dts:s}),a.len+=p.length}a.samples=q,this.remuxAudio(a,b,c)}},{key:"remuxID3",value:function(a,b){var c,d=a.samples.length,e=a.inputTimeScale,f=this._initPTS,g=this._initDTS;if(d){for(var h=0;h<d;h++)c=a.samples[h],c.pts=(c.pts-f)/e,c.dts=(c.dts-g)/e;this.observer.trigger(j.default.FRAG_PARSING_METADATA,{samples:a.samples})}a.samples=[],b=b}},{key:"remuxText",value:function(a,b){a.samples.sort(function(a,b){return a.pts-b.pts});var c,d=a.samples.length,e=a.inputTimeScale,f=this._initPTS;if(d){for(var g=0;g<d;g++)c=a.samples[g],c.pts=(c.pts-f)/e;this.observer.trigger(j.default.FRAG_PARSING_USERDATA,{samples:a.samples})}a.samples=[],b=b}},{key:"_PTSNormalize",value:function(a,b){var c;if(void 0===b)return a;for(c=b<a?-8589934592:8589934592;Math.abs(a-b)>4294967296;)a+=c;return a}}]),a}();c.default=o},{33:33,35:35,36:36,44:44,53:53}],46:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(35),h=d(g),i=function(){function a(b){e(this,a),this.observer=b}return f(a,[{key:"destroy",value:function(){}},{key:"resetTimeStamp",value:function(){}},{key:"resetInitSegment",value:function(){}},{key:"remux",value:function(a,b,c,d,e,f,g,i){var j=this.observer,k="";a&&(k+="audio"),b&&(k+="video"),j.trigger(h.default.FRAG_PARSING_DATA,{data1:i,startPTS:e,startDTS:e,type:k,nb:1,dropped:0}),j.trigger(h.default.FRAG_PARSED)}}]),a}();c.default=i},{35:35}],47:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=/^(\d+)x(\d+)$/,g=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,h=function(){function a(b){d(this,a),"string"==typeof b&&(b=a.parseAttrList(b));for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c])}return e(a,[{key:"decimalInteger",value:function(a){var b=parseInt(this[a],10);return b>Number.MAX_SAFE_INTEGER?1/0:b}},{key:"hexadecimalInteger",value:function(a){if(this[a]){var b=(this[a]||"0x").slice(2);b=(1&b.length?"0":"")+b;for(var c=new Uint8Array(b.length/2),d=0;d<b.length/2;d++)c[d]=parseInt(b.slice(2*d,2*d+2),16);return c}return null}},{key:"hexadecimalIntegerAsNumber",value:function(a){var b=parseInt(this[a],16);return b>Number.MAX_SAFE_INTEGER?1/0:b}},{key:"decimalFloatingPoint",value:function(a){return parseFloat(this[a])}},{key:"enumeratedString",value:function(a){return this[a]}},{key:"decimalResolution",value:function(a){var b=f.exec(this[a]);if(null!==b)return{width:parseInt(b[1],10),height:parseInt(b[2],10)}}}],[{key:"parseAttrList",value:function(a){var b,c={};for(g.lastIndex=0;null!==(b=g.exec(a));){var d=b[2],e='"';0===d.indexOf(e)&&d.lastIndexOf(e)===d.length-1&&(d=d.slice(1,-1)),c[b[1]]=d}return c}}]),a}();c.default=h},{}],48:[function(a,b,c){"use strict";var d={search:function(a,b){for(var c=0,d=a.length-1,e=null,f=null;c<=d;){e=(c+d)/2|0,f=a[e];var g=b(f);if(g>0)c=e+1;else{if(!(g<0))return f;d=e-1}}return null}};b.exports=d},{}],49:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},g=function(a){var b=a;return f.hasOwnProperty(a)&&(b=f[a]),String.fromCharCode(b)},h=15,i=100,j={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},k={17:2,18:4,21:6,22:8,23:10,19:13,20:15},l={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},m={25:2,26:4,29:6,30:8,31:10,27:13,28:15},n=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],o={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(a){this.time=a},log:function(a,b){var c=this.verboseFilter[a];this.verboseLevel>=c&&console.log(this.time+" ["+a+"] "+b)}},p=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].toString(16));return b},q=function(){function a(b,c,e,f,g){d(this,a),this.foreground=b||"white",this.underline=c||!1,this.italics=e||!1,this.background=f||"black",this.flash=g||!1}return e(a,[{key:"reset",value:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}},{key:"setStyles",value:function(a){for(var b=["foreground","underline","italics","background","flash"],c=0;c<b.length;c++){var d=b[c];a.hasOwnProperty(d)&&(this[d]=a[d])}}},{key:"isDefault",value:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}},{key:"equals",value:function(a){return this.foreground===a.foreground&&this.underline===a.underline&&this.italics===a.italics&&this.background===a.background&&this.flash===a.flash}},{key:"copy",value:function(a){this.foreground=a.foreground,this.underline=a.underline,this.italics=a.italics,this.background=a.background,this.flash=a.flash}},{key:"toString",value:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}]),a}(),r=function(){
function a(b,c,e,f,g,h){d(this,a),this.uchar=b||" ",this.penState=new q(c,e,f,g,h)}return e(a,[{key:"reset",value:function(){this.uchar=" ",this.penState.reset()}},{key:"setChar",value:function(a,b){this.uchar=a,this.penState.copy(b)}},{key:"setPenState",value:function(a){this.penState.copy(a)}},{key:"equals",value:function(a){return this.uchar===a.uchar&&this.penState.equals(a.penState)}},{key:"copy",value:function(a){this.uchar=a.uchar,this.penState.copy(a.penState)}},{key:"isEmpty",value:function(){return" "===this.uchar&&this.penState.isDefault()}}]),a}(),s=function(){function a(){d(this,a),this.chars=[];for(var b=0;b<i;b++)this.chars.push(new r);this.pos=0,this.currPenState=new q}return e(a,[{key:"equals",value:function(a){for(var b=!0,c=0;c<i;c++)if(!this.chars[c].equals(a.chars[c])){b=!1;break}return b}},{key:"copy",value:function(a){for(var b=0;b<i;b++)this.chars[b].copy(a.chars[b])}},{key:"isEmpty",value:function(){for(var a=!0,b=0;b<i;b++)if(!this.chars[b].isEmpty()){a=!1;break}return a}},{key:"setCursor",value:function(a){this.pos!==a&&(this.pos=a),this.pos<0?(o.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>i&&(o.log("ERROR","Too large cursor position "+this.pos),this.pos=i)}},{key:"moveCursor",value:function(a){var b=this.pos+a;if(a>1)for(var c=this.pos+1;c<b+1;c++)this.chars[c].setPenState(this.currPenState);this.setCursor(b)}},{key:"backSpace",value:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}},{key:"insertChar",value:function(a){a>=144&&this.backSpace();var b=g(a);return this.pos>=i?void o.log("ERROR","Cannot insert "+a.toString(16)+" ("+b+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(b,this.currPenState),void this.moveCursor(1))}},{key:"clearFromPos",value:function(a){var b;for(b=a;b<i;b++)this.chars[b].reset()}},{key:"clear",value:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}},{key:"clearToEndOfRow",value:function(){this.clearFromPos(this.pos)}},{key:"getTextString",value:function(){for(var a=[],b=!0,c=0;c<i;c++){var d=this.chars[c].uchar;" "!==d&&(b=!1),a.push(d)}return b?"":a.join("")}},{key:"setPenStyles",value:function(a){this.currPenState.setStyles(a);var b=this.chars[this.pos];b.setPenState(this.currPenState)}}]),a}(),t=function(){function a(){d(this,a),this.rows=[];for(var b=0;b<h;b++)this.rows.push(new s);this.currRow=h-1,this.nrRollUpRows=null,this.reset()}return e(a,[{key:"reset",value:function(){for(var a=0;a<h;a++)this.rows[a].clear();this.currRow=h-1}},{key:"equals",value:function(a){for(var b=!0,c=0;c<h;c++)if(!this.rows[c].equals(a.rows[c])){b=!1;break}return b}},{key:"copy",value:function(a){for(var b=0;b<h;b++)this.rows[b].copy(a.rows[b])}},{key:"isEmpty",value:function(){for(var a=!0,b=0;b<h;b++)if(!this.rows[b].isEmpty()){a=!1;break}return a}},{key:"backSpace",value:function(){var a=this.rows[this.currRow];a.backSpace()}},{key:"clearToEndOfRow",value:function(){var a=this.rows[this.currRow];a.clearToEndOfRow()}},{key:"insertChar",value:function(a){var b=this.rows[this.currRow];b.insertChar(a)}},{key:"setPen",value:function(a){var b=this.rows[this.currRow];b.setPenStyles(a)}},{key:"moveCursor",value:function(a){var b=this.rows[this.currRow];b.moveCursor(a)}},{key:"setCursor",value:function(a){o.log("INFO","setCursor: "+a);var b=this.rows[this.currRow];b.setCursor(a)}},{key:"setPAC",value:function(a){o.log("INFO","pacData = "+JSON.stringify(a));var b=a.row-1;if(this.nrRollUpRows&&b<this.nrRollUpRows-1&&(b=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==b){for(var c=0;c<h;c++)this.rows[c].clear();var d=this.currRow+1-this.nrRollUpRows,e=this.lastOutputScreen;if(e){var f=e.rows[d].cueStartTime;if(f&&f<o.time)for(var g=0;g<this.nrRollUpRows;g++)this.rows[b-this.nrRollUpRows+g+1].copy(e.rows[d+g])}}this.currRow=b;var i=this.rows[this.currRow];if(null!==a.indent){var j=a.indent,k=Math.max(j-1,0);i.setCursor(a.indent),a.color=i.chars[k].penState.foreground}var l={foreground:a.color,underline:a.underline,italics:a.italics,background:"black",flash:!1};this.setPen(l)}},{key:"setBkgData",value:function(a){o.log("INFO","bkgData = "+JSON.stringify(a)),this.backSpace(),this.setPen(a),this.insertChar(32)}},{key:"setRollUpRows",value:function(a){this.nrRollUpRows=a}},{key:"rollUp",value:function(){if(null===this.nrRollUpRows)return void o.log("DEBUG","roll_up but nrRollUpRows not set yet");o.log("TEXT",this.getDisplayText());var a=this.currRow+1-this.nrRollUpRows,b=this.rows.splice(a,1)[0];b.clear(),this.rows.splice(this.currRow,0,b),o.log("INFO","Rolling up")}},{key:"getDisplayText",value:function(a){a=a||!1;for(var b=[],c="",d=-1,e=0;e<h;e++){var f=this.rows[e].getTextString();f&&(d=e+1,a?b.push("Row "+d+": '"+f+"'"):b.push(f.trim()))}return b.length>0&&(c=a?"["+b.join(" | ")+"]":b.join("\n")),c}},{key:"getTextAndFormat",value:function(){return this.rows}}]),a}(),u=function(){function a(b,c){d(this,a),this.chNr=b,this.outputFilter=c,this.mode=null,this.verbose=0,this.displayedMemory=new t,this.nonDisplayedMemory=new t,this.lastOutputScreen=new t,this.currRollUpRow=this.displayedMemory.rows[h-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return e(a,[{key:"reset",value:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[h-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null}},{key:"getHandler",value:function(){return this.outputFilter}},{key:"setHandler",value:function(a){this.outputFilter=a}},{key:"setPAC",value:function(a){this.writeScreen.setPAC(a)}},{key:"setBkgData",value:function(a){this.writeScreen.setBkgData(a)}},{key:"setMode",value:function(a){a!==this.mode&&(this.mode=a,o.log("INFO","MODE="+a),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=a)}},{key:"insertChars",value:function(a){for(var b=0;b<a.length;b++)this.writeScreen.insertChar(a[b]);var c=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";o.log("INFO",c+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(o.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}},{key:"ccRCL",value:function(){o.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}},{key:"ccBS",value:function(){o.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}},{key:"ccAOF",value:function(){}},{key:"ccAON",value:function(){}},{key:"ccDER",value:function(){o.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}},{key:"ccRU",value:function(a){o.log("INFO","RU("+a+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(a)}},{key:"ccFON",value:function(){o.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})}},{key:"ccRDC",value:function(){o.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}},{key:"ccTR",value:function(){o.log("INFO","TR"),this.setMode("MODE_TEXT")}},{key:"ccRTD",value:function(){o.log("INFO","RTD"),this.setMode("MODE_TEXT")}},{key:"ccEDM",value:function(){o.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()}},{key:"ccCR",value:function(){o.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()}},{key:"ccENM",value:function(){o.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}},{key:"ccEOC",value:function(){if(o.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var a=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=a,this.writeScreen=this.nonDisplayedMemory,o.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()}},{key:"ccTO",value:function(a){o.log("INFO","TO("+a+") - Tab Offset"),this.writeScreen.moveCursor(a)}},{key:"ccMIDROW",value:function(a){var b={flash:!1};if(b.underline=a%2===1,b.italics=a>=46,b.italics)b.foreground="white";else{var c=Math.floor(a/2)-16,d=["white","green","blue","cyan","red","yellow","magenta"];b.foreground=d[c]}o.log("INFO","MIDROW: "+JSON.stringify(b)),this.writeScreen.setPen(b)}},{key:"outputDataUpdate",value:function(){var a=o.time;null!==a&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(a,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,a,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:a):this.cueStartTime=a,this.lastOutputScreen.copy(this.displayedMemory))}},{key:"cueSplitAtTime",value:function(a){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,a,this.displayedMemory),this.cueStartTime=a))}}]),a}(),v=function(){function a(b,c,e){d(this,a),this.field=b||1,this.outputs=[c,e],this.channels=[new u(1,c),new u(2,e)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return e(a,[{key:"getHandler",value:function(a){return this.channels[a].getHandler()}},{key:"setHandler",value:function(a,b){this.channels[a].setHandler(b)}},{key:"addData",value:function(a,b){var c,d,e,f=!1;this.lastTime=a,o.setTime(a);for(var g=0;g<b.length;g+=2)if(d=127&b[g],e=127&b[g+1],0!==d||0!==e){if(o.log("DATA","["+p([b[g],b[g+1]])+"] -> ("+p([d,e])+")"),c=this.parseCmd(d,e),c||(c=this.parseMidrow(d,e)),c||(c=this.parsePAC(d,e)),c||(c=this.parseBackgroundAttributes(d,e)),!c&&(f=this.parseChars(d,e)))if(this.currChNr&&this.currChNr>=0){var h=this.channels[this.currChNr-1];h.insertChars(f)}else o.log("WARNING","No channel found yet. TEXT-MODE?");c?this.dataCounters.cmd+=2:f?this.dataCounters.char+=2:(this.dataCounters.other+=2,o.log("WARNING","Couldn't parse cleaned data "+p([d,e])+" orig: "+p([b[g],b[g+1]])))}else this.dataCounters.padding+=2}},{key:"parseCmd",value:function(a,b){var c=null,d=(20===a||28===a)&&32<=b&&b<=47,e=(23===a||31===a)&&33<=b&&b<=35;if(!d&&!e)return!1;if(a===this.lastCmdA&&b===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,o.log("DEBUG","Repeated command ("+p([a,b])+") is dropped"),!0;c=20===a||23===a?1:2;var f=this.channels[c-1];return 20===a||28===a?32===b?f.ccRCL():33===b?f.ccBS():34===b?f.ccAOF():35===b?f.ccAON():36===b?f.ccDER():37===b?f.ccRU(2):38===b?f.ccRU(3):39===b?f.ccRU(4):40===b?f.ccFON():41===b?f.ccRDC():42===b?f.ccTR():43===b?f.ccRTD():44===b?f.ccEDM():45===b?f.ccCR():46===b?f.ccENM():47===b&&f.ccEOC():f.ccTO(b-32),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=c,!0}},{key:"parseMidrow",value:function(a,b){var c=null;if((17===a||25===a)&&32<=b&&b<=47){if(c=17===a?1:2,c!==this.currChNr)return o.log("ERROR","Mismatch channel in midrow parsing"),!1;var d=this.channels[c-1];return d.ccMIDROW(b),o.log("DEBUG","MIDROW ("+p([a,b])+")"),!0}return!1}},{key:"parsePAC",value:function(a,b){var c=null,d=null,e=(17<=a&&a<=23||25<=a&&a<=31)&&64<=b&&b<=127,f=(16===a||24===a)&&64<=b&&b<=95;if(!e&&!f)return!1;if(a===this.lastCmdA&&b===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;c=a<=23?1:2,d=64<=b&&b<=95?1===c?j[a]:l[a]:1===c?k[a]:m[a];var g=this.interpretPAC(d,b),h=this.channels[c-1];return h.setPAC(g),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=c,!0}},{key:"interpretPAC",value:function(a,b){var c=b,d={color:null,italics:!1,indent:null,underline:!1,row:a};return c=b>95?b-96:b-64,d.underline=1===(1&c),c<=13?d.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(c/2)]:c<=15?(d.italics=!0,d.color="white"):d.indent=4*Math.floor((c-16)/2),d}},{key:"parseChars",value:function(a,b){var c=null,d=null,e=null;if(a>=25?(c=2,e=a-8):(c=1,e=a),17<=e&&e<=19){var f=b;f=17===e?b+80:18===e?b+112:b+144,o.log("INFO","Special char '"+g(f)+"' in channel "+c),d=[f]}else 32<=a&&a<=127&&(d=0===b?[a]:[a,b]);if(d){var h=p(d);o.log("DEBUG","Char codes =  "+h.join(",")),this.lastCmdA=null,this.lastCmdB=null}return d}},{key:"parseBackgroundAttributes",value:function(a,b){var c,d,e,f,g=(16===a||24===a)&&32<=b&&b<=47,h=(23===a||31===a)&&45<=b&&b<=47;return!(!g&&!h)&&(c={},16===a||24===a?(d=Math.floor((b-32)/2),c.background=n[d],b%2===1&&(c.background=c.background+"_semi")):45===b?c.background="transparent":(c.foreground="black",47===b&&(c.underline=!0)),e=a<24?1:2,f=this.channels[e-1],f.setBkgData(c),this.lastCmdA=null,this.lastCmdB=null,!0)}},{key:"reset",value:function(){for(var a=0;a<this.channels.length;a++)this.channels[a]&&this.channels[a].reset();this.lastCmdA=null,this.lastCmdB=null}},{key:"cueSplitAtTime",value:function(a){for(var b=0;b<this.channels.length;b++)this.channels[b]&&this.channels[b].cueSplitAtTime(a)}}]),a}();c.default=v},{}],50:[function(a,b,c){"use strict";var d=a(56),e={newCue:function(a,b,c,e){for(var f,g,h,i,j,k=window.VTTCue||window.TextTrackCue,l=0;l<e.rows.length;l++)if(f=e.rows[l],h=!0,i=0,j="",!f.isEmpty()){for(var m=0;m<f.chars.length;m++)f.chars[m].uchar.match(/\s/)&&h?i++:(j+=f.chars[m].uchar,h=!1);f.cueStartTime=b,b===c&&(c+=1e-4),g=new k(b,c,(0,d.fixLineBreaks)(j.trim())),i>=16?i--:i++,navigator.userAgent.match(/Firefox\//)?g.line=l+1:g.line=l>7?l-2:l+1,g.align="left",g.position=Math.max(0,Math.min(100,100*(i/32)+(navigator.userAgent.match(/Firefox\//)?50:0))),a.addCue(g)}}};b.exports=e},{56:56}],51:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(52),h=d(g),i=function(){function a(b,c,d,f){e(this,a),this.hls=b,this.defaultEstimate_=f,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new h.default(c),this.fast_=new h.default(d)}return f(a,[{key:"sample",value:function(a,b){a=Math.max(a,this.minDelayMs_);var c=8e3*b/a,d=a/1e3;this.fast_.sample(d,c),this.slow_.sample(d,c)}},{key:"canEstimate",value:function(){var a=this.fast_;return a&&a.getTotalWeight()>=this.minWeight_}},{key:"getEstimate",value:function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}},{key:"destroy",value:function(){}}]),a}();c.default=i},{52:52}],52:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b){d(this,a),this.alpha_=b?Math.exp(Math.log(.5)/b):0,this.estimate_=0,this.totalWeight_=0}return e(a,[{key:"sample",value:function(a,b){var c=Math.pow(this.alpha_,a);this.estimate_=b*(1-c)+c*this.estimate_,this.totalWeight_+=a}},{key:"getTotalWeight",value:function(){return this.totalWeight_}},{key:"getEstimate",value:function(){if(this.alpha_){var a=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/a}return this.estimate_}}]),a}();c.default=f},{}],53:[function(a,b,c){"use strict";function d(){}function e(a,b){return b="["+a+"] > "+b}function f(a){var b=self.console[a];return b?function(){for(var c=arguments.length,d=Array(c),f=0;f<c;f++)d[f]=arguments[f];d[0]&&(d[0]=e(a,d[0])),b.apply(self.console,d)}:d}function g(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];c.forEach(function(b){j[b]=a[b]?a[b].bind(a):f(b)})}Object.defineProperty(c,"__esModule",{value:!0});var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},i={trace:d,debug:d,log:d,warn:d,info:d,error:d},j=i;c.enableLogs=function(a){if(a===!0||"object"===("undefined"==typeof a?"undefined":h(a))){g(a,"debug","log","info","warn","error");try{j.log()}catch(a){j=i}}else j=i},c.logger=j},{}],54:[function(a,b,c){"use strict";var d={toString:function(a){for(var b="",c=a.length,d=0;d<c;d++)b+="["+a.start(d).toFixed(3)+","+a.end(d).toFixed(3)+"]";return b}};b.exports=d},{}],55:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.default=function(){function a(a){if("string"!=typeof a)return!1;var b=f[a.toLowerCase()];return!!b&&a.toLowerCase()}function b(a){if("string"!=typeof a)return!1;var b=g[a.toLowerCase()];return!!b&&a.toLowerCase()}function c(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)a[d]=c[d]}return a}function d(d,f,g){var h=this,i=function(){if("undefined"!=typeof navigator)return/MSIE\s8\.0/.test(navigator.userAgent)}(),j={};i?h=document.createElement("custom"):j.enumerable=!0,h.hasBeenReset=!1;var k="",l=!1,m=d,n=f,o=g,p=null,q="",r=!0,s="auto",t="start",u=50,v="middle",w=50,x="middle";if(Object.defineProperty(h,"id",c({},j,{get:function(){return k},set:function(a){k=""+a}})),Object.defineProperty(h,"pauseOnExit",c({},j,{get:function(){return l},set:function(a){l=!!a}})),Object.defineProperty(h,"startTime",c({},j,{get:function(){return m},set:function(a){if("number"!=typeof a)throw new TypeError("Start time must be set to a number.");m=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"endTime",c({},j,{get:function(){return n},set:function(a){if("number"!=typeof a)throw new TypeError("End time must be set to a number.");n=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"text",c({},j,{get:function(){return o},set:function(a){o=""+a,this.hasBeenReset=!0}})),Object.defineProperty(h,"region",c({},j,{get:function(){return p},set:function(a){p=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"vertical",c({},j,{get:function(){return q},set:function(b){var c=a(b);if(c===!1)throw new SyntaxError("An invalid or illegal string was specified.");q=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"snapToLines",c({},j,{get:function(){return r},set:function(a){r=!!a,this.hasBeenReset=!0}})),Object.defineProperty(h,"line",c({},j,{get:function(){return s},set:function(a){if("number"!=typeof a&&a!==e)throw new SyntaxError("An invalid number or illegal string was specified.");s=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"lineAlign",c({},j,{get:function(){return t},set:function(a){var c=b(a);if(!c)throw new SyntaxError("An invalid or illegal string was specified.");t=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"position",c({},j,{get:function(){return u},set:function(a){if(a<0||a>100)throw new Error("Position must be between 0 and 100.");u=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"positionAlign",c({},j,{get:function(){return v},set:function(a){var c=b(a);if(!c)throw new SyntaxError("An invalid or illegal string was specified.");v=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"size",c({},j,{get:function(){return w},set:function(a){if(a<0||a>100)throw new Error("Size must be between 0 and 100.");w=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"align",c({},j,{get:function(){return x},set:function(a){var c=b(a);if(!c)throw new SyntaxError("An invalid or illegal string was specified.");x=c,this.hasBeenReset=!0}})),h.displayState=void 0,i)return h}if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var e="auto",f={"":!0,lr:!0,rl:!0},g={start:!0,middle:!0,end:!0,left:!0,right:!0};return d.prototype.getCueAsHTML=function(){var a=window.WebVTT;return a.convertCueToDOMTree(window,this.text)},d}()},{}],56:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new m,this.regionList=[]}function f(a){function b(a,b,c,d){return 3600*(0|a)+60*(0|b)+(0|c)+(0|d)/1e3}var c=a.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return c?c[3]?b(c[1],c[2],c[3].replace(":",""),c[4]):c[1]>59?b(c[1],c[2],0,c[4]):b(0,c[1],c[2],c[4]):null}function g(){this.values=Object.create(null)}function h(a,b,c,d){var e=d?a.split(d):[a];for(var f in e)if("string"==typeof e[f]){var g=e[f].split(c);if(2===g.length){var h=g[0],i=g[1];b(h,i)}}}function i(a,b,c){function d(){var b=f(a);if(null===b)throw new Error("Malformed timestamp: "+j);return a=a.replace(/^[^\sa-zA-Z-]+/,""),b}function e(a,b){var d=new g;h(a,function(a,b){switch(a){case"region":for(var e=c.length-1;e>=0;e--)if(c[e].id===b){d.set(a,c[e].region);break}break;case"vertical":d.alt(a,b,["rl","lr"]);break;case"line":var f=b.split(","),g=f[0];d.integer(a,g),d.percent(a,g)&&d.set("snapToLines",!1),d.alt(a,g,["auto"]),2===f.length&&d.alt("lineAlign",f[1],["start",o,"end"]);break;case"position":f=b.split(","),d.percent(a,f[0]),2===f.length&&d.alt("positionAlign",f[1],["start",o,"end","line-left","line-right","auto"]);break;case"size":d.percent(a,b);break;case"align":d.alt(a,b,["start",o,"end","left","right"])}},/:/,/\s/),b.region=d.get("region",null),b.vertical=d.get("vertical","");var e=d.get("line","auto");"auto"===e&&n.line===-1&&(e=-1),b.line=e,b.lineAlign=d.get("lineAlign","start"),b.snapToLines=d.get("snapToLines",!0),b.size=d.get("size",100),b.align=d.get("align",o);var f=d.get("position","auto");"auto"===f&&50===n.position&&(f="start"===b.align||"left"===b.align?0:"end"===b.align||"right"===b.align?100:50),b.position=f}function i(){a=a.replace(/^\s+/,"")}var j=a;if(i(),b.startTime=d(),i(),"-->"!==a.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+j);a=a.substr(3),i(),b.endTime=d(),i(),e(a,b)}function j(a){return a.replace(/<br(?: \/)?>/gi,"\n")}Object.defineProperty(c,"__esModule",{value:!0}),c.fixLineBreaks=void 0;var k=a(55),l=d(k),m=function(){return{decode:function(a){if(!a)return"";if("string"!=typeof a)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(a))}}};g.prototype={set:function(a,b){this.get(a)||""===b||(this.values[a]=b)},get:function(a,b,c){return c?this.has(a)?this.values[a]:b[c]:this.has(a)?this.values[a]:b},has:function(a){return a in this.values},alt:function(a,b,c){for(var d=0;d<c.length;++d)if(b===c[d]){this.set(a,b);break}},integer:function(a,b){/^-?\d+$/.test(b)&&this.set(a,parseInt(b,10))},percent:function(a,b){var c;return!!((c=b.match(/^([\d]{1,3})(\.[\d]*)?%$/))&&(b=parseFloat(b),b>=0&&b<=100))&&(this.set(a,b),!0)}};var n=new l.default(0,0,0),o="middle"===n.align?"middle":"center";e.prototype={parse:function(a){function b(){var a=d.buffer,b=0;for(a=j(a);b<a.length&&"\r"!==a[b]&&"\n"!==a[b];)++b;var c=a.substr(0,b);return"\r"===a[b]&&++b,"\n"===a[b]&&++b,d.buffer=a.substr(b),c}function c(a){h(a,function(a,b){switch(a){case"Region":console.log("parse region",b)}},/:/)}var d=this;a&&(d.buffer+=d.decoder.decode(a,{stream:!0}));try{var e;if("INITIAL"===d.state){if(!/\r\n|\n/.test(d.buffer))return this;e=b();var f=e.match(/^WEBVTT([ \t].*)?$/);if(!f||!f[0])throw new Error("Malformed WebVTT signature.");d.state="HEADER"}for(var g=!1;d.buffer;){if(!/\r\n|\n/.test(d.buffer))return this;switch(g?g=!1:e=b(),d.state){case"HEADER":/:/.test(e)?c(e):e||(d.state="ID");continue;case"NOTE":e||(d.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){d.state="NOTE";break}if(!e)continue;if(d.cue=new l.default(0,0,""),d.state="CUE",e.indexOf("-->")===-1){d.cue.id=e;continue}case"CUE":try{i(e,d.cue,d.regionList)}catch(a){d.cue=null,d.state="BADCUE";continue}d.state="CUETEXT";continue;case"CUETEXT":var k=e.indexOf("-->")!==-1;if(!e||k&&(g=!0)){d.oncue&&d.oncue(d.cue),d.cue=null,d.state="ID";continue}d.cue.text&&(d.cue.text+="\n"),d.cue.text+=e;continue;case"BADCUE":e||(d.state="ID");continue}}}catch(a){"CUETEXT"===d.state&&d.cue&&d.oncue&&d.oncue(d.cue),d.cue=null,d.state="INITIAL"===d.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var a=this;try{if(a.buffer+=a.decoder.decode(),(a.cue||"HEADER"===a.state)&&(a.buffer+="\n\n",a.parse()),"INITIAL"===a.state)throw new Error("Malformed WebVTT signature.")}catch(a){throw a}return a.onflush&&a.onflush(),this}},c.fixLineBreaks=j,c.default=e},{55:55}],57:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}var e=a(56),f=d(e),g=function(a){var b=parseInt(a.substr(-3)),c=parseInt(a.substr(-6,2)),d=parseInt(a.substr(-9,2)),e=a.length>9?parseInt(a.substr(0,a.indexOf(":"))):0;return isNaN(b)||isNaN(c)||isNaN(d)||isNaN(e)?-1:(b+=1e3*c,b+=6e4*d,b+=36e5*e)},h=function a(b){for(var a=5381,c=b.length;c;)a=33*a^b.charCodeAt(--c);return(a>>>0).toString()},i=function(a,b,c){var d=a[b],e=a[d.prevCC];if(!e||!e.new&&d.new)return a.ccOffset=a.presentationOffset=d.start,void(d.new=!1);for(;e&&e.new;)a.ccOffset+=d.start-e.start,d.new=!1,d=e,e=a[d.prevCC];a.presentationOffset=c},j={parse:function(a,b,c,d,e,j){var k=/\r\n|\n\r|\n|\r/g,l=String.fromCharCode.apply(null,new Uint8Array(a)).trim().replace(k,"\n").split("\n"),m="00:00.000",n=0,o=0,p=0,q=[],r=void 0,s=!0,t=new f.default;t.oncue=function(a){var b=c[d],e=c.ccOffset;b&&b.new&&(o?e=c.ccOffset=b.start:i(c,d,p)),p&&!o&&(e=p+c.ccOffset-c.presentationOffset),a.startTime+=e-o,a.endTime+=e-o,a.id=h(a.startTime)+h(a.endTime)+h(a.text),a.text=decodeURIComponent(escape(a.text)),a.endTime>0&&q.push(a)},t.onparsingerror=function(a){r=a},t.onflush=function(){return r&&j?void j(r):void e(q)},l.forEach(function(a){if(s){if(a.startsWith("X-TIMESTAMP-MAP=")){s=!1,a.substr(16).split(",").forEach(function(a){a.startsWith("LOCAL:")?m=a.substr(6):a.startsWith("MPEGTS:")&&(n=parseInt(a.substr(7)))});try{b=b<0?b+8589934592:b,n-=b,o=g(m)/1e3,p=n/9e4,o===-1&&(r=new Error("Malformed X-TIMESTAMP-MAP: "+a))}catch(b){r=new Error("Malformed X-TIMESTAMP-MAP: "+a)}return}""===a&&(s=!1)}t.parse(a+"\n")}),t.flush()}};b.exports=j},{56:56}],58:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a(53),g=function(){function a(b){d(this,a),b&&b.xhrSetup&&(this.xhrSetup=b.xhrSetup)}return e(a,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var a=this.loader;a&&4!==a.readyState&&(this.stats.aborted=!0,a.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null}},{key:"load",value:function(a,b,c){this.context=a,this.config=b,this.callbacks=c,this.stats={trequest:performance.now(),retry:0},this.retryDelay=b.retryDelay,this.loadInternal()}},{key:"loadInternal",value:function(){var a,b=this.context;a="undefined"!=typeof XDomainRequest?this.loader=new XDomainRequest:this.loader=new XMLHttpRequest;var c=this.stats;c.tfirst=0,c.loaded=0;var d=this.xhrSetup;if(d)try{d(a,b.url)}catch(c){a.open("GET",b.url,!0),d(a,b.url)}a.readyState||a.open("GET",b.url,!0),b.rangeEnd&&a.setRequestHeader("Range","bytes="+b.rangeStart+"-"+(b.rangeEnd-1)),a.onreadystatechange=this.readystatechange.bind(this),a.onprogress=this.loadprogress.bind(this),a.responseType=b.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),a.send()}},{key:"readystatechange",value:function(a){var b=a.currentTarget,c=b.readyState,d=this.stats,e=this.context,g=this.config;if(!d.aborted&&c>=2)if(window.clearTimeout(this.requestTimeout),0===d.tfirst&&(d.tfirst=Math.max(performance.now(),d.trequest)),4===c){var h=b.status;if(h>=200&&h<300){d.tload=Math.max(d.tfirst,performance.now());var i=void 0,j=void 0;"arraybuffer"===e.responseType?(i=b.response,j=i.byteLength):(i=b.responseText,j=i.length),d.loaded=d.total=j;var k={url:b.responseURL,data:i};this.callbacks.onSuccess(k,d,e)}else d.retry>=g.maxRetry||h>=400&&h<499?(f.logger.error(h+" while loading "+e.url),this.callbacks.onError({code:h,text:b.statusText},e)):(f.logger.warn(h+" while loading "+e.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,g.maxRetryDelay),d.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),g.timeout)}},{key:"loadtimeout",value:function(){f.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context)}},{key:"loadprogress",value:function(a){var b=this.stats;b.loaded=a.loaded,a.lengthComputable&&(b.total=a.total);var c=this.callbacks.onProgress;c&&c(b,this.context,null)}}]),a}();c.default=g},{53:53}]},{},[40])(40)}),define("player/getSupportedMode",["jquery","hlsjs","../vendor/swfobject"],function(a,b,c){"use strict";function d(a){return f.canPlayType(a).replace(/^no$/,"")}var e=["hls","hlsjs","flash","h264"],f=document.createElement("video");return function(a){var g=navigator.userAgent.toLowerCase(),h=g.indexOf("windows nt")>-1&&g.indexOf("; arm;")>-1,i=a.modes||e,j=(String(g).match(/\schrome\/([\d]+)/)||[])[1],k={flash:function(){return!(h||g.indexOf("android")!==-1||!c.hasFlashPlayerVersion(a.flashVersion))},h264:function(){return!(!f.canPlayType||!d('video/mp4; codecs="avc1.42E01E"'))},hls:function(){return!(!f.canPlayType||g.indexOf("android")!==-1||g.indexOf("googletv")!==-1||!d("application/vnd.apple.mpegURL")&&!d("application/x-mpegURL"))},hlsjs:function(){return!(k.hls()||!f.canPlayType||g.indexOf("windows phone")!==-1||j&&!(j>=34)||!b.isSupported())}};if(a.mode&&k[a.mode]!==-1)return!!k[a.mode]()&&a.mode;try{for(var l=-1,m=i.length;++l<m;)if(k[i[l]]())return i[l]}catch(a){}return!1}}),define("player/checkRequiredParams",[],function(){"use strict";var a=["el","talks"];return function(b,c){for(var d=!0,e=a.length;e--;)b[a[e]]||(c({type:"init",message:"Required option property is missing: "+a[e],severity:"fatal"}),d=!1);return d}}),define("player/flashifySource",[],function(){"use strict";return function(a){return a+(a.indexOf("?")===-1?"?":"&")+"preroll=Blank&qr&network=tv"}}),define("player/getTalk",[],function(){"use strict";return function(a,b,c){var d,e=a.options.talks,f=e.length;for(c||(c=0);f--;)if(d=e[f],d.id==b)return e[f+c]}}),define("player/addHandlersFlash",["jquery","./flashifySource","./throttle","./getTalk"],function(a,b,c,d){"use strict";var e=c(100,function(a,b){a("currentTime").publishUnique(b)}),f=c(100,function(a,b){a("postrollRemaining").publishUnique(b)});return function(b){function c(c,m){switch(c){case"player.error":b.throwError(a.extend({},m,{type:"flash"}));break;case"player.pause":k=!1,g("pause").publish();break;case"player.seeked":b._isFirstPlaying||g("seeked").publish();break;case"player.seeking":b._isFirstPlaying||(g("seeking").publish(),k&&(l=!0));break;case"player.play":b._isFirstPlaying=!1,g("ready.seekable").publish(),h&&(g("bufferPlayable").publish(),h=!1),k=!0,!b._isRequestedPlay&&l||g("play").publish(),l=!1,b._isRequestedPlay=!1;break;case"player.complete":k=!1,g("complete").publish(b.currentTalk);break;case"player.talk.complete":k=!1,g("talkComplete").publish(b.currentTalk);break;case"player.ready":g("ready.flashInterface").publish();break;case"player.loaded":g("ready.flashTalk").publish();var n=d(b,m.talkId);b.currentTalk=n,g("talk").publishUnique(n),
g("talk.language").publishUnique(n),j&&b.el.playVideo(),j=!0;break;case"player.metadata":g("duration.total").publishUnique(m.duration);break;case"player.timeupdate":e(g,m.time);break;case"player.volumechange":var o=Math.round(1e3*+m.volume)/1e3;(o>0||!i)&&g("volume").publishUnique(o);break;case"player.ad.preroll.block":g("adBlock").publish(),g("prerollBlock").publish();break;case"player.ad.preroll.start":g("prerollStart").publish();break;case"player.ad.preroll.end":g("prerollComplete").publish();break;case"player.ad.postroll.start":g("postrollStart").publish();break;case"player.ad.postroll.end":g("postrollComplete").publish();break;case"player.ad.postroll.duration":g("postrollDuration").publish(m.duration);break;case"player.ad.postroll.remaining":f(g,m.time);break;case"player.buffer.empty":h||(h=!0,g("bufferUnplayable").publish());break;case"player.subtitle.display":g("subtitleCue.unnormalized").publish(m.text);break;case"player.mouse.down":b.postrolling?g("postrollClick").publish():b.toggle();break;case"player.metrics":g("metricsData").publish(m);break;case"player.metrics.toggle":g("metricsToggle").publish()}}var g=b.topic,h=!1,i=b.config.get("muted");g("muted").subscribe(function(a){i=a}),g("ready.flashInterface").once(function(){var a=b.currentTalk||b.options.talks[0];b.currentTalk=a,b._setSource(a.id,a.resources.hls.stream,a.introDuration,a.adDuration,a.postAdDuration)}),g("ready.flashTalk").once(function(){g("ready.handlers").publish(),b.capQualityToStage(b.options.capQualityToStage)});var j,k,l;window.onPlayerEvent=function(a,d){try{c(a,d)}catch(a){if(!a)return;b.throwError({message:a.message,stack:a.stack})}};var m=b.options.history,n=[];if(m&&m.length)for(var o=-1,p=m.length;++o<p;)window.onPlayerEvent.apply(n.slice.apply(m[o]))}}),define("player/isLastTalk",[],function(){"use strict";return function(a){return a.currentTalk.id===a.options.talks[a.options.talks.length-1].id}}),define("player/addHandlersVideo",["jquery","./throttle","./isLastTalk","./postroll-client/index"],function(a,b,c,d){"use strict";function e(a){var b=a.topic,c=d.forPlayer(a);b("complete.mediaEnded").subscribe(function(){c.hasAd()?c.startAd():b("complete").publish(a.currentTalk)}),b("postrollComplete").subscribe(function(){c.hasAd()&&b("complete").publish(a.currentTalk)})}function f(a){var b=a.topic,c={};b("play").subscribe(function(){c={}}),b("talkComplete.unnormalized").subscribe(function(){var d=a.currentTalk||{};c.id&&d.id==c.id||b("talkComplete").publish(d),c=d})}function g(a){a.topic("bufferUnplayable.unnormalized").subscribe(function(b){a.topic(b?"bufferUnplayable":"bufferPlayable").publish()})}function h(a){function b(){return a.options.customSubtitles&&!g("subtitleCue.unavailable").read()?"hidden":"showing"}function c(){f&&f.activeCues&&f.activeCues[0]&&g("subtitleCue.unnormalized").publish(f.activeCues[0].text)}function d(a){a&&(a.addEventListener("cuechange",c),a.mode=b())}function e(a){a&&(a.mode="disabled",a.removeEventListener("cuechange",c))}var f,g=a.topic;g("subtitleCue.unavailable").subscribe(function(a){f&&(f.mode=b())}),g("subtitle.track").subscribe(function(a){e(f),f=a,d(f)}),g("subtitle").subscribe(function(a){!a&&f&&(e(f),f=void 0)}),g("nativeControls").subscribe(function(a){g("subtitleCue.unavailable").publish(a)})}return function(c){function d(){j("bufferUnplayable.unnormalized").publishUnique(!1)}function i(){var a=c.currentTalk&&c.currentTalk.id;j("bufferUnplayable.unnormalized").read()||j("play.unnormalized").read()!==a||m&&j("play").publish()}var j=c.topic,k=c.el,l=a(k);f(c),e(c),g(c);var m=!1;j("ready.sourceSet").subscribe(function(a){m=a}),a.each(["seeked","seeking"],function(a,b){l.on(b,function(){m&&j(b).publish()})}),l.on("pause",function(){m&&j("pause").publish()}),l.on("canplay",d),l.on("canplaythrough",d),l.on("timeupdate",b(100,function(){m&&j("currentTime").publishUnique(k.currentTime)})),l.on("durationchange",function(){m&&j("duration.total").publishUnique(k.duration)}),l.on("ended",function(){m&&(j("talkComplete.unnormalized").publish(),j("complete.mediaEnded").publish())}),l.on("error",function(a){var b=k&&k.error&&k.error.code;c.throwError({message:"Error playing video",currentTime:k.currentTime,src:k.src,code:b||void 0}),m&&3===b&&"hlsjs"===c.mode&&c._hlsjsRecoverMedia&&c._hlsjsRecoverMedia()}),l.on("volumechange",function(){m&&(j("volume").publishUnique(Math.round(1e3*+k.volume)/1e3),j("muted").publishUnique(k.muted))}),l.on("webkitpresentationmodechanged",function(a,b){j("popOut").publishUnique("picture-in-picture"===a.target.webkitPresentationMode)}),l.on("loadstart",function(){m&&j("bufferUnplayable.unnormalized").publishUnique(!0)}),l.on("waiting",function(){m&&j("bufferUnplayable.unnormalized").publishUnique(!0)}),l.on("suspend",function(){m&&j("bufferUnplayable.unnormalized").publishUnique(!1)}),l.on("hlsjs"===c.mode?"loadeddata":"loadedmetadata",function(){j("ready.seekable").publish()}),l.on("play",function(){j("play.unnormalized").publish(c.currentTalk&&c.currentTalk.id)}),j("play.unnormalized").subscribe(i),j("bufferPlayable").subscribe(i),j("talk.id").subscribe(function(){j("talk").publishUnique(c.currentTalk)}),j("ready").subscribe(function(){c.currentTalk&&j("talk.id").publishUnique(c.currentTalk.id)}),h(c)}}),define("player/addHandlersHls",["jquery","./clickOverlay"],function(a,b){"use strict";function c(b){var d=b.el,f=b.topic,g=a(d);g.on("canplay",function(){f("talk.language").publish(b.currentTalk)});var h;f("talk").subscribe(function(a){h!==a.id&&(e(b),h=a.id)}),f("currentTime").subscribe(c.checkAdEvents)}function d(a){var b=new Image;b.src=a}function e(e){function f(a){k.push(c.createAdEvent(a))}var g=e.topic;c.adEvents=[];var h;try{h=e.currentTalk.resources.hls.metadata}catch(a){return void e.throwError({type:"init",message:"Missing HLS metadata for current talk.",severity:"fatal"})}var i={},j=e.maiAd;j&&j.hlsParams&&(i=j.hlsParams);var k=[];a.getJSON(h,i).then(function(a){var h=a.timing;h.content&&(e.currentTalk.introDuration=h.content.start),f({startsAt:8,endsAt:12,onFirstStart:function(){j&&j.prerollImpressions.forEach(d)},onEveryStart:function(){g("prerollStart").publish(),j&&b.forPlayer(e).show(j.prerollClickDestination)},onEveryEnd:function(){g("prerollComplete").publish(),j&&b.forPlayer(e).hide()}}),h.ad&&(g("duration.stitchedPostrollOffset").publish(h.ad.end-h.ad.start),f({startsAt:Math.floor(h.ad.start),endsAt:Math.floor(h.ad.end),onFirstStart:function(){j&&j.postrollQ0Impressions.forEach(d)},onEveryStart:function(){g("talkComplete.unnormalized").publish(),g("postrollStart").publish(),j&&b.forPlayer(e).show(j.postrollClickDestination,j.postrollClickImpressions)},onEveryEnd:function(){g("postrollComplete").publish(),j&&b.forPlayer(e).hide()}}),f({startsAt:Math.floor(h.ad.start+(h.ad.end-h.ad.start)/4),endsAt:Math.floor(h.ad.end),onFirstStart:function(){j&&j.postrollQ1Impressions.forEach(d)}}),f({startsAt:Math.floor(h.ad.start+(h.ad.end-h.ad.start)/2),endsAt:Math.floor(h.ad.end),onFirstStart:function(){j&&j.postrollQ2Impressions.forEach(d)}}),f({startsAt:Math.floor(h.ad.start+3*(h.ad.end-h.ad.start)/4),endsAt:Math.floor(h.ad.end),onFirstStart:function(){j&&j.postrollQ3Impressions.forEach(d)}}),f({startsAt:Math.floor(h.ad.end)-1,endsAt:Math.floor(h.ad.end),onFirstStart:function(){j&&j.postrollQ4Impressions.forEach(d)}})),c.adEvents=k}).fail(function(a,b,c){e.throwError({message:"Error retrieving HLS metadata",status:b,uri:h,query:i})})}function f(a){a.isCurrent||(a.onEveryStart(),a.hasEverStarted||(a.onFirstStart(),a.hasEverStarted=!0),a.isCurrent=!0)}function g(a){a.isCurrent&&(a.onEveryEnd(),a.hasEverEnded||(a.onFirstEnd(),a.hasEverEnded=!0),a.isCurrent=!1)}return c.adEvents=[],c.createAdEvent=function(b){return a.extend({startsAt:0,endsAt:-1,onFirstStart:a.noop,onFirstEnd:a.noop,onEveryStart:a.noop,onEveryEnd:a.noop},b,{isCurrent:!1,hasEverStarted:!1,hasEverEnded:!1})},c.checkAdEvents=function(a){for(var b,d=c.adEvents,e=d.length,h=0;h<e;h++)b=d[h],a>=b.startsAt&&(a<b.endsAt||b.endsAt===-1)?f(b):b.isCurrent&&g(b)},c}),define("player/addHandlersHlsjs",[],function(){"use strict";function a(b){var c=b.topic;c("currentTime").subscribe(function(d){var e="",f="",g="",h="",i="";if(b.hlsjs){try{e=Math.floor(b.hlsjs.abrController&&b.hlsjs.abrController.bwEstimator?b.hlsjs.abrController.bwEstimator.getEstimate():b.hlsjs.config.abrEwmaDefaultEstimate);var j=a.splitBuffered(b.el.buffered,d,Math.max(0,b.hlsjs.config.maxBufferHole,b.hlsjs.config.maxFragLookUpTolerance));g=j[0],f=j[1];var k=a.splitBuffered(b.el.buffered,d,0);i=k[0],h=k[1]}catch(a){}c("metricsData").publish({bandwidth:e,bufferLength:f,backBufferLength:g,intolerantBufferLength:h,intolerantBackBufferLength:i,currentLevel:b.hlsjs.currentLevel,nextLevel:b.hlsjs.nextLevel,loadLevel:b.hlsjs.loadLevel,nextLoadLevel:b.hlsjs.nextLoadLevel})}})}return a.splitBuffered=function(a,b,c){if(!a||!a.length)return[0,0];var d,e,f,g,h,i=a.length;for(h=-1;++h<i&&(d=a.start(h),e=a.end(h),!(Math.max(b,g||0)+c<d));)(!f||g+c<d)&&(f=d,g=e),b-c<e&&(g=e);return[Math.max(b-f,0),Math.max(g-b,0)]},a}),define("player/getLanguage",[],function(){"use strict";return function(a,b){if(!a.languages||!b)return!1;for(var c=a.languages.length;c--;)if(a.languages[c].languageCode===b)return a.languages[c];return!1}}),define("player/addHandlers",["./throttle","./addHandlersFlash","./addHandlersVideo","./addHandlersHls","./addHandlersHlsjs","./getLanguage","./isLastTalk"],function(a,b,c,d,e,f,g){"use strict";function h(a){function b(){d&&g("subtitleCue").publishUnique("")}function c(){e&&f&&g("subtitleCue").publishUnique(d.replace("\n","<br />"))}var d,e=a.options.customSubtitles,f=!0,g=a.topic;g("seeking").subscribe(b),g("talk").subscribe(b),g("talkComplete").subscribe(b),g("subtitleCue.unavailable").subscribe(function(a){a?(f=!1,b()):(f=!0,c())}),g("subtitleCue.unnormalized").subscribe(function(a){d=a,c()}),g("subtitle").subscribe(function(a){a||b()})}return function(a){function i(b){function c(){if(e){var c=e-f;b("duration").publishUnique(c),d&&(b("progress").publishUnique(d/c),b("contentTime").publishUnique(Math.round(1e3*(d-(a.currentTalk&&a.currentTalk.introDuration||0))))),g&&f&&(b("postrollDuration").publishUnique(f),b("postrollRemaining").publishUnique(e-d))}}var d,e,f=0,g=!1;b("currentTime").subscribe(function(a){d=a,c()}),b("duration.total").subscribe(function(a){e=a,c()}),b("duration.stitchedPostrollOffset").subscribe(function(a){f=a>0?+a:0,c()}),b("postrollStart").subscribe(function(){g=!0,c()}),b("postrollComplete").subscribe(function(){g=!1,c()}),b("talk").subscribe(function(){d=0,b("duration.stitchedPostrollOffset").publishUnique(0),b("progress").publishUnique(0),b("contentTime").publishUnique(0)}),b("progress").publishUnique(0),b("contentTime").publishUnique(0)}var j=a.mode,k=a.topic;switch(j){case"flash":b(a);break;case"h264":c(a);break;case"hls":c(a),d(a);break;case"hlsjs":c(a),d(a),e(a);break;default:return void a.throwError({type:"init",message:"No handlers found for unrecognized player mode: "+j,severity:"fatal"})}"flash"!==j&&k("ready.handlers").publish(),a.options.talks&&a.options.talks[0]&&k("duration.total").publishUnique(a.options.talks[0].duration),k("duration").subscribe(function(b){a.currentTalk?a.currentTalk.duration=b:a.options.talks&&a.options.talks[0]&&(a.options.talks[0].duration=b)}),k("complete").subscribe(function(){g(a)?k("ended").publish(a.currentTalk):a.playNext()}),k("popOut").subscribe(function(b){a.config.set("popOut",b)}),k("play").once(function(){a.config.get("popOut")&&a.popOut(!0)}),i(k),k("postrollStart").subscribe(function(){a.postrolling=!0}),k("postrollComplete").subscribe(function(){a.postrolling=!1}),k("talk").subscribe(function(){a.postrolling&&k("postrollComplete").publish(),a.postrolling=!1}),k("talk.language").subscribe(function(b){if(a.subtitle){var c=a.config.get("languageCode"),d=f(b,c);d||!b.isSubtitleRequired&&b.nativeLanguage===a.options.nativeLanguage||(d=f(b,a.options.nativeLanguage)),d?a.subtitle(d.languageCode,!1):a.subtitle(!1,!1)}}),k("ready.sourceSet").subscribe(function(){k("ready.sourceSetting").publishUnique(!1)}),h(a)}}),define("player/actionsFlash",["jquery","./flashifySource","./getTalk","./getLanguage"],function(a,b,c,d){"use strict";var e={};return a.each({pause:"pauseVideo",seek:"seek",sendAds:"sendAds",capQualityToStage:"capQualityToStage"},function(a,b){e[a]=function(){var a=this.el[b];a&&a.apply(this.el,[].slice.call(arguments))}}),e.play=function(){this._isRequestedPlay=!0,this.lastPlayedTalkId==(this.currentTalk&&this.currentTalk.id)?this.el.resumeVideo():(this._isFirstPlaying=!0,this.el.playVideo())},e.playTalk=function(a){var b=c(this,a);b&&this.currentTalk!=b?(this._isFirstPlaying=!0,this.currentTalk=b,this._setSource(b.id,b.resources.hls.stream,b.introDuration,b.adDuration,b.postAdDuration)):this.play()},e.mute=function(a){this.el.volume(a?0:this.config.get("volume"))},e.subtitle=function(a,b){var c=d(this.currentTalk,a);c?this.el.setLanguage(c.languageCode,c.isRtl):this.el.setLanguage(null,null),b!==!1&&this.config.set("languageCode",!!c&&c.languageCode),this.topic("subtitle").publishUnique(c)},e.volume=function(a){this.el.volume(a)},e._playbackRate=function(){},e._setSource=function(a,b,c,d,e){this._unsetSource(),this.topic("ready.sourceSetting").publishUnique(!0),this.el.load(a,b,c,d,e),this.topic("ready.sourceSet").publishUnique(!0)},e._setSourceFromCurrentTalk=function(){var a=this.currentTalk;this._setSource(a.id,a.resources.hls.stream,a.introDuration,a.adDuration,a.postAdDuration)},e._unsetSource=function(){this.topic("ready.sourceSet").publishUnique(!1)},e._setSource.early=!0,e._setSourceFromCurrentTalk.early=!0,e._unsetSource.early=!0,e}),define("player/actionsH264",["jquery","./getTalk"],function(a,b){"use strict";var c={};return c.play=function(){this.topic("talk").publishUnique(this.currentTalk),this.el.play()},c.pause=function(){this.el.pause()},c.playTalk=function(a){var c=b(this,a);!c||this.currentTalk&&this.currentTalk.id==c.id?this.play():(this.currentTalk=c,this.topic("talk.id").publishUnique(c.id),this._setSource(c.resources.h264[0].file),this.el.play())},c.mute=function(a){this.el.muted=a},c.seek=function(a){this.el.currentTime=a},c.volume=function(a){this.el.volume=a},c._playbackRate=function(a){this.el.playbackRate=a},c._setSource=function(a){this._unsetSource(),this.topic("ready.sourceSetting").publishUnique(!0),this.el.src=a,this.topic("ready.sourceSet").publishUnique(!0)},c._setSourceFromCurrentTalk=function(){var a=this.currentTalk;this._setSource(a.resources.h264[0].file)},c._unsetSource=function(a){this.el.src="",this.topic("ready.sourceSet").publishUnique(!1)},c._setSource.early=!0,c._setSourceFromCurrentTalk.early=!0,c._unsetSource.early=!0,c}),define("player/actionsHls",["jquery","./getTalk","./getLanguage","./hlsInitTalk"],function(a,b,c,d){"use strict";var e={};return e.play=function(){this.topic("talk.id").publishUnique(this.currentTalk.id),this.el.play()},e.pause=function(){this.el.pause()},e.playTalk=function(a){var c=b(this,a),e=this.topic,f=this.el;if(!c||this.currentTalk&&this.currentTalk.id==c.id)this.play();else{var g=this;this.currentTalk=c,d(this,f).done(function(){g.play()}).always(function(){e("talk.id").publishUnique(c.id)})}},e.mute=function(a){this.el.muted=a},e.seek=function(a){this.el.currentTime=a},e.subtitle=function(a,b){var d=c(this.currentTalk,a);a=(d&&d.languageCode||"").toLowerCase();for(var e,f=this.el,g=f.textTracks.length,h=!1;g--;)e=f.textTracks[g],e&&(e.language||"").toLowerCase()===a?(this.topic("subtitle.track").publish(e),h=!0):e.mode="disabled";h||(d=!1),b!==!1&&this.config.set("languageCode",!!d&&a),this.topic("subtitle").publishUnique(d)},e.volume=function(a){this.el.volume=a},e._playbackRate=function(a){this.el.playbackRate=a},e._setSource=function(a){this._unsetSource(),this.topic("ready.sourceSetting").publishUnique(!0),this.el.src=a,this.topic("ready.sourceSet").publishUnique(!0)},e._setSourceFromCurrentTalk=function(){this._unsetSource(),this.topic("ready.sourceSetting").publishUnique(!0),d(this,this.el)},e._unsetSource=function(a){this.el.src="",this.topic("ready.sourceSet").publishUnique(!1)},e._setSource.early=!0,e._setSourceFromCurrentTalk.early=!0,e._unsetSource.early=!0,e}),define("player/isMobile",[],function(){"use strict";function a(){return a.isIOS()||a.isAndroid()}function b(b){return!!a.ua.match(b)}var c=/Android/g,d=/(iPad|iPhone|iPod)/g;return a.isIOS=function(){return b(d)},a.isAndroid=function(){return b(c)},a.ua=window.navigator&&window.navigator.userAgent||"",a}),define("player/hlsjsCustomCapLevelController",["jquery","hlsjs","./isMobile"],function(a,b,c){"use strict";function d(c){var d=this;a.extend(d,{hls:c,restrictedLevels:[],_onFpsDropLevelCapping:function(a,b){d.onFpsDropLevelCapping(b)},_onManifestParsed:function(a,b){d.onManifestParsed(b)},_onMediaAttaching:function(a,b){d.onMediaAttaching(b)}}),c.on(b.Events.FPS_DROP_LEVEL_CAPPING,d._onFpsDropLevelCapping),c.on(b.Events.MANIFEST_PARSED,d._onManifestParsed),c.on(b.Events.MEDIA_ATTACHING,d._onMediaAttaching)}return a.extend(d.prototype,{destroy:function(){var a=this.hls;a&&(a.off(b.Events.FPS_DROP_LEVEL_CAPPING,this._onFpsDropLevelCapping),a.off(b.Events.MANIFEST_PARSED,this._onManifestParsed),a.off(b.Events.MEDIA_ATTACHING,this._onMediaAttaching)),this.media=null,this.restrictedLevels=[],this.autoLevelCapping=-1,this.timer&&(this.timer=clearInterval(this.timer))},detectPlayerSize:function(){if(this.media){var a=this.levels?this.levels.length:0;if(a){var b=this.hls;b.config.capQualityToStage&&(b.autoLevelCapping=this.getMaxLevel(a-1)),b.autoLevelCapping>this.autoLevelCapping&&b.streamController.nextLevelSwitch(),this.autoLevelCapping=b.autoLevelCapping}}},onFpsDropLevelCapping:function(a){this.isLevelRestricted(a.droppedLevel)||this.restrictedLevels.push(a.droppedLevel)},onManifestParsed:function(b){if(!c()){var d=this.hls;this.levels=b.levels,d.firstLevel=this.getMaxLevel(b.firstLevel),this.timer&&clearInterval(this.timer),this.timer=setInterval(a.proxy(this.detectPlayerSize,this),2e3),this.detectPlayerSize()}},onMediaAttaching:function(a){this.media=a.media instanceof HTMLVideoElement?a.media:null},getMediaHeight:function(){var a=0,b=this.media;return b&&(a=b.height||b.clientHeight||b.offsetHeight),a},getMaxLevel:function(a){var b,c,d,e,f,g=0,h=0;for(b=Math.max(480,this.getMediaHeight()),h=0;h<=a&&(c=this.levels[h],d=c.height,e=this.levels[h+1],!(d>b))&&!this.isLevelRestricted(h)&&!(f&&f.height===d&&b-d<100&&(!e||e.height>b));h++)g=h,f=c;return g},isLevelRestricted:function(a){return this.restrictedLevels.indexOf(a)!==-1}}),d}),define("player/actionsHlsjs",["jquery","hlsjs","./hlsjsCustomCapLevelController","./actionsHls"],function(a,b,c,d){"use strict";function e(b){var c=a();if(!b||!b.languages||!b.languages.length)return c;var d="";try{b.resources.hls.stream.match(/[?&]preview\b/)&&(d="?preview")}catch(a){}for(var e=b.languages.length;e--;){var f=b.languages[e];c=c.add(a("<track>").attr("kind","subtitles").attr("label",f.languageName).attr("src","https://hls.ted.com/talks/"+b.id+"/subtitles/"+f.languageCode+"/full.vtt"+d).attr("srclang",f.languageCode))}return c}function f(a,b){var c=a._hlsjsErrorData&&+a._hlsjsErrorData.mediaRecoveryStarted;return c>+i&&+new Date-c<(b||1e3)}function g(a,b){var c=a._hlsjsErrorData&&+a._hlsjsErrorData.networkRecoveryStarted;return c>+i&&+new Date-c<(b||1e3)}var h={},i=new Date;return a.extend(h,d),h._hlsjsRecoverMedia=function(){var b=this,c=b._hlsjsErrorData||{},d=b&&b.topic("currentTime").read()||"N/A",e={type:"hlsjs",severity:"info",streamUrl:c.streamUrl,currentTime:d};if(f(b,3e3))return b.throwError(a.extend({message:"Media recovery rejected: too soon"},e)),!1;if(c.mediaRecoveryTime!==d&&(c.mediaRecoveryTime=d,c.mediaRecoveryCount=0),b.el&&b.el.error&&b.el.error.code===b.el.error.MEDIA_ERR_DECODE){var g=(b.hlsjs.currentLevel||2)-1;b.hlsjs.autoLevelCapping=Math.max(g,b.hlsjs.autoLevelCapping),b.hlsjs.currentLevel=g,b.hlsjs.nextLevel=g}return c.mediaRecoveryCount>0&&b.hlsjs.swapAudioCodec(),b.hlsjs.recoverMediaError(),c.mediaRecoveryCount++,c.mediaRecoveryStarted=new Date,e.recovery_attempts=c.mediaRecoveryCount,b.throwError(a.extend({message:"Media recovery started"},e)),b.el&&b.el.play(),!0},h._hlsjsRecoverNetwork=function(){var b=this,c=b._hlsjsErrorData||{},d=b&&b.topic("currentTime").read()||"N/A",e={type:"hlsjs",severity:"info",streamUrl:c.streamUrl,currentTime:d};return g(b,3e3)?(b.throwError(a.extend({message:"Network recovery rejected: too soon"},e)),!1):(c.networkRecoveryTime!==d&&(c.networkRecoveryTime=d,c.networkRecoveryCount=0),b.hlsjs.startLoad(),c.networkRecoveryCount++,c.networkRecoveryStarted=new Date,e.recovery_attempts=c.networkRecoveryCount,b.throwError(a.extend({message:"Network recovery started"},e)),b.el&&b.el.play(),!0)},h._hlsjsErrorSetup=function(a){var b=this;b._hlsjsErrorData={networkRecoveryTime:"N/A",networkRecoveryCount:0,networkRecoveryStarted:null,mediaRecoveryTime:"N/A",mediaRecoveryCount:0,mediaRecoveryStarted:null,streamUrl:a}},h._hlsjsErrorHandle=function(a){var c=this,d=c._hlsjsErrorData||{},e={type:"hlsjs",message:a.type+": "+a.details,severity:"info",streamUrl:d.streamUrl,currentTime:c&&c.topic("currentTime").read()||"N/A"};if(a.fatal){var f;switch(a.type){case b.ErrorTypes.NETWORK_ERROR:f=h._hlsjsRecoverNetwork.call(c),e.severity=a.fatal&&!f?"fatal":"warning",e.recovering=f,e.recovery_attempts=d.networkRecoveryCount;break;case b.ErrorTypes.MEDIA_ERROR:f=h._hlsjsRecoverMedia.call(c),e.severity=a.fatal&&!f?"fatal":"warning",e.recovering=f,e.recovery_attempts=d.mediaRecoveryCount;break;default:e.severity="fatal"}}switch(a.details){case b.ErrorDetails.MANIFEST_LOAD_ERROR:case b.ErrorDetails.LEVEL_LOAD_ERROR:e.request_url=a.url,e.response_code=a.response&&a.response.code,e.response_text=a.response&&a.response.text;break;case b.ErrorDetails.MANIFEST_LOAD_TIMEOUT:case b.ErrorDetails.LEVEL_LOAD_TIMEOUT:e.request_url=a.url;break;case b.ErrorDetails.MANIFEST_PARSING_ERROR:e.request_url=a.url,e.reason=a.reason;break;case b.ErrorDetails.LEVEL_SWITCH_ERROR:e.hls_level=a.level,e.reason=a.reason;break;case b.ErrorDetails.FRAG_LOAD_ERROR:case b.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case b.ErrorDetails.FRAG_LOAD_TIMEOUT:e.request_url=a.frag&&a.frag.url,e.request_bytes_start=a.frag&&a.frag.byteRangeStartOffset,e.request_bytes_end=a.frag&&a.frag.byteRangeEndOffset,e.response_code=a.response&&a.response.code,e.response_text=a.response&&a.response.text;break;case b.ErrorDetails.FRAG_PARSING_ERROR:e.reason=a.reason;break;case b.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR:e.media_url=a.url;break;case b.ErrorDetails.BUFFER_ADD_CODEC_ERROR:e.mse_error=a.err&&a.err.message,e.mse_mime_type=a.mimeType;break;case b.ErrorDetails.BUFFER_APPEND_ERROR:e.request_url=a.frag&&a.frag.url,e.request_bytes_start=a.frag&&a.frag.byteRangeStartOffset,e.request_bytes_end=a.frag&&a.frag.byteRangeEndOffset;break;case b.ErrorDetails.BUFFER_SEEK_OVER_HOLE:e.hole_duration=a.hole}c.throwError(e)},h._setSource=function(d){var f=this;f._unsetSource(),f.topic("ready.sourceSetting").publishUnique(!0);var g=a.extend({capQualityToStage:f.options.capQualityToStage,capLevelController:c,startLevel:f.config.get("hlsjsStartLevel"),subtitleStreamController:!1,subtitleTrackController:!1,timelineController:!1,enableCEA708Captions:!1,enableWebVTT:!1},f.options.hlsjsConfig||{});f.hlsjs=new b(g);var i=f.options.hlsjsEvents||{};for(var j in i)i.hasOwnProperty(j)&&f.hlsjs.on(b.Events[j],function(a,b){i[j].call(f.hlsjs,b)});f.hlsjs.on(b.Events.MANIFEST_PARSED,function(){f.topic("ready.sourceSet").publishUnique(!0)}),f.hlsjs.on(b.Events.LEVEL_LOADED,function(a,b){f.config.set("hlsjsStartLevel",b.level)}),f.hlsjs.on(b.Events.LEVEL_SWITCHING,function(a,b){b&&b.bitrate>0&&f.topic("metricsData.bitrate").publishUnique(b.bitrate)}),h._hlsjsErrorSetup.call(f,d),f.hlsjs.on(b.Events.ERROR,function(a,b){h._hlsjsErrorHandle.call(f,b)}),f.hlsjs.loadSource(d),f.hlsjs.attachMedia(f.el);var k=a(f.el);k.attr("crossorigin","anonymous"),k.append(e(f.currentTalk))},h._unsetSource=function(){var b=this;b.hlsjs&&(b.hlsjs.destroy(),delete b.hlsjs),b.el&&a(b.el).removeAttr("crossorigin").removeAttr("src").find("track").remove(),b.topic("ready.sourceSet").publishUnique(!1)},h.capQualityToStage=function(a){this.hlsjs&&(this.hlsjs.config.capQualityToStage=a)},h._setSource.early=!0,h._unsetSource.early=!0,h.capQualityToStage.early=!0,h}),define("player/augmentTalks",["jquery"],function(a){"use strict";return function(b){if(!b||!b.length)return[];for(var c,d=b.length,e=d;e--;)c=a.extend({index:e,introDuration:12.05116},b[e]);return b}}),define("player/getFullScreenActions",["jquery"],function(a){"use strict";function b(b){var c=document,d=b.fullScreenMode,e=f[d];b.topic("fullScreen").subscribe(function(a){b.isFullScreen=a,b.topic(a?"enterFullScreen":"exitFullScreen").publish()}),"webkitVideo"===d?a(b.el).on("webkitpresentationmodechanged",function(){b.topic("fullScreen").publishUnique("fullscreen"===b.el.webkitPresentationMode)}):e&&a(c).on(e.change,function(){c[e.element]===b.fullScreenElement?b.topic("fullScreen").publishUnique(!0):!c[e.element]&&b.isFullScreen&&b.topic("fullScreen").publishUnique(!1)})}function c(a){function b(){c.webkitEnterFullscreen()}var c=a.el;c.readyState>=1?b(a):(c.addEventListener("loadedmetadata",b,!1),a.play())}function d(a){var b=a.fullScreenMode,c=window.document;"webkitVideo"===b?a.el.webkitExitFullscreen():f[b]&&c[f[b].cancel]()}function e(a){var b=a.fullScreenMode;"webkitVideo"===b?c(a):f[b]?a.fullScreenElement[f[b].request]():a.throwError({type:"client",message:"Full screen mode not supported",severity:"warning"})}var f={standard:{cancel:"cancelFullScreen",change:"fullscreenchange",enabled:"fullscreenEnabled",error:"fullscreenerror",element:"fullscreenElement",request:"requestFullScreen"},moz:{cancel:"mozCancelFullScreen",change:"mozfullscreenchange",enabled:"mozFullScreenEnabled",error:"mozfullscreenerror",element:"mozFullScreenElement",request:"mozRequestFullScreen"},ms:{cancel:"msExitFullscreen",change:"MSFullscreenChange",enabled:"msFullscreenEnabled",error:"MSFullscreenError",element:"msFullscreenElement",request:"msRequestFullscreen"},webkit:{cancel:"webkitCancelFullScreen",change:"webkitfullscreenchange",enabled:"webkitFullscreenEnabled",error:"webkitfullscreenerror",element:"webkitCurrentFullScreenElement",request:"webkitRequestFullScreen"}};return function(a){return a.topic("ready.dom").subscribe(function(){b(a)}),{requestFullScreen:function(b){a.fullScreenElement||(a.fullScreenElement=b||a.el),e(a)},cancelFullScreen:function(){d(a)}}}}),define("player/addActions",["jquery","./actionsFlash","./actionsH264","./actionsHls","./actionsHlsjs","./augmentTalks","./clickOverlay","./getTalk","./getFullScreenActions","./postroll-client/index"],function(a,b,c,d,e,f,g,h,i,j){"use strict";var k={flash:b,h264:c,hls:d,hlsjs:e};return function(b){function c(a){for(var c=-1,d=a.length;++c<d;)a[c].callback.apply(b,a[c].args)}function d(a){return function(){var c=[].slice.call(arguments);return o&&p||a.early?a.apply(b,c):n.push({callback:a,args:c}),o&&!p&&a.sourcer&&!b.topic("ready.sourceSetting").read()&&b._setSourceFromCurrentTalk(),b}}function e(){o=b.topic("ready").read(),p=b.topic("ready.sourceSet").read(),o&&p&&(c(n),n=[])}var l=b.mode,m=k[l],n=[],o=!1,p=!1;if(!m)return void b.throwError({type:"init",message:"No actions found for unrecognized player mode: "+l,severity:"fatal"});b.topic("ready.sourceSet").subscribe(e),b.topic("ready").once(e),b.topic("play").subscribe(function(){b.lastPlayedTalkId=b.currentTalk&&b.currentTalk.id}),m.play=function(){var a=m.play,c=!1;return b.topic("ended").subscribe(function(){c=!0}),b.topic("play").subscribe(function(){c=!1}),function(){c&&m.seek(0),a.call(b)}}(),m.playNext=function(){var a=h(b,b.currentTalk.id,1);a&&b.playTalk(a.id)},m.playPrev=function(){var a=h(b,b.currentTalk.id,-1);a&&b.playTalk(a.id)},m.playbackRate=function(a){b.topic("playbackRate").publish(a)},m.popOut=function(a){b.canPopOut&&b.el.webkitSetPresentationMode&&b.el.webkitSetPresentationMode(a?"picture-in-picture":"inline")},m.volume=function(){var a=m.volume;return function(c){c=Math.round(1e3*+c)/1e3,c<0&&(c=0),c>1&&(c=1),a.call(b,c),b.topic("volume").publishUnique(c)}}(),m.mute=function(){var a=m.mute;return function(c){c=!!c,a.call(b,c),b.topic("muted").publishUnique(c)}}(),m.seek=function(){var a=m.seek,c=0;return b.topic("duration").subscribe(function(a){c=a}),function(d){d=+d,d<0&&(d=0),d>c-.5&&(d=c-.5),a.call(b,d)}}(),m.seek=function(){var a=m.seek,c=!1,d=!1;return b.topic("ready.seekable").once(function(){c!==!1&&a.call(b,c),d=!0}),function(e){d?a.call(b,e):c=e}}(),m.contentTime=function(a){b.seek(a/1e3+(b.currentTalk&&b.currentTalk.introDuration||0))},m.toggle=function(){b.paused?b.play():b.pause()},m.capQualityToStage=function(){var c=m.capQualityToStage||a.noop;return function(a){b.options.capQualityToStage=!!a,c.call(b,!!a)}}();var q=i(b);m.requestFullScreen=q.requestFullScreen,m.cancelFullScreen=q.cancelFullScreen,m.nativeControls=function(a){b.canNativeControls&&(a?b.el.setAttribute("controls","controls"):b.el.removeAttribute("controls"),b.topic("nativeControls").publishUnique(!!a))};var r;m.nativeFullScreen=function(a){b.canNativeFullScreen&&(a?(r=b.el.getAttribute("controls"),m.requestFullScreen(b.el),m.nativeControls(!0)):(r||m.nativeControls(!1),m.cancelFullScreen()))},m.setTalks=function(a){if(a&&a.length){b._unsetSource(),g.forPlayer(b).hide(),j.forPlayer(b).abandon(),b.options.talks=f(a);var c=a[0];b.currentTalk=c,b.topic("talk.id").publishUnique(c.id),b._setSourceFromCurrentTalk()}},m.cancelFullScreen.early=!0,m.setTalks.early=!0,m.play.sourcer=!0,m.playNext.sourcer=!0,m.playPrev.sourcer=!0,m.playTalk.sourcer=!0,m.seek.sourcer=!0,m.contentTime.sourcer=!0;for(var s in m)m.hasOwnProperty(s)&&(b[s]=d(m[s]))}}),define("player/addProperties",["./isMobile"],function(a){"use strict";function b(){return g.requestFullScreen?!!f.fullscreenEnabled&&"standard":g.mozRequestFullScreen?!!f.mozFullScreenEnabled&&"moz":g.webkitRequestFullScreen?!!f.webkitFullscreenEnabled&&"webkit":g.webkitEnterFullscreen?"webkitVideo":!!g.msRequestFullscreen&&(!!f.msFullscreenEnabled&&"ms")}function c(){return!(!g.playbackRate||g.playbackRate!==g.defaultPlaybackRate)}function d(){return"function"==typeof g.webkitSupportsPresentationMode}function e(){return!a()}var f=document,g=f.createElement("video");return function(a){var f=a.options.mode,g="hls"===f||"hlsjs"===f||"h264"===f;a.fullScreenMode=b(),a.canFullScreen=a.fullScreenMode!==!1,a.canNativeControls=g,a.canNativeFullScreen=a.canNativeControls&&a.canFullScreen,a.canPlaybackRate=!!g&&c(),a.canPopOut="flash"!==f&&d(),a.canSubtitle="flash"===f||"hls"===f||"hlsjs"===f,a.canVolume="flash"===f||e(),a.mode=f,a.talks=a.options.talks,a.postrolling=!1,a.paused=!0,a.on("play",function(){a.paused=!1}).on("pause",function(){a.paused=!0})}}),define("player/addPlaybackRate",[],function(){"use strict";var a=1;return function(b){function c(){return b.config.get("playbackRate")}function d(){g?b._playbackRate(a):b._playbackRate(c())}function e(){g=!1,d()}function f(){g=!0,d()}var g=!1;b.on("ready",function(){b.playbackRate(c())}),b.on("play",d),b.on("prerollStart",f),b.on("postrollStart",f),b.on("prerollComplete",e),b.on("postrollComplete",e),b.on("playbackRate",function(a){b.config.set("playbackRate",a),d()})}}),define("player/addProlongedBuffering",[],function(){"use strict";function a(a){function c(){l&&(window.clearInterval(l),l=null)}function d(){var a,c=new Date-m,d=b.length,e=i&&!k,f=e?"prolongedRebuffer":"prolongedBuffer";if(!j)return void(m=new Date);for(n[f]=n[f]||[];d--;)a=b[d],c>a&&n[f].indexOf(a)===-1&&(n[f].push(a),o(f).publish(a))}function e(){c(),m=new Date,l=window.setInterval(d,100)}function f(){c()}function g(){j=!0}function h(){j=!1}var i,j,k,l,m,n={},o=a.topic;o("talk").subscribe(function(){i=!1,n={}}),o("bufferPlayable").subscribe(function(){i=!0}),o("seeking").subscribe(function(){k=!0}),o("seeked").subscribe(function(){
window.setTimeout(function(){k=!1},500)}),o("bufferUnplayable").subscribe(e),o("bufferPlayable").subscribe(f),o("play").subscribe(g),o("pause").subscribe(h),o("talk").subscribe(h),o("talkComplete").subscribe(f),o("talkComplete").subscribe(h),o("prolongedBuffer").subscribe(function(b){b%2e3&&a.throwError({message:"Prolonged Buffer: "+b})}),o("prolongedRebuffer").subscribe(function(b){b%2e3&&a.throwError({message:"Prolonged Rebuffer: "+b})})}var b=[5e3,4e3,3e3,2e3,1e3];return a}),define("player/addPlayToken",[],function(){"use strict";function a(b){a.init(b)}var b=Math.pow(2,53)-1;return a.makeToken=function(){return["001",Math.floor(Math.random()*b).toString(36),(new Date).getTime().toString(36)].join("-")},a.init=function(b){var c=b.topic;c("ready.sourceSetting").subscribe(function(d){if(d){var e=a.makeToken();b.playToken=e,c("playToken").publishUnique(e)}})},a}),define("player/addVolume",[],function(){"use strict";return function(a){var b=!1;a.on("ready",function(){a.volume(a.config.get("volume")),a.mute(a.config.get("muted"))}).on("muted",function(c){b=c,a.config.set("muted",c)}).on("volume",function(c){a.config.set("volume",c),c>0&&b&&a.mute(!1)})}}),define("player/addInitPromise",["jquery"],function(a){"use strict";return function(b){var c=new a.Deferred;b.on("error",function(a){c.rejectWith(b,[a])}),b.on("ready",function(){"pending"===c.state()&&c.resolveWith(b,[b])}),a.extend(b,c.promise())}}),define("player/addThrower",["jquery","./isMobile"],function(a,b){"use strict";var c=window,d=c&&c.console,e=d&&d.log;return function(f){var g=!0;f.one("play",function(){g=!1}),f.throwError=function(h){var i=!!f,j=i&&f.mode,k={context:"ted_player_wrapper",type:"unknown",message:"Something happened",severity:"warning",deviceType:b()?"mobile":"desktop",playerMode:j,playToken:i&&f.playToken||"",location:c&&c.location.href,currentTime:i&&f.topic("currentTime").read()||"",isPostrolling:i&&!!f.postrolling,pev:"004"},l={};"hls"===j&&f.el&&(l.streamUrl=f.el.src),"hlsjs"===j&&f.hlsjs&&(l.levelLoad=f.hlsjs.loadLevel,l.streamUrl=f.hlsjs.url);var m={};f&&f.maiAd&&(m.masterLineItemId=f.maiAd.lineItemId,m.masterCreativeId=f.maiAd.creativeId,m.masterTargetingValue=f.maiAd.companionTargetingValue);var n=a.extend({},k,l,m,h||{});g&&"fatal"===n.severity&&(n.severity="abortive");var o,p;switch(n.severity){case"abortive":case"fatal":o=1,p="#F2D2CF";break;case"warning":o=2,p="#FCF1CC";break;default:o=3,p="#999999"}f.options&&f.options.logLevel>=o&&(a.post("https://error-collector.ted.com/",{message:n}),f.options.logConsole>0&&e&&(1===f.options.logConsole?d.log("%cPaRappa: "+n.message,"color: "+p):d.log(n))),f.topic("error").publish(n)},f.throwConsoleData=function(a){e&&f.options.logLevel>=3&&f.options.logConsole>=2&&d.log(a)}}}),define("player/Config",["jquery"],function(a){"use strict";function b(a){this._options=a,this._inited=!1}return a.extend(b.prototype,{_init:function(){if(!this._inited){var b=this._options.storageAdapter.getObject(this._options.storageProperty);this.internal=a.extend({},this._options.defaults,b),this._inited=!0}},get:function(a){return this._init(),this.internal[a]},set:function(a,b){this._init(),this.internal[a]=b,this._options.storageAdapter.setObject(this._options.storageProperty,this.internal)}}),b}),define("player/StorageAdapter",["jquery"],function(a){"use strict";function b(a){if(!(a&&a.getItem&&a.setItem&&window.JSON&&JSON.parse&&JSON.stringify))return!1;try{var b=Math.floor(99999*Math.random()).toString(36),c="parappa-test-"+b;if(a.setItem(c,b),a.getItem(c,b)!==b)return!1;a.removeItem(c)}catch(a){return!1}return!0}function c(a){this.fallback={},this.adapter=a,this.isStorable=b(a)}return a.extend(c.prototype,{getItem:function(a){return this.isStorable?this.adapter.getItem(a):this.fallback[a]},getObject:function(b){var c=this.getItem(b);try{if(c=JSON.parse(c),"object"===a.type(c))return c}catch(a){}return{}},setItem:function(a,b){this.isStorable?this.adapter.setItem(a,b):this.fallback[a]=b},setObject:function(b,c){"object"===a.type(c)&&this.setItem(b,JSON.stringify(c))}}),c}),define("player/Player",["jquery","./topicFactory","./replaceElement","./getSupportedMode","./checkRequiredParams","./addHandlers","./addActions","./addProperties","./addPlaybackRate","./addProlongedBuffering","./addPlayToken","./addVolume","./augmentTalks","./isLastTalk","./addInitPromise","./addThrower","./Config","./StorageAdapter"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";function s(n){var r=this;this.topic=b({bufferPlayable:void 0,bufferUnplayable:void 0,prolongedBuffer:void 0,prolongedRebuffer:void 0,play:void 0,pause:void 0,prerollStart:void 0,prerollBlock:void 0,postrollStart:void 0,postrollEnd:void 0,adBlock:void 0,seeked:void 0,seeking:void 0}),p(r);var s=!1;this.topic("error").subscribe(function(a){"abortive"===a.severity&&(s=!0)}),o(r),n=a.extend({},v,n),this.options=n,e(n,r.throwError),n.mode=d(n),n.mode||r.throwError({type:"client",message:"Client does not support any player mode.",severity:"fatal"}),n.talks=m(n.talks),n.talks.length||r.throwError({type:"init",message:"No talks sent to player.",severity:"fatal"}),this.options=n,this.config=new q(a.extend({defaults:{languageCode:!1,muted:!1,volume:n.defaultVolume,playbackRate:n.defaultPlaybackRate,hlsjsStartLevel:n.hlsjsConfig.startLevel,popOut:!1}},n)),h(this),g(r),l(r),i(r),j(r),k(r),s||(this.topic("ready.dom").once(function(){function a(){!s&&b&&c&&r.topic("ready").publishUnique(!0)}var b=!1,c=!1;window.setTimeout(function(){f(r),r.topic("ready.sourceSet").subscribe(function(c){b=c,a()}),r.topic("ready.handlers").once(function(){c=!0,a()})},10)}),c(this))}var t,u=function(){var a=document.createElement("video");return a&&a.defaultPlaybackRate?a.defaultPlaybackRate:1}();try{t=window.localStorage}catch(a){}t=new r(t);var v={attrs:{},customSubtitles:!1,defaultPlaybackRate:u,defaultVolume:.5,el:null,flashVersion:"11.1.0",mai:!1,maiAdUnitId:null,maiPostrollType:"vast",modes:void 0,nativeLanguage:"en",storageAdapter:t,storageProperty:"playerconfig",hlsjsConfig:{},hlsjsEvents:{},logLevel:2,logConsole:1,capQualityToStage:!0,swf:"https://pb.tedcdn.com/assets/player/flash_hls/player_4_01_002.swf"};a.extend(s.prototype,{off:function(a,b){return this.topic(a).unsubscribe(b),this},on:function(a,b){return this.topic(a).subscribe(b),this},one:function(a,b){return this.topic(a).once(b),this},isLastTalk:function(){return n(this)}}),s.getSupportedMode=function(){return d(v)};b();return s}),define("widgets/player",["jquery","lodash","widgets/player/ga-tracker","widgets/player/ted-tracker","widgets/player/cs-tracker","widgets/player/qa-tracker","utils/f","utils/is_mobile","utils/query_param","utils/ted","player/Player","lib/browserDetect","lib/pubSub","lib/focus-zone","Cookies","spinjs","jqueryui/widget","widgets/hover","lib/resize"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";function q(){return i("playerMode")||null}function r(a){a.preventDefault(),a.stopPropagation()}var s="player",t=s+"--paused",u=s+"--playing",v=s+"--fullscreen",w=s+"--uncropped",x=s+"--show-cursor",y=s+"__container",z=y+"__cursor-killer",A=y+"__focus",B=y+"__placeholder",C=y+"__video",D=a("<div></div>"),E=b.once(function(c,d){window.onYouTubeIframeAPIReady=b.bind(c,d),a.getScript("//www.youtube.com/iframe_api")});return a.widget("ted.player",a.ted.hover,{options:{breakpoint:!0,currentTalk:null,flashVars:{},hlsjsConfig:{maxStarvationDelay:2},hlsjsEvents:{},logLevel:2,metricsKey:null,mai:!0,maiAdUnitId:null,maiPostrollType:"stitched",mode:q(),nativeLanguage:"en",startTrackingAt:0,swf:j("playerPath"),talks:null,capQualityToStage:!0,hideCursorDelay:1e3,uncropped:!0,soonThreshold:.1,recordInIdentity:!0},_isPlayerInitialized:!1,_isPlaying:!1,_addElements:function(){var a=this.element.find("div."+y);a.length||(a=D.clone().addClass(y).appendTo(this.element));var b=a.find("div."+B);b.length||(b=D.clone().addClass(B).appendTo(a)),b.wrap(D.clone().addClass(A));var c=b.closest("div."+A).addClass(C).attr({href:"#",role:"button","aria-label":"Play/Pause"}),d=a.find("div."+z);d.length||(d=D.clone().addClass(z).appendTo(a)),this.elements={container:a,focal:c,placeholder:b,cursorKiller:d}},_breakpoint:function(a){this.options.breakpoint&&(a<1024?this.video.attr("controls","controls"):this.video.removeAttr("controls"))},_create:function(){this.options.currentTalk||(this.options.currentTalk=this.options.talks[0]),this._on({playerplay:function(){this._isPlaying=!0,this.element.addClass(u).removeClass(t)},playerpause:function(){this._isPlaying=!1,this.element.addClass(t).removeClass(u)},playerended:function(){this._isPlaying=!1,this.element.removeClass(t).removeClass(u)}}),this._isInternal=!this.talk().external,this.options.hoverStopDelay=this.options.hideCursorDelay,new c(this),new d(this),new e(this),new f(this),this._initializePlayer()},_initializePlayer:function(){this._isPlayerInitialized||(this._isPlayerInitialized=!0,this.element.addClass(s+" "+(this.options.uncropped?w:"")),this._addElements(),this._isInternal?this._initializeInternalPlayer():"YouTube"===this.talk().external.service&&this._initializeYouTubePlayer(),this._hoverInit())},_initializeYouTubePlayer:function(){E(this._youTubeApiReady,this),this._on({playerrequestplay:function(){this._ytPlayer&&this._ytPlayer.playVideo&&this._ytPlayer.playVideo()}})},_youTubeApiReady:function(){var b=this,c=this.talk(),d="//www.youtube.com/embed/"+c.external.code+"?showinfo=0&enablejsapi=1&autoplay=0&origin="+location.origin;c.external.startTime&&(d+="&start="+c.external.startTime);var e=a("<iframe class="+C+" src="+d+" frameborder=0 allowfullscreen></iframe>");b.elements.placeholder.replaceWith(e),b._ytPlayer=new YT.Player(e.get(0),{events:{}}),b._trigger("domready")},_getPlayerModes:function(){return["hls","hlsjs","flash","h264"]},_initializeInternalPlayer:function(){var c=i("dfptest"),d=i("maiAdUnitId");d&&(this.options.maiAdUnitId=d);var e=i("maiPostrollType");e&&(this.options.maiPostrollType=e),this.options.talks=this.options.talks.map(function(a){if(c){var b=encodeURIComponent(c);a.resources.hls.adUrl=a.resources.hls.adUrl.replace(/(cust_params=[^&]+)&/,"$1%26dfptest%3D"+b+"&"),a.resources.hls.maiTargeting.dfptest=c}var d=Number(a.introDuration);return a.introDuration=Math.min(d,11.82),a.adDuration=0===d?0:3.33,a.postAdDuration=0===d?0:.83,a});var f={class:C,playsinline:"playsinline"};this.player=new k({attrs:f,el:this.elements.placeholder.get(0),flashVars:this.options.flashVars,hlsjsConfig:this.options.hlsjsConfig,hlsjsEvents:this.options.hlsjsEvents,logLevel:this.options.logLevel,mai:this.options.mai,maiAdUnitId:this.options.maiAdUnitId,maiPostrollType:this.options.maiPostrollType,metricsKey:this.options.metricsKey,mode:this.options.mode,modes:this._getPlayerModes(),nativeLanguage:this.options.nativeLanguage,capQualityToStage:this.options.capQualityToStage,swf:this.options.swf,talks:this.options.talks}),this.element.addClass(s+"--"+this.mode()),h()&&this.element.addClass(s+"--is-mobile"),this._subscribeToPlayerEvents(),this._subscribeToKeyboardEvents(),this.player.one("ready.dom",b.bind(this._playerDomReady,this)),this.player.canFullScreen&&(this.player.on("enterFullScreen",b.bind(this._playerEnterFullScreen,this)),this.player.on("exitFullScreen",b.bind(this._playerExitFullScreen,this))),this.player.on("talk",b.bind(function(a){this.options.currentTalk=a,this._trigger("talk",null,a)},this)),this.player.on("bufferUnplayable",b.bind(this._bufferingStarted,this)),this.player.on("bufferPlayable",b.bind(this._bufferingStopped,this)),this.player.on("prolongedBuffer",b.bind(function(a){this._trigger("prolongedBuffer",null,{duration:a})},this)),this.player.on("prolongedRebuffer",b.bind(function(a){this._trigger("prolongedRebuffer",null,{duration:a})},this)),this._on({playercurrenttime:function(a,b){this._currentTime=b.currentTime},playerplaybackrate:function(a,b){this._playbackRate=b.playbackRate},playerpopout:function(a,b){this._popOut=b.popOut},playervolume:function(a,b){this._volume=b.volume},playerprogress:function(){var a;return function(b,c){!a&&c.progress>1-this.options.soonThreshold&&this.player.isLastTalk()&&(a=!0,this._trigger("soon"))}}(),playerpostrollcomplete:function(){this.player.isLastTalk()&&!this._queuedTalkId&&(this._queuedTalkId=this.options.currentTalk.id)},playerrequestplay:function(){var c=a("*:focus");c.closest(this.elements.focal).length||(this._oldFocus=c),this.elements.focal.attr("tabindex","1"),this._queuedTalkId?(a(this.player.el).attr("preload",""),this.player.playTalk(this._queuedTalkId),this._queuedTalkId=null,b.delay(g(this.player,"play"))):this.player.play()},playerplay:function(){this.elements.focal.focus()},playerrequestpause:function(){this.player.postrolling||this.player.pause()}})},_destroy:function(){this.options.breakpoint&&m("breakpoint").unsubscribe(this._breakpoint)},_playerDomReady:function(){var c=this,d=a(c.player.el);if(c.video=d,c.options.breakpoint&&m("breakpoint").subscribe(b.bind(c._breakpoint,c)),"hlsjs"===c.player.mode){var e="player-menu-"+Math.round(1e3*Math.random()),f=a('<menu type="context" id="'+e+'"></menu>'),g=a("<menuitem label=Metrics></menuitem>");g.on("click",function(){c._trigger("metricsToggle")}),f.append(g),d.append(f),d.attr("contextmenu",e)}c._trigger("domready")},_playerEnterFullScreen:function(){this.element.addClass(v),this._fullscreenZone("activate")},_playerExitFullScreen:function(){this.element.removeClass(v),this._fullscreenZone("deactivate")},_playerOption:function(a){return this.player&&this.player.options&&this.player.options[a]||null},_subscribeToKeyboardEvents:function(){this._on(this.elements.focal,{keydown:this._keyDown,keyup:this._keyUp})},_subscribeToPlayerEvents:function(){var a,c=this;this._on({playerrequestplay:function(){a=!0,c._hasPlayBeenRequested||(c._hasPlayBeenRequested=!0,c._showBuffering())},playerplay:function(){a=!1}}),b.forEach(["ad","currentTime","duration","ended","enterFullScreen","error","exitFullScreen","pause","play","progress","ready","seeked","seeking","volume","muted","idle","complete","talkComplete","prerollStart","prerollBlock","postrollStart","postrollComplete","postrollDuration","postrollRemaining","adBlock","bufferPlayable","bufferUnplayable","subtitle","playbackRate","popOut","playToken","metricsData","metricsToggle"],function(b){c.player.on(b,function(d){var e={};"play"!==b||a||c._trigger("requestplay"),e[b]=d,c._trigger(b,null,e),c["_"+b]=d})})},_hoverStart:function(a){this.element.addClass(x),this._trigger("hoverstart",a)},_hoverStop:function(a){this.element.removeClass(x),this._trigger("hoverstop",a)},_showBuffering:function(){this._spinner||(this._spinner=new p({lines:13,length:13,width:5,radius:16,color:"#FFF",trail:50,shadow:!0})),this._isBuffering&&this._hasPlayBeenRequested?this._spinner.spin(this.element.get(0)):this._spinner.stop()},_bufferingStarted:function(){this._isBuffering=!0,this._showBuffering()},_bufferingStopped:function(){this._isBuffering=!1,this._showBuffering()},_keyDown:function(b){var c=a.ui.keyCode,d=b.ctrlKey||b.shiftKey||b.altKey,e=this,f=e.options.currentTalk&&e.options.currentTalk.duration||0,g=e._currentTime||0,h=e.volume()||0;switch(b.keyCode){case c.ENTER:case c.NUMPAD_ENTER:case c.SPACE:e.toggle(),r(b);break;case c.DOWN:d?e.mute(!0):e.volume(h-.1),r(b);break;case c.UP:d?e.mute(!1):e.volume(h+.1),r(b);break;case c.LEFT:d?e.seek(g-.1*f):e.seek(g-15),r(b);break;case c.RIGHT:d?e.seek(g+.1*f):e.seek(g+15),r(b);break;case c.HOME:e.seek(0),r(b);break;case c.END:e.seek(f-1),r(b);break;case c.TAB:var i=this._oldFocus;this._tabDown||!i||i.is(":hidden")||i.is(":disabled")||(i.focus(),r(b)),this._oldFocus=null,this._tabDown=!0}},_keyUp:function(b){b.keyCode===a.ui.keyCode.TAB&&(this._tabDown=!1)},_fullscreenZone:function(a){var b=this.player.fullScreenElement,c=this._fullscreenZoneObj;b&&(c||(c=new n(b),this._fullscreenZoneObj=c),c[a]())},mode:function(){return this._isInternal?this.player.options.mode:"external"},talk:function(a){return arguments.length&&(this.queue(a),this._trigger("requestplay")),this.options.currentTalk},talks:function(){return this.player.talks},toggle:function(){this[this._isPlaying?"pause":"play"]()},play:function(){this._trigger("requestplay")},playNext:function(){this._trigger("requestnext"),this.player.playNext()},playPrev:function(){this._trigger("requestprev"),this.player.playPrev()},pause:function(){this._trigger("requestpause")},_playbackRate:null,playbackRate:function(a){return arguments.length&&(this.player.playbackRate(a),this._playbackRate=a),this._playbackRate},_popOut:!1,popOut:function(a){return arguments.length&&(this.player.popOut(a),this._popOut=a),this._popOut},queue:function(a){this._queuedTalkId=a},sendAds:function(a){this.player.sendAds(a)},seek:function(a,b){this.options.startTrackingAt=b?a:0,this.player.seek(a)},_subtitle:null,subtitle:function(a){if(arguments.length){var c=!!a&&b.find(this.talk().languages,{languageCode:a});this.player.subtitle(a),this._subtitle=c}return this._subtitle},_volume:null,volume:function(a){return arguments.length&&this.player.volume(a),this._volume},_muted:null,mute:function(a){return arguments.length&&this.player.mute(a),this._muted},toggleFullScreen:function(){var b=a("html,body"),c=a(document).scrollTop(),d=a(this.element),e=d.offset().top;c>e&&b.scrollTop(e),this[this.player.isFullScreen?"cancelFullScreen":"requestFullScreen"](this.elements.container.get(0))},requestFullScreen:function(a){this.player.requestFullScreen(a)},cancelFullScreen:function(a){this.player.cancelFullScreen(a)},isControllable:function(){return this._isInternal},isFullScreen:function(){return!!this._isInternal&&this.player.isFullScreen},isMai:function(){var a=this.mode();return!("hls"!==a&&"hlsjs"!==a||!this._playerOption("mai")||!this._playerOption("maiAdUnitId"))},canFullScreen:function(){return!!this._isInternal&&this.player.canFullScreen},canPlaybackRate:function(){return!!this._isInternal&&this.player.canPlaybackRate},canPopOut:function(){return!!this._isInternal&&this.player.canPopOut},canSubtitle:function(){return this._isInternal&&!!this.player.canSubtitle},canVolume:function(){return this._isInternal&&!!this.player.canVolume},capQualityToStage:function(a){this.options.capQualityToStage=a,this.player.capQualityToStage(a)},maiAdUnitId:function(){return this._playerOption("maiAdUnitId")}}),function(b,c){return a(b).player(c)}}),define("es6!utils/abby.babel",["exports","module","./ted"],function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}var e=d(c);b.exports=function(a,b){var c=(0,e.default)("abby")&&(0,e.default)("abby").tests[a];return b.split(",").filter(function(a){return a===c}).length>0}}),define("templates/helpers/abby",["es6!utils/abby.babel","Handlebars"],function(a,b){"use strict";b.registerHelper("abby",function(c){var d=Object.keys(c.hash)[0];if(a(d,c.hash[d]))return new b.SafeString(c.fn(this))})}),define("hbs!templates/playerPip",["hbs","hbs/handlebars","templates/helpers/thumb","templates/helpers/abby"],function(a,b){var c=b.template({1:function(a,b,c,d){return'        <div class="d:n d:b@lg">\n          <span class="f-w:700 p-r:2">Help spread this idea</span>\n        </div>\n        <div data-talk-share></div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'\n<div class="player-pip__controls">\n  <div class="player-pip__thumb">'+this.escapeExpression((b.thumb||a&&a.thumb||b.helperMissing).call(a,"",{name:"thumb",hash:{},data:d}))+'</div>\n\n  <a class="player-pip__controls__button player-pip__controls__play" href="#">\n    <i class="player-pip__controls__icon g-pip-play"></i>\n  </a>\n\n  <a class="player-pip__controls__button player-pip__controls__pause" href="#">\n    <i class="player-pip__controls__icon g-pip-pause"></i>\n  </a>\n</div>\n\n<div class="d:f p-x:2 a-i:c h:full">\n  <div class="flx-g:1">\n    <div style="padding-left: 140px;" class="p-r:1 player-pip__details"></div>\n  </div>\n  <div class="">\n    <div class="d:f a-i:c">\n'+(null!=(e=(b.abby||a&&a.abby||b.helperMissing).call(a,{name:"abby",hash:{sticky_share:"b,c,d"},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+"    </div>\n  </div>\n</div>\n"},useData:!0});return b.registerPartial("templates/playerPip",c),c}),define("hbs!templates/playerPipDetails",["hbs","hbs/handlebars","templates/helpers/t","templates/helpers/formatDate","templates/helpers/formatDuration"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'\n<div class="player-pip__meta">\n  <span class="player-pip__meta__event">'+this.escapeExpression((e=null!=(e=b.event||(null!=a?a.event:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"event",hash:{},data:d}):e))+"</span>\n  &middot;\n  "+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Filmed",{name:"t",hash:{},data:d}))+'\n  <span class="player-pip__meta__value">'+this.escapeExpression((b.formatDate||a&&a.formatDate||b.helperMissing).call(a,"MMMM YYYY",null!=a?a.filmed:a,{name:"formatDate",hash:{forceUTC:!0},data:d}))+'</span>\n  &middot;\n  <span class="player-pip__meta__value">'+this.escapeExpression((b.formatDuration||a&&a.formatDuration||b.helperMissing).call(a,null!=a?a.duration:a,{name:"formatDuration",hash:{},data:d}))+'</span>\n</div>\n\n<a class="l3 player-pip__title player-pip__top-link" href="#">'+this.escapeExpression((e=null!=(e=b.name||(null!=a?a.name:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"name",hash:{},data:d}):e))+"</a>\n"},useData:!0});return b.registerPartial("templates/playerPipDetails",c),c}),define("es6!components/share/share-button.babel",["exports","module","react"],function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}var e=d(c),f=function(a){var b=a.icon,c=a.itemClassname,d=a.color,f=a.service,g=a.showLabel,h=void 0===g||g,i=a.label,j=a.onShare,k=function(){return j(f)};return e.default.createElement("button",{className:" sb ",onClick:k},e.default.createElement("div",{className:"\n          c:"+(d||f||"red")+"\n          "+(h?"m-b:.8":"")+"\n        "},e.default.createElement("span",{className:"\n            icon\n            icon_circle-"+(b||f)+"-fill\n            l-h:d\n            w:full\n            h:full\n            p-x:.5\n            "+c+"\n          ",title:i})),h&&e.default.createElement("div",{className:"f:.8 f-w:700"},i))};f.propTypes={icon:c.PropTypes.string,itemClassname:c.PropTypes.string.isRequired,color:c.PropTypes.string,service:c.PropTypes.string.isRequired,showLabel:c.PropTypes.bool,label:c.PropTypes.string.isRequired,onShare:c.PropTypes.func.isRequired},b.exports=f}),define("es6!components/share/share-bar.babel",["exports","module","react","es6!./share-button.babel"],function(a,b,c,d){"use strict";function e(a){return a&&a.__esModule?a:{default:a}}var f=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},g=e(c),h=e(d),i=function(a){var b=a.itemClassname,c=a.services,d=a.showLabel,e=a.onShare,i=function(a){e(a)};return g.default.createElement("ul",{services:c,className:" sl d:f "},c.map(function(a){return g.default.createElement("li",{key:a.label},g.default.createElement(h.default,f({},a,{onShare:i,itemClassname:b,showLabel:d})))}))};i.propTypes={itemClassname:c.PropTypes.string.isRequired,services:c.PropTypes.array.isRequired,showLabel:c.PropTypes.bool,onShare:c.PropTypes.func.isRequired},b.exports=i}),define("es6!components/share/share-bar-container.babel",["exports","module","react","utils/share","es6!./share-bar.babel","lib/ga"],function(a,b,c,d,e,f){"use strict";function g(a){return a&&a.__esModule?a:{default:a}}var h=g(c),i=g(d),j=g(e),k=function(a){var b=a.data,c=b.itemClassname,d=b.showLabel,e=b.services,g=b.talk,k=function(a){(0,f.sendEvent)("talk.share","start",a),(0,i.default)(a,{url:g.shareurl||g.canonical,message:g.title})};return h.default.createElement(j.default,{onShare:k,services:e,itemClassname:c,showLabel:d})};k.propTypes={data:c.PropTypes.shape({itemClassname:c.PropTypes.string,services:c.PropTypes.array.isRequired,showLabel:c.PropTypes.bool,talk:c.PropTypes.object.isRequired})},b.exports=k}),define("es6!components/share/index.babel",["exports","module","react","react-dom","jquery","es6!./share-bar-container.babel"],function(a,b,c,d,e,f){"use strict";function g(a){return a&&a.__esModule?a:{default:a}}var h=g(c),i=g(e),j=g(f);b.exports=function(a,b){return(0,i.default)(b).each(function(b,c){return(0,d.render)(h.default.createElement(j.default,{data:a}),c)})}}),define("widgets/playerPip",["jquery","hbs!templates/playerPip","hbs!templates/playerPipDetails","es6!components/share/index.babel","es6!utils/abby.babel","waypoints","jqueryui/widget"],function(a,b,c,d,e){"use strict";var f="player-pip--playing",g="player-pip--paused",h="player-pip__container";return a.widget("ted.playerPip",{options:{player:null,waypoint:null},shouldBeOn:!1,_create:function(){var c=this,f=a(c.options.player),g=a("html,body"),i=a(b()),j=this.element.find("div."+h);j.length||(j=a("<div></div>").addClass(h).appendTo(this.element)),j.append(i);var k=[{icon:"facebook",color:"facebook",service:"facebook",label:"Facebook"},{icon:"linkedin",color:"linkedin",service:"linkedin",label:"LinkedIn"}];e("sticky_share","b")&&d({talk:f.player("talk"),itemClassname:"f:6",services:[k[0]]},"[data-talk-share]"),e("sticky_share","c")&&d({talk:f.player("talk"),itemClassname:"f:6",services:[k[1]]},"[data-talk-share]"),e("sticky_share","d")&&(console.log("hit d"),d({talk:f.player("talk"),itemClassname:"f:6",services:k},"[data-talk-share]")),this.$detailsElement=a(".player-pip__details"),this.options.player&&this._setPlayer(),c._on({"click a.player-pip__controls__play":function(a){a.preventDefault(),this._trigger("play")},"click a.player-pip__controls__pause":function(a){a.preventDefault(),this._trigger("pause")},"click a.player-pip__top-link":function(a){a.preventDefault(),g.animate({scrollTop:c.options.waypoint.offset().top},200)}}),c.options.waypoint.waypoint(function(a){c.shouldBeOn="down"===a,c.refreshState()},{offset:function(){return-c.options.waypoint.height()}})},_setPlayer:function(){function b(a){c.details({event:a.event,filmed:a.filmed,published:a.published,duration:a.duration,name:a.name,thumb:a.thumb})}var c=this,d=a(c.options.player);b(d.player("talk")),c._on({playerpipchangestate:function(a,b){d.player("capQualityToStage",!b.isOn)},playerpipplay:function(){d.player("play")},playerpippause:function(){d.player("pause")}}),d.on("playerrequestplay",function(){c.element.addClass(f)}).on("playerplay",function(){c.element.removeClass(g).addClass(f)}).on("playerpause",function(){c.element.addClass(g).removeClass(f)}).on("playerended",function(){c.element.removeClass(g).removeClass(f)}).on("playertalk",function(a,c){b(c)})},details:function(b){var d;arguments.length&&(a.isPlainObject(b)?(b=a.extend({eventName:"",filmed:new Date,duration:0,name:"",thumb:""},b),b.filmed*=1e3,b.thumb&&this.element.find("img.thumb__image").attr("src",b.thumb),d=c(b)):d=b,this.$detailsElement.html(d))},refreshState:function(){var a=this.shouldBeOn;this.element[a?"addClass":"removeClass"]("player-pip--on"),this._trigger("changeState",null,{isOn:a})}}),function(b,c){return a(b).playerPip(c)}}),define("widgets/playerHero",["jquery","lodash","lib/pubSub","utils/is_mobile","Modernizr","hbs!templates/playerHeroHiccup","widgets/controls","widgets/player","widgets/playerPip","lib/resize"],function(a,b,c,d,e,f){"use strict";return a.widget("ted.playerHero",{_hasPlayed:!1,options:{hiccups:!1,isSkip:!1,isTranscript:!1,mai:void 0,maiAdUnitId:null,maiPostrollType:"stitched",metricsKey:null,nativeLanguage:"en",precontrol:!1,talks:[]},_create:function(){var a=this;a.playerElement=a.element.find("div.player"),a.maxiControlsElement=a.element.find("div.controls--maxi"),a.miniControlsElement=a.element.find("div.controls--mini"),a.pipElement=a.element.find("div.player-pip"),this._addPlayStates(),a._on(a.playerElement,{playererror:function(b,c){var d=c.error,e="client"===d.type&&"isClient";"abortive"===d.severity&&a._hiccup(e||"isInit"),"fatal"===d.severity&&a._hiccup(e||"isFatal")},playerrequestplay:function(){a._onFirstPlay()}}),a._on({"click a.player-hero__play":function(a){a.preventDefault(),this.play()}}),a._on(a.pipElement,{playerpipchangestate:function(b,c){a.element[c.isOn?"addClass":"removeClass"]("player-hero--pip-on")}}),a.playerElement.player({mai:a.options.mai,maiAdUnitId:a.options.maiAdUnitId,maiPostrollType:a.options.maiPostrollType,metricsKey:a.options.metricsKey,nativeLanguage:a.options.nativeLanguage,talks:a.options.talks})},_isMiniBreakpoint:!1,_isPlayerInitialized:!1,_isPlayerFullScreen:!1,_addPlayStates:function(){function a(){b.element.addClass(g).removeClass(k).removeClass(f).removeClass(h).removeClass(j)}var b=this,c=!1,e=b.playerElement,f="player-hero--idle",g="player-hero--playing",h="player-hero--paused",i="player-hero--adsing",j="player-hero--unactivated",k="player-hero--ended",l="player-hero--early-request",m="player-hero--requestable";b._on(e,{playerplay:a,playerrequestplay:a,playerpause:function(){b.element.removeClass(g).removeClass(f).removeClass(k),e.player("isControllable")?b.element.addClass(h).removeClass(j):b.element.addClass(j)},playerdomready:function(){window.playerHeroPlay&&(window.playerHeroPlay=function(){return!0}),b.element.addClass(m),b.element.hasClass(l)&&(c=!0,b.play(),e.addClass("player--playing"),b.element.removeClass(l))},playerready:function(){c&&(b.play(),c=!1),d()||b.pipElement.playerPip({player:b.playerElement,waypoint:b.element.find("div.player-hero__banner")}),b.options.precontrol&&b._renderMaxiControls()},playeridle:function(){b.element.addClass(f)},playerended:function(){b.element.removeClass(f).addClass(k).removeClass(h).removeClass(j).addClass(g)},playerenterfullscreen:function(){b._isPlayerFullScreen=!0,b._refreshMiniControlsState(),b._isPlayerInitialized||b.play()},playerexitfullscreen:function(){b._isPlayerFullScreen=!1,b._refreshMiniControlsState()},playerpostrollstart:function(){b.element.addClass(i)},playerpostrollcomplete:function(){b.element.removeClass(i)},playerhoverstart:function(){this.miniControlsElement.addClass("controls--visible")},playerhoverstop:function(){this.miniControlsElement.removeClass("controls--visible")}})},_refreshMiniControlsState:function(){var a=this._isPlayerFullScreen||this._isMiniBreakpoint;this.miniControlsElement[a?"addClass":"removeClass"]("controls--active")},_renderMaxiControls:function(){this._isMaxiControlsRendered||(this._isMaxiControlsRendered=!0,this.playerElement.player("isControllable")?this.maxiControlsElement.controls({isSkip:this.options.isSkip,isTranscript:this.options.isTranscript,player:this.playerElement,template:"maxi"}):this.element.addClass("player-hero--uncontrollable"))},_onFirstPlay:function(){var a=this;if(!a._isPlayerInitialized){a._isPlayerInitialized=!0,a._renderMaxiControls(),this.playerElement.player("isControllable")&&a.miniControlsElement.controls({player:a.playerElement,template:"mini"});var d=a.playerElement.player("mode"),e=a.options.hiccups;(e===d||e===!0||b.isArray(e)&&b.contains(e,d))&&a._hiccup("isHiccup"),"flash"===d&&c("breakpoint").subscribe(function(b){a._isMiniBreakpoint=b<1024,a._refreshMiniControlsState()})}},_hiccup:function(a){if(!this._hiccuped){this._hiccuped=!0;var b={};b[a]=!0,this.element.prepend(f(b))}},play:function(){this._hasPlayed=!0,TED.playerOffset&&TED.playerOffset>0&&this.playerElement.player("seek",TED.playerOffset),this.playerElement.player("play")},player:function(){return this.playerElement}}),function(b,c){return a(b).playerHero(c)}}),define("hbs!templates/popupMenu",["hbs","hbs/handlebars"],function(a,b){var c=b.template({1:function(a,b,c,d){var e,f;return'      <li class="poup-menu__item">\n        <a href="'+this.escapeExpression((f=null!=(f=b.url||(null!=a?a.url:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"url",hash:{},data:d}):f))+'" '+(null!=(e=b.if.call(a,null!=a?a.blank:a,{name:"if",hash:{},fn:this.program(2,d,0),
inverse:this.noop,data:d}))?e:"")+' class="l3 popup-menu__link">\n          '+this.escapeExpression((f=null!=(f=b.label||(null!=a?a.label:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"label",hash:{},data:d}):f))+"\n        </a>\n      </li>\n"},2:function(a,b,c,d){return'target="_blank"'},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'\n<div class="popup-menu">\n  <ul class="popup-menu__list">\n'+(null!=(e=b.each.call(a,null!=a?a.items:a,{name:"each",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+"  </ul>\n</div>\n"},useData:!0});return b.registerPartial("templates/popupMenu",c),c}),define("widgets/popupMenu",["jquery","lodash","hbs!templates/popupMenu","widgets/tooltip"],function(a,b,c){"use strict";return a.widget("ted.popupMenu",a.ted.tooltip,{options:{interactive:!0,inverse:!0,items:[],position:{my:"center top+10",at:"center bottom",of:window,collision:"fit flip"}},_create:function(){this.options.content||(this.options.content=c({items:this._items()})),this._super(),this._on(this.popupObject,{"click a.popup-menu__link":function(a){var b=this.popupObject.find("a.popup-menu__link").index(a.target),c=b===-1?null:this.options.items[b];c.url||a.preventDefault(),this._trigger("itemclick",a,c)!==!1&&c.callback&&c.callback.call(a.target,a,c)}})},_items:function(){return b.map(this.options.items,function(a){var c=a.url||"#",d=a.blank||c.match(/^(?:https?:)?\/\//);return b.merge({},a,{url:c,blank:d})})}}),function(b,c){return a(b).popupMenu(c)}}),define("hbs!templates/talkDownloadModal",["hbs","hbs/handlebars","templates/helpers/t"],function(a,b){var c=b.template({1:function(a,b,c,d){var e;return'    <select class="talk-download__language form-control form-control--dropdown">\n      <option value="">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Subtitles: None",{name:"t",hash:{},data:d}))+"</option>\n"+(null!=(e=b.each.call(a,null!=a?a.subtitledLanguages:a,{name:"each",hash:{},fn:this.program(2,d,0),inverse:this.noop,data:d}))?e:"")+"    </select>\n"},2:function(a,b,c,d){var e;return'        <option value="'+this.escapeExpression((e=null!=(e=b.languageCode||(null!=a?a.languageCode:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"languageCode",hash:{},data:d}):e))+'">\n          '+this.escapeExpression((e=null!=(e=b.languageName||(null!=a?a.languageName:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"languageName",hash:{},data:d}):e))+"\n        </options>\n"},4:function(a,b,c,d){var e;return'      <li data-size="'+this.escapeExpression((e=null!=(e=b.size||(null!=a?a.size:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"size",hash:{},data:d}):e))+'">\n        <label>\n          <input name="size" class="talk-download__size" type="radio" value="'+this.escapeExpression((e=null!=(e=b.size||(null!=a?a.size:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"size",hash:{},data:d}):e))+'">\n          '+this.escapeExpression((e=null!=(e=b.label||(null!=a?a.label:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"label",hash:{},data:d}):e))+"\n        </label>\n      </li>\n"},6:function(a,b,c,d){var e;return'  <div class="talk-download__audio">\n    <h4>'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Audio",{name:"t",hash:{},data:d}))+'</h4>\n    <div class="talk-download__coach">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Audio downloads are available in MP3 format.",{name:"t",hash:{},data:d}))+'</div>\n\n    <a class="button" href="'+this.escapeExpression(this.lambda(null!=(e=null!=a?a.talk:a)?e.audioDownload:e,a))+'" download>'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Download audio",{name:"t",hash:{},data:d}))+"</a>\n  </div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'\n<div class="modal__head">\n  <a class="modal__close modal__head__close" href="#" role="button">\n    <i class="g-button-modal-close">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Close",{name:"t",hash:{},data:d}))+'</i>\n  </a>\n\n  <h3 class="modal__head__title">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Download this talk",{name:"t",hash:{},data:d}))+'</h3>\n</div>\n\n<div class="talk-download__video">\n  <h4>'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Video",{name:"t",hash:{},data:d}))+'</h4>\n  <div class="talk-download__coach">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Videos are available for download in MP4 format.",{name:"t",hash:{},data:d}))+"</div>\n\n"+(null!=(e=b.if.call(a,null!=(e=null!=a?a.talk:a)?e.subtitledDownloads:e,{name:"if",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+'\n  <ul class="talk-download__list">\n'+(null!=(e=b.each.call(a,null!=a?a.sizes:a,{name:"each",hash:{},fn:this.program(4,d,0),inverse:this.noop,data:d}))?e:"")+'  </ul>\n\n  <a class="button talk-download__button--video" href="#" download>'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Download video",{name:"t",hash:{},data:d}))+'</a>\n\n  <div class="talk-download__link">\n    For low bandwidth downloads,\n    <a href="http://www.ted.com/talks/quick-list" target="_blank">\n      visit TED\'s quicklist\n    </a>\n  </div>\n</div>\n\n'+(null!=(e=b.if.call(a,null!=(e=null!=a?a.talk:a)?e.audioDownload:e,{name:"if",hash:{},fn:this.program(6,d,0),inverse:this.noop,data:d}))?e:"")},useData:!0});return b.registerPartial("templates/talkDownloadModal",c),c}),define("widgets/talkDownloadModal",["jquery","hbs!templates/talkDownloadModal","widgets/modal"],function(a,b){"use strict";function c(a,b){for(var c,d=a.length,e=[],f=-1;++f<d;)c=a[f],b&&b[c.languageCode]&&e.push(c);return e}var d=[{size:"low",label:"Low (320x180)"},{size:"medium",label:"Medium (512x288)"},{size:"high",label:"High (854x480)"}];a.widget("ted.talkDownloadModal",a.ted.modal,{options:{subtitle:null,talk:null},elements:{},_create:function(){this.element.html(b({sizes:d,talk:this.options.talk,subtitledLanguages:c(this.options.talk.languages,this.options.talk.subtitledDownloads)})),this.elements.sizeRadios=this.element.find("input.talk-download__size"),this.elements.sizeItems=this.elements.sizeRadios.closest("li"),this.elements.videoDownload=this.element.find("a.talk-download__button--video"),this.elements.languageDropdown=this.element.find("select.talk-download__language"),this._on({talkdownloadmodalopen:this._onOpen}),this._super(),this._on({"click input.talk-download__size":this.refreshVideoUrl,"change select.talk-download__language":this.refreshVideoUrl,"click a.talk-download__button--video":function(a){this._trigger("download",a,{type:"video",language:this.elements.languageDropdown.val(),quality:this.elements.sizeRadios.filter(":checked:data(visible)").val()})},"click a.talk-download__button--audio":function(a){this._trigger("download",a,{type:"audio"})}}),this.refreshVideoUrl()},refreshVideoUrl:function(){var b,c=this.elements.languageDropdown.val(),d=this.options.talk;b=c?d.subtitledDownloads[c]:d.nativeDownloads,this.elements.sizeItems.each(function(){var c=a(this),d=c.find("input"),e="visible",f=b[c.data("size")];f?(c.show(),d.data(e,e)):(c.hide(),d.removeData(e))});var e=this.elements.sizeRadios.filter(":checked:data(visible)");e.length||(e=this.elements.sizeRadios.filter(":data(visible)").last().prop("checked",!0)),this.elements.videoDownload.attr("href",b[e.val()])},_onOpen:function(){this.options.subtitle&&this.elements.languageDropdown.length&&this.elements.languageDropdown.val(this.options.subtitle),this.refreshVideoUrl()}})}),define("hbs!templates/talkShareModal",["hbs","hbs/handlebars","templates/helpers/t"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'\n<div class="modal__head">\n  <a class="modal__close modal__head__close" href="#" role="button">\n    <i class="g-button-modal-close">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Close",{name:"t",hash:{},data:d}))+'</i>\n  </a>\n\n  <h3 class="modal__head__title">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Share this talk",{name:"t",hash:{},data:d}))+'</h3>\n</div>\n\n<div class="talk-share o:h">\n  <div\n    class="\n      m-b:4\n    "\n  >\n    <div data-talk-share-modal></div>\n  </div>\n\n  <div class="m-b:4">\n    <h4\n      class="\n        t-t:u\n        f:1\n        c:gray\n        m-b:.7\n      "\n    >\n      Direct Link\n    </h4>\n    <input\n      data-share-url-input\n      readonly="readonly"\n      data-share-service="link"\n      class="\n        form-control\n        bg:gray-ll\n      "\n      value='+this.escapeExpression(this.lambda(null!=(e=null!=a?a.talk:a)?e.canonical:e,a))+'\n    >\n  </div>\n\n  <div class="m-b:2">\n    <h4\n      class="\n        t-t:u\n        f:1\n        c:gray\n        m-b:.7\n      "\n    >\n      Download Video (mp4)\n    </h4>\n    <button\n      data-download-talk\n      class="\n        sb\n        bg:gray-dd\n        c:white\n        f-w:700\n        p-x:3\n        p-y:.8\n        l-h:n\n        f:2\n      "\n    >\n      Download video\n    </button>\n  </div>\n</div>\n\n'},useData:!0});return b.registerPartial("templates/talkShareModal",c),c}),define("widgets/talkShareModal",["jquery","hbs!templates/talkShareModal","es6!components/share/index.babel","lib/ga","widgets/modal"],function(a,b,c,d){"use strict";a.widget("ted.talkShareModal",a.ted.modal,{options:{talk:null,services:null},elements:{},_create:function(){this._setContent(),this._super();var b=this.options;setTimeout(function(){c(b,"[data-talk-share-modal]")},100),this._on({"click [data-share-url-input]":function(b){a(b.target).select()},"click [data-share-service]":function(b){var c=a(b.target).data("share-service");d.sendEvent("talk.share","start",c)},"click [data-download-talk]":function(b){a(b.target).trigger("talkDownloadModal:open")}})},_setContent:function(){this.element.html(b(this.options))}})}),define("hbs!templates/talkEmbedModal",["hbs","hbs/handlebars","templates/helpers/t"],function(a,b){var c=b.template({1:function(a,b,c,d){var e;return'    <div>\n      <h4 class="m5">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Select subtitles",{name:"t",hash:{},data:d}))+'</h4>\n      <select class="talk-embed__language">\n        <option value="">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Subtitles: None",{name:"t",hash:{},data:d}))+"</option>\n"+(null!=(e=b.each.call(a,null!=(e=null!=a?a.talk:a)?e.languages:e,{name:"each",hash:{},fn:this.program(2,d,0),inverse:this.noop,data:d}))?e:"")+"      </select>\n    </div>\n"},2:function(a,b,c,d){var e;return'          <option value="'+this.escapeExpression((e=null!=(e=b.languageCode||(null!=a?a.languageCode:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"languageCode",hash:{},data:d}):e))+'">\n            '+this.escapeExpression((e=null!=(e=b.languageName||(null!=a?a.languageName:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"languageName",hash:{},data:d}):e))+"\n          </options>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'\n<div class="modal__head">\n  <a class="modal__close modal__head__close" href="#" role="button">\n    <i class="g-button-modal-close">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Close",{name:"t",hash:{},data:d}))+'</i>\n  </a>\n\n  <h3 class="modal__head__title">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Embed this talk",{name:"t",hash:{},data:d}))+'</h3>\n</div>\n\n<div class="talk-embed">\n  <div>\n    <h4 class="m5">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Copy & paste this code into your website or blog.",{name:"t",hash:{},data:d}))+'</h4>\n    <input class="form-control talk-embed__code">\n    <h4 class="m5">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Wordpress shortcode",{name:"t",hash:{},data:d}))+'</h4>\n    <input class="form-control talk-embed__wordpress">\n  </div>\n\n'+(null!=(e=b.if.call(a,null!=(e=null!=a?a.talk:a)?e.languages:e,{name:"if",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+'\n  <div class="talk-embed__sizes">\n    <h4 class="m5">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Select a size",{name:"t",hash:{},data:d}))+'</h4>\n    <a class="talk-embed__size talk-embed__size--small" href="#" data-x="560" data-y="315">560 x 315</a>\n    <a class="talk-embed__size talk-embed__size--selected talk-embed__size--medium" href="#" data-x="640" data-y="360">640 x 360</a>\n    <a class="talk-embed__size talk-embed__size--large" href="#" data-x="854" data-y="480">854 x 480</a>\n  </div>\n</div>\n'},useData:!0});return b.registerPartial("templates/talkEmbedModal",c),c}),define("widgets/talkEmbedModal",["jquery","hbs!templates/talkEmbedModal","widgets/modal"],function(a,b){"use strict";var c="talk-embed",d=c+"__size",e=d+"--selected";a.widget("ted.talkEmbedModal",a.ted.modal,{options:{talk:null},elements:{},_create:function(){this._setContent(),this._super(),this._on({"click a.talk-embed__size":function(b){this.elements.sizes.removeClass(e),a(b.target).addClass(e),this.refreshEmbed(),b.preventDefault()},"click input.talk-embed__code":function(b){a(b.target).select()},"change select.talk-embed__language":this.refreshEmbed}),this.refreshEmbed()},_setContent:function(){this.element.html(b(this.options)),this.elements.code=this.element.find("input."+c+"__code"),this.elements.wordpress=this.element.find("input."+c+"__wordpress"),this.elements.sizes=this.element.find("a."+d),this.elements.language=this.element.find("select."+c+"__language")},_setOptions:function(a,b){this._super(a,b),this._setContent(),this.refreshEmbed()},refreshEmbed:function(){var a=this.elements.language.val(),b=this.elements.sizes.filter("a."+e),c=a?"lang/"+a+"/":"",d=a?" lang="+a:"";this.elements.code.val(['<div style="max-width:',b.data("x"),'">','<div style="position:relative;height:0;padding-bottom:56.25%">',"<iframe ",'src="https://embed.ted.com/talks/',c,this.options.talk.slug+'" ','width="',b.data("x"),'" ','height="',b.data("y"),'" ','style="position:absolute;left:0;top:0;width:100%;height:100%" ','frameborder="0" scrolling="no" ',"allowfullscreen></iframe>","</div>","</div>"].join("")),this.elements.wordpress.val(["[ted id=",this.options.talk.id,d,"]"].join(""))}})}),define("hbs!templates/talkRatingModal",["hbs","hbs/handlebars","templates/helpers/t"],function(a,b){var c=b.template({1:function(a,b,c,d){var e;return'        <li class="talk-rating__item">\n          <label>\n            <input class="talk-rating__checkbox" type="checkbox" value="'+this.escapeExpression((e=null!=(e=b.id||(null!=a?a.id:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"id",hash:{},data:d}):e))+'">\n            <span>'+this.escapeExpression((e=null!=(e=b.name||(null!=a?a.name:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"name",hash:{},data:d}):e))+"</span>\n          </label>\n        </li>\n"},3:function(a,b,c,d){return'      <div class="talk-rating__flip">\n        <a class="l3 talk-rating__flip__link" href="#">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"See all ratings",{name:"t",hash:{},data:d}))+"</a>\n      </div>\n"},5:function(a,b,c,d){var e;return'        <li class="talk-rating__item">\n          <div class="talk-rating__result">\n            <div class="talk-rating__result__bar" style="width:'+this.escapeExpression((e=null!=(e=b.percent||(null!=a?a.percent:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"percent",hash:{},data:d}):e))+'%"></div>\n            <span class="talk-rating__result__name">'+this.escapeExpression((e=null!=(e=b.name||(null!=a?a.name:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"name",hash:{},data:d}):e))+'</span>\n            <span class="talk-rating__result__value">'+this.escapeExpression((e=null!=(e=b.percent||(null!=a?a.percent:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"percent",hash:{},data:d}):e))+"%</span>\n          </div>\n        </li>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'\n<div class="talk-rating">\n  <div class="modal__head">\n    <a class="modal__close modal__head__close" href="#" role="button">\n      <i class="g-button-modal-close">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Close",{name:"t",hash:{},data:d}))+'</i>\n    </a>\n    <h3 class="modal__head__title">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Rate this talk",{name:"t",hash:{},data:d}))+'</h3>\n  </div>\n\n  <div class="talk-rating__submit">\n    <p>\n      '+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"How would you describe this talk? Tell us by choosing up to three words. (If you choose just one, it will count three times.)",{name:"t",hash:{},data:d}))+'\n    </p>\n\n    <ul class="talk-rating__list">\n'+(null!=(e=b.each.call(a,null!=a?a.ratings:a,{name:"each",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+'    </ul>\n\n    <button class="button talk-rating__submit__commit" disabled>'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Submit",{name:"t",hash:{},data:d}))+"</button>\n\n"+(null!=(e=b.if.call(a,null!=a?a.total:a,{name:"if",hash:{},fn:this.program(3,d,0),inverse:this.noop,data:d}))?e:"")+'  </div>\n\n  <div class="talk-rating__show">\n    <p>\n      <span class="talk-rating__submitted-message">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Thanks for rating this talk!",{name:"t",hash:{},data:d}))+"</span>\n      "+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Here's what everyone else thought:",{name:"t",hash:{},data:d}))+'\n    </p>\n\n    <ul class="talk-rating__list">\n'+(null!=(e=b.each.call(a,null!=a?a.ratings:a,{name:"each",hash:{},fn:this.program(5,d,0),inverse:this.noop,data:d}))?e:"")+'    </ul>\n\n    <div class="talk-rating__flip">\n      <a class="l3 talk-rating__flip__link" href="#">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Submit your own rating",{name:"t",hash:{},data:d}))+"</a>\n    </div>\n  </div>\n\n</div>\n"},useData:!0});return b.registerPartial("templates/talkRatingModal",c),c}),function(a,b,c){"object"==typeof exports?module.exports=c():"function"==typeof define&&define.amd?define("depot",c):b[a]=c()}("depot",this,function(){"use strict";function a(a){return a&&JSON.parse(a)}function b(a,b){return a+"-"+b}function c(a,b){var c,d;if("function"==typeof a)c=a(b);else{c=!0;for(d in a)c&=a[d]===b[d]}return c}function d(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function e(){return d()+d()+"-"+d()+"-"+d()+"-"+d()+"-"+d()+d()+d()}function f(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function g(a,b){var c,d;if(b=f({idAttribute:"_id",storageAdaptor:localStorage},b),!b.storageAdaptor)throw new Error("No storage adaptor was found");return c=b.storageAdaptor.getItem(a),d=c&&c.split(",")||[],Object.create(h,{name:{value:a},store:{value:c},ids:{value:d,writable:!0},idAttribute:{value:b.idAttribute},storageAdaptor:{value:b.storageAdaptor}})}var h={save:function(a){var c;return a[this.idAttribute]||(a[this.idAttribute]=e()),c=a[this.idAttribute]+"",this.ids.indexOf(c)<0&&(this.ids.push(c),this.storageAdaptor.setItem(this.name,this.ids.join(","))),this.storageAdaptor.setItem(b(this.name,c),JSON.stringify(a)),a},update:function(a,b){"undefined"==typeof b&&(b=a,a=b[this.idAttribute]);var c=this.get(a);return c&&(c=f(c,b),this.save(c)),c},updateAll:function(a){var b=this.all();return b.forEach(function(b){b=f(b,a),this.save(b)},this),b},find:function(d){var e,f,g=this.name,h=this;return d?this.ids.reduce(function(i,j){return f=a(h.storageAdaptor.getItem(b(g,j))),e=c(d,f),e&&i.push(f),i},[]):this.all()},get:function(c){return a(this.storageAdaptor.getItem(b(this.name,c)))},all:function(){var c,d=this,e=this.name;return this.ids.reduce(function(f,g){return c=d.storageAdaptor.getItem(b(e,g)),c&&f.push(a(c)),f},[])},destroy:function(c){var d,e=c[this.idAttribute]?c[this.idAttribute]:c,f=b(this.name,e);return c=a(this.storageAdaptor.getItem(f)),this.storageAdaptor.removeItem(f),d=this.ids.indexOf(e),d!=-1&&this.ids.splice(d,1),this.storageAdaptor.setItem(this.name,this.ids.join(",")),c},destroyAll:function(d){for(var e,f,g,h,i=this.ids.length-1;i>=0;i--)e=this.ids[i],h=b(this.name,e),d?(g=a(this.storageAdaptor.getItem(h)),f=c(d,g),f&&(this.storageAdaptor.removeItem(h),this.ids.splice(i,1))):this.storageAdaptor.removeItem(h);d?this.storageAdaptor.setItem(this.name,this.ids.join(",")):(this.storageAdaptor.removeItem(this.name),this.ids=[])},size:function(){return this.ids.length}};return g}),define("widgets/talkRatingModal",["jquery","lodash","Modernizr","hbs!templates/talkRatingModal","depot","widgets/modal"],function(a,b,c,d,e){"use strict";var f=a.ted.modal.prototype;if(c.localstorage){var g=e("talkRatings",{idAttribute:"id",storageAdaptor:window.sessionStorage});a.widget("ted.talkRatingModal",a.ted.modal,{options:{talkId:null,ratings:[]},_create:function(){var a=g.get(this.options.talkId),c=this;this._calculateTotal(),this._calculatePercents(),this.element.html(d({ratings:this.options.ratings,total:this.options.total})),a&&this.submitted(),f._create.apply(this,b.toArray(arguments)),this.boxes=this.element.find("input.talk-rating__checkbox"),this.button=this.element.find("button.talk-rating__submit__commit"),this._on("button.talk-rating__submit__commit",{click:function(a){a.preventDefault(),c.submit()}}),this._on("input.talk-rating__checkbox",{click:function(){c.sanitize()}}),this._on("a.talk-rating__flip__link",{click:function(a){a.preventDefault(),c.element.toggleClass("talk-rating--flipped")}})},_calculatePercents:function(){var a=this.options.total;b.forEach(this.options.ratings,function(b){b.percent=a>0?Math.round(b.count/a*100):0})},_calculateTotal:function(){var a=b.pluck(this.options.ratings,"count");this.options.total=b.reduce(a,function(a,b){return a+b})},sanitize:function(){var a=this.boxes,b=a.filter(":checked");this.button.prop("disabled",!b.length),a.not(b).prop("disabled",b.length>2)},submit:function(){var b=this.element.find("input.talk-rating__checkbox:checked"),c=b.map(function(){return+this.value}).toArray(),d=this;return this._trigger("submit"),a.post("/ratings",{talk_id:this.options.talkId,talk_rating_ids:c},"json").then(function(){g.save({id:d.options.talkId,ratings:c}),d.submitted()},function(){window.alert("Sorry, your rating couldn't be saved. Please try again.")})},submitted:function(){this.element.addClass("talk-rating--submitted")}})}}),define("widgets/favoriteButton",["jquery","lodash","lib/auth","lib/favorite","lib/pubSub","widgets/tooltip"],function(a,b,c,d,e){"use strict";function f(){return a(document.documentElement).hasClass("loggedin")}var g="favorite-button",h=g+"--remove",i=g+"--add",j=g+"--working",k=g+"__label",l="Unlike",m="Like",n="Error",o="Working";a.widget("ted.favoriteButton",a.ted.tooltip,{options:{favoriteId:null,interactive:!0,inverse:!0,position:{my:"right middle",at:"left middle",collision:"flip flip"},itemId:null,itemType:null,supportTouch:!1,allowClick:!0,signInUrl:window.TED?window.TED.signInUrl:"",signUpUrl:window.TED?window.TED.signUpUrl:""},add:function(){this._toggleFavorite(!0)},details:function(){var a,b=this.options;return a={itemId:b.itemId,itemType:b.itemType},b.favoriteId&&(a.id=b.favoriteId),a},remove:function(){this._toggleFavorite(!1)},_handleFavoriteButtonEvents:{click:function(a){(f()||c.capable())&&(a.preventDefault(),f()?this._toggleFavorite():c.prompt().done(this._toggleFavoriteBound))}},_isAdded:!1,_checkAddition:function(a){this._isOurItem(a)&&this._toggledFavorite(!0)},_checkRemoval:function(a){this._isOurItem(a)&&this._toggledFavorite(!1)},_create:function(){var a=this;this.element.addClass(g),this.label=this.element.find("."+k),b.extend(a.options,{content:'<div style="color:#111;text-align:left;font-size:13px;line-height:1.4;width:145px;"><a class="l3 auth-login" href="'+a.options.signInUrl+'">Log in</a> or <a class="l3" href="'+a.options.signUpUrl+'">sign up</a><br>to like.</div>',beforeOpen:function(){return!f()}}),a._checkDetails(),a._checkAddition=b.bind(a._checkAddition,a),a._checkRemoval=b.bind(a._checkRemoval,a),e("favorite.add").subscribe(a._checkAddition),e("favorite.remove").subscribe(a._checkRemoval),a._on(a._handleFavoriteButtonEvents),a._super(),a._toggleFavoriteBound=b.bind(a._toggleFavorite,a),f()||(a.element.attr("href",a.options.signInUrl),e("auth.login").subscribe(function(){a._checkDetails(),a.element.attr("href","#")}))},_destroy:function(){e("favorite.add").unsubscribe(this._checkAddition),e("favorite.remove").unsubscribe(this._checkRemoval),this._super()},_isOurItem:function(a){return a.itemId===this.options.itemId||a.itemType===this.options.itemType},_setOption:function(a,b){this._super(a,b),"itemId"!==a&&"itemType"!==a||this._checkDetails()},_checkDetails:function(){var a=this;d.get(a.details()).then(function(b){a._isAdded=!!b,b&&(a.options.favoriteId=b.id),a._toggledFavorite(a._isAdded)},function(){a._toggledFavorite(!1)})},_setLabel:function(a){this.label.text(a)},_toggleFavorite:function(a){var c=this;b.isUndefined(a)&&(a=!this._isAdded),a=!!a,c.element.hasClass(j)||(c.element.addClass(j),c._setLabel(o),d[a?"add":"remove"](c.details()).then(function(b){c.options.favoriteId=a?b.id:null,c._toggledFavorite(a)},function(){c._setLabel(n),b.delay(function(){c._setLabel(a?m:l)},800)}).always(function(){c.element.removeClass(j)}))},_toggledFavorite:function(a){this._setLabel(a?l:m),this._isAdded=a,this.element.addClass(a?h:i).removeClass(a?i:h)}})}),define("widgets/watchLaterButton",["jquery","lodash","deferLink","lib/auth","lib/ga","lib/watchLater","lib/pubSub","widgets/tooltip"],function(a,b,c,d,e,f,g){"use strict";function h(){return a(document.documentElement).hasClass("loggedin")}var i="watch-later-button",j=i+"--remove",k=i+"--add",l=i+"--working",m=i+"__label",n="Remove",o="Add to list",p="Error",q="Working";a.widget("ted.watchLaterButton",a.ted.tooltip,{options:{interactive:!0,inverse:!0,position:{my:"right middle",at:"left middle",collision:"flip flip"},saveId:null,itemId:null,itemType:null,supportTouch:!1,allowClick:!0,signInMessage:"Short on time? Save\nthis to your list so you can watch later.",signInUrl:window.TED?window.TED.signInUrl:""},add:function(){this._toggleSave(!0)},details:function(){var a,b=this.options;return a={itemId:b.itemId,itemType:b.itemType},b.saveId&&(a.id=b.saveId),a},update:function(a){b.extend(this.options,a),f.update(this.details())},remove:function(){this._toggleSave(!1)},_handleWatchLaterEvents:{click:function(a){return e.sendEvent("watchLater","click",this.options.itemType.toLowerCase()),h()||d.capable()?(a.preventDefault(),void(h()?this._toggleSave():d.prompt().done(this._toggleSaveBound))):void c(50).call(a.target,a)}},_isSaved:!1,_checkAddition:function(a){this._isOurItem(a)&&this._toggledSave(!0)},_checkRemoval:function(a){this._isOurItem(a)&&this._toggledSave(!1)},_create:function(){var a=this;this.element.addClass(i),this.label=this.element.find("."+m),b.extend(a.options,{content:'<div style="color:#111;font-size:13px;line-height:1.6;text-align:left;width:145px;">'+a.options.signInMessage.replace("\n","<br>")+"</div>",beforeOpen:function(){return!h()}}),a._checkDetails(),a._checkAddition=b.bind(a._checkAddition,a),a._checkRemoval=b.bind(a._checkRemoval,a),g("watchLater.add").subscribe(a._checkAddition),g("watchLater.remove").subscribe(a._checkRemoval),a._on(a._handleWatchLaterEvents),a._super(),a._toggleSaveBound=b.bind(a._toggleSave,a),h()||(a.element.attr("href",a.options.signInUrl),g("auth.login").subscribe(function(){a._checkDetails(),a.element.attr("href","#")}))},_destroy:function(){g("watchLater.add").unsubscribe(this._checkAddition),g("watchLater.remove").unsubscribe(this._checkRemoval),this._super()},_isOurItem:function(a){return a.itemId===this.options.itemId&&a.itemType===this.options.itemType},_setOption:function(a,b){this._super(a,b),"itemId"!==a&&"itemType"!==a||this._checkDetails()},_checkDetails:function(){var a=this;f.get(a.details()).then(function(b){a._isAdded=!!b,b&&(a.options.saveId=b.id),a._toggledSave(a._isAdded)},function(){a._toggledSave(!1)})},_setLabel:function(a){this.label.text(a)},_toggleSave:function(a){var c=this;b.isUndefined(a)&&(a=!this._isAdded),a=!!a,c.element.hasClass(l)||(c.element.addClass(l),c._setLabel(q),f[a?"add":"remove"](c.details()).then(function(b){c.options.saveId=a?b.id:null,c._toggledSave(a)},function(){c._setLabel(p),b.delay(function(){c._setLabel(a?o:n)},800)}).always(function(){c.element.removeClass(l)}))},_toggledSave:function(a){this._setLabel(a?n:o),this._isAdded=a,this.element.addClass(a?j:k).removeClass(a?k:j)}})}),define("talk/talkPage",["jquery","lodash","./countdown","utils/query_param","lib/ga","lib/pubSub","talk/transcript","lib/ads","lib/instaplay","lib/qos","lib/favorite","lib/watchLater","utils/is_mobile","utils/share","utils/timeFromUrl","views/subtitle-modal","hbs!templates/talkEndCard","hbs!templates/talkViewsBreakdown","views/ThreadView","models/Thread","hbs!templates/subtitle-help-modal","dq","clipboard","widgets/playerHero","widgets/tooltip","widgets/popupMenu","widgets/talkArticleLink","widgets/talkDownloadModal","widgets/talkShareModal","widgets/talkEmbedModal","widgets/talkRatingModal","widgets/favoriteButton","widgets/watchLaterButton","waypoints"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){"use strict";function x(a){return z.indexOf(a)===-1}function y(a,b){if("embed"===b.service)A.embed(a);else{x(b.service)&&e.sendEvent("talk.share","start",b.service);var c=2744===B.talks[0].id;n(b.service,{url:B.talks[0].shareurl||B.talks[0].canonical,message:(c?"Pope Francis: ":"")+B.talks[0].title+(c?" #TED2017":"")})}}var z=["later","download","rate","share"],A={},B={isInstaplay:!0,isTranscript:!0};return A.endCardTempl=function(a){var d=c.getNext(a.relatedTalks);return d&&B.isInstaplay&&i.capable()&&!m()?c.template({nextTalk:d,relatedTalks:b.reject(a.relatedTalks,d)}):q(a)},A.forceEndCard=function(){var a=d("endCard");if(a){var e,f=A.options.relatedTalks.slice(0,3),g=f[0],h=b.reject(f,g);e="checker"===a?c.checkerTemplate({nextTalk:g,relatedTalks:h}):"timer"===a||"timer-halted"===a?c.timerTemplate({nextTalk:g,relatedTalks:h}):A.endCardTempl({relatedTalks:f}),A.hero.removeClass("player-hero--unactivated").addClass("player-hero--playing player-hero--ended").find("a.player-hero__play").after(e),"timer"===a&&c.startCountdown()}},A.checkDeepLink=function(){var a=o(),b=a.seconds;if(b){if(a.offset){var c=B.talks[0].introDuration;b+=c}var d=A.hero.data("tedPlayerHero").playerElement;d.one("playerready",function(){d.player("seek",b)})}},A.initComments=b.once(function(){var a=new t({id:B.threadId}),b=new s({el:document.getElementById("thread"),model:a});b.render(),a.set("sort",b.getSort()),a.more(),f("comment.report").subscribe(function(){e.sendEvent("comment","flag","talk")}),f("comment.create").subscribe(function(a){e.sendEvent("comment",a.parentId?"reply":"new","talk")}),f("comment.upvote").subscribe(function(a){a.upvoted&&e.sendEvent("comment","upvote","talk")})}),A.initClipboard=b.once(function(){var b="The URL was copied to your clipboard",c="Now copy the URL to your clipboard",d="[data-clipboard-action]",e=a(d),f=a("#copyVal"),g=a('<div style="display: none;" class="f:.9 m-t:2"></div>'),h=new w(d,{text:function(){return f.val()}});f.parent().prepend(g),e.on("click",function(){f.slideToggle("fast",function(){f.get(0).scrollLeft=0})}),h.on("success",function(){g.html(b),g.show(),setTimeout(function(){f.slideUp("fast",function(){g.html(""),g.hide()})},3e3)}),h.on("error",function(){g.html(c),g.show(),f.focus().select(),setTimeout(function(){f.slideUp("fast",function(){g.html(""),g.hide()})},1e4)})}),A.initExtras=function(){var c=[];a('a.ga-link[data-ga-category="talk.extras"]').each(function(){c.push(a(this).data("ga-label").split("|")[0])}),c.length&&e.sendEvent("talk.extras","impression",b.uniq(c).join("|"),{
nonInteraction:1}),a("a.open-article").talkArticleLink(),a("a.talk-more__link--citations").on("talkarticlelinkshow",function(){e.sendEvent("talk.extras","click","citation|show")}).on("talkarticlelinkhide",function(){e.sendEvent("talk.extras","click","citation|hide")})},A.initInstaplay=function(){if(B.isInstaplay&&i.check(window.location.href)){var a=A.hero.playerHero("player");a.player("play")}},A.init=function(d){var f=d.talks[0];a.extend(B,d||{}),A.options=B,A.hero=a("#player-hero").playerHero({isTranscript:B.isTranscript,mai:B.mai,maiAdUnitId:B.maiAdUnitId,nativeLanguage:B.language,precontrol:B.precontrol||!1,talks:B.talks}),e.sendEvent("talk.page","view",f.id,{nonInteraction:1}),A.initSubtitles(),A.initClipboard(),h.initPlayer(A.hero.playerHero("player")),j.player=A.hero.playerHero("player"),j.initQos(),A.initInstaplay(),A.initWatchLater(f),A.initFavorite(f),A.checkDeepLink();var i=function(){return d.share_actions.filter(function(a){return!a.noShareMenu}).map(function(a){return{label:a.label,service:a.label.toLowerCase()}})},k=a("#sharing-other").popupMenu({items:b.map(i(),function(a){return b.merge(a,{callback:y})})}).popupMenu("popup").find("li.poup-menu__item");b.each(b.filter(i(),{smallOnly:!0}),function(a,b){k.eq(b).addClass("d:n@lg")}),a("a.talk-sharing__link, [data-service]").each(function(b,c){a(c).on("click",function(b){var c=a(this);b.preventDefault(),y(b,{label:c.data("service-label"),service:c.data("service-name")})})}),g.player=A.hero.data("tedPlayerHero").playerElement,g.initLink({offset:1e3*f.introDuration}),g.player.one("playerplay",function(){A.hero.find("a.player-hero__play").after(A.endCardTempl({relatedTalks:B.relatedTalks.slice(0,3)}))}),g.player.one("playerended",c.startCountdown),a("a.download-button, [data-download-talk]").each(function(b,c){a(document).on("talkDownloadModal:open",A.download),a(c).on("click",A.download)}),a("a.share-button, [data-share-talk]").each(function(b,c){a(c).on("click",A.share(i()))}),a("a.rate-button, [data-rate-talk]").each(function(b,c){a(c).on("click",A.rate)}),a("#thread").waypoint(A.initComments,{offset:"100%"}),A.initCoder(),A.initExtras(),A.initNoLanguage(),A.forceEndCard()},A.initCoder=function(){var a;return b.once(function(){history&&history.replaceState&&(g.player.on("playerpause",function(){if(a){var b=window.location.href.split("#")[0],c=a-B.talks[0].introDuration;if(c<=0)return;history.replaceState(history.state,null,b+"#t-"+Math.floor(1e3*c))}}),g.player.on("playercurrenttime",function(b,c){a=c.currentTime}))})}(),A.download=function(){var b;return function(c){c&&c.preventDefault()&&c.preventDefault(),b?b.talkDownloadModal("open"):(b=a("<div>").talkDownloadModal(a.extend({open:e.sendEvent.recall("talk.download","show"),download:function(a,b){e.sendEvent("talk.download","download",b.type+("audio"===b.type?"":"|"+b.quality))}},{talk:B.talks[0]})),g.player.on("playersubtitle",function(a,c){b.talkDownloadModal("option","subtitle",c.subtitle.languageCode)}))}}(),A.share=function(b){return function(){var c;return function(d){d&&d.preventDefault()&&d.preventDefault(),c?c.talkShareModal("open"):c=a("<div>").talkShareModal(a.extend({open:e.sendEvent.recall("talk.share","show")},{talk:B.talks[0],services:b}))}}()},A.embed=function(){var b;return function(){b?b.talkEmbedModal("open"):b=a("<div>").talkEmbedModal(a.extend({open:e.sendEvent.recall("talk.share","start","embed")},{talk:B.talks[0]}))}}(),A.initBreakdown=function(c){a("#sharing-count").tooltip({openDelay:300,content:r({sources:b.map(c,function(a){return a.width=a.value/2,a})}),position:{my:"center top+10",at:"center bottom",of:window,collision:"fit flip"},inverse:"true",interactive:!0})},A.initFavorite=function(c){var d={itemId:c.id,itemType:"Talk"};a("a.favorite-button, [data-favorite-talk]").favoriteButton(d);var g=null,h=b.once(function(){e.sendEvent("favorite","play","talk")}),i=A.hero.playerHero("player");i.on("playercurrenttime",function(){g&&h()}),k.get(d).done(function(a){a&&(g=a.id)}),f("favorite.add").subscribe(function(a){a.itemId===d.itemId&&a.itemType===d.itemType&&(g=a.id)}),f("favorite.remove").subscribe(function(a){a.itemId===d.itemId&&a.itemType===d.itemType&&(g=null)})},A.initNoLanguage=function(){d("nolanguage")&&a("<div class=player-hero__hiccup><div class=player-hero__inner><div class=container>Sorry, subtitles are not available in the language you requested.</div></div></div>").insertBefore(A.hero)},A.initSubtitles=function(){var b=a("#hero-subtitle-link"),c=A.hero.playerHero("player"),f=a("<div>").html(u()).modal({autoOpen:!1}),g=!1,h=new p;"h264"===c.player("mode")&&d("language")&&(a('<div class="player-hero__hiccup player-hero__hiccup-warning"><div class=player-hero__inner><div class=container><i class="player-hero__hiccup-close g-button-modal-close pos:a top:0 top:2@md right:2"></i><strong class="f:2">Subtitles unavailable</strong><br> Your browser and/or Flash version needs to be updated in order to see subtitles. | <a href="#" class=hero-subtitle-help>Learn more</a></div></div></div>').insertBefore(A.hero),a(".player-hero__hiccup-close").on("click",function(b){b.preventDefault(),b.stopPropagation(),a(".player-hero__hiccup").hide()})),A.hero.on("click","a.controls__subtitles",function(){e.sendEvent("talk.subtitleSelector","show","controls")}),a(".hero-subtitle-help").on("click",function(a){a.preventDefault(),a.stopPropagation(),f.modal("open")}),b.on("click",function(a){a.preventDefault(),g&&(h.open(),e.sendEvent("talk.subtitleSelector","show","hero"))});var i;h.state.on("change:selected",function(a,b){var d=String(i),e=String(b),f=e!==d,g=!!b&&f;f&&(c.player("subtitle",b),h.close()),g&&c.player("play")}),c.on({playerready:function(){c.player("canSubtitle")&&(h.render(),g=!0,b.removeClass("player-hero__meta__transcript-link--unclickable"))},playersubtitle:function(a,b){i=!!(b&&b.subtitle&&b.subtitle.languageCode)&&b.subtitle.languageCode,h.state.set("selected",i)},playertalk:function(a,b){h.state.set("languages",b.languages)}})},A.initWatchLater=function(c){var d={itemId:c.id,itemType:"Talk"},g=A.hero.playerHero("player");a('a.watch-later-button, [data-later-talk], [data-service-name="list"]').watchLaterButton(a.extend({signInMessage:"Short on time? Save\nthis talk to your list so you can watch later."},d));var h=null,i=b.once(function(a){e.sendEvent("watchLater","play","talk",a)});g.on("playercurrenttime",b.throttle(function(a,b){if(h){var c=Math.floor(b.currentTime);c>5&&l.update({id:h,secondsPlayed:c}),i(c)}},3e4)),l.get(d).done(function(a){a&&(a.secondsPlayed&&!o().seconds&&g.one("playerready",function(){g.player("seek",a.secondsPlayed,!0)}),h=a.id)}),f("watchLater.add").subscribe(function(a){a.itemId===c.id&&(h=a.id)}),f("watchLater.remove").subscribe(function(a){a.itemId===c.id&&(h=null)})},A.rate=function(){var b;return function(c){c&&c.preventDefault()&&c.preventDefault(),b?b.talkRatingModal("open"):b=a("<div>").talkRatingModal(a.extend({open:e.sendEvent.recall("talk.rate","show"),submit:e.sendEvent.recall("talk.rate","submit")},{talkId:B.talks[0].id,ratings:B.ratings}))}}(),A.hero=null,A}),define("components/main-nav/components/popups/views/popup",["Backbone","jqueryui/core"],function(a){"use strict";return a.View.extend({events:{keydown:"_onKeyDown",keyup:"_onKeyUp"},isOpen:!1,_onKeyDown:function(a){if(a.keyCode===$.ui.keyCode.TAB){var b=this.$el.find(":tabbable"),c=a.target,d=b.filter(":first").get(0),e=c===d&&a.shiftKey,f=b.filter(":last").get(0),g=c===f&&!a.shiftKey;(e||g)&&this.hide()}},_onKeyUp:function(a){a.keyCode===$.ui.keyCode.ESCAPE&&this.hide()},hide:function(){this.isOpen=!1,this.$el.attr("aria-hidden","true"),this.trigger("hide"),this.$el.removeClass("Main-nav/Popper__popup--visible").addClass("Main-nav/Popper__popup--hidden")},show:function(){this.isOpen=!0,this.$el.attr("aria-hidden","false"),this.trigger("show"),this.$el.removeClass("Main-nav/Popper__popup--hidden").addClass("Main-nav/Popper__popup--visible")}})}),define("components/main-nav/lib/screen-size",["lodash","lib/resize"],function(a,b){"use strict";function c(b,c){return function(){b()&&c.apply(this,a.toArray(arguments))}}function d(){return b("breakpoint").read()<1024}function e(){return!d()}return{isSmall:d,isBig:e,ifSmall:a.partial(c,d),ifBig:a.partial(c,e)}}),define("components/main-nav/components/popups/views/popper-bar",["Backbone","../../../lib/screen-size"],function(a,b){"use strict";return a.View.extend({events:{"click *[data-popper-target]":"_clickPopperTarget","mouseenter *[data-popper-root]":"_hoverPopperRoot","mouseleave *[data-popper-root]":"_unhoverPopperRoot"},_trigger:function(a,b,c){this.trigger(a,b,c.data("popper-name"),c)},_clickPopperTarget:b.ifBig(function(a){var b=$(a.currentTarget).closest("*[data-popper-root]");a.preventDefault(),this._trigger("pop",a,b)}),_hoverPopperRoot:b.ifBig(function(a){this._trigger("pop",a,$(a.currentTarget))}),_unhoverPopperRoot:b.ifBig(function(a){this._trigger("unpop",a,$(a.currentTarget))})})}),define("components/main-nav/components/popups/views/smoke",["Backbone"],function(a){"use strict";return a.View.extend({_isOpen:!1,initialize:function(){var a=this;a._hide=function(){a._isOpen||a.$el.removeClass("Main-nav/Popper__smoke--visible").addClass("Main-nav/Popper__smoke--hidden")}},hide:function(){this._isOpen=!1,window.setTimeout(this._hide,100)},show:function(){this._isOpen=!0,this.$el.removeClass("Main-nav/Popper__smoke--hidden").addClass("Main-nav/Popper__smoke--visible")}})}),define("components/main-nav/components/popups/index",["lodash","./views/popup","./views/popper-bar","./views/smoke"],function(a,b,c,d){"use strict";function e(b){a.forOwn(a.omit(h.popups,b),function(a){a.hide()})}function f(){var b;a.forOwn(h.popups,function(a){b=b||a.isOpen}),i()[b?"show":"hide"]()}function g(a,c){var d=h.popups[a];return d&&d instanceof b||(d=h.popups[a]=new b({el:c.find(".Main-nav\\/Popper__popup")}),d.on("hide",function(){f()}),d.on("show",function(){e(a),f()})),d}var h={};h.popups={};var i=a.once(function(){var a=new d({el:document.getElementById("main-nav-popper-smoke")});return a.render(),a});return h.init=function(){var a=new c({el:document.getElementById("main-nav")});a.render(),h.popperBar=a,a.on("pop",function(a,b,c){g(b,c).show()}),a.on("unpop",function(a,b,c){g(b,c).hide()})},h}),define("components/accordion/index",["lodash","Backbone"],function(a,b){"use strict";var c="Accordion__item",d="Accordion__content",e="Accordion__item--open";return b.View.extend({events:{"click .Accordion__opener":"_clickAccordionOpener"},_clickAccordionOpener:function(a){a.preventDefault();var b=$(a.target).closest("."+c);b.closest(".Accordion").find("."+c).not(b).removeClass(e).find("."+d).slideUp(150);var f=b.hasClass(e);b[f?"removeClass":"addClass"](e).find("."+d)[f?"slideUp":"slideDown"](150);var g=b.data("accordion-item-name");this.trigger("accordion-"+(f?"close":"open"),a,g)}})}),define("lib/shoji",["jquery","lodash","Modernizr","lib/focus-zone","lib/resize","utils/throwError"],function(a,b,c,d,e,f){"use strict";function g(b){var c=a(b);return c.hasClass(r)||(c=c.closest("div."+r)),c.length||f("Could not find fixture "+b),c}function h(){n.removeClass(s+" "+t)}function i(){v(),a(document.activeElement).blur(),n.removeClass(s+" "+t)}function j(c,d){var e=a("<div class="+r+">"),f={};return b.defaults(f,d,{at:"left"}),v(),e.addClass(r+"--"+f.at),e.data("at",f.at),e.append(c),e.appendTo(o),e}function k(){return v(),c.csstransforms3d&&p>=320}function i(){v(),h(),q.deactivate()}function l(a){var b=g(a);v(),o.children().removeClass(u),b.addClass(u),m(b.data("at")),q.activate()}function m(a){h(),n.addClass("shoji--opened shoji--"+a)}var n,o,p,q,r="shoji__fixture",s="shoji--left",t="shoji--right",u=r+"--revealed",v=b.once(function(){n=a("#shoji"),o=a("#shoji-fixtures"),q=new d(o),a("#shoji-lattice").on("click",function(){return i(),!1}),a('<a class="shoji__closer" href="#" role="button" tabindex="0"><div class="shoji__closer__label">Close</div></a>').on("click",function(a){a.preventDefault(),i()}).appendTo(o),e("breakpoint").subscribe(function(a){p=a})});return{_getFixture:g,_init:v,addFixture:j,canSlide:k,concealFixture:i,revealFixture:l,slide:m}}),define("components/main-nav/components/slideout/views/shoji-fixture",["lodash","Backbone","lib/shoji"],function(a,b,c){"use strict";return b.View.extend({fixture:null,isShoji:!1,shojiOpenAt:"left",_renderForShoji:function(){this.fixture=c.addFixture(this.$el.detach(),{at:this.shojiOpenAt}),this.isShoji=!0},hide:function(){return this.isShoji?c.concealFixture():this.$el.hide(),this.trigger("hide"),this},show:function(){return this.isShoji?c.revealFixture(this.fixture):this.$el.show(),this.trigger("show"),this},render:function(){return c.canSlide()?this._renderForShoji():this.$el.hide(),this}})}),define("components/main-nav/components/slideout/components/drilldown/models/screen",["Backbone"],function(a){"use strict";return a.Model.extend({defaults:{tense:"present"}})}),define("components/main-nav/components/slideout/components/drilldown/views/screen",["lodash","Backbone"],function(a,b){"use strict";var c={present:"Drilldown-screen--present",past:"Drilldown-screen--past",future:"Drilldown-screen--future"},d=a.values(c).join(" ");return b.View.extend({className:"Drilldown-screen",initialize:function(a){this.setContent(a.content),this.listenTo(this.model,"change:tense",this.renderTense)},renderTense:function(){this.$el.removeClass(d).addClass(c[this.model.get("tense")])},render:function(){return this.rendered||(this.rendered=!0,this.setContent()),this.renderTense(),this},setContent:function(a){a&&(this.content=a),this.rendered&&this.content&&(this.content.render(),this.$el.append(this.content.$el))}})}),define("components/main-nav/components/slideout/components/drilldown/index",["Backbone","./models/screen","./views/screen"],function(a,b,c){"use strict";return a.View.extend({events:{"click a[data-drilldown]":"_clickDrilldownLink"},rendered:!1,_clickDrilldownLink:function(a){a.preventDefault();var b=$(a.target),c=b.data("drilldown")||b.attr("href");"back"===c?this.openPrimary():this.secondaries[c]?this.openSecondary(this.secondaries[c]):this.trigger("spawn",this.addSecondary(c))},initialize:function(){this.primary=this.createScreen(),this.secondaries={}},render:function(){return this.rendered||(this.renderScreen(this.primary),_.forOwn(this.secondaries,_.bind(this.renderScreen,this)),this.rendered=!0),this},renderScreen:function(a){a&&(a.render(),this.$el.append(a.$el))},createScreen:function(a){return new c({model:new b,content:a})},setPrimary:function(a){this.primary.content=a,this.rendered&&this.renderScreen(this.primary)},addSecondary:function(a,b){var c=this.createScreen(b);return c.model.set("id",a),this.secondaries[a]=c,this.rendered?(c.model.set("tense","future"),this.renderScreen(c),this.openSecondary(c)):this.primary.model.set("tense","past"),c},openPrimary:function(){var a=this;_.defer(function(){a.primary.model.set("tense","present"),_.forOwn(a.secondaries,function(a){a.model.set("tense","future")})})},openSecondary:function(a){$("body").animate({scrollTop:0},200);var b=this;_.defer(function(){b.primary.model.set("tense","past"),a.model.set("tense","present")})}})}),define("components/main-nav/components/slideout/index",["lodash","components/accordion/index","./views/shoji-fixture","./components/drilldown/index"],function(a,b,c,d){"use strict";return c.extend(b.prototype).extend({initialize:function(){this.render=a.once(this.render),this.drilldown=new d,this.drilldown.on("spawn",this.onSpawn,this)},onSpawn:function(a){this.trigger("spawn",a)},render:function(){return c.prototype.render.call(this),this.drilldown.render(),this.$el.append(this.drilldown.$el),this},setPrimary:function(a){this.drilldown.setPrimary(a)},addSecondary:function(a,b){this.drilldown.addSecondary(a,b)}})}),define("components/main-nav/lib/menu-parser",["lodash","jquery"],function(a,b){"use strict";function c(a){var c=a.find("h3.submenu__heading");if(c.length)return{label:b.trim(c.text()),url:c.find("a").attr("href")||"#"}}function d(a){var c=[];return a.find("ul.submenu__list:first > li.submenu__item").each(function(){var a=b(this),e=a.find("a.submenu__link:first"),f={label:b.trim(e.text()),url:e.attr("href")||"#"},g=d(a);g.length&&(f.items=g),c.push(f)}),c}function e(b){return a.filter(a.union([c(b)],d(b)))}function f(a){var c=new b.Deferred;return b.ajax({url:a,xhrFields:{withCredentials:!0}}).then(function(a){c.resolve(e(b(a).find("#submenu")))},function(){c.reject()}),c.promise()}return{parse:e,load:f}}),define("components/main-nav/lib/current-user",["Backbone","lib/pubSub","lib/currentUser"],function(a,b,c){"use strict";function d(a){e.set(a)}var e=new a.Model;return c.getDetails().done(d),b("auth.login").subscribe(d),e}),define("components/main-nav/views/account-button",["Backbone","../lib/current-user","lib/pubSub"],function(a,b,c){"use strict";return a.View.extend({initialize:function(){this.listenTo(b,"change",this.render)},render:function(){if(b.get("id")){var a=b.get("avatarUrl");this.$el.find("div.Main-nav__account-button__avatar").css("background-image","url("+a+")"),this.renderBadge()}},renderBadge:function(){function a(){e.removeClass("Main-nav__account-button__badge--bouncing")}function b(){e.addClass("Main-nav__account-button__badge--visible").addClass("Main-nav__account-button__badge--bouncing"),window.setTimeout(a,600)}function d(){e.removeClass("Main-nav__account-button__badge--visible")}var e=this.$el.find("div.Main-nav__account-button__badge");c("favorite.add").subscribe(b),c("watchLater.add").subscribe(b),c("watchLater.remove").subscribe(d)}})}),define("components/main-nav/config",["utils/ted"],function(a){"use strict";return{urls:{yourList:"/dashboard/list",favorites:"/dashboard/favorites",watchHistory:"/dashboard/history",conferences:"/dashboard/conferences",tedEdHistory:"https://ed.ted.com/activity/lessons",tedXEvents:"https://tedx-apply.ted.com/manage",confBadge:"/dashboard/conferences/badge",confContact:"/dashboard/conferences/contact",settings:a("settingsUrl"),profile:"/profile",logOut:a("signOutUrl")}}}),define("components/main-nav/lib/menu-builder",["lodash"],function(a){"use strict";function b(b){return a.filter(b)}function c(c,d,e){var f=a.extend({condition:!0,external:!1,label:c,url:d,items:null},e||{});if(a.isArray(d)&&(f.items=b(d),f.url=void 0),f.condition)return f}return{item:c,list:b}}),define("hbs!components/main-nav/templates/account-popup-menu",["hbs","hbs/handlebars"],function(a,b){var c=b.template({1:function(a,b,c,d){var e,f;return'    <li>\n      <a\n        class="\n          Main-nav__fs-1\n          hover/bg:gray-ll\n          f-w:700\n          d:b\n          p-x:4\n          p-y:.7\n          undec\n          ga-link\n        "\n        href="'+this.escapeExpression((f=null!=(f=b.url||(null!=a?a.url:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"url",hash:{},data:d}):f))+'"\n        data-ga-category="navigation.item"\n        data-ga-action="account"\n        data-ga-label="'+this.escapeExpression((f=null!=(f=b.url||(null!=a?a.url:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"url",hash:{},data:d}):f))+'"\n        '+(null!=(e=b.if.call(a,null!=a?a.external:a,{name:"if",hash:{},fn:this.program(2,d,0),inverse:this.noop,data:d}))?e:"")+"\n      >"+this.escapeExpression((f=null!=(f=b.label||(null!=a?a.label:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"label",hash:{},data:d}):f))+"</a>\n    </li>\n"},2:function(a,b,c,d){return'target="_blank"'},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f;return'<div class="\n    b-b\n    b:black.9\n    p-x:4\n    p-y:.8\n  "\n>\n  <div class="Main-nav__fs-6 f-w:700">Hi, '+this.escapeExpression((f=null!=(f=b.userName||(null!=a?a.userName:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"userName",hash:{},data:d}):f))+'</div>\n</div>\n\n<ul class="\n    b-b\n    b:black.9\n    sl\n  "\n>\n'+(null!=(e=b.each.call(a,null!=a?a.menuItems:a,{name:"each",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+'</ul>\n\n<div>\n  <a\n    class="\n      hover/bg:gray-ll\n      d:b\n      f-w:700\n      p-x:4\n      p-y:2\n      Main-nav__fs-1\n      undec\n      ga-link\n    "\n    href="'+this.escapeExpression(this.lambda(null!=(e=null!=a?a.urls:a)?e.logOut:e,a))+'"\n    data-ga-category="navigation.item"\n    data-ga-action="account"\n    data-ga-label="'+this.escapeExpression(this.lambda(null!=(e=null!=a?a.urls:a)?e.logOut:e,a))+'"\n  >Log out</a>\n</div>\n'},useData:!0});return b.registerPartial("components/main-nav/templates/account-popup-menu",c),c}),define("components/main-nav/views/account-popup-menu",["Backbone","../config","../lib/current-user","../lib/menu-builder","hbs!../templates/account-popup-menu"],function(a,b,c,d,e){"use strict";return a.View.extend({initialize:function(){this.listenTo(c,"change",this.render)},getMenuItems:function(){var a=b.urls;return d.list([d.item("Your list",a.yourList),d.item("Likes",a.favorites),d.item("Watch history",a.watchHistory),d.item("TEDx events",a.tedXEvents,{external:!0,condition:c.get("isTEDxOrganizer")}),d.item("Conferences",a.conferences,{condition:c.get("hasConferences")}),d.item("Your TED-Ed activity",a.tedEdHistory,{external:!0,condition:c.get("hasEdActivity")}),d.item("Account settings",a.settings),d.item("Your profile",a.profile)])},render:function(){this.$el.html(e({userName:c.get("firstName"),menuItems:this.getMenuItems(),urls:b.urls}))}})}),define("hbs!components/main-nav/templates/slideout-menu-item",["hbs","hbs/handlebars"],function(a,b){var c=b.template({1:function(a,b,c,d){return"        b-b\n        b:black.9\n"},3:function(a,b,c,d){return"f-w:700"},5:function(a,b,c,d){return"ga-link"},7:function(a,b,c,d){return'target="_blank"'},9:function(a,b,c,d){return"data-drilldown"},11:function(a,b,c,d){var e;return'      data-ga-action="'+this.escapeExpression((e=null!=(e=b.gaAction||(null!=a?a.gaAction:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"gaAction",hash:{},data:d}):e))+'"\n      data-ga-category="navigation.item"\n      data-ga-label="'+this.escapeExpression((e=null!=(e=b.url||(null!=a?a.url:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"url",hash:{},data:d}):e))+'"\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f;return'<li>\n  <a\n    class="\n'+(null!=(e=b.if.call(a,null!=a?a.border:a,{name:"if",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+"      d:b\n      "+(null!=(e=b.if.call(a,null!=a?a.bold:a,{name:"if",hash:{},fn:this.program(3,d,0),inverse:this.noop,data:d}))?e:"")+"\n      "+(null!=(e=b.if.call(a,null!=a?a.gaAction:a,{name:"if",hash:{},fn:this.program(5,d,0),inverse:this.noop,data:d}))?e:"")+'\n      p-x:5\n      p-y:.8\n      undec\n      Main-nav__fs-4\n    "\n    href="'+this.escapeExpression((f=null!=(f=b.url||(null!=a?a.url:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"url",hash:{},data:d}):f))+'"\n    '+(null!=(e=b.if.call(a,null!=a?a.external:a,{name:"if",hash:{},fn:this.program(7,d,0),inverse:this.noop,data:d}))?e:"")+"\n    "+(null!=(e=b.if.call(a,null!=a?a.drilldown:a,{name:"if",hash:{},fn:this.program(9,d,0),inverse:this.noop,data:d}))?e:"")+"\n"+(null!=(e=b.if.call(a,null!=a?a.gaAction:a,{name:"if",hash:{},fn:this.program(11,d,0),inverse:this.noop,data:d}))?e:"")+"  >"+this.escapeExpression((f=null!=(f=b.label||(null!=a?a.label:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"label",hash:{},data:d}):f))+"</a>\n</li>\n"},useData:!0});return b.registerPartial("components/main-nav/templates/slideout-menu-item",c),b.registerPartial("./slideout-menu-item",c),b.registerPartial("./slideout-menu-item",c),c}),define("hbs!components/main-nav/templates/slideout-menu-cascaded-item",["hbs","hbs/handlebars","hbs!components/main-nav/templates/slideout-menu-item"],function(a,b){var c=b.template({1:function(a,b,c,d){var e;return null!=(e=this.invokePartial(c["./slideout-menu-item"],a,{name:"./slideout-menu-item",data:d,indent:"      ",helpers:b,partials:c}))?e:""},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f;return'<li\n  class="\n    b-b\n    b:black.9\n  "\n>\n  <a\n    class="\n      d:b\n      f-w:700\n      p-x:5 p-y:.8\n      undec\n      Main-nav__fs-4\n    "\n    href="'+this.escapeExpression((f=null!=(f=b.url||(null!=a?a.url:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"url",hash:{},data:d}):f))+'"\n  >'+this.escapeExpression((f=null!=(f=b.label||(null!=a?a.label:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"label",hash:{},data:d}):f))+'</a>\n  <ul class="sl">\n'+(null!=(e=b.each.call(a,null!=a?a.items:a,{name:"each",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+"  </ul>\n</li>\n"},usePartial:!0,useData:!0});return b.registerPartial("components/main-nav/templates/slideout-menu-cascaded-item",c),b.registerPartial("./slideout-menu-cascaded-item",c),c}),define("hbs!components/main-nav/templates/slideout-menu-accordion-item",["hbs","hbs/handlebars","hbs!components/main-nav/templates/slideout-menu-item"],function(a,b){var c=b.template({1:function(a,b,c,d){var e;return'    data-accordion-item-name="'+this.escapeExpression((e=null!=(e=b.name||(null!=a?a.name:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"name",hash:{},data:d}):e))+'"\n'},3:function(a,b,c,d,e,f){var g;return null!=(g=this.invokePartial(c["./slideout-menu-item"],a,{name:"./slideout-menu-item",hash:{gaAction:null!=f[1]?f[1].name:f[1],border:!0},data:d,indent:"      ",helpers:b,partials:c}))?g:""},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d,e,f){var g,h;return'<li\n  class="Accordion__item"\n'+(null!=(g=b.if.call(a,null!=a?a.name:a,{name:"if",hash:{},fn:this.program(1,d,0,e,f),inverse:this.noop,data:d}))?g:"")+'>\n  <a\n    href="#"\n    class="\n      b-b\n      b:black.9\n      d:b\n      f-w:700\n      p-x:5\n      p-y:.8\n      pos:r\n      undec\n      Accordion__opener\n      Main-nav__fs-4\n    "\n  >\n    <svg\n      class="\n        m-w:4\n        pos:a\n        left:0\n        top:0\n        h:full\n        Accordion__arrow\n      "\n      xmlns="http://www.w3.org/2000/svg"\n      viewBox="-300 0 890 512"\n    >\n      <path fill="#231F20" d="M47.745 499.5v-487l416.51 243.483z"/>\n    </svg>\n    '+this.escapeExpression((h=null!=(h=b.label||(null!=a?a.label:a))?h:b.helperMissing,"function"==typeof h?h.call(a,{name:"label",hash:{},data:d}):h))+'\n  </a>\n  <ul\n    class="\n      bg:white\n      sl\n      Accordion__content\n    "\n  >\n'+(null!=(g=b.each.call(a,null!=a?a.items:a,{name:"each",hash:{},fn:this.program(3,d,0,e,f),inverse:this.noop,data:d}))?g:"")+"  </ul>\n</li>\n"},usePartial:!0,useData:!0,useDepths:!0});return b.registerPartial("components/main-nav/templates/slideout-menu-accordion-item",c),b.registerPartial("./slideout-menu-accordion-item",c),c}),define("hbs!components/main-nav/templates/slideout-menu",["hbs","hbs/handlebars","hbs!components/main-nav/templates/slideout-menu-cascaded-item","hbs!components/main-nav/templates/slideout-menu-accordion-item","hbs!components/main-nav/templates/slideout-menu-item"],function(a,b){var c=b.template({1:function(a,b,c,d){var e;return null!=(e=b.if.call(a,null!=a?a.items:a,{name:"if",hash:{},fn:this.program(2,d,0),inverse:this.program(7,d,0),data:d}))?e:""},2:function(a,b,c,d){var e;return null!=(e=b.if.call(a,null!=a?a.url:a,{name:"if",hash:{},fn:this.program(3,d,0),inverse:this.program(5,d,0),data:d}))?e:""},3:function(a,b,c,d){var e;return null!=(e=this.invokePartial(c["./slideout-menu-cascaded-item"],a,{name:"./slideout-menu-cascaded-item",data:d,indent:"        ",helpers:b,partials:c}))?e:""},5:function(a,b,c,d){var e;return null!=(e=this.invokePartial(c["./slideout-menu-accordion-item"],a,{name:"./slideout-menu-accordion-item",data:d,indent:"        ",helpers:b,partials:c}))?e:""},7:function(a,b,c,d){var e;return null!=(e=this.invokePartial(c["./slideout-menu-item"],a,{name:"./slideout-menu-item",hash:{border:!0,bold:!0},data:d,indent:"      ",helpers:b,partials:c}))?e:""},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'<ul class="sl Accordion">\n'+(null!=(e=b.each.call(a,null!=a?a.menuItems:a,{name:"each",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+"</ul>\n"},usePartial:!0,useData:!0});return b.registerPartial("components/main-nav/templates/slideout-menu",c),b.registerPartial("./slideout-menu",c),c}),define("hbs!components/main-nav/templates/account-slideout-menu",["hbs","hbs/handlebars","hbs!components/main-nav/templates/slideout-menu"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f;return'<div\n  class="\n    b-b\n    b:black.9\n    p:.8\n  "\n>\n  <div\n    class="\n      f-w:700\n      Main-nav__fs-6\n    "\n  >\n    Hi, '+this.escapeExpression((f=null!=(f=b.userName||(null!=a?a.userName:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"userName",hash:{},data:d}):f))+"\n  </div>\n</div>\n\n"+(null!=(e=this.invokePartial(c["./slideout-menu"],a,{name:"./slideout-menu",data:d,helpers:b,partials:c}))?e:"")},usePartial:!0,useData:!0});return b.registerPartial("components/main-nav/templates/account-slideout-menu",c),c}),define("components/main-nav/views/account-slideout-menu",["lodash","Backbone","../config","../lib/current-user","../lib/menu-builder","hbs!../templates/account-slideout-menu"],function(a,b,c,d,e,f){"use strict";function g(b){return a.extend({gaAction:"account"},b||{})}return b.View.extend({initialize:function(){this.listenTo(d,"change",this.render)},getMenuItems:function(){var b=c.urls,f=a.map(d.get("upcomingConferences"),function(a){return e.item(a.name,"/dashboard/conferences/"+a.slug)});return e.list([e.item("Your talks",[e.item("Your list",b.yourList,g()),e.item("Likes",b.favorites,g()),e.item("Watch history",b.watchHistory,g())]),e.item("TEDx Events",b.tedXEvents,g({external:!0,condition:d.get("isTEDxOrganizer")})),e.item("Conferences",a.union(f,[e.item("Badge",b.confBadge,g()),e.item("Contact us",b.confContact,g())]),{condition:d.get("hasConferences")}),e.item("Your TED-Ed activity",b.tedEdHistory,g({external:!0,condition:d.get("hasEdActivity")})),e.item("Account",b.settings,g({drilldown:!0})),e.item("Your profile",b.profile,g()),e.item("Log out",b.logOut,g())])},render:function(){return this.$el.html(f({userName:d.get("firstName"),menuItems:this.getMenuItems()})),this}})}),define("components/main-nav/views/big-search",["lodash","Backbone","lib/focus-zone","views/mixins/cached-find"],function(a,b,c,d){"use strict";var e=b.View.extend({events:{"click a.Main-nav__search__close":"_onClickClose",keyup:"_onKeyUp"},_onClickClose:function(a){a.preventDefault(),this.hide()},_onKeyUp:function(a){this.isOpen&&a.keyCode===$.ui.keyCode.ESCAPE&&this.hide()},getFocusZone:function(){return this.focusZone=this.focusZone||new c(this.el),this.focusZone},hide:function(){this.isOpen=!1,this.getFocusZone().deactivate(),this.$el.attr("aria-hidden","true"),this.find("a.Main-nav__search__close").attr("tabindex","-1"),this.find("input.Main-nav__search__input").attr("tabindex","-1"),this.trigger("hide")},show:function(){var b=this;b.isOpen=!0,b.trigger("show"),a.delay(function(){b.getFocusZone().activate(),b.$el.removeAttr("aria-hidden"),b.find("a.Main-nav__search__close").attr("tabindex","0"),b.find("input.Main-nav__search__input").attr("tabindex","0").focus().select()},100)}});return a.extend(e.prototype,d),e}),define("hbs!components/main-nav/templates/hamburger-slideout-menu",["hbs","hbs/handlebars","hbs!components/main-nav/templates/slideout-menu"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'<form\n  class="\n    b-b\n    b:black.9\n    p:.6\n  "\n  action="/search"\n  role="search"\n>\n  <div class="pos:r">\n    <input\n      class="form-control"\n      autocorrect="off"\n      name="q"\n      placeholder="Search"\n    />\n    <label\n      class="\n        pos:a\n        right:0\n        top:0\n      "\n    >\n      <input\n        class="d:n"\n        type="submit"\n      />\n      <svg\n        xmlns="http://www.w3.org/2000/svg"\n        width="40"\n        height="40"\n        viewBox="0 0 40 40"\n        role="button"\n        tabindex="0"\n      >\n        <title>Search</title>\n        <rect x="5" y="10" width="30" height="20" fill="#FFF" />\n        <path d="M17.769 5.081c-7.006 0-12.708 5.695-12.708 12.693 0 6.999 5.702 12.695 12.711 12.695 2.529 0 4.886-.752 6.869-2.033l5.441 5.435a2.695 2.695 0 0 0 3.805 0 2.688 2.688 0 0 0 0-3.803l-5.44-5.431a12.59 12.59 0 0 0 2.034-6.863c-.001-6.998-5.7-12.693-12.712-12.693zm10.165 12.693c0 5.599-4.56 10.151-10.162 10.151-5.604 0-10.163-4.554-10.163-10.151 0-5.597 4.559-10.15 10.163-10.146 5.602 0 10.16 4.549 10.162 10.146z" fill="#666" />\n      </svg>\n    </label>\n  </div>\n</form>\n\n'+(null!=(e=this.invokePartial(c["./slideout-menu"],a,{
name:"./slideout-menu",data:d,helpers:b,partials:c}))?e:"")},usePartial:!0,useData:!0});return b.registerPartial("components/main-nav/templates/hamburger-slideout-menu",c),c}),define("components/main-nav/views/hamburger-slideout-menu",["Backbone","hbs!../templates/hamburger-slideout-menu"],function(a,b){"use strict";return a.View.extend({menuItems:[],initialize:function(a){this.menuItems=a.menuItems},render:function(){return this.$el.html(b({menuItems:this.menuItems})),this}})}),define("hbs!components/main-nav/templates/slideout-secondary",["hbs","hbs/handlebars","hbs!components/main-nav/templates/slideout-menu"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'<a\n  class="\n    b-b\n    b:black.9\n    undec\n    Main-nav__fs-4\n    pos:r\n    p-y:.8\n    p-x:5\n    f-w:700\n    d:b\n  "\n  href="#"\n  role="button"\n  data-drilldown="back"\n>\n  <svg\n    class="\n      m-w:4\n      pos:a\n      left:0\n      top:0\n      h:full\n    "\n    xmlns="http://www.w3.org/2000/svg"\n    viewBox="-270 242 60 30"\n  >\n    <path d="M-226.3 269l-12-12 12-12-1.7-1.7-13.7 13.7 13.7 13.7 1.7-1.7z" />\n  </svg>\n  Back\n</a>\n\n'+(null!=(e=this.invokePartial(c["./slideout-menu"],a,{name:"./slideout-menu",data:d,helpers:b,partials:c}))?e:"")+'\n<div class="p-y:6 pos:r">\n  <div\n    class="\n      spinner--centered\n      Main-nav__slideout-spinner\n    "\n  ></div>\n</div>\n'},usePartial:!0,useData:!0});return b.registerPartial("components/main-nav/templates/slideout-secondary",c),c}),define("components/main-nav/views/slideout-secondary",["Backbone","spinjs","hbs!../templates/slideout-secondary"],function(a,b,c){"use strict";return a.View.extend({menuItems:[],render:function(){return this._spinner&&this.menuItems.length&&this._spinner.stop(),this.$el.html(c({menuItems:this.menuItems})),this._spinner||this.menuItems.length||(this._spinner=new b,this._spinner.spin(this.$el.find("div.Main-nav__slideout-spinner").get(0))),this}})}),define("components/main-nav/index",["lodash","./components/popups/index","./components/slideout/index","./lib/menu-parser","./lib/screen-size","./views/account-button","./views/account-popup-menu","./views/account-slideout-menu","./views/big-search","./views/hamburger-slideout-menu","./views/slideout-secondary"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(){var a=new c;return a.$el.appendTo("#main-nav-slideouts"),a.on("spawn",function(a){var b=new k;a.setContent(b);var c=a.model.get("id");d.load(c).done(function(a){b.menuItems=a,b.render()}).fail(function(){window.location.href=c})}),a}function m(){$("#main-nav-account-button").on("click",e.ifSmall(function(){q().render().show()})),q().setPrimary(new h);var a=new g({el:document.getElementById("main-nav-account-menu")});a.render();var b=new f({el:document.getElementById("main-nav-account-button")});b.render()}function n(){var a=new i({el:document.getElementById("main-nav-search-form")});a.render();var b=$("#main-nav");a.on("show",function(){b.addClass("Main-nav--searching")}),a.on("hide",function(){b.removeClass("Main-nav--searching")}),$("#main-nav-search").on("click",function(b){b.preventDefault(),a.show()})}function o(){var a=new k;return a.menuItems=d.parse($("#submenu")),a}var p={},q=a.once(function(){var a=l();return a.shojiOpenAt="right",a}),r=a.once(function(){var a=l();return a});return p.openHamburger=function(){r().render().show()},p.init=function(a){m(),n(),b.init(),r().setPrimary(new j({menuItems:a.menuItems})),$("#main-nav").removeClass("Main-nav--uninitialized")},p.addSubmenuToHamburger=function(){r().addSecondary("currentPage",o())},p.addSubmenuToAccount=function(){q().addSecondary("currentPage",o())},p}),define("global/links",["jquery","deferLink","lib/ga"],function(a,b,c){"use strict";function d(a){if(a.match(location.origin))return!1;for(var b=-1;++b<h;)if(a.match(g[b].re))return g[b]}function e(b,c,d){b=a.extend({},i,b);for(var e in b)b.hasOwnProperty(e)&&a.isFunction(b[e])&&(b[e]=b[e].call(c,d));return b}function f(a){var f=d(this.href);return!f||(c.send(e(f,this,a)),b.call(this,a))}var g=[{re:/^https?:\/\/(?:.*\.)tedprize\.(org|com)/,eventCategory:"link.outbound.tedPrize"},{re:/^https?:\/\/ed\.ted\.com/,eventCategory:"link.outbound.tedEd"},{re:/^https?:\/\/tedfellows\.posterous\.com/,eventCategory:"link.outbound.fellowsBlog"},{re:/^https?:\/\/(?:.*\.)universalsubtitles\.org/,eventCategory:"link.outbound.translatorDashboard"},{re:/^https?:\/\/(?:.*\.)feedburner\.com/,eventCategory:"link.outbound.feedburner"},{re:/^https?:\/\//}],h=g.length,i={hitType:"event",eventCategory:"link.outbound.other",eventAction:"click",eventLabel:function(){return this.href}};return{init:function(){a("body").on("click","a[href]",f)}}}),define("Mailcheck",["exports"],function(a){var b={domainThreshold:2,secondLevelThreshold:2,topLevelThreshold:2,defaultDomains:["msn.com","bellsouth.net","telus.net","comcast.net","optusnet.com.au","earthlink.net","qq.com","sky.com","icloud.com","mac.com","sympatico.ca","googlemail.com","att.net","xtra.co.nz","web.de","cox.net","gmail.com","ymail.com","aim.com","rogers.com","verizon.net","rocketmail.com","google.com","optonline.net","sbcglobal.net","aol.com","me.com","btinternet.com","charter.net","shaw.ca"],defaultSecondLevelDomains:["yahoo","hotmail","mail","live","outlook","gmx"],defaultTopLevelDomains:["com","com.au","com.tw","ca","co.nz","co.uk","de","fr","it","ru","net","org","edu","gov","jp","nl","kr","se","eu","ie","co.il","us","at","be","dk","hk","es","gr","ch","no","cz","in","net","net.au","info","biz","mil","co.jp","sg","hu"],run:function(a){a.domains=a.domains||b.defaultDomains,a.secondLevelDomains=a.secondLevelDomains||b.defaultSecondLevelDomains,a.topLevelDomains=a.topLevelDomains||b.defaultTopLevelDomains,a.distanceFunction=a.distanceFunction||b.sift3Distance;var c=function(a){return a},d=a.suggested||c,e=a.empty||c,f=b.suggest(b.encodeEmail(a.email),a.domains,a.secondLevelDomains,a.topLevelDomains,a.distanceFunction);return f?d(f):e()},suggest:function(a,b,c,d,e){a=a.toLowerCase();var f=this.splitEmail(a);if(c&&d&&c.indexOf(f.secondLevelDomain)!==-1&&d.indexOf(f.topLevelDomain)!==-1)return!1;var g=this.findClosestDomain(f.domain,b,e,this.domainThreshold);if(g)return g!=f.domain&&{address:f.address,domain:g,full:f.address+"@"+g};var h=this.findClosestDomain(f.secondLevelDomain,c,e,this.secondLevelThreshold),i=this.findClosestDomain(f.topLevelDomain,d,e,this.topLevelThreshold);if(f.domain){var g=f.domain,j=!1;if(h&&h!=f.secondLevelDomain&&(g=g.replace(f.secondLevelDomain,h),j=!0),i&&i!=f.topLevelDomain&&(g=g.replace(f.topLevelDomain,i),j=!0),1==j)return{address:f.address,domain:g,full:f.address+"@"+g}}return!1},findClosestDomain:function(a,b,c,d){d=d||this.topLevelThreshold;var e,f=99,g=null;if(!a||!b)return!1;c||(c=this.sift3Distance);for(var h=0;h<b.length;h++){if(a===b[h])return a;e=c(a,b[h]),e<f&&(f=e,g=b[h])}return f<=d&&null!==g&&g},sift3Distance:function(a,b){if(null==a||0===a.length)return null==b||0===b.length?0:b.length;if(null==b||0===b.length)return a.length;for(var c=0,d=0,e=0,f=0,g=5;c+d<a.length&&c+e<b.length;){if(a.charAt(c+d)==b.charAt(c+e))f++;else{d=0,e=0;for(var h=0;h<g;h++){if(c+h<a.length&&a.charAt(c+h)==b.charAt(c)){d=h;break}if(c+h<b.length&&a.charAt(c)==b.charAt(c+h)){e=h;break}}}c++}return(a.length+b.length)/2-f},splitEmail:function(a){var b=a.trim().split("@");if(b.length<2)return!1;for(var c=0;c<b.length;c++)if(""===b[c])return!1;var d=b.pop(),e=d.split("."),f="",g="";if(0==e.length)return!1;if(1==e.length)g=e[0];else{f=e[0];for(var c=1;c<e.length;c++)g+=e[c]+".";g=g.substring(0,g.length-1)}return{topLevelDomain:g,secondLevelDomain:f,domain:d,address:b.join("@")}},encodeEmail:function(a){var b=encodeURI(a);return b=b.replace("%20"," ").replace("%25","%").replace("%5E","^").replace("%60","`").replace("%7B","{").replace("%7C","|").replace("%7D","}")}};return"undefined"!=typeof module&&module.exports&&(module.exports=b),"function"==typeof define&&define.amd&&define("mailcheck",[],function(){return b}),"undefined"!=typeof window&&window.jQuery&&!function(a){a.fn.mailcheck=function(a){var c=this;if(a.suggested){var d=a.suggested;a.suggested=function(a){d(c,a)}}if(a.empty){var e=a.empty;a.empty=function(){e.call(null,c)}}a.email=this.val(),b.run(a)}}(jQuery),b}),define("lib/newsletter",["jquery","Mailcheck"],function(a,b){"use strict";function c(b){var c=[],d=[];return b.isDaily&&c.push("daily"),b.isWeekly&&c.push("weekly"),b.isFellows&&c.push("fellows"),a.post("/subscriptions",{subscription:{email:b.email,list:c}}).done(function(b){a.each(b,function(a,b){d.push(b.error)})})}function d(c){var d=[],e=new a.Deferred;return""===c.email&&d.push("blankemail"),(""+c.email).match(/.+@.+/)||d.push("email"),c.isDaily||c.isWeekly||c.isFellows||d.push("subscription"),b.run({email:c.email,suggested:function(a){if(d.push({type:"suggestion",data:a.full}),1===d.length){var e=c.email.match(/@(.+$)/)[1];b.defaultDomains.push(e)}}}),d.length?e.rejectWith(c,[d]):e.resolveWith(c),e.promise()}function e(b){function e(a){"error"===a.status?i.rejectWith(b,[["uncaught"]]):i.resolveWith(b)}function f(){i.rejectWith(b,[["server"]])}function g(){c(b).then(e,f)}function h(a){i.rejectWith(this,[a])}var i=new a.Deferred;return d(b).then(g,h),i}return{ajax:c,subscribe:e,validate:d}}),define("global/subscribe",["jquery","lodash","lib/newsletter","lib/ga"],function(a,b,c,d){"use strict";function e(){d.sendEvent("newsletter","success",b.filter([!!h.isDaily&&"daily",!!h.isWeekly&&"weekly"]).join(",")),a(n+"-details").slideUp(o),a(n+"-success").slideDown(o)}function f(b){var c,d,e,f=b[0];if(m.slideUp(o),"object"==typeof f?(c=f.type,d=f.data):c=f,e=a(n+"-error-"+c),e.slideDown(o),d){var g=e.find(".newsletter-signup-error__data");g.text(d),g.click(function(a){a.preventDefault(),l.val(d),m.slideUp(o)})}}function g(a){p(),d.sendEvent("newsletter","submit","footer"),h={email:l.val(),isDaily:j.is(":checked"),isWeekly:k.is(":checked")},c.subscribe(h).then(e,f),a.preventDefault()}var h,i,j,k,l,m,n="#newsletter-signup",o="fast",p=b.once(function(){j=a(n+"-daily"),k=a(n+"-weekly"),l=a(n+"-email"),m=i.find("p.footer-newsletter__error")});return{init:function(){i=a(n),i.on("submit",g)}}}),define("global/uconf",["jquery","Cookies"],function(a,b){"use strict";var c="#";return{init:function(d,e){a(c+e).on("click",function(e){e.preventDefault(),a(c+d).slideUp("fast"),b.expire("_uconf",{domain:"ted.com",path:"/"})})}}}),define("global/keyboard",["jquery","exports","jqueryui/core"],function(a,b){"use strict";b._keyDowned=!1,b._keyDown=function(c){var d;c.keyCode!==a.ui.keyCode.SPACE||b._keyDowned||c.isPropagationStopped()||c.isDefaultPrevented()||!(d=a(c.target)).is("a[role=button]")||(c.preventDefault(),d.trigger("click",c)),b._keyDowned=!0},b._keyUp=function(){b._keyDowned=!1},b.init=function(){a(window).on({keydown:b._keyDown,keyup:b._keyUp})}}),define("global/fallback",["lib/fallback","lib/ga","exports"],function(a,b,c){"use strict";var d=window;c.init=function(){a.isEnabled()&&(d.document.documentElement.className+=" fallback",b.sendEvent("error","fallback",d.location.hostname+d.location.pathname))}}),define("global/track-a-block",["lib/errorCollector","utils/query_param","exports"],function(a,b,c){"use strict";function d(a,b){f&&console&&console.log&&console.log("%c"+(a?" ":" ")+b,"color:"+(a?"green":"red"))}function e(b,c,e,f){d(b,f),b||a.log(e,{error:!1,context:"tab",library:c})}var f=!!b("tab"),g=window,h={gaLoaded:!1,gaObjectified:!1,gptLoaded:!1,gptExecuting:!1};c.onGaLoad=function(){h.gaLoaded=!0},c.onGptExecution=function(){h.gptExecuting=!0},c.onGptLoad=function(){h.gptLoaded=!0},c.checkGaObject=function(){var a=g[g.GoogleAnalyticsObject];h.gaObjectified=a!==g.__gaIn&&42===a.answer},c.checkBlox=function(){e(h.gaLoaded,"ga","noload","analytics.js loaded"),e(h.gaObjectified,"ga","norun","GA running"),e(h.gptLoaded,"gpt","noload","gpt.js loaded"),e(h.gptExecuting,"gpt","norun","GPT running")},c.init=function(){window.setTimeout(c.checkGaObject,200),window.setTimeout(c.checkBlox,500)}}),define("global/errors",["lib/errorCollector"],function(a){"use strict";window.onerror=function(b,c,d){d&&c.match(/^https?:\/\/(?:.*\.)?(?:ted|tedcdn)\.com\//)&&(!c.match(/\.js/)&&d<5||a.log(b,{file:c,line:d}))}}),require(["jquery","lodash","dq","components/main-nav/index","global/links","global/subscribe","global/uconf","global/keyboard","global/fallback","global/track-a-block","lib/ads","lib/ga","global/errors","lib/auth","lib/instaplay","jqueryujs"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";b.defer(function(){e.init(),f.init(),h.init(),i.init(),j.init()});var m=window.console;m&&m.log&&m.log(["%cAre you a web tinkerer? Join us at TED!","https://www.ted.com/jobs"].join("\n"),"color:#E62B1E"),c({q:_g,modules:{ads:k,tab:j,ga:l,mainNav:d,uconf:g}})}),define("global",function(){}),define("talk",["jquery","dq","talk/talkPage","talk/transcript","global"],function(a,b,c,d){"use strict";b({modules:{talkPage:c,transcript:d}})})}();